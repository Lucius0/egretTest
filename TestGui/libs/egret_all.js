/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
/**
 * @namespace egret
 */
var egret;
(function (egret) {
    /**
     * @class egret.HashObject
     * @classdesc 哈希对象。引擎内所有对象的基类，为对象实例提供唯一的hashCode值,提高对象比较的性能。
     * @implements egret.IHashObject
     */
    var HashObject = (function () {
        /**
         * @method egret.HashObject#constructor
         */
        function HashObject() {
            this._hashCode = HashObject.hashCount++;
        }
        Object.defineProperty(HashObject.prototype, "hashCode", {
            /**
             * 返回此对象唯一的哈希值,用于唯一确定一个对象。hashCode为大于等于1的整数。
             * @member {number} egret.HashObject#hashCode
             */
            get: function () {
                return this._hashCode;
            },
            enumerable: true,
            configurable: true
        });
        /**
         * 哈希计数
         */
        HashObject.hashCount = 1;
        return HashObject;
    })();
    egret.HashObject = HashObject;
    HashObject.prototype.__class__ = "egret.HashObject";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.Recycler
     * @classdesc
     * 对象缓存复用工具类，可用于构建对象池，一段时间后会自动回收对象。
     * @extends egret.HashObject
     */
    var Recycler = (function (_super) {
        __extends(Recycler, _super);
        /**
         * @method egret.Recycler#constructor
         * @param autoDisposeTime {number}
         */
        function Recycler(autoDisposeTime) {
            if (autoDisposeTime === void 0) { autoDisposeTime = 300; }
            _super.call(this);
            this.objectPool = [];
            this._length = 0;
            if (autoDisposeTime < 1)
                autoDisposeTime = 1;
            this.autoDisposeTime = autoDisposeTime;
            this.frameCount = 0;
        }
        Recycler.prototype._checkFrame = function () {
            this.frameCount--;
            if (this.frameCount <= 0) {
                this.dispose();
            }
        };
        Object.defineProperty(Recycler.prototype, "length", {
            /**
             * 缓存的对象数量
             * @member {number} egret.Recycler#length
             */
            get: function () {
                return this._length;
            },
            enumerable: true,
            configurable: true
        });
        /**
         * 缓存一个对象以复用
         * @method egret.Recycler#push
         * @param object {any}
         */
        Recycler.prototype.push = function (object) {
            var pool = this.objectPool;
            if (pool.indexOf(object) == -1) {
                pool.push(object);
                this._length++;
                if (this.frameCount == 0) {
                    this.frameCount = this.autoDisposeTime;
                    Recycler._callBackList.push(this);
                }
            }
        };
        /**
         * 获取一个缓存的对象
         * @method egret.Recycler#pop
         * @returns {any}
         */
        Recycler.prototype.pop = function () {
            if (this._length == 0)
                return null;
            this._length--;
            return this.objectPool.pop();
        };
        /**
         * 立即清空所有缓存的对象。
         * @method egret.Recycler#dispose
         */
        Recycler.prototype.dispose = function () {
            if (this._length > 0) {
                this.objectPool = [];
                this._length = 0;
            }
            this.frameCount = 0;
            var list = Recycler._callBackList;
            var index = list.indexOf(this);
            if (index != -1) {
                list.splice(index, 1);
            }
        };
        Recycler._callBackList = [];
        return Recycler;
    })(egret.HashObject);
    egret.Recycler = Recycler;
    Recycler.prototype.__class__ = "egret.Recycler";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    egret.__START_TIME;
    /**
     * 用于计算相对时间。此方法返回自启动 Egret 引擎以来经过的毫秒数。
     * @method egret.getTimer
     * @returns {number} 启动 Egret 引擎以来经过的毫秒数。
     */
    function getTimer() {
        return Date.now() - egret.__START_TIME;
    }
    egret.getTimer = getTimer;
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    egret.__callLaterFunctionList = [];
    egret.__callLaterThisList = [];
    egret.__callLaterArgsList = [];
    /**
     * 延迟函数到屏幕重绘前执行。
     * @method egret.callLater
     * @param method {Function} 要延迟执行的函数
     * @param thisObject {any} 回调函数的this引用
     * @param ...args {any} 函数参数列表
     */
    function callLater(method, thisObject) {
        var args = [];
        for (var _i = 2; _i < arguments.length; _i++) {
            args[_i - 2] = arguments[_i];
        }
        egret.__callLaterFunctionList.push(method);
        egret.__callLaterThisList.push(thisObject);
        egret.__callLaterArgsList.push(args);
    }
    egret.callLater = callLater;
    egret.__callAsyncFunctionList = [];
    egret.__callAsyncThisList = [];
    egret.__callAsyncArgsList = [];
    /**
     * 异步调用函数
     * @param method {Function} 要异步调用的函数
     * @param thisObject {any} 函数的this引用
     * @param ...args {any} 函数参数列表
     */
    function __callAsync(method, thisObject) {
        var args = [];
        for (var _i = 2; _i < arguments.length; _i++) {
            args[_i - 2] = arguments[_i];
        }
        egret.__callAsyncFunctionList.push(method);
        egret.__callAsyncThisList.push(thisObject);
        egret.__callAsyncArgsList.push(args);
    }
    egret.__callAsync = __callAsync;
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret_dom;
(function (egret_dom) {
    egret_dom.header = "";
    /**
     * 获取当前浏览器的类型
     * @returns {string}
     */
    function getHeader() {
        var tempStyle = document.createElement('div').style;
        var transArr = ["t", "webkitT", "msT", "MozT", "OT"];
        for (var i = 0; i < transArr.length; i++) {
            var transform = transArr[i] + 'ransform';
            if (transform in tempStyle)
                return transArr[i];
        }
        return transArr[0];
    }
    egret_dom.getHeader = getHeader;
    /**
     * 获取当前浏览器类型
     * @type {string}
     */
    function getTrans(type) {
        if (egret_dom.header == "") {
            egret_dom.header = getHeader();
        }
        return egret_dom.header + type.substring(1, type.length);
    }
    egret_dom.getTrans = getTrans;
})(egret_dom || (egret_dom = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var Event = (function (_super) {
        __extends(Event, _super);
        /**
         * @class egret.Event
         * @classdesc
         * Event 类作为创建 Event 对象的基类，当发生事件时，Event 对象将作为参数传递给事件侦听器。
         * Event 类的属性包含有关事件的基本信息，例如事件的类型或者是否可以取消事件的默认行为。
         * 对于许多事件（如由 Event 类常量表示的事件），此基本信息就足够了。但其他事件可能需要更详细的信息。
         * 例如，与触摸关联的事件需要包括有关触摸事件的位置以及在触摸事件期间是否按下了任何键的其他信息。
         * 您可以通过扩展 Event 类（TouchEvent 类执行的操作）将此类其他信息传递给事件侦听器。
         * Egret API 为需要其他信息的常见事件定义多个 Event 子类。与每个 Event 子类关联的事件将在每个类的文档中加以介绍。
         * Event 类的方法可以在事件侦听器函数中使用以影响事件对象的行为。
         * 某些事件有关联的默认行为，通过调用 preventDefault() 方法，您的事件侦听器可以取消此行为。
         * 可以通过调用 stopPropagation() 或 stopImmediatePropagation() 方法，将当前事件侦听器作为处理事件的最后一个事件侦听器。
         * @param {string} type 事件的类型，可以作为 Event.type 访问。
         * @param bubbles{boolean} 确定 Event 对象是否参与事件流的冒泡阶段。默认值为 false。
         * @param cancelable{boolean} 确定是否可以取消 Event 对象。默认值为 false。
         */
        function Event(type, bubbles, cancelable) {
            if (bubbles === void 0) { bubbles = false; }
            if (cancelable === void 0) { cancelable = false; }
            _super.call(this);
            this._eventPhase = 2;
            this._isDefaultPrevented = false;
            this._isPropagationStopped = false;
            this._isPropagationImmediateStopped = false;
            this.isNew = true;
            this._type = type;
            this._bubbles = bubbles;
            this._cancelable = cancelable;
        }
        Object.defineProperty(Event.prototype, "type", {
            /**
             * 事件的类型。类型区分大小写。
             * @member {string} egret.Event#type
             */
            get: function () {
                return this._type;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Event.prototype, "bubbles", {
            /**
             * 表示事件是否为冒泡事件。如果事件可以冒泡，则此值为 true；否则为 false。
             * @member {boolean} egret.Event#bubbles
             */
            get: function () {
                return this._bubbles;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Event.prototype, "cancelable", {
            /**
             * 表示是否可以阻止与事件相关联的行为。如果可以取消该行为，则此值为 true；否则为 false。
             * @member {boolean} egret.Event#cancelable
             */
            get: function () {
                return this._cancelable;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Event.prototype, "eventPhase", {
            /**
             * 事件流中的当前阶段。此属性可以包含以下数值：
             * 捕获阶段 (EventPhase.CAPTURING_PHASE)。
             * 目标阶段 (EventPhase.AT_TARGET)。
             * 冒泡阶段 (EventPhase.BUBBLING_PHASE)。
             * @member {boolean} egret.Event#eventPhase
             */
            get: function () {
                return this._eventPhase;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Event.prototype, "currentTarget", {
            /**
             * 当前正在使用某个事件侦听器处理 Event 对象的对象。例如，如果用户单击“确定”按钮，
             * 则当前目标可以是包含该按钮的节点，也可以是它的已为该事件注册了事件侦听器的始祖之一。
             * @member {any} egret.Event#currentTarget
             */
            get: function () {
                return this._currentTarget;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Event.prototype, "target", {
            /**
             * 事件目标。此属性包含目标节点。例如，如果用户单击“确定”按钮，则目标节点就是包含该按钮的显示列表节点。
             * @member {any} egret.Event#target
             */
            get: function () {
                return this._target;
            },
            enumerable: true,
            configurable: true
        });
        /**
         * 检查是否已对事件调用 preventDefault() 方法。
         * @method egret.Event#isDefaultPrevented
         * @returns {boolean} 如果已调用 preventDefault() 方法，则返回 true；否则返回 false。
         */
        Event.prototype.isDefaultPrevented = function () {
            return this._isDefaultPrevented;
        };
        /**
         * 如果可以取消事件的默认行为，则取消该行为。
         * 许多事件都有默认执行的关联行为。例如，如果用户在文本字段中键入一个字符，则默认行为就是在文本字段中显示该字符。
         * 由于可以取消 TextEvent.TEXT_INPUT 事件的默认行为，因此您可以使用 preventDefault() 方法来防止显示该字符。
         * 注意：当cancelable属性为false时，此方法不可用。
         * @method egret.Event#preventDefault
         */
        Event.prototype.preventDefault = function () {
            if (this._cancelable)
                this._isDefaultPrevented = true;
        };
        /**
         * 防止对事件流中当前节点的后续节点中的所有事件侦听器进行处理。此方法不会影响当前节点 (currentTarget) 中的任何事件侦听器。
         * 相比之下，stopImmediatePropagation() 方法可以防止对当前节点中和后续节点中的事件侦听器进行处理。
         * 对此方法的其它调用没有任何效果。可以在事件流的任何阶段中调用此方法。
         * 注意：此方法不会取消与此事件相关联的行为；有关此功能的信息，请参阅 preventDefault()。
         * @method egret.Event#stopPropagation
         */
        Event.prototype.stopPropagation = function () {
            if (this._bubbles)
                this._isPropagationStopped = true;
        };
        /**
         * 防止对事件流中当前节点中和所有后续节点中的事件侦听器进行处理。此方法会立即生效，并且会影响当前节点中的事件侦听器。
         * 相比之下，在当前节点中的所有事件侦听器都完成处理之前，stopPropagation() 方法不会生效。
         * 注意：此方法不会取消与此事件相关联的行为；有关此功能的信息，请参阅 preventDefault()。
         * @method egret.Event#stopImmediatePropagation
         */
        Event.prototype.stopImmediatePropagation = function () {
            if (this._bubbles)
                this._isPropagationImmediateStopped = true;
        };
        Event.prototype._reset = function () {
            if (this.isNew) {
                this.isNew = false;
                return;
            }
            this._isDefaultPrevented = false;
            this._isPropagationStopped = false;
            this._isPropagationImmediateStopped = false;
            this._target = null;
            this._currentTarget = null;
            this._eventPhase = 2;
        };
        Event._dispatchByTarget = function (EventClass, target, type, props, bubbles, cancelable) {
            if (bubbles === void 0) { bubbles = false; }
            if (cancelable === void 0) { cancelable = false; }
            var recycler = EventClass.eventRecycler;
            if (!recycler) {
                recycler = EventClass.eventRecycler = new egret.Recycler();
            }
            var event = recycler.pop();
            if (!event) {
                event = new EventClass(type);
            }
            else {
                event._type = type;
            }
            event._bubbles = bubbles;
            event._cancelable = cancelable;
            if (props) {
                for (var key in props) {
                    event[key] = props[key];
                    if (event[key] !== null) {
                        props[key] = null;
                    }
                }
            }
            var result = target.dispatchEvent(event);
            recycler.push(event);
            return result;
        };
        Event._getPropertyData = function (EventClass) {
            var props = EventClass._props;
            if (!props)
                props = EventClass._props = {};
            return props;
        };
        /**
         * 使用指定的EventDispatcher对象来抛出Event事件对象。抛出的对象将会缓存在对象池上，供下次循环复用。
         * @method egret.Event.dispatchEvent
         */
        Event.dispatchEvent = function (target, type, bubbles, data) {
            if (bubbles === void 0) { bubbles = false; }
            var eventClass = Event;
            var props = Event._getPropertyData(eventClass);
            if (data) {
                props.data = data;
            }
            Event._dispatchByTarget(eventClass, target, type, props, bubbles);
        };
        /**
         * 在将显示对象直接添加到舞台显示列表或将包含显示对象的子树添加至舞台显示列表中时调度。
         * 以下方法会触发此事件：DisplayObjectContainer.addChild()、DisplayObjectContainer.addChildAt()。
         * @constant {string} egret.Event.ADDED_TO_STAGE
         */
        Event.ADDED_TO_STAGE = "addedToStage";
        /**
         * 在从显示列表中直接删除显示对象或删除包含显示对象的子树时调度。DisplayObjectContainer 类的以下两个方法会生成此事件：removeChild() 和 removeChildAt()。
         * 如果必须删除某个对象来为新对象提供空间，则 DisplayObjectContainer 对象的下列方法也会生成此事件：addChild()、addChildAt() 和 setChildIndex()。
         * @constant {string} egret.Event.REMOVED_FROM_STAGE
         */
        Event.REMOVED_FROM_STAGE = "removedFromStage";
        /**
         * 将显示对象添加到显示列表中时调度。以下方法会触发此事件：
         * DisplayObjectContainer.addChild()、DisplayObjectContainer.addChildAt()。
         * @constant {string} egret.Event.ADDED
         */
        Event.ADDED = "added";
        /**
         * 将要从显示列表中删除显示对象时调度。DisplayObjectContainer 类的以下两个方法会生成此事件：removeChild() 和 removeChildAt()。
         * 如果必须删除某个对象来为新对象提供空间，则 DisplayObjectContainer 对象的下列方法也会生成此事件：addChild()、addChildAt() 和 setChildIndex()。
         * @constant {string} egret.Event.REMOVED
         */
        Event.REMOVED = "removed";
        /**
         * 完成
         * @constant {string} egret.Event.COMPLETE
         */
        Event.COMPLETE = "complete";
        /**
         * 主循环：进入新的一帧
         * @constant {string} egret.Event.ENTER_FRAME
         */
        Event.ENTER_FRAME = "enterFrame";
        /**
         * 主循环：开始渲染
         * @constant {string} egret.Event.RENDER
         */
        Event.RENDER = "render";
        /**
         * 主循环：渲染完毕
         * @constant {string} egret.Event.FINISH_RENDER
         */
        Event.FINISH_RENDER = "finishRender";
        /**
         * 主循环：updateTransform完毕
         * @constant {string} egret.Event.FINISH_UPDATE_TRANSFORM
         */
        Event.FINISH_UPDATE_TRANSFORM = "finishUpdateTransform";
        /**
         * 离开舞台。
         * @constant {string} egret.Event.LEAVE_STAGE
         */
        Event.LEAVE_STAGE = "leaveStage";
        /**
         * 舞台尺寸发生改变
         * @constant {string} egret.Event.RESIZE
         */
        Event.RESIZE = "resize";
        /**
         * 状态改变
         * @constant {string} egret.Event.CHANGE
         */
        Event.CHANGE = "change";
        /**
         * 游戏激活
         * @constant {string} egret.Event.ACTIVATE
         */
        Event.ACTIVATE = "activate";
        /**
         * 取消激活
         * @constant {string} egret.Event.DEACTIVATE
         */
        Event.DEACTIVATE = "deactivate";
        /**
         * Event.CLOSE 常量定义 close 事件对象的 type 属性的值。
         * @constant {string} egret.Event.CLOSE
         */
        Event.CLOSE = "close";
        /**
         * Event.CONNECT 常量定义 connect 事件对象的 type 属性的值。
         * @constant {string} egret.Event.CONNECT
         */
        Event.CONNECT = "connect";
        return Event;
    })(egret.HashObject);
    egret.Event = Event;
    Event.prototype.__class__ = "egret.Event";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.HTTPStatusEvent
     * @classdesc
     * 在网络请求返回 HTTP 状态代码时，应用程序将调度 HTTPStatusEvent 对象。
     * 在错误或完成事件之前，将始终发送 HTTPStatusEvent 对象。HTTPStatusEvent 对象不一定表示错误条件；它仅反映网络堆栈提供的 HTTP 状态代码（如果有的话）。
     * @extends egret.Event
     */
    var HTTPStatusEvent = (function (_super) {
        __extends(HTTPStatusEvent, _super);
        /**
         * @method egret.HTTPStatusEvent#constructor
         * @param type {string}
         * @param bubbles {boolean}
         * @param cancelable {boolean}
         */
        function HTTPStatusEvent(type, bubbles, cancelable) {
            if (bubbles === void 0) { bubbles = false; }
            if (cancelable === void 0) { cancelable = false; }
            _super.call(this, type, bubbles, cancelable);
            /**
             * 由服务器返回的 HTTP 状态代码。【只读】
             * @type {number}
             * @private
             */
            this._status = 0;
        }
        Object.defineProperty(HTTPStatusEvent.prototype, "status", {
            get: function () {
                return this._status;
            },
            enumerable: true,
            configurable: true
        });
        /**
         * 使用指定的EventDispatcher对象来抛出Event事件对象。抛出的对象将会缓存在对象池上，供下次循环复用。
         * @method egret.IOErrorEvent.dispatchIOErrorEvent
         * @param target {egret.IEventDispatcher}
         */
        HTTPStatusEvent.dispatchHTTPStatusEvent = function (target, status) {
            if (HTTPStatusEvent.httpStatusEvent == null) {
                HTTPStatusEvent.httpStatusEvent = new HTTPStatusEvent(HTTPStatusEvent.HTTP_STATUS);
            }
            HTTPStatusEvent.httpStatusEvent._status = status;
            target.dispatchEvent(HTTPStatusEvent.httpStatusEvent);
        };
        /**
         * HTTPStatusEvent.HTTP_STATUS 常量定义 httpStatus 事件对象的 type 属性值。
         * @constant {string} egret.IOErrorEvent.IO_ERROR
         */
        HTTPStatusEvent.HTTP_STATUS = "httpStatus";
        HTTPStatusEvent.httpStatusEvent = null;
        return HTTPStatusEvent;
    })(egret.Event);
    egret.HTTPStatusEvent = HTTPStatusEvent;
    HTTPStatusEvent.prototype.__class__ = "egret.HTTPStatusEvent";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.IOErrorEvent
     * @classdesc IO流事件，当错误导致输入或输出操作失败时调度 IOErrorEvent 对象。
     * @extends egret.Event
     */
    var IOErrorEvent = (function (_super) {
        __extends(IOErrorEvent, _super);
        /**
         * @method egret.IOErrorEvent#constructor
         * @param type {string}
         * @param bubbles {boolean}
         * @param cancelable {boolean}
         */
        function IOErrorEvent(type, bubbles, cancelable) {
            if (bubbles === void 0) { bubbles = false; }
            if (cancelable === void 0) { cancelable = false; }
            _super.call(this, type, bubbles, cancelable);
        }
        /**
         * 使用指定的EventDispatcher对象来抛出Event事件对象。抛出的对象将会缓存在对象池上，供下次循环复用。
         * @method egret.IOErrorEvent.dispatchIOErrorEvent
         * @param target {egret.IEventDispatcher}
         */
        IOErrorEvent.dispatchIOErrorEvent = function (target) {
            var eventClass = IOErrorEvent;
            egret.Event._dispatchByTarget(eventClass, target, IOErrorEvent.IO_ERROR);
        };
        /**
         * @constant {string} egret.IOErrorEvent.IO_ERROR
         */
        IOErrorEvent.IO_ERROR = "ioError";
        return IOErrorEvent;
    })(egret.Event);
    egret.IOErrorEvent = IOErrorEvent;
    IOErrorEvent.prototype.__class__ = "egret.IOErrorEvent";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var TouchEvent = (function (_super) {
        __extends(TouchEvent, _super);
        /**
         * 创建一个作为参数传递给事件侦听器的 Event 对象。
         *
         * @class egret.TouchEvent
         * @classdesc
         * TouchEvent事件类
         * @extends egret.Event
         * @constructor egret.TouchEvent
         * @param type {string} 事件的类型，可以作为 Event.type 访问。
         * @param bubbles {boolean} 确定 Event 对象是否参与事件流的冒泡阶段。默认值为 false。
         * @param cancelable {boolean} 确定是否可以取消 Event 对象。默认值为 false。
         * @param touchPointID {number}
         * @param stageX {number}
         * @param stageY {number}
         * @param ctrlKey {boolean}
         * @param altKey {boolean}
         * @param shiftKey {boolean}
         * @param touchDown {boolean}
         */
        function TouchEvent(type, bubbles, cancelable, touchPointID, stageX, stageY, ctrlKey, altKey, shiftKey, touchDown) {
            if (bubbles === void 0) { bubbles = true; }
            if (cancelable === void 0) { cancelable = true; }
            if (touchPointID === void 0) { touchPointID = 0; }
            if (stageX === void 0) { stageX = 0; }
            if (stageY === void 0) { stageY = 0; }
            if (ctrlKey === void 0) { ctrlKey = false; }
            if (altKey === void 0) { altKey = false; }
            if (shiftKey === void 0) { shiftKey = false; }
            if (touchDown === void 0) { touchDown = false; }
            _super.call(this, type, bubbles, cancelable);
            this._stageX = 0;
            this._stageY = 0;
            this.touchPointID = touchPointID;
            this._stageX = stageX;
            this._stageY = stageY;
            this.ctrlKey = ctrlKey;
            this.altKey = altKey;
            this.touchDown = touchDown;
        }
        Object.defineProperty(TouchEvent.prototype, "stageX", {
            /**
             * 事件发生点在全局舞台坐标中的水平坐标。
             * @member {number} egret.TouchEvent#stageX
             */
            get: function () {
                return this._stageX;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TouchEvent.prototype, "stageY", {
            /**
             * 事件发生点在全局舞台坐标中的垂直坐标。
             * @member {number} egret.TouchEvent#stageY
             */
            get: function () {
                return this._stageY;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TouchEvent.prototype, "localX", {
            /**
             * 事件发生点相对于currentTarget的水平坐标。
             * @member {number} egret.TouchEvent#localX
             */
            get: function () {
                var dp = this._currentTarget;
                var point = dp.globalToLocal(this._stageX, this._stageY, egret.Point.identity);
                return point.x;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TouchEvent.prototype, "localY", {
            /**
             * 事件发生点相对于currentTarget的垂直坐标。
             * @member {number} egret.TouchEvent#localY
             */
            get: function () {
                var dp = this._currentTarget;
                var point = dp.globalToLocal(this._stageX, this._stageY, egret.Point.identity);
                return point.y;
            },
            enumerable: true,
            configurable: true
        });
        /**
         * 使用指定的EventDispatcher对象来抛出Event事件对象。抛出的对象将会缓存在对象池上，供下次循环复用。
         * @method egret.TouchEvent.dispatchTouchEvent
         * @param target {egret.IEventDispatcher}
         * @param type {string}
         * @param touchPointID {number}
         * @param stageX {number}
         * @param stageY {number}
         * @param ctrlKey {boolean}
         * @param altKey {boolean}
         * @param shiftKey {boolean}
         * @param touchDown {boolean}
         */
        TouchEvent.dispatchTouchEvent = function (target, type, touchPointID, stageX, stageY, ctrlKey, altKey, shiftKey, touchDown) {
            if (touchPointID === void 0) { touchPointID = 0; }
            if (stageX === void 0) { stageX = 0; }
            if (stageY === void 0) { stageY = 0; }
            if (ctrlKey === void 0) { ctrlKey = false; }
            if (altKey === void 0) { altKey = false; }
            if (shiftKey === void 0) { shiftKey = false; }
            if (touchDown === void 0) { touchDown = false; }
            var eventClass = TouchEvent;
            var props = egret.Event._getPropertyData(eventClass);
            props.touchPointID = touchPointID;
            props._stageX = stageX;
            props._stageY = stageY;
            props.ctrlKey = ctrlKey;
            props.altKey = altKey;
            props.shiftKey = shiftKey;
            props.touchDown = touchDown;
            egret.Event._dispatchByTarget(eventClass, target, type, props, true, true);
        };
        /**
         * 轻触
         * @constant {string} egret.TouchEvent.TOUCH_TAP
         */
        TouchEvent.TOUCH_TAP = "touchTap";
        /**
         * 移动
         * @constant {string} egret.TouchEvent.TOUCH_MOVE
         */
        TouchEvent.TOUCH_MOVE = "touchMove";
        /**
         * 开始触摸
         * @constant {string} egret.TouchEvent.TOUCH_BEGIN
         */
        TouchEvent.TOUCH_BEGIN = "touchBegin";
        /**
         * 在同一对象上结束触摸
         * @constant {string} egret.TouchEvent.TOUCH_END
         */
        TouchEvent.TOUCH_END = "touchEnd";
        /**
         * 在对象外部结束触摸
         * @constant {string} egret.TouchEvent.TOUCH_RELEASE_OUTSIDE
         */
        TouchEvent.TOUCH_RELEASE_OUTSIDE = "touchReleaseOutside";
        /**
         * @deprecated
         */
        TouchEvent.TOUCH_ROLL_OUT = "touchRollOut";
        /**
         * @deprecated
         */
        TouchEvent.TOUCH_ROLL_OVER = "touchRollOver";
        /**
         * @deprecated
         */
        TouchEvent.TOUCH_OUT = "touchOut";
        /**
         * @deprecated
         */
        TouchEvent.TOUCH_OVER = "touchOver";
        return TouchEvent;
    })(egret.Event);
    egret.TouchEvent = TouchEvent;
    TouchEvent.prototype.__class__ = "egret.TouchEvent";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
/** @namespace egret */
var egret;
(function (egret) {
    /**
     * @class egret.TimerEvent
     * @classdesc
     * 每当 Timer 对象达到由 Timer.delay 属性指定的间隔时，Timer 对象即会调度 TimerEvent 对象。
     * @extends egret.Event
     */
    var TimerEvent = (function (_super) {
        __extends(TimerEvent, _super);
        /**
         *
         * @method egret.TimerEvent#constructor
         * @param type {string} 事件的类型。事件侦听器可以通过继承的 type 属性访问此信息。
         * @param bubbles {boolean} 确定 Event 对象是否冒泡。事件侦听器可以通过继承的 bubbles 属性访问此信息。
         * @param cancelable {boolean} 确定是否可以取消 Event 对象。事件侦听器可以通过继承的 cancelable 属性访问此信息。
         */
        function TimerEvent(type, bubbles, cancelable) {
            if (bubbles === void 0) { bubbles = false; }
            if (cancelable === void 0) { cancelable = false; }
            _super.call(this, type, bubbles, cancelable);
        }
        /**
         * 使用指定的EventDispatcher对象来抛出Event事件对象。抛出的对象将会缓存在对象池上，供下次循环复用。
         * @method egret.TimerEvent.dispatchTimerEvent
         * @param target {egret.IEventDispatcher}
         * @param type {string}
         */
        TimerEvent.dispatchTimerEvent = function (target, type) {
            var eventClass = TimerEvent;
            egret.Event._dispatchByTarget(eventClass, target, type);
        };
        /**
         * 每当 Timer 对象达到根据 Timer.delay 属性指定的间隔时调度。
         * @constant {string} egret.TimerEvent.TIMER
         */
        TimerEvent.TIMER = "timer";
        /**
         * 每当它完成 Timer.repeatCount 设置的请求数后调度。
         * @constant {string} egret.TimerEvent.TIMER_COMPLETE
         */
        TimerEvent.TIMER_COMPLETE = "timerComplete";
        return TimerEvent;
    })(egret.Event);
    egret.TimerEvent = TimerEvent;
    TimerEvent.prototype.__class__ = "egret.TimerEvent";
})(egret || (egret = {}));
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    var ProgressEvent = (function (_super) {
        __extends(ProgressEvent, _super);
        /**
         * @method egret.ProgressEvent#constructor
         * @param type {string}
         * @param bubbles {boolean}
         * @param cancelable {boolean}
         * @param bytesLoaded {number}
         * @param bytesTotal {number}
         */
        function ProgressEvent(type, bubbles, cancelable, bytesLoaded, bytesTotal) {
            if (bubbles === void 0) { bubbles = false; }
            if (cancelable === void 0) { cancelable = false; }
            if (bytesLoaded === void 0) { bytesLoaded = 0; }
            if (bytesTotal === void 0) { bytesTotal = 0; }
            _super.call(this, type, bubbles, cancelable);
            this.bytesLoaded = bytesLoaded;
            this.bytesTotal = bytesTotal;
        }
        /**
         * 使用指定的EventDispatcher对象来抛出Event事件对象。抛出的对象将会缓存在对象池上，供下次循环复用。
         * @method egret.ProgressEvent.dispatchIOErrorEvent
         * @param target {egret.IEventDispatcher}
         */
        ProgressEvent.dispatchProgressEvent = function (target, type, bytesLoaded, bytesTotal) {
            if (bytesLoaded === void 0) { bytesLoaded = 0; }
            if (bytesTotal === void 0) { bytesTotal = 0; }
            egret.Event._dispatchByTarget(ProgressEvent, target, type, { "bytesLoaded": bytesLoaded, "bytesTotal": bytesTotal });
        };
        /**
         * @constant {string} egret.ProgressEvent.PROGRESS
         */
        ProgressEvent.PROGRESS = "progress";
        /**
         * @constant {string} egret.ProgressEvent.SOCKET_DATA
         */
        ProgressEvent.SOCKET_DATA = "socketData";
        return ProgressEvent;
    })(egret.Event);
    egret.ProgressEvent = ProgressEvent;
    ProgressEvent.prototype.__class__ = "egret.ProgressEvent";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    /**
     * @class egret.EventPhase
     * @classdesc
     * EventPhase 类可为 Event 类的 eventPhase 属性提供值。
     */
    var EventPhase = (function () {
        function EventPhase() {
        }
        /**
         * 捕获阶段，是事件流的第一个阶段。
         * @constant {number} egret.EventPhase.CAPTURING_PHASE
         */
        EventPhase.CAPTURING_PHASE = 1;
        /**
         * 目标阶段，是事件流的第二个阶段。
         * @constant {number} egret.EventPhase.AT_TARGET
         */
        EventPhase.AT_TARGET = 2;
        /**
         * 冒泡阶段，是事件流的第三个阶段。
         * @constant {number} egret.EventPhase.BUBBLING_PHASE
         */
        EventPhase.BUBBLING_PHASE = 3;
        return EventPhase;
    })();
    egret.EventPhase = EventPhase;
    EventPhase.prototype.__class__ = "egret.EventPhase";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     *
     * @class egret.EventDispatcher
     * @classdesc
     * EventDispatcher是egret的事件派发器类，负责进行事件的发送和侦听。
     *
     * 事件目标是事件如何通过显示列表层次结构这一问题的焦点。当发生鼠标单击、触摸或按键等事件时，
     * 引擎会将事件对象调度到从显示列表根开始的事件流中。然后该事件对象在显示列表中前进，直到到达事件目标，
     * 然后从这一点开始其在显示列表中的回程。在概念上，到事件目标的此往返行程被划分为三个阶段：
     * 捕获阶段包括从根到事件目标节点之前的最后一个节点的行程，目标阶段仅包括事件目标节点，冒泡阶段包括回程上遇到的任何后续节点到显示列表的根。
     *
     * @extends egret.HashObject
     * @implements egret.IEventDispatcher
     *
     */
    var EventDispatcher = (function (_super) {
        __extends(EventDispatcher, _super);
        /**
         * EventDispatcher 类是可调度事件的所有类的基类。EventDispatcher 类实现 IEventDispatcher 接口
         * ，并且是 DisplayObject 类的基类。EventDispatcher 类允许显示列表上的任何对象都是一个事件目标，
         * 同样允许使用 IEventDispatcher 接口的方法。
         */
        function EventDispatcher(target) {
            if (target === void 0) { target = null; }
            _super.call(this);
            if (target) {
                this._eventTarget = target;
            }
            else {
                this._eventTarget = this;
            }
        }
        /**
         * 添加事件侦听器
         * @method egret.EventDispatcher#addEventListener
         * @param type {string} 事件的类型。
         * @param listener {Function} 处理事件的侦听器函数。此函数必须接受 Event 对象作为其唯一的参数，并且不能返回任何结果，
         * 如下面的示例所示： function(evt:Event):void 函数可以有任何名称。
         * @param thisObject {any} 侦听函数绑定的this对象
         * @param useCapture {boolean} 确定侦听器是运行于捕获阶段还是运行于目标和冒泡阶段。如果将 useCapture 设置为 true，
         * 则侦听器只在捕获阶段处理事件，而不在目标或冒泡阶段处理事件。如果 useCapture 为 false，则侦听器只在目标或冒泡阶段处理事件。
         * 要在所有三个阶段都侦听事件，请调用 addEventListener 两次：一次将 useCapture 设置为 true，一次将 useCapture 设置为 false。
         * @param  priority {number} 事件侦听器的优先级。优先级由一个带符号的 32 位整数指定。数字越大，优先级越高。优先级为 n 的所有侦听器会在
         * 优先级为 n -1 的侦听器之前得到处理。如果两个或更多个侦听器共享相同的优先级，则按照它们的添加顺序进行处理。默认优先级为 0。
         */
        EventDispatcher.prototype.addEventListener = function (type, listener, thisObject, useCapture, priority) {
            if (useCapture === void 0) { useCapture = false; }
            if (priority === void 0) { priority = 0; }
            if (typeof useCapture === "undefined") {
                useCapture = false;
            }
            if (typeof priority === "undefined") {
                priority = 0;
            }
            if (!listener) {
                egret.Logger.fatal("addEventListener侦听函数不能为空");
            }
            var eventMap;
            if (useCapture) {
                if (!this._captureEventsMap)
                    this._captureEventsMap = {};
                eventMap = this._captureEventsMap;
            }
            else {
                if (!this._eventsMap)
                    this._eventsMap = {};
                eventMap = this._eventsMap;
            }
            var list = eventMap[type];
            if (!list) {
                list = eventMap[type] = [];
            }
            this._insertEventBin(list, listener, thisObject, priority);
        };
        /**
         * 在一个事件列表中按优先级插入事件对象
         */
        EventDispatcher.prototype._insertEventBin = function (list, listener, thisObject, priority, display) {
            if (display === void 0) { display = undefined; }
            var insertIndex = -1;
            var length = list.length;
            for (var i = 0; i < length; i++) {
                var bin = list[i];
                if (bin.listener === listener && bin.thisObject === thisObject && bin.display === display) {
                    return false;
                }
                if (insertIndex == -1 && bin.priority < priority) {
                    insertIndex = i;
                }
            }
            var eventBin = { listener: listener, thisObject: thisObject, priority: priority };
            if (display) {
                eventBin.display = display;
            }
            if (insertIndex != -1) {
                list.splice(insertIndex, 0, eventBin);
            }
            else {
                list.push(eventBin);
            }
            return true;
        };
        /**
         * 移除事件侦听器
         * @method egret.EventDispatcher#removeEventListener
         * @param type {string} 事件名
         * @param listener {Function} 侦听函数
         * @param thisObject {any} 侦听函数绑定的this对象
         * @param useCapture {boolean} 是否使用捕获，这个属性只在显示列表中生效。
         */
        EventDispatcher.prototype.removeEventListener = function (type, listener, thisObject, useCapture) {
            if (useCapture === void 0) { useCapture = false; }
            var eventMap = useCapture ? this._captureEventsMap : this._eventsMap;
            if (!eventMap)
                return;
            var list = eventMap[type];
            if (!list) {
                return;
            }
            this._removeEventBin(list, listener, thisObject);
            if (list.length == 0) {
                delete eventMap[type];
            }
        };
        /**
         * 在一个事件列表中按优先级插入事件对象
         */
        EventDispatcher.prototype._removeEventBin = function (list, listener, thisObject, display) {
            if (display === void 0) { display = undefined; }
            var length = list.length;
            for (var i = 0; i < length; i++) {
                var bin = list[i];
                if (bin.listener === listener && bin.thisObject === thisObject && bin.display === display) {
                    list.splice(i, 1);
                    return true;
                }
            }
            return false;
        };
        /**
         * 检测是否存在监听器
         * @method egret.EventDispatcher#hasEventListener
         * @param type {string} 事件类型
         * @returns {boolean}
         * @stable A
         */
        EventDispatcher.prototype.hasEventListener = function (type) {
            return (this._eventsMap && this._eventsMap[type] || this._captureEventsMap && this._captureEventsMap[type]);
        };
        /**
         * 检查是否用此 EventDispatcher 对象或其任何始祖为指定事件类型注册了事件侦听器。将指定类型的事件调度给此
         * EventDispatcher 对象或其任一后代时，如果在事件流的任何阶段触发了事件侦听器，则此方法返回 true。
         * hasEventListener() 与 willTrigger() 方法的区别是：hasEventListener() 只检查它所属的对象，
         * 而 willTrigger() 方法检查整个事件流以查找由 type 参数指定的事件。
         * @method egret.EventDispatcher#willTrigger
         * @param type {string} 事件类型
         * @returns {boolean} 是否注册过监听器，如果注册过返回true，反之返回false
         */
        EventDispatcher.prototype.willTrigger = function (type) {
            return this.hasEventListener(type);
        };
        /**
         * 将事件分派到事件流中。事件目标是对其调用 dispatchEvent() 方法的 EventDispatcher 对象。
         * @method egret.EventDispatcher#dispatchEvent
         * @param event {egret.Event} 调度到事件流中的 Event 对象。如果正在重新分派事件，则会自动创建此事件的一个克隆。 在调度了事件后，其 _eventTarget 属性将无法更改，因此您必须创建此事件的一个新副本以能够重新调度。
         * @returns {boolean} 如果成功调度了事件，则值为 true。值 false 表示失败或对事件调用了 preventDefault()。
         */
        EventDispatcher.prototype.dispatchEvent = function (event) {
            event._reset();
            event._target = this._eventTarget;
            event._currentTarget = this._eventTarget;
            return this._notifyListener(event);
        };
        EventDispatcher.prototype._notifyListener = function (event) {
            var eventMap = event._eventPhase == 1 ? this._captureEventsMap : this._eventsMap;
            if (!eventMap) {
                return true;
            }
            var list = eventMap[event._type];
            if (!list) {
                return true;
            }
            var length = list.length;
            if (length == 0) {
                return true;
            }
            list = list.concat();
            for (var i = 0; i < length; i++) {
                var eventBin = list[i];
                eventBin.listener.call(eventBin.thisObject, event);
                if (event._isPropagationImmediateStopped) {
                    break;
                }
            }
            return !event._isDefaultPrevented;
        };
        /**
         * 派发一个包含了特定参数的事件到所有注册了特定类型侦听器的对象中。 这个方法使用了一个内部的事件对象池因避免重复的分配导致的额外开销。
         * @method egret.EventDispatcher#dispatchEventWith
         * @param type {string} 事件类型
         * @param bubbles {boolean} 是否冒泡，默认false
         * @param data {any}附加数据(可选)
         */
        EventDispatcher.prototype.dispatchEventWith = function (type, bubbles, data) {
            if (bubbles === void 0) { bubbles = false; }
            egret.Event.dispatchEvent(this, type, bubbles, data);
        };
        return EventDispatcher;
    })(egret.HashObject);
    egret.EventDispatcher = EventDispatcher;
    EventDispatcher.prototype.__class__ = "egret.EventDispatcher";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.MainContext
     * @classdesc
     * MainContext是游戏的核心跨平台接口，组合了多个功能Context，并是游戏启动的主入口
     * @extends egret.EventDispatcher
     */
    var MainContext = (function (_super) {
        __extends(MainContext, _super);
        function MainContext() {
            _super.call(this);
            this.reuseEvent = new egret.Event("");
        }
        /**
         * 游戏启动，开启主循环，参考Flash的滑动跑道模型
         * @method egret.MainContext#run
         */
        MainContext.prototype.run = function () {
            egret.Ticker.getInstance().run();
            egret.Ticker.getInstance().register(this.renderLoop, this, Number.NEGATIVE_INFINITY);
            egret.Ticker.getInstance().register(this.broadcastEnterFrame, this, Number.POSITIVE_INFINITY);
            this.touchContext.run();
        };
        /**
         * 滑动跑道模型，渲染部分
         */
        MainContext.prototype.renderLoop = function (frameTime) {
            if (egret.__callLaterFunctionList.length > 0) {
                var functionList = egret.__callLaterFunctionList;
                egret.__callLaterFunctionList = [];
                var thisList = egret.__callLaterThisList;
                egret.__callLaterThisList = [];
                var argsList = egret.__callLaterArgsList;
                egret.__callLaterArgsList = [];
            }
            var stage = this.stage;
            var event = MainContext.cachedEvent;
            event._type = egret.Event.RENDER;
            this.dispatchEvent(event);
            if (egret.Stage._invalidateRenderFlag) {
                this.broadcastRender();
                egret.Stage._invalidateRenderFlag = false;
            }
            if (functionList) {
                this.doCallLaterList(functionList, thisList, argsList);
            }
            if (egret.__callAsyncFunctionList.length > 0) {
                this.doCallAsyncList();
            }
            var context = this.rendererContext;
            context.onRenderStart();
            context.clearScreen();
            stage._updateTransform();
            event._type = egret.Event.FINISH_UPDATE_TRANSFORM;
            this.dispatchEvent(event);
            stage._draw(context);
            event._type = egret.Event.FINISH_RENDER;
            this.dispatchEvent(event);
            context.onRenderFinish();
        };
        /**
         * 广播EnterFrame事件。
         */
        MainContext.prototype.broadcastEnterFrame = function (frameTime) {
            var event = this.reuseEvent;
            event._type = egret.Event.ENTER_FRAME;
            this.dispatchEvent(event);
            var list = egret.DisplayObject._enterFrameCallBackList.concat();
            var length = list.length;
            for (var i = 0; i < length; i++) {
                var eventBin = list[i];
                event._target = eventBin.display;
                event._currentTarget = eventBin.display;
                eventBin.listener.call(eventBin.thisObject, event);
            }
            list = egret.Recycler._callBackList;
            for (i = list.length - 1; i >= 0; i--) {
                list[i]._checkFrame();
            }
        };
        /**
         * 广播Render事件。
         */
        MainContext.prototype.broadcastRender = function () {
            var event = this.reuseEvent;
            event._type = egret.Event.RENDER;
            var list = egret.DisplayObject._renderCallBackList.concat();
            var length = list.length;
            for (var i = 0; i < length; i++) {
                var eventBin = list[i];
                var target = eventBin.display;
                event._target = target;
                event._currentTarget = target;
                eventBin.listener.call(eventBin.thisObject, event);
            }
        };
        /**
         * 执行callLater回调函数列表
         */
        MainContext.prototype.doCallLaterList = function (funcList, thisList, argsList) {
            var length = funcList.length;
            for (var i = 0; i < length; i++) {
                var func = funcList[i];
                if (func != null) {
                    func.apply(thisList[i], argsList[i]);
                }
            }
        };
        /**
         * 执行callAsync回调函数列表
         */
        MainContext.prototype.doCallAsyncList = function () {
            var locCallAsyncFunctionList = egret.__callAsyncFunctionList.concat();
            var locCallAsyncThisList = egret.__callAsyncThisList.concat();
            var locCallAsyncArgsList = egret.__callAsyncArgsList.concat();
            egret.__callAsyncFunctionList.length = 0;
            egret.__callAsyncThisList.length = 0;
            egret.__callAsyncArgsList.length = 0;
            for (var i = 0; i < locCallAsyncFunctionList.length; i++) {
                var func = locCallAsyncFunctionList[i];
                if (func != null) {
                    func.apply(locCallAsyncThisList[i], locCallAsyncArgsList[i]);
                }
            }
        };
        MainContext.DEVICE_PC = "web";
        MainContext.DEVICE_MOBILE = "native";
        MainContext.RUNTIME_HTML5 = "runtime_html5";
        MainContext.RUNTIME_NATIVE = "runtime_native";
        MainContext.cachedEvent = new egret.Event("");
        return MainContext;
    })(egret.EventDispatcher);
    egret.MainContext = MainContext;
    MainContext.prototype.__class__ = "egret.MainContext";
})(egret || (egret = {}));
var testDeviceType = function () {
    if (!this["navigator"]) {
        return true;
    }
    var ua = navigator.userAgent.toLowerCase();
    return (ua.indexOf('mobile') != -1 || ua.indexOf('android') != -1);
};
var testRuntimeType = function () {
    if (this["navigator"]) {
        return true;
    }
    return false;
};
egret.MainContext.instance = new egret.MainContext();
egret.MainContext.deviceType = testDeviceType() ? egret.MainContext.DEVICE_MOBILE : egret.MainContext.DEVICE_PC;
egret.MainContext.runtimeType = testRuntimeType() ? egret.MainContext.RUNTIME_HTML5 : egret.MainContext.RUNTIME_NATIVE;
delete testDeviceType;
delete testRuntimeType;
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    /**
     * @class egret.Profiler
     * @classdesc
     * Profiler是egret的性能检测分析类
     * 请使用 egret.Profiler.getInstance().run();打开性能分析显示。
     */
    var Profiler = (function () {
        function Profiler() {
            this._lastTime = 0;
            this._logicPerformanceCost = 0;
            this._renderPerformanceCost = 0;
            this._updateTransformPerformanceCost = 0;
            this._preDrawCount = 0;
            this._tick = 0;
            this._maxDeltaTime = 500;
            this._totalDeltaTime = 0;
        }
        /**
         * 返回系统中唯一的Profiler实例。
         * @returns {Profiler}
         */
        Profiler.getInstance = function () {
            if (Profiler.instance == null) {
                Profiler.instance = new Profiler();
            }
            return Profiler.instance;
        };
        /**
         * 启动Profiler
         * @method egret.Profiler#run
         */
        Profiler.prototype.run = function () {
            //todo 加入debug参数
            egret.Ticker.getInstance().register(this.update, this);
            if (this._txt == null) {
                this._txt = new egret.TextField();
                this._txt.size = 28;
                this._txt.multiline = true;
                egret.MainContext.instance.stage.addChild(this._txt);
            }
            var context = egret.MainContext.instance;
            context.addEventListener(egret.Event.ENTER_FRAME, this.onEnterFrame, this);
            context.addEventListener(egret.Event.RENDER, this.onStartRender, this);
            context.addEventListener(egret.Event.FINISH_RENDER, this.onFinishRender, this);
            context.addEventListener(egret.Event.FINISH_UPDATE_TRANSFORM, this.onFinishUpdateTransform, this);
        };
        /**
         * @private
         */
        Profiler.prototype.onEnterFrame = function (event) {
            this._lastTime = egret.getTimer();
        };
        /**
         * @private
         */
        Profiler.prototype.onStartRender = function (event) {
            var now = egret.getTimer();
            this._logicPerformanceCost = now - this._lastTime;
            this._lastTime = now;
        };
        Profiler.prototype.onFinishUpdateTransform = function (event) {
            var now = egret.getTimer();
            this._updateTransformPerformanceCost = now - this._lastTime;
            this._lastTime = now;
        };
        /**
         * @private
         */
        Profiler.prototype.onFinishRender = function (event) {
            var now = egret.getTimer();
            this._renderPerformanceCost = now - this._lastTime;
            this._lastTime = now;
        };
        /**
         * @private
         */
        Profiler.prototype.update = function (frameTime) {
            this._tick++;
            this._totalDeltaTime += frameTime;
            if (this._totalDeltaTime >= this._maxDeltaTime) {
                var drawStr = (this._preDrawCount - 1).toString();
                var timeStr = Math.ceil(this._logicPerformanceCost).toString() + "," + Math.ceil(this._updateTransformPerformanceCost).toString() + "," + Math.ceil(this._renderPerformanceCost).toString() + "," + Math.ceil(egret.MainContext.instance.rendererContext.renderCost).toString();
                var frameStr = Math.floor(this._tick * 1000 / this._totalDeltaTime).toString();
                this._txt.text = "draw:" + drawStr + "\n" + "cost:" + timeStr + "\n" + "FPS:" + frameStr;
                this._totalDeltaTime = 0;
                this._tick = 0;
            }
            this._preDrawCount = 0;
        };
        /**
         * @method egret.Profiler#onDrawImage
         * @private
         */
        Profiler.prototype.onDrawImage = function () {
            this._preDrawCount++;
        };
        return Profiler;
    })();
    egret.Profiler = Profiler;
    Profiler.prototype.__class__ = "egret.Profiler";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.Ticker
     * @classdesc
     * Ticker是egret引擎的心跳控制器，是游戏唯一的时间处理入口。开发者务必不要使用setTimeout / setInterval 等方法，而是统一使用Ticker
     * @extends egret.EventDispatcher
     */
    var Ticker = (function (_super) {
        __extends(Ticker, _super);
        function Ticker() {
            _super.apply(this, arguments);
            this._timeScale = 1;
            this._paused = false;
            this.callBackList = [];
        }
        /**
         * 启动心跳控制器。
         * 这个函数应只在游戏初始化时调用一次
         * @method egret.Ticker#run
         * @stable A
         */
        Ticker.prototype.run = function () {
            egret.__START_TIME = new Date().getTime();
            var context = egret.MainContext.instance.deviceContext;
            context.executeMainLoop(this.update, this);
        };
        Ticker.prototype.update = function (advancedTime) {
            var list = this.callBackList.concat();
            var length = list.length;
            var frameTime = advancedTime * this._timeScale;
            frameTime *= this._timeScale;
            for (var i = 0; i < length; i++) {
                var eventBin = list[i];
                eventBin.listener.call(eventBin.thisObject, frameTime);
            }
        };
        /**
         * 注册帧回调事件，同一函数的重复监听会被忽略。
         * @method egret.Ticker#register
         * @param listener {Function} 帧回调函数,参数返回上一帧和这帧的间隔时间。示例：onEnterFrame(frameTime:number):void
         * @param thisObject {any} 帧回调函数的this对象
         * @param priority {any} 事件优先级，开发者请勿传递 Number.NEGATIVE_INFINITY 和 Number.POSITIVE_INFINITY
         * @stable A-
         */
        Ticker.prototype.register = function (listener, thisObject, priority) {
            if (priority === void 0) { priority = 0; }
            var list = this.callBackList;
            this._insertEventBin(list, listener, thisObject, priority);
        };
        /**
         * 取消侦听enterFrame事件
         * @method egret.Ticker#unregister
         * @param listener {Function} 事件侦听函数
         * @param thisObject {any} 侦听函数的this对象
         * @stable A-
         */
        Ticker.prototype.unregister = function (listener, thisObject) {
            var list = this.callBackList;
            this._removeEventBin(list, listener, thisObject);
        };
        /**
         * 在指定的延迟（以毫秒为单位）后运行指定的函数。
         * @method egret.Ticker#setTimeout
         * @param listener {Function}
         * @param thisObject {any}
         * @param delay {number}
         * @param ...parameter {any}
         * @deprecated
         */
        Ticker.prototype.setTimeout = function (listener, thisObject, delay) {
            var parameters = [];
            for (var _i = 3; _i < arguments.length; _i++) {
                parameters[_i - 3] = arguments[_i];
            }
            egret.Logger.warning("Ticker#setTimeout方法即将废弃,请使用egret.setTimeout");
            egret.setTimeout.apply(null, [listener, thisObject, delay].concat(parameters));
        };
        /**
         * @method egret.Ticker#setTimeScale
         * @param timeScale {number}
         */
        Ticker.prototype.setTimeScale = function (timeScale) {
            this._timeScale = timeScale;
        };
        /**
         * @method egret.Ticker#getTimeScale
         */
        Ticker.prototype.getTimeScale = function () {
            return this._timeScale;
        };
        /**
         * @method egret.Ticker#pause
         */
        Ticker.prototype.pause = function () {
            this._paused = true;
        };
        /**
         * @method egret.Ticker#resume
         */
        Ticker.prototype.resume = function () {
            this._paused = false;
        };
        /**
         * @method egret.Ticker.getInstance
         * @returns {Ticker}
         */
        Ticker.getInstance = function () {
            if (Ticker.instance == null) {
                Ticker.instance = new Ticker();
            }
            return Ticker.instance;
        };
        return Ticker;
    })(egret.EventDispatcher);
    egret.Ticker = Ticker;
    Ticker.prototype.__class__ = "egret.Ticker";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    /**
     * @class egret.HorizontalAlign
     * @classdesc 水平对齐方式
     */
    var HorizontalAlign = (function () {
        function HorizontalAlign() {
        }
        /**
         * 左对齐
         * @constant egret.HorizontalAlign.LEFT
         */
        HorizontalAlign.LEFT = "left";
        /**
         * 右对齐
         * @constant egret.HorizontalAlign.RIGHT
         */
        HorizontalAlign.RIGHT = "right";
        /**
         * 水平居中对齐
         * @constant egret.HorizontalAlign.CENTER
         */
        HorizontalAlign.CENTER = "center";
        /**
         * 水平两端对齐
         * 注意：TextFiled不支持此对齐方式。
         * @constant egret.HorizontalAlign.JUSTIFY
         */
        HorizontalAlign.JUSTIFY = "justify";
        /**
         * 相对于容器对子项进行内容对齐。这会将所有子项的大小统一调整为容器的"内容宽度"。
         * 容器的"内容宽度"是最大子项的大小,如果所有子项都小于容器的宽度，则会将所有子项的大小调整为容器的宽度。
         * 注意：TextFiled不支持此对齐方式。
         * @constant egret.HorizontalAlign.CONTENT_JUSTIFY
         */
        HorizontalAlign.CONTENT_JUSTIFY = "contentJustify";
        return HorizontalAlign;
    })();
    egret.HorizontalAlign = HorizontalAlign;
    HorizontalAlign.prototype.__class__ = "egret.HorizontalAlign";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    /**
     * @class egret.VerticalAlign
     * @classdesc 垂直对齐方式
     */
    var VerticalAlign = (function () {
        function VerticalAlign() {
        }
        /**
         * 顶对齐
         * @constant egret.VerticalAlign.TOP
         */
        VerticalAlign.TOP = "top";
        /**
         * 底对齐
         * @constant egret.VerticalAlign.BOTTOM
         */
        VerticalAlign.BOTTOM = "bottom";
        /**
         * 垂直居中对齐
         * @constant egret.VerticalAlign.MIDDLE
         */
        VerticalAlign.MIDDLE = "middle";
        /**
         * 垂直两端对齐
         * 注意：TextFiled不支持此对齐方式。
         * @constant egret.VerticalAlign.JUSTIFY
         */
        VerticalAlign.JUSTIFY = "justify";
        /**
         * 相对于容器对子项进行内容对齐。这会将所有子项的大小统一调整为容器的"内容高度"。
         * 容器的"内容高度"是最大子项的大小,如果所有子项都小于容器的高度，则会将所有子项的大小调整为容器的高度。
         * 注意：TextFiled不支持此对齐方式。
         * @constant egret.VerticalAlign.CONTENT_JUSTIFY
         */
        VerticalAlign.CONTENT_JUSTIFY = "contentJustify";
        return VerticalAlign;
    })();
    egret.VerticalAlign = VerticalAlign;
    VerticalAlign.prototype.__class__ = "egret.VerticalAlign";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.Timer
     * @classdesc
     * @extends egret.EventDispatcher
     */
    var Timer = (function (_super) {
        __extends(Timer, _super);
        function Timer(delay, repeatCount) {
            if (repeatCount === void 0) { repeatCount = 0; }
            _super.call(this);
            this._currentCount = 0;
            this.delay = delay;
            this.repeatCount = repeatCount;
        }
        /**
         * @method egret.Timer#currentCount
         * @returns {number}
         */
        Timer.prototype.currentCount = function () {
            return this._currentCount;
        };
        Object.defineProperty(Timer.prototype, "running", {
            /**
             * @member {boolean} egret.Timer#running
             */
            get: function () {
                return this._running;
            },
            enumerable: true,
            configurable: true
        });
        /**
         * @method egret.Timer#reset
         */
        Timer.prototype.reset = function () {
            this.stop();
            this._currentCount = 0;
        };
        /**
         * @method egret.Timer#start
         */
        Timer.prototype.start = function () {
            if (this._running)
                return;
            this.lastTime = egret.getTimer();
            if (this._currentCount != 0) {
                this._currentCount = 0;
            }
            egret.Ticker.getInstance().register(this.onEnterFrame, this);
            this._running = true;
        };
        /**
         * @method egret.Timer#stop
         */
        Timer.prototype.stop = function () {
            if (!this._running)
                return;
            egret.Ticker.getInstance().unregister(this.onEnterFrame, this);
            this._running = false;
        };
        Timer.prototype.onEnterFrame = function (frameTime) {
            var now = egret.getTimer();
            var passTime = now - this.lastTime;
            if (passTime > this.delay) {
                this.lastTime = now;
                this._currentCount++;
                egret.TimerEvent.dispatchTimerEvent(this, egret.TimerEvent.TIMER);
                if (this.repeatCount > 0 && this._currentCount >= this.repeatCount) {
                    this.stop();
                    egret.TimerEvent.dispatchTimerEvent(this, egret.TimerEvent.TIMER_COMPLETE);
                }
            }
        };
        return Timer;
    })(egret.EventDispatcher);
    egret.Timer = Timer;
    Timer.prototype.__class__ = "egret.Timer";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    /**
     * 返回一个对象的完全限定名<br/>
     * @method egret.getQualifiedClassName
     * @param value {any} 需要完全限定类名称的对象，可以将任何 TypeScript / JavaScript值传递给此方法，包括所有可用的TypeScript / JavaScript类型、对象实例、原始类型（如number）和类对象
     * @returns {string}
     * @example
     *  egret.getQualifiedClassName(egret.DisplayObject) //返回 "egret.DisplayObject"
     */
    function getQualifiedClassName(value) {
        var prototype = value.prototype ? value.prototype : Object.getPrototypeOf(value);
        if (prototype.hasOwnProperty("__class__")) {
            return prototype["__class__"];
        }
        var constructorString = prototype.constructor.toString();
        var index = constructorString.indexOf("(");
        var className = constructorString.substring(9, index);
        Object.defineProperty(prototype, "__class__", {
            value: className,
            enumerable: false,
            writable: true
        });
        return className;
    }
    egret.getQualifiedClassName = getQualifiedClassName;
    /**
    * 返回一个对象的父类完全限定名<br/>
    * @method egret.getQualifiedSuperclassName
    * @param value {any} 需要取得父类的对象，可以将任何 TypeScript / JavaScript值传递给此方法，包括所有可用的TypeScript / JavaScript类型、对象实例、原始类型（如number）和类对象
    * @returns {Function}
    * @example
    *  egret.getQualifiedSuperclassName(egret.DisplayObjectContainer) //返回 "egret.DisplayObject"
    */
    function getQualifiedSuperclassName(value) {
        var prototype = value.prototype ? value.prototype : Object.getPrototypeOf(value);
        if (prototype.hasOwnProperty("__superclass__")) {
            return prototype["__superclass__"];
        }
        var superProto = Object.getPrototypeOf(prototype);
        if (superProto == null)
            return null;
        var superClass = getQualifiedClassName(superProto.constructor);
        if (!superClass)
            return null;
        Object.defineProperty(prototype, "__superclass__", {
            value: superClass,
            enumerable: false,
            writable: true
        });
        return superClass;
    }
    egret.getQualifiedSuperclassName = getQualifiedSuperclassName;
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    var __getDefinitionByName__cache = {};
    /**
     * 返回 name 参数指定的类的类对象引用。
     * @method egret.getDefinitionByName
     * @param name {string} 类的名称。
     * @returns {any}
     * @example
     * egret.getDefinitionByName("egret.DisplayObject") //返回 DisplayObject类定义
     */
    function getDefinitionByName(name) {
        if (!name)
            return null;
        var definition = __getDefinitionByName__cache[name];
        if (definition) {
            return definition;
        }
        var paths = name.split(".");
        var length = paths.length;
        definition = __global;
        for (var i = 0; i < length; i++) {
            var path = paths[i];
            definition = definition[path];
            if (!definition) {
                return null;
            }
        }
        __getDefinitionByName__cache[name] = definition;
        return definition;
    }
    egret.getDefinitionByName = getDefinitionByName;
})(egret || (egret = {}));
var __global = __global || this;
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    var __setTimeout__cache = {};
    var __setTimeout__index = 0;
    /**
     * 在指定的延迟（以毫秒为单位）后运行指定的函数。
     * @method egret.setTimeout
     * @param listener {Function} 侦听函数
     * @param thisObject {any} this对象
     * @param delay {number} 延迟时间，以毫秒为单位
     * @param ...args {any} 参数列表
     * @returns {number} 返回索引，可以用于 clearTimeout
     */
    function setTimeout(listener, thisObject, delay) {
        var args = [];
        for (var _i = 3; _i < arguments.length; _i++) {
            args[_i - 3] = arguments[_i];
        }
        var data = { listener: listener, thisObject: thisObject, delay: delay, params: args };
        if (__setTimeout__index == 0) {
            egret.Ticker.getInstance().register(timeoutUpdate, null);
        }
        __setTimeout__index++;
        __setTimeout__cache[__setTimeout__index] = data;
        return __setTimeout__index;
    }
    egret.setTimeout = setTimeout;
    /**
     * 清除指定延迟后运行的函数。
     * @method egret.clearTimeout
     * @param key {number}
     */
    function clearTimeout(key) {
        delete __setTimeout__cache[key];
    }
    egret.clearTimeout = clearTimeout;
    function timeoutUpdate(dt) {
        for (var key in __setTimeout__cache) {
            var data = __setTimeout__cache[key];
            data.delay -= dt;
            if (data.delay <= 0) {
                data.listener.apply(data.thisObject, data.params);
                delete __setTimeout__cache[key];
            }
        }
    }
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    /**
     * 检查指定的应用程序域之内是否存在一个公共定义。该定义可以是一个类、一个命名空间或一个函数的定义。
    * @method egret.hasDefinition
     * @param name {string} 定义的名称。
    * @returns {boolean}
     * @example
     * egret.hasDefinition("egret.DisplayObject") //返回 true
     */
    function hasDefinition(name) {
        var definition = egret.getDefinitionByName(name);
        return definition ? true : false;
    }
    egret.hasDefinition = hasDefinition;
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    /**
     * 转换数字为颜色字符串
     * @method egret.toColorString
     * @param value {number}
     * @returns {string}
     */
    function toColorString(value) {
        if (isNaN(value) || value < 0)
            value = 0;
        if (value > 16777215)
            value = 16777215;
        var color = value.toString(16).toUpperCase();
        while (color.length < 6) {
            color = "0" + color;
        }
        return "#" + color;
    }
    egret.toColorString = toColorString;
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.Matrix
     * @classdesc
     * 2D矩阵类，包括常见矩阵算法
     * @extends egret.HashObject
     */
    var Matrix = (function (_super) {
        __extends(Matrix, _super);
        /**
         * @method egret.Matrix#constructor
         * @param a {number} 缩放或旋转图像时影响像素沿 x 轴定位的值。
         * @param b {number} 旋转或倾斜图像时影响像素沿 y 轴定位的值。
         * @param c {number} 旋转或倾斜图像时影响像素沿 x 轴定位的值。
         * @param d {number} 缩放或旋转图像时影响像素沿 y 轴定位的值。
         * @param tx {number} 沿 x 轴平移每个点的距离。
         * @param ty {number} 沿 y 轴平移每个点的距离。
         */
        function Matrix(a, b, c, d, tx, ty) {
            if (a === void 0) { a = 1; }
            if (b === void 0) { b = 0; }
            if (c === void 0) { c = 0; }
            if (d === void 0) { d = 1; }
            if (tx === void 0) { tx = 0; }
            if (ty === void 0) { ty = 0; }
            _super.call(this);
            this.a = a;
            this.b = b;
            this.c = c;
            this.d = d;
            this.tx = tx;
            this.ty = ty;
        }
        /**
         * 前置矩阵
         * @method egret.Matrix#prepend
         * @param a {number}
         * @param b {number}
         * @param c {number}
         * @param d {number}
         * @param tx {number}
         * @param ty {number}
         * @returns {egret.Matrix}
         */
        Matrix.prototype.prepend = function (a, b, c, d, tx, ty) {
            var tx1 = this.tx;
            if (a != 1 || b != 0 || c != 0 || d != 1) {
                var a1 = this.a;
                var c1 = this.c;
                this.a = a1 * a + this.b * c;
                this.b = a1 * b + this.b * d;
                this.c = c1 * a + this.d * c;
                this.d = c1 * b + this.d * d;
            }
            this.tx = tx1 * a + this.ty * c + tx;
            this.ty = tx1 * b + this.ty * d + ty;
            return this;
        };
        /**
         * 后置矩阵
         * @method egret.Matrix#append
         * @param a {number}
         * @param b {number}
         * @param c {number}
         * @param d {number}
         * @param tx {number}
         * @param ty {number}
         * @returns {egret.Matrix}
         */
        Matrix.prototype.append = function (a, b, c, d, tx, ty) {
            var a1 = this.a;
            var b1 = this.b;
            var c1 = this.c;
            var d1 = this.d;
            if (a != 1 || b != 0 || c != 0 || d != 1) {
                this.a = a * a1 + b * c1;
                this.b = a * b1 + b * d1;
                this.c = c * a1 + d * c1;
                this.d = c * b1 + d * d1;
            }
            this.tx = tx * a1 + ty * c1 + this.tx;
            this.ty = tx * b1 + ty * d1 + this.ty;
            return this;
        };
        /**
         * 前置矩阵
         * @method egret.Matrix#prependTransform
         * @param x {number}
         * @param y {number}
         * @param scaleX {number}
         * @param scaleY {number}
         * @param rotation {number}
         * @param skewX {number}
         * @param skewY {number}
         * @param regX {number}
         * @param regY {number}
         * @returns {egret.Matrix}
         */
        Matrix.prototype.prependTransform = function (x, y, scaleX, scaleY, rotation, skewX, skewY, regX, regY) {
            if (rotation % 360) {
                var r = rotation; // * Matrix.DEG_TO_RAD;
                var cos = egret.NumberUtils.cos(r);
                var sin = egret.NumberUtils.sin(r);
            }
            else {
                cos = 1;
                sin = 0;
            }
            if (regX || regY) {
                // append the registration offset:
                this.tx -= regX;
                this.ty -= regY;
            }
            if (skewX || skewY) {
                // TODO: can this be combined into a single prepend operation?
                //                skewX *= Matrix.DEG_TO_RAD;
                //                skewY *= Matrix.DEG_TO_RAD;
                this.prepend(cos * scaleX, sin * scaleX, -sin * scaleY, cos * scaleY, 0, 0);
                this.prepend(egret.NumberUtils.cos(skewY), egret.NumberUtils.sin(skewY), -egret.NumberUtils.sin(skewX), egret.NumberUtils.cos(skewX), x, y);
            }
            else {
                this.prepend(cos * scaleX, sin * scaleX, -sin * scaleY, cos * scaleY, x, y);
            }
            return this;
        };
        /**
         * 后置矩阵
         * @method egret.Matrix#appendTransform
         * @param x {number}
         * @param y {number}
         * @param scaleX {number}
         * @param scaleY {number}
         * @param rotation {number}
         * @param skewX {number}
         * @param skewY {number}
         * @param regX {number}
         * @param regY {number}
         * @returns {egret.Matrix}
         */
        Matrix.prototype.appendTransform = function (x, y, scaleX, scaleY, rotation, skewX, skewY, regX, regY) {
            if (rotation % 360) {
                var r = rotation; // * Matrix.DEG_TO_RAD;
                var cos = egret.NumberUtils.cos(r);
                var sin = egret.NumberUtils.sin(r);
            }
            else {
                cos = 1;
                sin = 0;
            }
            if (skewX || skewY) {
                // TODO: can this be combined into a single append?
                //                skewX *= Matrix.DEG_TO_RAD;
                //                skewY *= Matrix.DEG_TO_RAD;
                this.append(egret.NumberUtils.cos(skewY), egret.NumberUtils.sin(skewY), -egret.NumberUtils.sin(skewX), egret.NumberUtils.cos(skewX), x, y);
                this.append(cos * scaleX, sin * scaleX, -sin * scaleY, cos * scaleY, 0, 0);
            }
            else {
                this.append(cos * scaleX, sin * scaleX, -sin * scaleY, cos * scaleY, x, y);
            }
            if (regX || regY) {
                // prepend the registration offset:
                this.tx -= regX * this.a + regY * this.c;
                this.ty -= regX * this.b + regY * this.d;
            }
            return this;
        };
        /**
         * 对 Matrix 对象应用旋转转换。
         * 矩阵旋转，以角度制为单位
         * @method egret.Matrix#rotate
         * @param angle {number} 角度
         * @returns {egret.Matrix}
         */
        Matrix.prototype.rotate = function (angle) {
            var cos = Math.cos(angle);
            var sin = Math.sin(angle);
            var a1 = this.a;
            var c1 = this.c;
            var tx1 = this.tx;
            this.a = a1 * cos - this.b * sin;
            this.b = a1 * sin + this.b * cos;
            this.c = c1 * cos - this.d * sin;
            this.d = c1 * sin + this.d * cos;
            this.tx = tx1 * cos - this.ty * sin;
            this.ty = tx1 * sin + this.ty * cos;
            return this;
        };
        /**
         * 矩阵斜切，以角度值为单位
         * @method egret.Matrix#skew
         * @param skewX {number}
         * @param skewY {number}
         * @returns {egret.Matrix}
         */
        Matrix.prototype.skew = function (skewX, skewY) {
            //            skewX = skewX * Matrix.DEG_TO_RAD;
            //            skewY = skewY * Matrix.DEG_TO_RAD;
            this.append(egret.NumberUtils.cos(skewY), egret.NumberUtils.sin(skewY), -egret.NumberUtils.sin(skewX), egret.NumberUtils.cos(skewX), 0, 0);
            return this;
        };
        /**
         * 矩阵缩放
         * @method egret.Matrix#scale
         * @param x {number}
         * @param y {number}
         * @returns {egret.Matrix}
         */
        Matrix.prototype.scale = function (x, y) {
            this.a *= x;
            this.d *= y;
            this.c *= x;
            this.b *= y;
            this.tx *= x;
            this.ty *= y;
            return this;
        };
        /**
         * 沿 x 和 y 轴平移矩阵，由 x 和 y 参数指定。
         * @method egret.Matrix#translate
         * @param x {number} 沿 x 轴向右移动的量（以像素为单位）。
         * @param y {number} 沿 y 轴向下移动的量（以像素为单位）。
         * @returns {egret.Matrix}
         */
        Matrix.prototype.translate = function (x, y) {
            this.tx += x;
            this.ty += y;
            return this;
        };
        /**
         * 为每个矩阵属性设置一个值，该值将导致 null 转换。
         * 通过应用恒等矩阵转换的对象将与原始对象完全相同。
         * 调用 identity() 方法后，生成的矩阵具有以下属性：a=1、b=0、c=0、d=1、tx=0 和 ty=0。
         * @method egret.Matrix#identity
         * @returns {egret.Matrix}
         */
        Matrix.prototype.identity = function () {
            this.a = this.d = 1;
            this.b = this.c = this.tx = this.ty = 0;
            return this;
        };
        /**
         * 矩阵重置为目标矩阵
         * @method egret.Matrix#identityMatrix
         * @returns {egret.Matrix}
         */
        Matrix.prototype.identityMatrix = function (matrix) {
            this.a = matrix.a;
            this.b = matrix.b;
            this.c = matrix.c;
            this.d = matrix.d;
            this.tx = matrix.tx;
            this.ty = matrix.ty;
            return this;
        };
        /**
         * 执行原始矩阵的逆转换。
         * 您可以将一个逆矩阵应用于对象来撤消在应用原始矩阵时执行的转换。
         * @method egret.Matrix#invert
         * @returns {egret.Matrix}
         */
        Matrix.prototype.invert = function () {
            var a1 = this.a;
            var b1 = this.b;
            var c1 = this.c;
            var d1 = this.d;
            var tx1 = this.tx;
            var n = a1 * d1 - b1 * c1;
            this.a = d1 / n;
            this.b = -b1 / n;
            this.c = -c1 / n;
            this.d = a1 / n;
            this.tx = (c1 * this.ty - d1 * tx1) / n;
            this.ty = -(a1 * this.ty - b1 * tx1) / n;
            return this;
        };
        /**
         * 根据一个矩阵，返回某个点在该矩阵上的坐标
         * @method egret.Matrix.transformCoords
         * @param matrix {egret.Matrix}
         * @param x {number}
         * @param y {number}
         * @returns {numberPoint}
         * @stable C 该方法以后可能删除
         */
        Matrix.transformCoords = function (matrix, x, y) {
            var resultPoint = egret.Point.identity;
            resultPoint.x = matrix.a * x + matrix.c * y + matrix.tx;
            resultPoint.y = matrix.d * y + matrix.b * x + matrix.ty;
            //        resultPoint.x = matrix.a * x + matrix.c * y - matrix.tx;
            //        resultPoint.y = matrix.d * y + matrix.b * x - matrix.ty;
            return resultPoint;
        };
        Matrix.prototype.toArray = function (transpose) {
            if (!this.array) {
                this.array = new Float32Array(9);
            }
            if (transpose) {
                this.array[0] = this.a;
                this.array[1] = this.b;
                this.array[2] = 0;
                this.array[3] = this.c;
                this.array[4] = this.d;
                this.array[5] = 0;
                this.array[6] = this.tx;
                this.array[7] = this.ty;
                this.array[8] = 1;
            }
            else {
                this.array[0] = this.a;
                this.array[1] = this.b;
                this.array[2] = this.tx;
                this.array[3] = this.c;
                this.array[4] = this.d;
                this.array[5] = this.ty;
                this.array[6] = 0;
                this.array[7] = 0;
                this.array[8] = 1;
            }
            return this.array;
        };
        Matrix.identity = new Matrix();
        Matrix.DEG_TO_RAD = Math.PI / 180;
        return Matrix;
    })(egret.HashObject);
    egret.Matrix = Matrix;
    Matrix.prototype.__class__ = "egret.Matrix";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.Point
     * @classdesc
     * Point 对象表示二维坐标系统中的某个位置，其中 x 表示水平轴，y 表示垂直轴。
     * @extends egret.HashObject
     */
    var Point = (function (_super) {
        __extends(Point, _super);
        /**
         * 创建一个 egret.Point 对象
         * @method egret.Point#constructor
         * @param x {number} 该对象的x属性值，默认为0
         * @param y {number} 该对象的y属性值，默认为0
         */
        function Point(x, y) {
            if (x === void 0) { x = 0; }
            if (y === void 0) { y = 0; }
            _super.call(this);
            this.x = x;
            this.y = y;
        }
        /**
         * 克隆点对象
         * @method egret.Point#clone
         * @returns {egret.Point}
         */
        Point.prototype.clone = function () {
            return new Point(this.x, this.y);
        };
        /**
         * 确定两个点是否相同。如果两个点具有相同的 x 和 y 值，则它们是相同的点。
         * @method egret.Point#equals
         * @param {egret.Point} toCompare 要比较的点。
         * @returns {boolean} 如果该对象与此 Point 对象相同，则为 true 值，如果不相同，则为 false。
         */
        Point.prototype.equals = function (toCompare) {
            return this.x == toCompare.x && this.y == toCompare.y;
        };
        /**
         * 返回 pt1 和 pt2 之间的距离。
         * @method egret.Point#distance
         * @param p1 {egret.Point} 第一个点
         * @param p2 {egret.Point} 第二个点
         * @returns {number} 第一个点和第二个点之间的距离。
         */
        Point.distance = function (p1, p2) {
            return Math.sqrt((p1.x - p2.x) * (p1.x - p2.x) + (p1.y - p2.y) * (p1.y - p2.y));
        };
        Point.identity = new Point(0, 0);
        return Point;
    })(egret.HashObject);
    egret.Point = Point;
    Point.prototype.__class__ = "egret.Point";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.Rectangle
     * @classdesc 矩形类
     * Rectangle 对象是按其位置（由它左上角的点 (x, y) 确定）以及宽度和高度定义的区域。
     * Rectangle 类的 x、y、width 和 height 属性相互独立；更改一个属性的值不会影响其他属性。
     * 但是，right 和 bottom 属性与这四个属性是整体相关的。例如，如果更改 right 属性的值，则 width 属性的值将发生变化；如果更改 bottom 属性，则 height 属性的值将发生变化。
     * @extends egret.HashObject
     */
    var Rectangle = (function (_super) {
        __extends(Rectangle, _super);
        function Rectangle(x, y, width, height) {
            if (x === void 0) { x = 0; }
            if (y === void 0) { y = 0; }
            if (width === void 0) { width = 0; }
            if (height === void 0) { height = 0; }
            _super.call(this);
            this.x = x;
            this.y = y;
            this.width = width;
            this.height = height;
        }
        Object.defineProperty(Rectangle.prototype, "right", {
            /**
             * x 和 width 属性的和。
             * @member {number} egret.Rectangle#right
             */
            get: function () {
                return this.x + this.width;
            },
            set: function (value) {
                this.width = value - this.x;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Rectangle.prototype, "bottom", {
            /**
             * y 和 height 属性的和。
             * @member {number} egret.Rectangle#bottom
             */
            get: function () {
                return this.y + this.height;
            },
            set: function (value) {
                this.height = value - this.y;
            },
            enumerable: true,
            configurable: true
        });
        /**
         * 举行类初始化赋值，开发者尽量调用此方法复用Rectangle对象，而不是每次需要的时候都重新创建
         * @method egret.Rectangle#initialize
         * @param x {number} 矩形的x轴
         * @param y {number} 矩形的y轴
         * @param width {number} 矩形的宽度
         * @param height {number} 矩形的高度
         * @returns {egret.Rectangle}
         */
        Rectangle.prototype.initialize = function (x, y, width, height) {
            this.x = x;
            this.y = y;
            this.width = width;
            this.height = height;
            return this;
        };
        /**
         * 确定由此 Rectangle 对象定义的矩形区域内是否包含指定的点。
         * @method egret.Rectangle#contains
         * @param x {number} 检测点的x轴
         * @param y {number} 检测点的y轴
         * @returns {boolean} 如果检测点位于矩形内，返回true，否则，返回false
         */
        Rectangle.prototype.contains = function (x, y) {
            return this.x <= x && this.x + this.width >= x && this.y <= y && this.y + this.height >= y;
        };
        /**
         * 确定在 toIntersect 参数中指定的对象是否与此 Rectangle 对象相交。此方法检查指定的 Rectangle 对象的 x、y、width 和 height 属性，以查看它是否与此 Rectangle 对象相交。
         * @method egret.Rectangle#intersects
         * @param toIntersect {egret.Rectangle} 要与此 Rectangle 对象比较的 Rectangle 对象。
         * @returns {boolean} 如果两个矩形相交，返回true，否则返回false
         */
        Rectangle.prototype.intersects = function (toIntersect) {
            var toIntersect_right = toIntersect.right;
            var toIntersect_bottom = toIntersect.bottom;
            var self_right = this.right;
            var self_bottom = this.bottom;
            if (this.contains(toIntersect.x, toIntersect.y))
                return true;
            else if (this.contains(toIntersect.x, toIntersect_bottom))
                return true;
            else if (this.contains(toIntersect_right, toIntersect.y))
                return true;
            else if (this.contains(toIntersect_right, toIntersect_bottom))
                return true;
            else if (toIntersect.contains(this.x, this.y))
                return true;
            else if (toIntersect.contains(this.x, self_bottom))
                return true;
            else if (toIntersect.contains(self_right, this.y))
                return true;
            else if (toIntersect.contains(self_right, self_bottom))
                return true;
            return false;
        };
        /**
         * 克隆矩形对象
         * @method egret.Rectangle#clone
         * @returns {egret.Rectangle} 返回克隆后的矩形
         */
        Rectangle.prototype.clone = function () {
            return new Rectangle(this.x, this.y, this.width, this.height);
        };
        /**
         * 确定由此 Rectangle 对象定义的矩形区域内是否包含指定的点。
         * 此方法与 Rectangle.contains() 方法类似，只不过它采用 Point 对象作为参数。
         * @method egret.Rectangle#containsPoint
         * @param point {egret.Point} 包含点对象
         * @returns {boolean} 如果包含，返回true，否则返回false
         */
        Rectangle.prototype.containsPoint = function (point) {
            if (this.x < point.x && this.x + this.width > point.x && this.y < point.y && this.y + this.height > point.y) {
                return true;
            }
            return false;
        };
        /**
         * 引擎内部用于函数传递返回值的全局矩形对象，开发者请勿随意修改此对象
         * @member {egret.Rectangle} egret.Rectangle.identity
         */
        Rectangle.identity = new Rectangle(0, 0, 0, 0);
        return Rectangle;
    })(egret.HashObject);
    egret.Rectangle = Rectangle;
    Rectangle.prototype.__class__ = "egret.Rectangle";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    /**
     * @class egret.Logger
     * @classdesc
     * Logger是引擎的日志处理模块入口
     * @stable B 目前Logger的接口设计没有问题，但是考虑到跨平台，需要将其改为一个Context，并且允许开发者自由扩展以实现自身游戏的日志分析收集需求
     * todo:GitHub文档，如何利用日志帮助游戏持续改进
     */
    var Logger = (function () {
        function Logger() {
        }
        /**
         * 表示出现了致命错误，开发者必须修复错误
         * @method egret.Logger.fatal
         * @param actionCode {string} 错误信息
         * @param value {Object} 错误描述信息
         */
        Logger.fatal = function (actionCode, value) {
            if (value === void 0) { value = null; }
            egret.Logger.traceToConsole("Fatal", actionCode, value);
            throw new Error(egret.Logger.getTraceCode("Fatal", actionCode, value));
        };
        /**
         * 记录正常的Log信息
         * @method egret.Logger.info
         * @param actionCode {string} 错误信息
         * @param value {Object} 错误描述信息
         */
        Logger.info = function (actionCode, value) {
            if (value === void 0) { value = null; }
            egret.Logger.traceToConsole("Info", actionCode, value);
        };
        /**
         * 记录可能会出现问题的Log信息
         * @method egret.Logger.warning
         * @param actionCode {string} 错误信息
         * @param value {Object} 错误描述信息
         */
        Logger.warning = function (actionCode, value) {
            if (value === void 0) { value = null; }
            egret.Logger.traceToConsole("Warning", actionCode, value);
        };
        /**
         * @private
         * @param type
         * @param actionCode
         * @param value
         */
        Logger.traceToConsole = function (type, actionCode, value) {
            console.log(egret.Logger.getTraceCode(type, actionCode, value));
        };
        /**
         * @private
         * @param type
         * @param actionCode
         * @param value
         * @returns {string}
         */
        Logger.getTraceCode = function (type, actionCode, value) {
            return "[" + type + "]" + actionCode + ":" + (value == null ? "" : value);
        };
        return Logger;
    })();
    egret.Logger = Logger;
    Logger.prototype.__class__ = "egret.Logger";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @deprecated
     */
    var SAXParser = (function (_super) {
        __extends(SAXParser, _super);
        function SAXParser() {
            _super.call(this);
            this._parser = null;
            this._xmlDict = null;
            this._isSupportDOMParser = null;
            this._xmlDict = {};
            if (window["DOMParser"]) {
                this._isSupportDOMParser = true;
                this._parser = new DOMParser();
            }
            else {
                this._isSupportDOMParser = false;
            }
        }
        /**
         * @deprecated
         */
        SAXParser.getInstance = function () {
            if (!SAXParser._instance) {
                SAXParser._instance = new SAXParser();
            }
            return SAXParser._instance;
        };
        /**
         * @deprecated
         */
        SAXParser.prototype.parserXML = function (textxml) {
            var i = 0;
            while (textxml.charAt(i) == "\n" || textxml.charAt(i) == "\t" || textxml.charAt(i) == "\r" || textxml.charAt(i) == " ") {
                i++;
            }
            if (i != 0) {
                textxml = textxml.substring(i, textxml.length);
            }
            var xmlDoc;
            if (this._isSupportDOMParser) {
                xmlDoc = this._parser.parseFromString(textxml, "text/xml");
            }
            else {
                xmlDoc = new ActiveXObject("Microsoft.XMLDOM");
                xmlDoc.async = "false";
                xmlDoc.loadXML(textxml);
            }
            if (xmlDoc == null) {
                egret.Logger.info("xml not found!");
            }
            return xmlDoc;
        };
        SAXParser._instance = null;
        return SAXParser;
    })(egret.HashObject);
    egret.SAXParser = SAXParser;
    SAXParser.prototype.__class__ = "egret.SAXParser";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.StageDelegate
     * @classdesc
     * StageDelegate负责处理屏幕适配策略
     * @extends egret.HashObject
     * @private
     */
    var StageDelegate = (function (_super) {
        __extends(StageDelegate, _super);
        /**
         * @method egret.StageDelegate#constructor
         */
        function StageDelegate() {
            _super.call(this);
            this._designWidth = 0;
            this._designHeight = 0;
            this._scaleX = 1;
            this._scaleY = 1;
            this._offSetY = 0;
            this._stageWidth = 0;
            this._stageHeight = 0;
        }
        /**
         * @method egret.StageDelegate.getInstance
         * @returns {StageDelegate}
         */
        StageDelegate.getInstance = function () {
            if (StageDelegate.instance == null) {
                ContainerStrategy.initialize();
                StageDelegate.instance = new StageDelegate();
            }
            return StageDelegate.instance;
        };
        /**
         * 设置舞台的宽高
         * @method egret.StageDelegate#setDesignSize
         * @param width {number}
         * @param height {number}
         */
        StageDelegate.prototype.setDesignSize = function (width, height) {
            this._designWidth = width;
            this._designHeight = height;
            if (arguments[2]) {
                egret.Logger.warning("该方法目前不应传入 resolutionPolicy 参数，请在 docs/1.0_Final_ReleaseNote中查看如何升级");
                var resolutionPolicy = arguments[2];
                this._setResolutionPolicy(resolutionPolicy);
            }
        };
        /**
         * @param resolutionPolic {any}
         */
        StageDelegate.prototype._setResolutionPolicy = function (resolutionPolicy) {
            this._resolutionPolicy = resolutionPolicy;
            resolutionPolicy.init(this);
            resolutionPolicy._apply(this, this._designWidth, this._designHeight);
        };
        /**
         * @method egret.StageDelegate#getScaleX
         */
        StageDelegate.prototype.getScaleX = function () {
            return this._scaleX;
        };
        /**
         * @method egret.StageDelegate#getScaleY
         */
        StageDelegate.prototype.getScaleY = function () {
            return this._scaleY;
        };
        /**
         * @method egret.StageDelegate#getOffSetY
         */
        StageDelegate.prototype.getOffSetY = function () {
            return this._offSetY;
        };
        /**
         * @deprecated
         */
        StageDelegate.canvas_name = "egretCanvas";
        /**
         */
        StageDelegate.canvas_div_name = "gameDiv";
        return StageDelegate;
    })(egret.HashObject);
    egret.StageDelegate = StageDelegate;
    StageDelegate.prototype.__class__ = "egret.StageDelegate";
    /**
     * @classdesc
     */
    var ResolutionPolicy = (function () {
        function ResolutionPolicy(containerStg, contentStg) {
            this._containerStrategy = containerStg;
            this._contentStrategy = contentStg;
        }
        /**
         * @method egret.ResolutionPolicy#init
         * @param view {egret.StageDelegate}
         */
        ResolutionPolicy.prototype.init = function (view) {
            this._containerStrategy.init(view);
            this._contentStrategy.init(view);
        };
        /**
         * @method egret.ResolutionPolicy#_apply
         * @param view {any}
         * @param designedResolutionWidth {any}
         * @param designedResolutionHeigh {any}
         */
        ResolutionPolicy.prototype._apply = function (view, designedResolutionWidth, designedResolutionHeight) {
            this._containerStrategy._apply(view, designedResolutionWidth, designedResolutionHeight);
            this._contentStrategy._apply(view, designedResolutionWidth, designedResolutionHeight);
        };
        return ResolutionPolicy;
    })();
    egret.ResolutionPolicy = ResolutionPolicy;
    ResolutionPolicy.prototype.__class__ = "egret.ResolutionPolicy";
    /**
     */
    var ContainerStrategy = (function () {
        function ContainerStrategy() {
        }
        /**
         * @method egret.ContainerStrategy.initialize
         */
        ContainerStrategy.initialize = function () {
            ContainerStrategy.EQUAL_TO_FRAME = new EqualToFrame();
        };
        /**
         * @method egret.ContainerStrategy#init
         * @param vie {any}
         */
        ContainerStrategy.prototype.init = function (view) {
        };
        /**
         * @method egret.ContainerStrategy#_apply
         * @param view {any}
         * @param designedWidth {any}
         * @param designedHeigh {any}
         */
        ContainerStrategy.prototype._apply = function (view, designedWidth, designedHeight) {
        };
        ContainerStrategy.prototype._setupContainer = function () {
            var body = document.body, style;
            if (body && (style = body.style)) {
                style.paddingTop = style.paddingTop || "0px";
                style.paddingRight = style.paddingRight || "0px";
                style.paddingBottom = style.paddingBottom || "0px";
                style.paddingLeft = style.paddingLeft || "0px";
                style.borderTop = style.borderTop || "0px";
                style.borderRight = style.borderRight || "0px";
                style.borderBottom = style.borderBottom || "0px";
                style.borderLeft = style.borderLeft || "0px";
                style.marginTop = style.marginTop || "0px";
                style.marginRight = style.marginRight || "0px";
                style.marginBottom = style.marginBottom || "0px";
                style.marginLeft = style.marginLeft || "0px";
            }
        };
        return ContainerStrategy;
    })();
    egret.ContainerStrategy = ContainerStrategy;
    ContainerStrategy.prototype.__class__ = "egret.ContainerStrategy";
    /**
     * @classdesc
     * @extends egret.ContainerStrategy
     */
    var EqualToFrame = (function (_super) {
        __extends(EqualToFrame, _super);
        function EqualToFrame() {
            _super.apply(this, arguments);
        }
        EqualToFrame.prototype._apply = function (view) {
            this._setupContainer();
        };
        return EqualToFrame;
    })(ContainerStrategy);
    egret.EqualToFrame = EqualToFrame;
    EqualToFrame.prototype.__class__ = "egret.EqualToFrame";
    /**
     */
    var ContentStrategy = (function () {
        function ContentStrategy() {
        }
        /**
         * @method egret.ContentStrategy#init
         * @param vie {any}
         */
        ContentStrategy.prototype.init = function (view) {
        };
        /**
         * @method egret.ContentStrategy#_apply
         * @param delegate {egret.StageDelegate}
         * @param designedResolutionWidth {number}
         * @param designedResolutionHeight {number}
         */
        ContentStrategy.prototype._apply = function (delegate, designedResolutionWidth, designedResolutionHeight) {
        };
        ContentStrategy.prototype.setEgretSize = function (w, h, styleW, styleH, left, top) {
            if (left === void 0) { left = 0; }
            if (top === void 0) { top = 0; }
            egret.StageDelegate.getInstance()._stageWidth = Math.round(w);
            egret.StageDelegate.getInstance()._stageHeight = Math.round(h);
            var container = document.getElementById(StageDelegate.canvas_div_name);
            container.style.width = styleW + "px";
            container.style.height = styleH + "px";
            container.style.top = top + "px";
        };
        /**
         * 显示区域分辨率宽
         * @returns {number}
         */
        ContentStrategy.prototype._getClientWidth = function () {
            return document.documentElement.clientWidth;
        };
        /**
         * 显示区域分辨率高
         * @returns {number}
         */
        ContentStrategy.prototype._getClientHeight = function () {
            return document.documentElement.clientHeight;
        };
        return ContentStrategy;
    })();
    egret.ContentStrategy = ContentStrategy;
    ContentStrategy.prototype.__class__ = "egret.ContentStrategy";
    /**
     * @class egret.FixedHeight
     * @classdesc
     * @extends egret.ContentStrategy
     */
    var FixedHeight = (function (_super) {
        __extends(FixedHeight, _super);
        /**
         * 构造函数
         * @param minWidth 最终游戏内适配的最小stageWidth，默认没有最小宽度
         */
        function FixedHeight(minWidth) {
            if (minWidth === void 0) { minWidth = 0; }
            _super.call(this);
            this.minWidth = minWidth;
        }
        /**
         * @method egret.FixedHeight#_apply
         * @param delegate {any}
         * @param designedResolutionWidth {any}
         * @param designedResolutionHeight {any}
         */
        FixedHeight.prototype._apply = function (delegate, designedResolutionWidth, designedResolutionHeight) {
            var viewPortWidth = this._getClientWidth(); //分辨率宽
            var viewPortHeight = this._getClientHeight(); //分辨率高
            var scale = viewPortHeight / designedResolutionHeight;
            var designW = viewPortWidth / scale;
            var designH = designedResolutionHeight;
            var scale2 = 1;
            if (this.minWidth != 0) {
                scale2 = Math.min(1, designW / this.minWidth);
            }
            this.setEgretSize(designW / scale2, designH, viewPortWidth, viewPortHeight * scale2);
            delegate._scaleX = scale * scale2;
            delegate._scaleY = scale * scale2;
        };
        return FixedHeight;
    })(ContentStrategy);
    egret.FixedHeight = FixedHeight;
    FixedHeight.prototype.__class__ = "egret.FixedHeight";
    /**
     * @class egret.FixedWidth
     * @classdesc
     * @extends egret.ContentStrategy
     */
    var FixedWidth = (function (_super) {
        __extends(FixedWidth, _super);
        /**
         * 构造函数
         * @param minHeight 最终游戏内适配的最小stageHeight，默认没有最小高度
         */
        function FixedWidth(minHeight) {
            if (minHeight === void 0) { minHeight = 0; }
            _super.call(this);
            this.minHeight = minHeight;
        }
        FixedWidth.prototype._apply = function (delegate, designedResolutionWidth, designedResolutionHeight) {
            var viewPortWidth = this._getClientWidth(); //分辨率宽
            var viewPortHeight = this._getClientHeight(); //分辨率高
            var scale = viewPortWidth / designedResolutionWidth;
            var designW = designedResolutionWidth;
            var designH = viewPortHeight / scale;
            var scale2 = 1;
            if (this.minHeight != 0) {
                scale2 = Math.min(1, designH / this.minHeight);
            }
            var offsetX = viewPortWidth * (1 - scale2) / 2;
            this.setEgretSize(designW, designH / scale2, viewPortWidth * scale2, viewPortHeight, offsetX);
            delegate._scaleX = scale * scale2;
            delegate._scaleY = scale * scale2;
        };
        return FixedWidth;
    })(ContentStrategy);
    egret.FixedWidth = FixedWidth;
    FixedWidth.prototype.__class__ = "egret.FixedWidth";
    /**
     * @class egret.FixedSize
     * @classdesc
     * @extends egret.ContentStrategy
     */
    var FixedSize = (function (_super) {
        __extends(FixedSize, _super);
        function FixedSize(width, height) {
            _super.call(this);
            this.width = width;
            this.height = height;
        }
        /**
         * @method egret.FixedSize#_apply
         * @param delegate {egret.StageDelegate}
         * @param designedResolutionWidth {number}
         * @param designedResolutionHeight {number}
         */
        FixedSize.prototype._apply = function (delegate, designedResolutionWidth, designedResolutionHeight) {
            var viewPortWidth = this.width;
            var viewPortHeight = this.height;
            var scale = viewPortWidth / designedResolutionWidth;
            this.setEgretSize(designedResolutionWidth, viewPortHeight / scale, viewPortWidth, viewPortHeight);
            delegate._scaleX = scale;
            delegate._scaleY = scale;
        };
        return FixedSize;
    })(ContentStrategy);
    egret.FixedSize = FixedSize;
    FixedSize.prototype.__class__ = "egret.FixedSize";
    /**
     * @class egret.NoScale
     * @classdesc
     * @extends egret.ContentStrategy
     */
    var NoScale = (function (_super) {
        __extends(NoScale, _super);
        function NoScale() {
            _super.call(this);
        }
        /**
         * @method egret.NoScale#_apply
         * @param delegate {egret.StageDelegate}
         * @param designedResolutionWidth {number}
         * @param designedResolutionHeight {number}
         */
        NoScale.prototype._apply = function (delegate, designedResolutionWidth, designedResolutionHeight) {
            var offsetX = Math.floor((designedResolutionWidth - designedResolutionWidth) / 2);
            this.setEgretSize(designedResolutionWidth, designedResolutionHeight, designedResolutionWidth, designedResolutionHeight, offsetX);
            delegate._scaleX = 1;
            delegate._scaleY = 1;
        };
        return NoScale;
    })(ContentStrategy);
    egret.NoScale = NoScale;
    NoScale.prototype.__class__ = "egret.NoScale";
    var ShowAll = (function (_super) {
        __extends(ShowAll, _super);
        function ShowAll() {
            _super.call(this);
        }
        /**
         * @method egret.NoScale#_apply
         * @param delegate {egret.StageDelegate}
         * @param designedResolutionWidth {number}
         * @param designedResolutionHeight {number}
         */
        ShowAll.prototype._apply = function (delegate, designedResolutionWidth, designedResolutionHeight) {
            var clientWidth = this._getClientWidth(); //分辨率宽
            var clientHeight = this._getClientHeight(); //分辨率宽
            var viewPortWidth = clientWidth;
            var viewPortHeight = clientHeight;
            var scale = (viewPortWidth / designedResolutionWidth < viewPortHeight / designedResolutionHeight) ? viewPortWidth / designedResolutionWidth : viewPortHeight / designedResolutionHeight;
            var designW = designedResolutionWidth;
            var designH = designedResolutionHeight;
            var viewPortWidth = designW * scale;
            var viewPortHeight = designH * scale;
            var scale2 = 1;
            var offsetX = Math.floor((clientWidth - viewPortWidth) / 2);
            delegate._offSetY = Math.floor((clientHeight - viewPortHeight) / 2);
            this.setEgretSize(designW, designH / scale2, viewPortWidth * scale2, viewPortHeight, offsetX, delegate._offSetY);
            delegate._scaleX = scale * scale2;
            delegate._scaleY = scale * scale2;
        };
        return ShowAll;
    })(ContentStrategy);
    egret.ShowAll = ShowAll;
    ShowAll.prototype.__class__ = "egret.ShowAll";
    var FullScreen = (function (_super) {
        __extends(FullScreen, _super);
        function FullScreen() {
            _super.call(this);
        }
        /**
         * @method egret.NoScale#_apply
         * @param delegate {egret.StageDelegate}
         * @param designedResolutionWidth {number}
         * @param designedResolutionHeight {number}
         */
        FullScreen.prototype._apply = function (delegate, designedResolutionWidth, designedResolutionHeight) {
            var viewPortWidth = this._getClientWidth(); //分辨率宽
            var viewPortHeight = this._getClientHeight(); //分辨率高
            var designW = designedResolutionWidth;
            var designH = designedResolutionHeight;
            var scalex = viewPortWidth / designedResolutionWidth;
            var scaley = viewPortHeight / designedResolutionHeight;
            viewPortWidth = designW * scalex;
            viewPortHeight = designH * scaley;
            this.setEgretSize(designW, designH, viewPortWidth, viewPortHeight);
            delegate._scaleX = scalex;
            delegate._scaleY = scaley;
        };
        return FullScreen;
    })(ContentStrategy);
    egret.FullScreen = FullScreen;
    FullScreen.prototype.__class__ = "egret.FullScreen";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @classdesc
     * @extends egret.HashObject
     * @private
     */
    var RenderFilter = (function (_super) {
        __extends(RenderFilter, _super);
        function RenderFilter() {
            _super.call(this);
            this._originalData = {};
            this._drawAreaList = [];
        }
        /**
         * @method egret.egret.getInstance
         * @returns {RenderFilter}
         */
        RenderFilter.getInstance = function () {
            if (RenderFilter.instance == null) {
                RenderFilter.instance = new RenderFilter();
            }
            return RenderFilter.instance;
        };
        /**
         * @method egret.egret#addDrawArea
         * @param area {egret.Rectangle}
         */
        RenderFilter.prototype.addDrawArea = function (area) {
            this._drawAreaList.push(area);
        };
        /**
         * @method egret.egret#clearDrawArea
         */
        RenderFilter.prototype.clearDrawArea = function () {
            this._drawAreaList = [];
        };
        /**
         * 先检查有没有不需要绘制的区域，再把需要绘制的区域绘制出来
         * @method egret.egret#drawImage
         * @param renderContext {any}
         * @param data {RenderData}
         * @param sourceX {number}
         * @param sourceY {number}
         * @param sourceWidth {number}
         * @param sourceHeight {number}
         * @param destX {number}
         * @param destY {number}
         * @param destWidth {number}
         * @param destHeight {number}
         */
        RenderFilter.prototype.drawImage = function (renderContext, data, sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight, repeat) {
            if (repeat === void 0) { repeat = undefined; }
            destX = destX || 0;
            destY = destY || 0;
            var locTexture = data._texture_to_render;
            if (locTexture == null || sourceHeight == 0 || sourceWidth == 0 || destWidth == 0 || destHeight == 0) {
                return;
            }
            var texture_scale_factor = egret.MainContext.instance.rendererContext.texture_scale_factor;
            sourceWidth = sourceWidth / texture_scale_factor;
            sourceHeight = sourceHeight / texture_scale_factor;
            if (this._drawAreaList.length == 0 || !egret.MainContext.instance.rendererContext["_cacheCanvasContext"]) {
                renderContext.drawImage(locTexture, sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight, repeat);
                return;
            }
            //计算worldBounds
            var bounds = egret.DisplayObject.getTransformBounds(data._getSize(egret.Rectangle.identity), data._worldTransform);
            data._worldBounds.initialize(bounds.x, bounds.y, bounds.width, bounds.height);
            var originalData = this._originalData;
            originalData.sourceX = sourceX;
            originalData.sourceY = sourceY;
            originalData.sourceWidth = sourceWidth;
            originalData.sourceHeight = sourceHeight;
            originalData.destX = destX;
            originalData.destY = destY;
            originalData.destWidth = destWidth;
            originalData.destHeight = destHeight;
            var locDrawAreaList = this.getDrawAreaList();
            for (var j = 0; j < locDrawAreaList.length; j++) {
                var drawArea = locDrawAreaList[j];
                if (this.ignoreRender(data, drawArea, originalData.destX, originalData.destY)) {
                    continue;
                }
                //在设置过重绘区域时算出不需要绘制的区域
                //                if (this._drawAreaList.length != 0) {
                //                    //不能允许有旋转和斜切的显示对象跨过重绘区域
                //                    if (data._worldTransform.b != 0 || data._worldTransform.c != 0) {
                //                        //之前已经判断过是否出了重绘区域了
                //                        if (data._worldBounds.x + originalData.destX < drawArea.x
                //                            || data._worldBounds.y + originalData.destY < drawArea.y
                //                            || data._worldBounds.x + data._worldBounds.width + originalData.destX > drawArea.x + drawArea.width
                //                            || data._worldBounds.y + data._worldBounds.height + originalData.destY > drawArea.y + drawArea.height) {
                //                            egret.Logger.fatal("请不要让带有旋转和斜切的显示对象跨过重绘区域");
                //                            return;
                //                        }
                //                    }
                //                    else {
                //                        //因为有旋转和斜切时候不允许跨过重绘区域，所以缩放属性可以直接这么取
                //                        var scaleX = data._worldTransform.a;
                //                        var scaleY = data._worldTransform.d;
                //                        var offset;
                //                        if (data._worldBounds.x + originalData.destX < drawArea.x) {
                //                            offset = (drawArea.x - data._worldBounds.x) / scaleX - originalData.destX;
                //                            sourceX += offset / (destWidth / sourceWidth);
                //                            sourceWidth -= offset / (destWidth / sourceWidth);
                //                            destWidth -= offset;
                //                            destX += offset;
                //                        }
                //                        if (data._worldBounds.y + originalData.destY < drawArea.y) {
                //                            offset = (drawArea.y - data._worldBounds.y) / scaleY - originalData.destY;
                //                            sourceY += offset / (destHeight / sourceHeight);
                //                            sourceHeight -= offset / (destHeight / sourceHeight);
                //                            destHeight -= offset;
                //                            destY += offset;
                //                        }
                //                        if (data._worldBounds.x + data._worldBounds.width + originalData.destX > drawArea.x + drawArea.width) {
                //                            offset = (data._worldBounds.x + data._worldBounds.width - drawArea.x - drawArea.width) / scaleX + originalData.destX;
                //                            sourceWidth -= offset / (destWidth / sourceWidth);
                //                            destWidth -= offset;
                //                        }
                //                        if (data._worldBounds.y + data._worldBounds.height + originalData.destY > drawArea.y + drawArea.height) {
                //                            offset = (data._worldBounds.y + data._worldBounds.height - drawArea.y - drawArea.height) / scaleY + originalData.destY;
                //                            sourceHeight -= offset / (destHeight / sourceHeight);
                //                            destHeight -= offset;
                //                        }
                //                    }
                //                }
                renderContext.drawImage(locTexture, sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight, repeat);
                break;
            }
        };
        RenderFilter.prototype.ignoreRender = function (data, rect, destX, destY) {
            var bounds = data._worldBounds;
            var destX = destX * data._worldTransform.a;
            var destY = destY * data._worldTransform.d;
            if (bounds.x + bounds.width + destX <= rect.x || bounds.x + destX >= rect.x + rect.width || bounds.y + bounds.height + destY <= rect.y || bounds.y + destY >= rect.y + rect.height) {
                return true;
            }
            return false;
        };
        /**
         * @method egret.egret#getDrawAreaList
         * @returns {Rectangle}
         */
        RenderFilter.prototype.getDrawAreaList = function () {
            var locDrawAreaList;
            //默认整个舞台都是重绘区域
            if (this._drawAreaList.length == 0) {
                if (!this._defaultDrawAreaList) {
                    this._defaultDrawAreaList = [new egret.Rectangle(0, 0, egret.MainContext.instance.stage.stageWidth, egret.MainContext.instance.stage.stageHeight)];
                    egret.MainContext.instance.stage.addEventListener(egret.Event.RESIZE, this.onResize, this);
                }
                locDrawAreaList = this._defaultDrawAreaList;
            }
            else {
                locDrawAreaList = this._drawAreaList;
            }
            return locDrawAreaList;
        };
        /**
         * 改变尺寸时使用
         */
        RenderFilter.prototype.onResize = function () {
            egret.MainContext.instance.stage.removeEventListener(egret.Event.RESIZE, this.onResize, this);
            this._defaultDrawAreaList = null;
        };
        return RenderFilter;
    })(egret.HashObject);
    egret.RenderFilter = RenderFilter;
    RenderFilter.prototype.__class__ = "egret.RenderFilter";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    /**
     * @classdesc 注入器
     * @class egret.Injector
     */
    var Injector = (function () {
        function Injector() {
        }
        /**
         * 以类定义为值进行映射注入，当第一次用getInstance()请求它的单例时才会被实例化。
         * @method egret.Injector.mapClass
         * @param whenAskedFor {any} whenAskedFor 传递类定义或类完全限定名作为需要映射的键。
         * @param instantiateClass {any} instantiateClass 传递类作为需要映射的值，它的构造函数必须为空。若不为空，请使用Injector.mapValue()方法直接注入实例。
         * @param named {string} named 可选参数，在同一个类作为键需要映射多条规则时，可以传入此参数区分不同的映射。在调用getInstance()方法时要传入同样的参数。
         */
        Injector.mapClass = function (whenAskedFor, instantiateClass, named) {
            if (named === void 0) { named = ""; }
            var requestName = this.getKey(whenAskedFor) + "#" + named;
            this.mapClassDic[requestName] = instantiateClass;
        };
        /**
         * 获取完全限定类名
         */
        Injector.getKey = function (hostComponentKey) {
            if (typeof (hostComponentKey) == "string")
                return hostComponentKey;
            return egret.getQualifiedClassName(hostComponentKey);
        };
        /**
         * 以实例为值进行映射注入,当用getInstance()请求单例时始终返回注入的这个实例。
         * @method egret.Injector.mapValue
         * @param whenAskedFor {any} 传递类定义或类的完全限定名作为需要映射的键。
         * @param useValue {any} 传递对象实例作为需要映射的值。
         * @param named {string} 可选参数，在同一个类作为键需要映射多条规则时，可以传入此参数区分不同的映射。在调用getInstance()方法时要传入同样的参数。
         */
        Injector.mapValue = function (whenAskedFor, useValue, named) {
            if (named === void 0) { named = ""; }
            var requestName = this.getKey(whenAskedFor) + "#" + named;
            this.mapValueDic[requestName] = useValue;
        };
        /**
         * 检查指定的映射规则是否存在
         * @method egret.Injector.hasMapRule
         * @param whenAskedFor {any} 传递类定义或类的完全限定名作为需要映射的键。
         * @param named {string} 可选参数，在同一个类作为键需要映射多条规则时，可以传入此参数区分不同的映射。
         * @returns {boolean}
         */
        Injector.hasMapRule = function (whenAskedFor, named) {
            if (named === void 0) { named = ""; }
            var requestName = this.getKey(whenAskedFor) + "#" + named;
            if (this.mapValueDic[requestName] || this.mapClassDic[requestName]) {
                return true;
            }
            return false;
        };
        /**
         * 获取指定类映射的单例，注意:这个方法总是返回全局唯一的实例，不会重复创建。
         * @method egret.Injector.getInstance
         * @param clazz {any} 类定义或类的完全限定名
         * @param named {string} 可选参数，若在调用mapClass()映射时设置了这个值，则要传入同样的字符串才能获取对应的单例
         * @returns {any}
         */
        Injector.getInstance = function (clazz, named) {
            if (named === void 0) { named = ""; }
            var requestName = this.getKey(clazz) + "#" + named;
            if (this.mapValueDic[requestName])
                return this.mapValueDic[requestName];
            var returnClass = (this.mapClassDic[requestName]);
            if (returnClass) {
                var instance = new returnClass();
                this.mapValueDic[requestName] = instance;
                delete this.mapClassDic[requestName];
                return instance;
            }
            throw new Error("调用了未配置的注入规则:" + requestName + "。 请先在项目初始化里配置指定的注入规则，再调用对应单例。");
        };
        /**
         * 储存类的映射规则
         */
        Injector.mapClassDic = {};
        Injector.mapValueDic = {};
        return Injector;
    })();
    egret.Injector = Injector;
    Injector.prototype.__class__ = "egret.Injector";
})(egret || (egret = {}));
/**
 * Copyright (c) Egret-Labs.org. Permission is hereby granted, free of charge,
 * to any person obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish, distribute,
 * sublicense, and/or sell copies of the Software, and to permit persons to whom
 * the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included
 * in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
 * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
 * PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE
 * FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
 * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
var egret;
(function (egret) {
    /**
     * @class egret.BlendMode
     * @classdesc
     * 提供混合模式可视效果的常量值的类。
     */
    var BlendMode = (function () {
        function BlendMode() {
        }
        /**
         * 该显示对象出现在背景前面。显示对象的像素值会覆盖背景的像素值。在显示对象为透明的区域，背景是可见的。
         * @constant {string} egret.BlendMode.NORMAL
         */
        BlendMode.NORMAL = "normal";
        /**
         * 将显示对象的原色值添加到它的背景颜色中，上限值为 0xFF。此设置通常用于使两个对象间的加亮溶解产生动画效果。
         * 例如，如果显示对象的某个像素的 RGB 值为 0xAAA633，背景像素的 RGB 值为 0xDD2200，则显示像素的结果 RGB 值为 0xFFC833（因为 0xAA + 0xDD > 0xFF，0xA6 + 0x22 = 0xC8，且 0x33 + 0x00 = 0x33）。
         * @constant {string} egret.BlendMode.ADD
         */
        BlendMode.ADD = "add";
        return BlendMode;
    })();
    egret.BlendMode = BlendMode;
    BlendMode.prototype.__class__ = "egret.BlendMode";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written pemission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.DisplayObject
     * @extends egret.EventDispatcher
     * @classdesc 类是可放在显示列表中的所有对象的基类。该显示列表管理运行时显示的所有对象。使用 DisplayObjectContainer 类排列显示列表中的显示对象。
     * DisplayObjectContainer 对象可以有子显示对象，而其他显示对象是“叶”节点，只有父级和同级，没有子级。
     * DisplayObject 类支持基本功能（如对象的 x 和 y 位置），也支持更高级的对象属性（如它的转换矩阵），所有显示对象都继承自 DisplayObject 类。
     * DisplayObject 类包含若干广播事件。通常，任何特定事件的目标均为一个特定的 DisplayObject 实例。
     * 若只有一个目标，则会将事件侦听器限制为只能放置到该目标上（在某些情况下，可放置到显示列表中该目标的祖代上），这意味着您可以向任何 DisplayObject 实例添加侦听器来侦听广播事件。
     * 任何继承自DisplayObject的类都必须实现以下方法
     * _render();
     * _measureBounds()
     * 不允许重写以下方法
     * _draw();
     * getBounds();
     *
     */
    var DisplayObject = (function (_super) {
        __extends(DisplayObject, _super);
        function DisplayObject() {
            _super.call(this);
            this.__hack_local_matrix = null;
            this._normalDirty = true;
            //对宽高有影响
            this._sizeDirty = true;
            this._texture_to_render = null;
            this._parent = null;
            /**
             * 表示 DisplayObject 实例相对于父级 DisplayObjectContainer 本地坐标的 x 坐标。
             * 如果该对象位于具有变形的 DisplayObjectContainer 内，则它也位于包含 DisplayObjectContainer 的本地坐标系中。因此，对于逆时针旋转 90 度的 DisplayObjectContainer，该 DisplayObjectContainer 的子级将继承逆时针旋转 90 度的坐标系。
             * @member {number} egret.DisplayObject#x
             */
            this._x = 0;
            /**
             * 表示 DisplayObject 实例相对于父级 DisplayObjectContainer 本地坐标的 y 坐标。
             * 如果该对象位于具有变形的 DisplayObjectContainer 内，则它也位于包含 DisplayObjectContainer 的本地坐标系中。因此，对于逆时针旋转 90 度的 DisplayObjectContainer，该 DisplayObjectContainer 的子级将继承逆时针旋转 90 度的坐标系。
             * @member {number} egret.DisplayObject#y
             */
            this._y = 0;
            /**
             * 表示从注册点开始应用的对象的水平缩放比例（百分比）。
             * 缩放本地坐标系统将更改 x 和 y 属性值，这些属性值是以整像素定义的。
             * 默认值为 1，即不缩放。
             * @member {number} egret.DisplayObject#scaleX
             * @default 1
             */
            this._scaleX = 1;
            /**
             * 表示从对象注册点开始应用的对象的垂直缩放比例（百分比）。
             * 缩放本地坐标系统将更改 x 和 y 属性值，这些属性值是以整像素定义的。
             * 默认值为 1，即不缩放。
             * @member {number} egret.DisplayObject#scaleY
             * @default 1
             */
            this._scaleY = 1;
            /**
             * 表示从对象绝对锚点X。
             * @member {number} egret.DisplayObject#anchorOffsetX
             * @default 0
             */
            this._anchorOffsetX = 0;
            /**
             * 表示从对象绝对锚点Y。
             * @member {number} egret.DisplayObject#anchorOffsetY
             * @default 0
             */
            this._anchorOffsetY = 0;
            /**
             * 表示从对象相对锚点X。
             * @member {number} egret.DisplayObject#anchorX
             * @default 0
             */
            this._anchorX = 0;
            /**
             * 表示从对象相对锚点Y。
             * @member {number} egret.DisplayObject#anchorY
             * @default 0
             */
            this._anchorY = 0;
            /**
             * 显示对象是否可见。
             * 不可见的显示对象已被禁用。例如，如果实例的 visible=false，则无法单击该对象。
             * 默认值为 true 可见
             * @member {boolean} egret.DisplayObject#visible
             */
            this._visible = true;
            /**
             * 表示 DisplayObject 实例距其原始方向的旋转程度，以度为单位。
             * 从 0 到 180 的值表示顺时针方向旋转；从 0 到 -180 的值表示逆时针方向旋转。对于此范围之外的值，可以通过加上或减去 360 获得该范围内的值。例如，my_video.rotation = 450语句与 my_video.rotation = 90 是相同的。
             * @member {number} egret.DisplayObject#rotation
             * @default 0 默认值为 0 不旋转。
             */
            this._rotation = 0;
            /**
             * 表示指定对象的 Alpha 透明度值。
             * 有效值为 0（完全透明）到 1（完全不透明）。alpha 设置为 0 的显示对象是活动的，即使它们不可见。
             * @member {number} egret.DisplayObject#alpha
             *  @default 1 默认值为 1。
             */
            this._alpha = 1;
            /**
             * 表示DisplayObject的x方向斜切
             * @member {number} egret.DisplayObject#skewX
             * @default 0
             */
            this._skewX = 0;
            /**
             * 表示DisplayObject的y方向斜切
             * @member {number} egret.DisplayObject#skewY
             * @default 0
             */
            this._skewY = 0;
            /**
             * 指定此对象是否接收鼠标/触摸事件
             * @member {boolean} egret.DisplayObject#touchEnabled
             * @default false 默认为 false 即不可以接收。
             */
            this._touchEnabled = false;
            /**
             * BlendMode 类中的一个值，用于指定要使用的混合模式。
             * 内部绘制位图的方法有两种。 如果启用了混合模式或外部剪辑遮罩，则将通过向矢量渲染器添加有位图填充的正方形来绘制位图。 如果尝试将此属性设置为无效值，则运行时会将此值设置为 BlendMode.NORMAL。
             * @member {string} egret.DisplayObject#blendMode
             */
            this.blendMode = null;
            /**
             * 显示对象的滚动矩形范围。显示对象被裁切为矩形定义的大小，当您更改 scrollRect 对象的 x 和 y 属性时，它会在矩形内滚动。
             *  @member {egret.Rectangle} egret.DisplayObject#scrollRect
             */
            this._scrollRect = null;
            this._hasWidthSet = false;
            this._hasHeightSet = false;
            /**
             * 调用显示对象被指定的 mask 对象遮罩。
             * 要确保当舞台缩放时蒙版仍然有效，mask 显示对象必须处于显示列表的活动部分。但不绘制 mask 对象本身。
             * 将 mask 设置为 null 可删除蒙版。
             */
            this.mask = null;
            this._worldBounds = null;
            this.worldAlpha = 1;
            this._rectW = 0;
            this._rectH = 0;
            this._stage = null;
            this._cacheAsBitmap = false;
            this._cacheDirty = false;
            /**
             * beta功能，请勿调用此方法
             */
            this._colorTransform = null;
            this._worldTransform = new egret.Matrix();
            this._worldBounds = new egret.Rectangle(0, 0, 0, 0);
            this._cacheBounds = new egret.Rectangle(0, 0, 0, 0);
        }
        DisplayObject.prototype._setDirty = function () {
            this._normalDirty = true;
        };
        DisplayObject.prototype.getDirty = function () {
            return this._normalDirty || this._sizeDirty;
        };
        DisplayObject.prototype._setParentSizeDirty = function () {
            var parent = this._parent;
            if (parent && (!(parent._hasWidthSet || parent._hasHeightSet))) {
                parent._setSizeDirty();
            }
        };
        DisplayObject.prototype._setSizeDirty = function () {
            if (this._sizeDirty) {
                return;
            }
            this._sizeDirty = true;
            this._setDirty();
            this._setCacheDirty();
            this._setParentSizeDirty();
        };
        DisplayObject.prototype._clearDirty = function () {
            //todo 这个除了文本的，其他都没有clear过
            this._normalDirty = false;
        };
        DisplayObject.prototype._clearSizeDirty = function () {
            //todo 最好在enterFrame都重新算一遍
            this._sizeDirty = false;
        };
        Object.defineProperty(DisplayObject.prototype, "parent", {
            /**
             * 表示包含此显示对象的 DisplayObjectContainer 对象。【只读】
             * 使用 parent 属性可以指定高于显示列表层次结构中当前显示对象的显示对象的相对路径。
             * @member {egret.DisplayObjectContainer} egret.DisplayObject#parent
             */
            get: function () {
                return this._parent;
            },
            enumerable: true,
            configurable: true
        });
        DisplayObject.prototype._parentChanged = function (parent) {
            this._parent = parent;
        };
        Object.defineProperty(DisplayObject.prototype, "x", {
            get: function () {
                return this._x;
            },
            set: function (value) {
                this._setX(value);
            },
            enumerable: true,
            configurable: true
        });
        DisplayObject.prototype._setX = function (value) {
            if (egret.NumberUtils.isNumber(value) && this._x != value) {
                this._x = value;
                this._setDirty();
                this._setParentSizeDirty();
            }
        };
        Object.defineProperty(DisplayObject.prototype, "y", {
            get: function () {
                return this._y;
            },
            set: function (value) {
                this._setY(value);
            },
            enumerable: true,
            configurable: true
        });
        DisplayObject.prototype._setY = function (value) {
            if (egret.NumberUtils.isNumber(value) && this._y != value) {
                this._y = value;
                this._setDirty();
                this._setParentSizeDirty();
            }
        };
        Object.defineProperty(DisplayObject.prototype, "scaleX", {
            get: function () {
                return this._scaleX;
            },
            set: function (value) {
                if (egret.NumberUtils.isNumber(value) && this._scaleX != value) {
                    this._scaleX = value;
                    this._setDirty();
                    this._setParentSizeDirty();
                }
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DisplayObject.prototype, "scaleY", {
            get: function () {
                return this._scaleY;
            },
            set: function (value) {
                if (egret.NumberUtils.isNumber(value) && this._scaleY != value) {
                    this._scaleY = value;
                    this._setDirty();
                    this._setParentSizeDirty();
                }
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DisplayObject.prototype, "anchorOffsetX", {
            get: function () {
                return this._anchorOffsetX;
            },
            set: function (value) {
                if (egret.NumberUtils.isNumber(value) && this._anchorOffsetX != value) {
                    this._anchorOffsetX = value;
                    this._setDirty();
                    this._setParentSizeDirty();
                }
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DisplayObject.prototype, "anchorOffsetY", {
            get: function () {
                return this._anchorOffsetY;
            },
            set: function (value) {
                if (egret.NumberUtils.isNumber(value) && this._anchorOffsetY != value) {
                    this._anchorOffsetY = value;
                    this._setDirty();
                    this._setParentSizeDirty();
                }
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DisplayObject.prototype, "anchorX", {
            get: function () {
                return this._anchorX;
            },
            set: function (value) {
                this._setAnchorX(value);
            },
            enumerable: true,
            configurable: true
        });
        DisplayObject.prototype._setAnchorX = function (value) {
            if (egret.NumberUtils.isNumber(value) && this._anchorX != value) {
                this._anchorX = value;
                this._setDirty();
                this._setParentSizeDirty();
            }
        };
        Object.defineProperty(DisplayObject.prototype, "anchorY", {
            get: function () {
                return this._anchorY;
            },
            set: function (value) {
                this._setAnchorY(value);
            },
            enumerable: true,
            configurable: true
        });
        DisplayObject.prototype._setAnchorY = function (value) {
            if (egret.NumberUtils.isNumber(value) && this._anchorY != value) {
                this._anchorY = value;
                this._setDirty();
                this._setParentSizeDirty();
            }
        };
        Object.defineProperty(DisplayObject.prototype, "visible", {
            get: function () {
                return this._visible;
            },
            set: function (value) {
                this._setVisible(value);
            },
            enumerable: true,
            configurable: true
        });
        DisplayObject.prototype._setVisible = function (value) {
            if (this._visible != value) {
                this._visible = value;
                this._setSizeDirty();
            }
        };
        Object.defineProperty(DisplayObject.prototype, "rotation", {
            get: function () {
                return this._rotation;
            },
            set: function (value) {
                if (egret.NumberUtils.isNumber(value) && this._rotation != value) {
                    this._rotation = value;
                    this._setSizeDirty();
                }
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DisplayObject.prototype, "alpha", {
            get: function () {
                return this._alpha;
            },
            set: function (value) {
                if (egret.NumberUtils.isNumber(value) && this._alpha != value) {
                    this._alpha = value;
                    this._setDirty();
                    this._setCacheDirty();
                }
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DisplayObject.prototype, "skewX", {
            get: function () {
                return this._skewX;
            },
            set: function (value) {
                if (egret.NumberUtils.isNumber(value) && this._skewX != value) {
                    this._skewX = value;
                    this._setSizeDirty();
                }
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DisplayObject.prototype, "skewY", {
            get: function () {
                return this._skewY;
            },
            set: function (value) {
                if (egret.NumberUtils.isNumber(value) && this._skewY != value) {
                    this._skewY = value;
                    this._setSizeDirty();
                }
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DisplayObject.prototype, "touchEnabled", {
            get: function () {
                return this._touchEnabled;
            },
            set: function (value) {
                this._setTouchEnabled(value);
            },
            enumerable: true,
            configurable: true
        });
        DisplayObject.prototype._setTouchEnabled = function (value) {
            this._touchEnabled = value;
        };
        Object.defineProperty(DisplayObject.prototype, "scrollRect", {
            get: function () {
                return this._scrollRect;
            },
            set: function (value) {
                this._setScrollRect(value);
            },
            enumerable: true,
            configurable: true
        });
        DisplayObject.prototype._setScrollRect = function (value) {
            this._scrollRect = value;
            this._setSizeDirty();
        };
        Object.defineProperty(DisplayObject.prototype, "measuredWidth", {
            /**
             * 测量宽度
             * @returns {number}
             */
            get: function () {
                return this._measureBounds().width;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DisplayObject.prototype, "measuredHeight", {
            /**
             * 测量高度
             * @returns {number}
             */
            get: function () {
                return this._measureBounds().height;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DisplayObject.prototype, "explicitWidth", {
            get: function () {
                return this._explicitWidth;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DisplayObject.prototype, "explicitHeight", {
            get: function () {
                return this._explicitHeight;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DisplayObject.prototype, "width", {
            /**
             * 表示显示对象的宽度，以像素为单位。
             * 宽度是根据显示对象内容的范围来计算的。优先顺序为 显式设置宽度 > 测量宽度。
             * @member {number} egret.DisplayObject#width
             * @returns {number}
             */
            get: function () {
                return this._getSize(egret.Rectangle.identity).width;
            },
            /**
             * 显式设置宽度
             * @param value
             */
            set: function (value) {
                this._setWidth(value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DisplayObject.prototype, "height", {
            /**
             * 表示显示对象的高度，以像素为单位。
             * 高度是根据显示对象内容的范围来计算的。优先顺序为 显式设置高度 > 测量高度。
             * @member {number} egret.DisplayObject#height
             * @returns {number}
             */
            get: function () {
                return this._getSize(egret.Rectangle.identity).height;
            },
            /**
             * 显式设置高度
             * @param value
             */
            set: function (value) {
                this._setHeight(value);
            },
            enumerable: true,
            configurable: true
        });
        /**
         * @inheritDoc
         */
        DisplayObject.prototype._setWidth = function (value) {
            this._setSizeDirty();
            this._setCacheDirty();
            this._explicitWidth = value;
            this._hasWidthSet = egret.NumberUtils.isNumber(value);
        };
        /**
         * @inheritDoc
         */
        DisplayObject.prototype._setHeight = function (value) {
            this._setSizeDirty();
            this._setCacheDirty();
            this._explicitHeight = value;
            this._hasHeightSet = egret.NumberUtils.isNumber(value);
        };
        /**
         * @private
         * @param renderContext
         */
        DisplayObject.prototype._draw = function (renderContext) {
            if (!this._visible) {
                this.destroyCacheBounds();
                return;
            }
            var hasDrawCache = this.drawCacheTexture(renderContext);
            if (hasDrawCache) {
                this.destroyCacheBounds();
                return;
            }
            var o = this;
            if (o._colorTransform) {
                renderContext.setGlobalColorTransform(o._colorTransform.matrix);
            }
            renderContext.setAlpha(o.worldAlpha, o.blendMode);
            renderContext.setTransform(o._worldTransform);
            var mask = o.mask || o._scrollRect;
            if (mask) {
                renderContext.pushMask(mask);
            }
            this._render(renderContext);
            if (mask) {
                renderContext.popMask();
            }
            if (o._colorTransform) {
                renderContext.setGlobalColorTransform(null);
            }
            this.destroyCacheBounds();
        };
        DisplayObject.prototype.drawCacheTexture = function (renderContext) {
            var display = this;
            if (display._cacheAsBitmap == false)
                return false;
            if (display._cacheDirty || display._texture_to_render == null || Math.round(display.width) != Math.round(display._texture_to_render._sourceWidth) || Math.round(display.height) != Math.round(display._texture_to_render._sourceHeight)) {
                var cached = display._makeBitmapCache();
                display._cacheDirty = !cached;
            }
            //没有成功生成cache的情形
            if (display._texture_to_render == null)
                return false;
            var renderTexture = display._texture_to_render;
            var offsetX = renderTexture._offsetX;
            var offsetY = renderTexture._offsetY;
            var width = renderTexture._textureWidth;
            var height = renderTexture._textureHeight;
            display._updateTransform();
            renderContext.setAlpha(display.worldAlpha, display.blendMode);
            renderContext.setTransform(display._worldTransform);
            var scale_factor = egret.MainContext.instance.rendererContext.texture_scale_factor;
            var renderFilter = egret.RenderFilter.getInstance();
            renderFilter.drawImage(renderContext, display, 0, 0, width * scale_factor, height * scale_factor, offsetX, offsetY, width, height);
            return true;
        };
        /**
         * @private
         * @param renderContext
         */
        DisplayObject.prototype._updateTransform = function () {
            this._calculateWorldTransform();
        };
        /**
         * 计算全局数据
         * @private
         */
        DisplayObject.prototype._calculateWorldTransform = function () {
            var o = this;
            var worldTransform = o._worldTransform;
            var parent = o._parent;
            worldTransform.identityMatrix(parent._worldTransform);
            this._getMatrix(worldTransform);
            var scrollRect = this._scrollRect;
            if (scrollRect) {
                worldTransform.append(1, 0, 0, 1, -scrollRect.x, -scrollRect.y);
            }
            //            if (this._texture_to_render){
            //                var bounds:egret.Rectangle = DisplayObject.getTransformBounds(o._getSize(Rectangle.identity), o._worldTransform);
            //                o._worldBounds.initialize(bounds.x, bounds.y, bounds.width, bounds.height);
            //            }
            o.worldAlpha = parent.worldAlpha * o._alpha;
        };
        /**
         * @private
         * @param renderContext
         */
        DisplayObject.prototype._render = function (renderContext) {
        };
        /**
         * 获取显示对象的测量边界
         * @method egret.DisplayObject#getBounds
         * @param resultRect {Rectangle} 可选参数，传入用于保存结果的Rectangle对象，避免重复创建对象。
         * @param calculateAnchor {boolean} 可选参数，是否会计算锚点。
         * @returns {Rectangle}
         */
        DisplayObject.prototype.getBounds = function (resultRect, calculateAnchor) {
            if (calculateAnchor === void 0) { calculateAnchor = true; }
            //            if (this._cacheBounds.x == 0 && this._cacheBounds.y == 0 && this._cacheBounds.width == 0 && this._cacheBounds.height == 0) {
            var rect = this._measureBounds();
            var w = this._hasWidthSet ? this._explicitWidth : rect.width;
            var h = this._hasHeightSet ? this._explicitHeight : rect.height;
            //记录测量宽高
            this._rectW = rect.width;
            this._rectH = rect.height;
            this._clearSizeDirty();
            var x = rect.x;
            var y = rect.y;
            var anchorX = 0, anchorY = 0;
            if (calculateAnchor) {
                if (this._anchorX != 0 || this._anchorY != 0) {
                    anchorX = w * this._anchorX;
                    anchorY = h * this._anchorY;
                }
                else {
                    anchorX = this._anchorOffsetX;
                    anchorY = this._anchorOffsetY;
                }
            }
            this._cacheBounds.initialize(x - anchorX, y - anchorY, w, h);
            //            }
            var result = this._cacheBounds;
            if (!resultRect) {
                resultRect = new egret.Rectangle();
            }
            return resultRect.initialize(result.x, result.y, result.width, result.height);
        };
        DisplayObject.prototype.destroyCacheBounds = function () {
            this._cacheBounds.x = 0;
            this._cacheBounds.y = 0;
            this._cacheBounds.width = 0;
            this._cacheBounds.height = 0;
        };
        DisplayObject.prototype._getConcatenatedMatrix = function () {
            //todo:采用local_matrix模式下这里的逻辑需要修改
            var matrix = DisplayObject.identityMatrixForGetConcatenated.identity();
            var o = this;
            while (o != null) {
                if (o._anchorX != 0 || o._anchorY != 0) {
                    var bounds = o._getSize(egret.Rectangle.identity);
                    matrix.prependTransform(o._x, o._y, o._scaleX, o._scaleY, o._rotation, o._skewX, o._skewY, bounds.width * o._anchorX, bounds.height * o._anchorY);
                }
                else {
                    matrix.prependTransform(o._x, o._y, o._scaleX, o._scaleY, o._rotation, o._skewX, o._skewY, o._anchorOffsetX, o._anchorOffsetY);
                }
                if (o._scrollRect) {
                    matrix.prepend(1, 0, 0, 1, -o._scrollRect.x, -o._scrollRect.y);
                }
                o = o._parent;
            }
            return matrix;
        };
        /**
         * 将 point 对象从显示对象的（本地）坐标转换为舞台（全局）坐标。
         * @method egret.DisplayObject#localToGlobal
         * @param x {number} 本地x坐标
         * @param y {number} 本地y坐标
         * @param resultPoint {Point} 可选参数，传入用于保存结果的Point对象，避免重复创建对象。
         * @returns {egret.Point} 具有相对于舞台的坐标的 Point 对象。
         */
        DisplayObject.prototype.localToGlobal = function (x, y, resultPoint) {
            if (x === void 0) { x = 0; }
            if (y === void 0) { y = 0; }
            var mtx = this._getConcatenatedMatrix();
            mtx.append(1, 0, 0, 1, x, y);
            if (!resultPoint) {
                resultPoint = new egret.Point();
            }
            resultPoint.x = mtx.tx;
            resultPoint.y = mtx.ty;
            return resultPoint;
        };
        /**
         * 将指定舞台坐标（全局）转换为显示对象（本地）坐标。
         * @method egret.DisplayObject#globalToLocal
         * @param x {number} 全局x坐标
         * @param y {number} 全局y坐标
         * @param resultPoint {Point} 可选参数，传入用于保存结果的Point对象，避免重复创建对象。
         * @returns {egret.Point} 具有相对于显示对象的坐标的 Point 对象。
         */
        DisplayObject.prototype.globalToLocal = function (x, y, resultPoint) {
            if (x === void 0) { x = 0; }
            if (y === void 0) { y = 0; }
            var mtx = this._getConcatenatedMatrix();
            mtx.invert();
            mtx.append(1, 0, 0, 1, x, y);
            if (!resultPoint) {
                resultPoint = new egret.Point();
            }
            resultPoint.x = mtx.tx;
            resultPoint.y = mtx.ty;
            return resultPoint;
        };
        /**
         * 检测指定坐标是否在显示对象内
         * @method egret.DisplayObject#hitTest
         * @param x {number} 检测坐标的x轴
         * @param y {number} 检测坐标的y轴
         * @param ignoreTouchEnabled {boolean} 是否忽略TouchEnabled
         * @returns {*}
         */
        DisplayObject.prototype.hitTest = function (x, y, ignoreTouchEnabled) {
            if (ignoreTouchEnabled === void 0) { ignoreTouchEnabled = false; }
            if (!this._visible || (!ignoreTouchEnabled && !this._touchEnabled)) {
                return null;
            }
            var bound = this._getSize(egret.Rectangle.identity);
            if (0 <= x && x < bound.width && 0 <= y && y < bound.height) {
                if (this.mask || this._scrollRect) {
                    if (this._scrollRect && x > this._scrollRect.x && y > this._scrollRect.y && x < this._scrollRect.x + this._scrollRect.width && y < this._scrollRect.y + this._scrollRect.height) {
                        return this;
                    }
                    else if (this.mask && this.mask.x <= x && x < this.mask.x + this.mask.width && this.mask.y <= y && y < this.mask.y + this.mask.height) {
                        return this;
                    }
                    return null;
                }
                return this;
            }
            else {
                return null;
            }
        };
        /**
         * 计算显示对象，以确定它是否与 x 和 y 参数指定的点重叠或相交。x 和 y 参数指定舞台的坐标空间中的点，而不是包含显示对象的显示对象容器中的点（除非显示对象容器是舞台）。
         * 注意，不要在大量物体中使用精确碰撞像素检测，这回带来巨大的性能开销
         * @method egret.DisplayObject#hitTestPoint
         * @param x {number}  要测试的此对象的 x 坐标。
         * @param y {number}  要测试的此对象的 y 坐标。
         * @param shapeFlag {boolean} 是检查对象 (true) 的实际像素，还是检查边框 (false) 的实际像素。
         * @returns {boolean} 如果显示对象与指定的点重叠或相交，则为 true；否则为 false。
         */
        DisplayObject.prototype.hitTestPoint = function (x, y, shapeFlag) {
            var p = this.globalToLocal(x, y);
            if (!shapeFlag) {
                return !!this.hitTest(p.x, p.y, true);
            }
            else {
                if (!this._hitTestPointTexture) {
                    this._hitTestPointTexture = new egret.RenderTexture();
                }
                var testTexture = this._hitTestPointTexture;
                testTexture.drawToTexture(this);
                var pixelData = testTexture.getPixel32(p.x - this._hitTestPointTexture._offsetX, p.y - this._hitTestPointTexture._offsetY);
                if (pixelData[3] != 0) {
                    return true;
                }
                return false;
            }
        };
        DisplayObject.prototype._getMatrix = function (parentMatrix) {
            if (!parentMatrix) {
                parentMatrix = egret.Matrix.identity.identity();
            }
            var anchorX, anchorY;
            var resultPoint = this._getOffsetPoint();
            anchorX = resultPoint.x;
            anchorY = resultPoint.y;
            var matrix = this.__hack_local_matrix;
            if (matrix) {
                parentMatrix.append(matrix.a, matrix.b, matrix.c, matrix.d, matrix.tx, matrix.ty);
                parentMatrix.append(1, 0, 0, 1, -anchorX, -anchorY);
            }
            else {
                parentMatrix.appendTransform(this._x, this._y, this._scaleX, this._scaleY, this._rotation, this._skewX, this._skewY, anchorX, anchorY);
            }
            return parentMatrix;
        };
        DisplayObject.prototype._getSize = function (resultRect) {
            if (this._hasHeightSet && this._hasWidthSet) {
                return resultRect.initialize(0, 0, this._explicitWidth, this._explicitHeight);
            }
            return this._measureSize(resultRect);
        };
        /**
         * 测量显示对象坐标与大小
         */
        DisplayObject.prototype._measureSize = function (resultRect) {
            if (this._sizeDirty) {
                resultRect = this._measureBounds();
                this._rectW = resultRect.width;
                this._rectH = resultRect.height;
                this._clearSizeDirty();
            }
            else {
                resultRect.width = this._rectW;
                resultRect.height = this._rectH;
            }
            resultRect.x = 0;
            resultRect.y = 0;
            return resultRect;
        };
        /**
         * 测量显示对象坐标，这个方法需要子类重写
         * @returns {egret.Rectangle}
         * @private
         */
        DisplayObject.prototype._measureBounds = function () {
            return egret.Rectangle.identity.initialize(0, 0, 0, 0);
        };
        DisplayObject.prototype._getOffsetPoint = function () {
            var o = this;
            var regX = o._anchorOffsetX;
            var regY = o._anchorOffsetY;
            if (o._anchorX != 0 || o._anchorY != 0) {
                var bounds = o._getSize(egret.Rectangle.identity);
                regX = o._anchorX * bounds.width;
                regY = o._anchorY * bounds.height;
            }
            var result = egret.Point.identity;
            result.x = regX;
            result.y = regY;
            return result;
        };
        DisplayObject.prototype._onAddToStage = function () {
            this._stage = egret.MainContext.instance.stage;
            egret.DisplayObjectContainer.__EVENT__ADD_TO_STAGE_LIST.push(this);
        };
        DisplayObject.prototype._onRemoveFromStage = function () {
            egret.DisplayObjectContainer.__EVENT__REMOVE_FROM_STAGE_LIST.push(this);
        };
        Object.defineProperty(DisplayObject.prototype, "stage", {
            /**
             * 显示对象的舞台。【只读】
             * 例如，您可以创建多个显示对象并加载到显示列表中，每个显示对象的 stage 属性是指相同的 Stage 对象。
             * 如果显示对象未添加到显示列表，则其 stage 属性会设置为 null。
             * @member {number} egret.DisplayObject#stage
             * @returns {egret.Stage}
             */
            get: function () {
                return this._stage;
            },
            enumerable: true,
            configurable: true
        });
        DisplayObject.prototype.addEventListener = function (type, listener, thisObject, useCapture, priority) {
            if (useCapture === void 0) { useCapture = false; }
            if (priority === void 0) { priority = 0; }
            _super.prototype.addEventListener.call(this, type, listener, thisObject, useCapture, priority);
            var isEnterFrame = (type == egret.Event.ENTER_FRAME);
            if (isEnterFrame || type == egret.Event.RENDER) {
                var list = isEnterFrame ? DisplayObject._enterFrameCallBackList : DisplayObject._renderCallBackList;
                this._insertEventBin(list, listener, thisObject, priority, this);
            }
        };
        DisplayObject.prototype.removeEventListener = function (type, listener, thisObject, useCapture) {
            if (useCapture === void 0) { useCapture = false; }
            _super.prototype.removeEventListener.call(this, type, listener, thisObject, useCapture);
            var isEnterFrame = (type == egret.Event.ENTER_FRAME);
            if (isEnterFrame || type == egret.Event.RENDER) {
                var list = isEnterFrame ? DisplayObject._enterFrameCallBackList : DisplayObject._renderCallBackList;
                this._removeEventBin(list, listener, thisObject, this);
            }
        };
        DisplayObject.prototype.dispatchEvent = function (event) {
            if (!event._bubbles) {
                return _super.prototype.dispatchEvent.call(this, event);
            }
            var list = [];
            var target = this;
            while (target) {
                list.push(target);
                target = target._parent;
            }
            event._reset();
            this._dispatchPropagationEvent(event, list);
            return !event._isDefaultPrevented;
        };
        DisplayObject.prototype._dispatchPropagationEvent = function (event, list, targetIndex) {
            var length = list.length;
            var eventPhase = 1;
            for (var i = length - 1; i >= 0; i--) {
                var currentTarget = list[i];
                event._currentTarget = currentTarget;
                event._target = this;
                event._eventPhase = eventPhase;
                currentTarget._notifyListener(event);
                if (event._isPropagationStopped || event._isPropagationImmediateStopped) {
                    return;
                }
            }
            var eventPhase = 2;
            var currentTarget = list[0];
            event._currentTarget = currentTarget;
            event._target = this;
            event._eventPhase = eventPhase;
            currentTarget._notifyListener(event);
            if (event._isPropagationStopped || event._isPropagationImmediateStopped) {
                return;
            }
            var eventPhase = 3;
            for (i = 1; i < length; i++) {
                var currentTarget = list[i];
                event._currentTarget = currentTarget;
                event._target = this;
                event._eventPhase = eventPhase;
                currentTarget._notifyListener(event);
                if (event._isPropagationStopped || event._isPropagationImmediateStopped) {
                    return;
                }
            }
        };
        DisplayObject.prototype.willTrigger = function (type) {
            var parent = this;
            while (parent) {
                if (parent.hasEventListener(type))
                    return true;
                parent = parent._parent;
            }
            return false;
        };
        Object.defineProperty(DisplayObject.prototype, "cacheAsBitmap", {
            get: function () {
                return this._cacheAsBitmap;
            },
            set: function (bool) {
                this._cacheAsBitmap = bool;
                if (bool) {
                    egret.callLater(this._makeBitmapCache, this);
                }
                else {
                    this._texture_to_render = null;
                }
            },
            enumerable: true,
            configurable: true
        });
        DisplayObject.prototype._makeBitmapCache = function () {
            if (!this.renderTexture) {
                this.renderTexture = new egret.RenderTexture();
            }
            var result = this.renderTexture.drawToTexture(this);
            if (result) {
                this._texture_to_render = this.renderTexture;
            }
            else {
                this._texture_to_render = null;
            }
            return result;
        };
        DisplayObject.prototype._setCacheDirty = function (dirty) {
            if (dirty === void 0) { dirty = true; }
            this._cacheDirty = dirty;
        };
        DisplayObject.getTransformBounds = function (bounds, mtx) {
            var x = bounds.x, y = bounds.y;
            //            var x, y;
            var width = bounds.width, height = bounds.height;
            if (x || y) {
                mtx.appendTransform(0, 0, 1, 1, 0, 0, 0, -x, -y);
            }
            //        if (matrix) { mtx.prependMatrix(matrix); }
            var x_a = width * mtx.a, x_b = width * mtx.b;
            var y_c = height * mtx.c, y_d = height * mtx.d;
            var tx = mtx.tx, ty = mtx.ty;
            var minX = tx, maxX = tx, minY = ty, maxY = ty;
            if ((x = x_a + tx) < minX) {
                minX = x;
            }
            else if (x > maxX) {
                maxX = x;
            }
            if ((x = x_a + y_c + tx) < minX) {
                minX = x;
            }
            else if (x > maxX) {
                maxX = x;
            }
            if ((x = y_c + tx) < minX) {
                minX = x;
            }
            else if (x > maxX) {
                maxX = x;
            }
            if ((y = x_b + ty) < minY) {
                minY = y;
            }
            else if (y > maxY) {
                maxY = y;
            }
            if ((y = x_b + y_d + ty) < minY) {
                minY = y;
            }
            else if (y > maxY) {
                maxY = y;
            }
            if ((y = y_d + ty) < minY) {
                minY = y;
            }
            else if (y > maxY) {
                maxY = y;
            }
            return bounds.initialize(minX, minY, maxX - minX, maxY - minY);
        };
        Object.defineProperty(DisplayObject.prototype, "colorTransform", {
            get: function () {
                return this._colorTransform;
            },
            set: function (value) {
                this._colorTransform = value;
            },
            enumerable: true,
            configurable: true
        });
        /**
         * @private
         * @returns {Matrix}
         */
        DisplayObject.identityMatrixForGetConcatenated = new egret.Matrix();
        DisplayObject._enterFrameCallBackList = [];
        DisplayObject._renderCallBackList = [];
        return DisplayObject;
    })(egret.EventDispatcher);
    egret.DisplayObject = DisplayObject;
    DisplayObject.prototype.__class__ = "egret.DisplayObject";
    var ColorTransform = (function () {
        function ColorTransform() {
            this.matrix = null;
        }
        ColorTransform.prototype.updateColor = function (r, g, b, a, addR, addG, addB, addA) {
            //todo;
        };
        return ColorTransform;
    })();
    egret.ColorTransform = ColorTransform;
    ColorTransform.prototype.__class__ = "egret.ColorTransform";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @extends egret.DisplayObject
     * @class egret.DisplayObjectContainer
     * @classdesc
     * DisplayObjectContainer 类是可用作显示列表中显示对象容器的所有对象的基类。
     * 该显示列表管理运行时中显示的所有对象。使用 DisplayObjectContainer 类排列显示列表中的显示对象。每个 DisplayObjectContainer 对象都有自己的子级列表，用于组织对象的 Z 轴顺序。Z 轴顺序是由前至后的顺序，可确定哪个对象绘制在前，哪个对象绘制在后等。
     */
    var DisplayObjectContainer = (function (_super) {
        __extends(DisplayObjectContainer, _super);
        function DisplayObjectContainer() {
            _super.call(this);
            this._touchChildren = true;
            this._children = [];
        }
        Object.defineProperty(DisplayObjectContainer.prototype, "touchChildren", {
            /**
             * 指定此对象的子项以及子孙项是否接收鼠标/触摸事件
             * 默认值为 true 即可以接收。
             * @member {boolean} egret.DisplayObjectContainer#touchChildren
             */
            get: function () {
                return this._touchChildren;
            },
            set: function (value) {
                this._touchChildren = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DisplayObjectContainer.prototype, "numChildren", {
            /**
             * 返回此对象的子项数目。【只读】
             * @member {number} egret.DisplayObjectContainer#numChildren
             */
            get: function () {
                return this._children.length;
            },
            enumerable: true,
            configurable: true
        });
        /**
         * 更改现有子项在显示对象容器中的位置。这会影响子对象的分层。
         * @method egret.DisplayObjectContainer#setChildIndex
         * @param child {egret.DisplayObject} 要为其更改索引编号的 DisplayObject 子实例。
         * @param index {number} 生成的 child 显示对象的索引编号。当新的索引编号小于0或大于已有子元件数量时，新加入的DisplayObject对象将会放置于最上层。
         */
        DisplayObjectContainer.prototype.setChildIndex = function (child, index) {
            this.doSetChildIndex(child, index);
        };
        DisplayObjectContainer.prototype.doSetChildIndex = function (child, index) {
            var lastIdx = this._children.indexOf(child);
            if (lastIdx < 0) {
                egret.Logger.fatal("child不在当前容器内");
            }
            //从原来的位置删除
            this._children.splice(lastIdx, 1);
            //放到新的位置
            if (index < 0 || this._children.length <= index) {
                this._children.push(child);
            }
            else {
                this._children.splice(index, 0, child);
            }
        };
        /**
         * 将一个 DisplayObject 子实例添加到该 DisplayObjectContainer 实例中。子项将被添加到该 DisplayObjectContainer 实例中其他所有子项的前（上）面。（要将某子项添加到特定索引位置，请使用 addChildAt() 方法。）
         * @method egret.DisplayObjectContainer#addChild
         * @param child {egret.DisplayObject} 要作为该 DisplayObjectContainer 实例的子项添加的 DisplayObject 实例。
         * @returns {egret.DisplayObject} 在 child 参数中传递的 DisplayObject 实例。
         */
        DisplayObjectContainer.prototype.addChild = function (child) {
            var index = this._children.length;
            if (child._parent == this)
                index--;
            return this._doAddChild(child, index);
        };
        /**
         * 将一个 DisplayObject 子实例添加到该 DisplayObjectContainer 实例中。该子项将被添加到指定的索引位置。索引为 0 表示该 DisplayObjectContainer 对象的显示列表的后（底）部。如果索引值为-1，则表示该DisplayObjectContainer 对象的显示列表的前（上）部。
         * @method egret.DisplayObjectContainer#addChildAt
         * @param child {egret.DisplayObject} 要作为该 DisplayObjectContainer 实例的子项添加的 DisplayObject 实例。
         * @param index {number} 添加该子项的索引位置。 如果指定当前占用的索引位置，则该位置以及所有更高位置上的子对象会在子级列表中上移一个位置。
         * @returns {egret.DisplayObject} 在 child 参数中传递的 DisplayObject 实例。
         */
        DisplayObjectContainer.prototype.addChildAt = function (child, index) {
            return this._doAddChild(child, index);
        };
        DisplayObjectContainer.prototype._doAddChild = function (child, index, notifyListeners) {
            if (notifyListeners === void 0) { notifyListeners = true; }
            if (child == this)
                return child;
            if (index < 0 || index > this._children.length) {
                egret.Logger.fatal("提供的索引超出范围");
                return child;
            }
            var host = child._parent;
            if (host == this) {
                this.doSetChildIndex(child, index);
                return child;
            }
            if (host) {
                var index = host._children.indexOf(child);
                if (index >= 0) {
                    host._doRemoveChild(index);
                }
            }
            this._children.splice(index, 0, child);
            child._parentChanged(this);
            if (notifyListeners)
                child.dispatchEventWith(egret.Event.ADDED, true);
            if (this._stage) {
                child._onAddToStage();
                var list = DisplayObjectContainer.__EVENT__ADD_TO_STAGE_LIST;
                while (list.length > 0) {
                    var childAddToStage = list.shift();
                    childAddToStage.dispatchEventWith(egret.Event.ADDED_TO_STAGE);
                }
            }
            child._setDirty();
            this._setSizeDirty();
            return child;
        };
        /**
         * 将一个 DisplayObject 子实例从 DisplayObjectContainer 实例中移除。
         * @method egret.DisplayObjectContainer#removeChild
         * @param child {egret.DisplayObject} 要删除的 DisplayObject 实例。
         * @returns {egret.DisplayObject} 在 child 参数中传递的 DisplayObject 实例。
         */
        DisplayObjectContainer.prototype.removeChild = function (child) {
            var index = this._children.indexOf(child);
            if (index >= 0) {
                return this._doRemoveChild(index);
            }
            else {
                egret.Logger.fatal("child未被addChild到该parent");
                return null;
            }
        };
        /**
         * 从 DisplayObjectContainer 的子列表中指定的 index 位置删除子 DisplayObject。
         * @method egret.DisplayObjectContainer#removeChildAt
         * @param index {number} 要删除的 DisplayObject 的子索引。
         * @returns {egret.DisplayObject} 已删除的 DisplayObject 实例。
         */
        DisplayObjectContainer.prototype.removeChildAt = function (index) {
            if (index >= 0 && index < this._children.length) {
                return this._doRemoveChild(index);
            }
            else {
                egret.Logger.fatal("提供的索引超出范围");
                return null;
            }
        };
        DisplayObjectContainer.prototype._doRemoveChild = function (index, notifyListeners) {
            if (notifyListeners === void 0) { notifyListeners = true; }
            var locChildren = this._children;
            var child = locChildren[index];
            if (notifyListeners)
                child.dispatchEventWith(egret.Event.REMOVED, true);
            if (this._stage) {
                child._onRemoveFromStage();
                var list = DisplayObjectContainer.__EVENT__REMOVE_FROM_STAGE_LIST;
                while (list.length > 0) {
                    var childAddToStage = list.shift();
                    childAddToStage.dispatchEventWith(egret.Event.REMOVED_FROM_STAGE);
                    childAddToStage._stage = null;
                }
            }
            child._parentChanged(null);
            locChildren.splice(index, 1);
            this._setSizeDirty();
            return child;
        };
        /**
         * 返回位于指定索引处的子显示对象实例。
         * @method egret.DisplayObjectContainer#getChildAt
         * @param index {number} 子对象的索引位置。
         * @returns {egret.DisplayObject} 位于指定索引位置处的子显示对象。
         */
        DisplayObjectContainer.prototype.getChildAt = function (index) {
            if (index >= 0 && index < this._children.length) {
                return this._children[index];
            }
            else {
                egret.Logger.fatal("提供的索引超出范围");
                return null;
            }
        };
        /**
         * 确定指定显示对象是 DisplayObjectContainer 实例的子项还是该实例本身。搜索包括整个显示列表（其中包括此 DisplayObjectContainer 实例）。孙项、曾孙项等，每项都返回 true。
         * @method egret.DisplayObjectContainer#contains
         * @param child {egret.DisplayObject} 要测试的子对象。
         * @returns {boolean} 如果指定的显示对象为DisplayObjectContainer该实例本身，则返回true，如果指定的显示对象为当前实例子项，则返回false。
         */
        DisplayObjectContainer.prototype.contains = function (child) {
            while (child) {
                if (child == this) {
                    return true;
                }
                child = child._parent;
            }
            return false;
        };
        /**
         * 在子级列表中两个指定的索引位置，交换子对象的 Z 轴顺序（前后顺序）。显示对象容器中所有其他子对象的索引位置保持不变。
         * @method egret.DisplayObjectContainer#swapChildrenAt
         * @param index1 {number} 第一个子对象的索引位置。
         * @param index2 {number} 第二个子对象的索引位置。
         */
        DisplayObjectContainer.prototype.swapChildrenAt = function (index1, index2) {
            if (index1 >= 0 && index1 < this._children.length && index2 >= 0 && index2 < this._children.length) {
                this._swapChildrenAt(index1, index2);
            }
            else {
                egret.Logger.fatal("提供的索引超出范围");
            }
        };
        /**
         * 交换两个指定子对象的 Z 轴顺序（从前到后顺序）。显示对象容器中所有其他子对象的索引位置保持不变。
         * @method egret.DisplayObjectContainer#swapChildren
         * @param child1 {egret.DisplayObject} 第一个子对象。
         * @param child2 {egret.DisplayObject} 第二个子对象。
         */
        DisplayObjectContainer.prototype.swapChildren = function (child1, child2) {
            var index1 = this._children.indexOf(child1);
            var index2 = this._children.indexOf(child2);
            if (index1 == -1 || index2 == -1) {
                egret.Logger.fatal("child未被addChild到该parent");
            }
            else {
                this._swapChildrenAt(index1, index2);
            }
        };
        DisplayObjectContainer.prototype._swapChildrenAt = function (index1, index2) {
            if (index1 == index2) {
                return;
            }
            var list = this._children;
            var child = list[index1];
            list[index1] = list[index2];
            list[index2] = child;
        };
        /**
         * 返回 DisplayObject 的 child 实例的索引位置。
         * @method egret.DisplayObjectContainer#getChildIndex
         * @param child {egret.DisplayObject} 要标识的 DisplayObject 实例。
         * @returns {number} 要标识的子显示对象的索引位置。
         */
        DisplayObjectContainer.prototype.getChildIndex = function (child) {
            return this._children.indexOf(child);
        };
        /**
         * 从 DisplayObjectContainer 实例的子级列表中删除所有 child DisplayObject 实例。
         * @method egret.DisplayObjectContainer#removeChildren
         */
        DisplayObjectContainer.prototype.removeChildren = function () {
            var locChildren = this._children;
            for (var i = locChildren.length - 1; i >= 0; i--) {
                this._doRemoveChild(i);
            }
        };
        DisplayObjectContainer.prototype._updateTransform = function () {
            if (!this._visible) {
                return;
            }
            _super.prototype._updateTransform.call(this);
            for (var i = 0, length = this._children.length; i < length; i++) {
                var child = this._children[i];
                child._updateTransform();
            }
        };
        DisplayObjectContainer.prototype._render = function (renderContext) {
            for (var i = 0, length = this._children.length; i < length; i++) {
                var child = this._children[i];
                child._draw(renderContext);
            }
        };
        /**
         * @see egret.DisplayObject._measureBounds
         * @returns {null}
         * @private
         */
        DisplayObjectContainer.prototype._measureBounds = function () {
            var minX = 0, maxX = 0, minY = 0, maxY = 0;
            var l = this._children.length;
            for (var i = 0; i < l; i++) {
                var child = this._children[i];
                if (!child._visible) {
                    continue;
                }
                var childBounds = child.getBounds(egret.Rectangle.identity, false);
                var childBoundsX = childBounds.x;
                var childBoundsY = childBounds.y;
                var childBoundsW = childBounds.width;
                var childBoundsH = childBounds.height;
                var childMatrix = child._getMatrix();
                var bounds = egret.DisplayObject.getTransformBounds(egret.Rectangle.identity.initialize(childBoundsX, childBoundsY, childBoundsW, childBoundsH), childMatrix);
                var x1 = bounds.x, y1 = bounds.y, x2 = bounds.width + bounds.x, y2 = bounds.height + bounds.y;
                if (x1 < minX || i == 0) {
                    minX = x1;
                }
                if (x2 > maxX || i == 0) {
                    maxX = x2;
                }
                if (y1 < minY || i == 0) {
                    minY = y1;
                }
                if (y2 > maxY || i == 0) {
                    maxY = y2;
                }
            }
            return egret.Rectangle.identity.initialize(minX, minY, maxX - minX, maxY - minY);
        };
        /**
         * 检测指定坐标是否在显示对象内
         * @method egret.DisplayObjectContainer#hitTest
         * @see egret.DisplayObject.hitTest
         * @param x {number} 检测坐标的x轴
         * @param y {number} 检测坐标的y轴
         * @param ignoreTouchEnabled {boolean} 是否忽略TouchEnabled
         * @returns {egret.DisplayObject} 返回所发生碰撞的DisplayObject对象
         */
        DisplayObjectContainer.prototype.hitTest = function (x, y, ignoreTouchEnabled) {
            if (ignoreTouchEnabled === void 0) { ignoreTouchEnabled = false; }
            var result;
            if (!this._visible) {
                return null;
            }
            if (this._scrollRect) {
                if (x < this._scrollRect.x || y < this._scrollRect.y || x > this._scrollRect.x + this._scrollRect.width || y > this._scrollRect.y + this._scrollRect.height) {
                    return null;
                }
            }
            else if (this.mask) {
                if (this.mask.x > x || x > this.mask.x + this.mask.width || this.mask.y > y || y > this.mask.y + this.mask.height) {
                    return null;
                }
            }
            var children = this._children;
            var l = children.length;
            var touchChildren = this._touchChildren; //这里不用考虑父级的touchChildren，从父级调用下来过程中已经判断过了。
            for (var i = l - 1; i >= 0; i--) {
                var child = children[i];
                var mtx = child._getMatrix();
                var scrollRect = child._scrollRect;
                if (scrollRect) {
                    mtx.append(1, 0, 0, 1, -scrollRect.x, -scrollRect.y);
                }
                mtx.invert();
                var point = egret.Matrix.transformCoords(mtx, x, y);
                var childHitTestResult = child.hitTest(point.x, point.y, true);
                if (childHitTestResult) {
                    if (!touchChildren) {
                        return this;
                    }
                    if (childHitTestResult._touchEnabled && touchChildren) {
                        return childHitTestResult;
                    }
                    result = this;
                }
            }
            if (result) {
                return result;
            }
            else if (this._texture_to_render || this["graphics"]) {
                return _super.prototype.hitTest.call(this, x, y, ignoreTouchEnabled);
            }
            return null;
        };
        DisplayObjectContainer.prototype._onAddToStage = function () {
            _super.prototype._onAddToStage.call(this);
            var length = this._children.length;
            for (var i = 0; i < length; i++) {
                var child = this._children[i];
                child._onAddToStage();
            }
        };
        DisplayObjectContainer.prototype._onRemoveFromStage = function () {
            _super.prototype._onRemoveFromStage.call(this);
            var length = this._children.length;
            for (var i = 0; i < length; i++) {
                var child = this._children[i];
                child._onRemoveFromStage();
            }
        };
        /**
         * 返回具有指定名称的子显示对象。
         * @method egret.DisplayObjectContainer#getChildByName
         * @param name {string} 要返回的子项的名称。
         * @returns {egret.DisplayObject} 具有指定名称的子显示对象。
         */
        DisplayObjectContainer.prototype.getChildByName = function (name) {
            var locChildren = this._children;
            var length = locChildren.length;
            var displayObject;
            for (var i = 0; i < length; i++) {
                displayObject = locChildren[i];
                if (displayObject.name == name) {
                    return displayObject;
                }
            }
            return null;
        };
        DisplayObjectContainer.__EVENT__ADD_TO_STAGE_LIST = [];
        DisplayObjectContainer.__EVENT__REMOVE_FROM_STAGE_LIST = [];
        return DisplayObjectContainer;
    })(egret.DisplayObject);
    egret.DisplayObjectContainer = DisplayObjectContainer;
    DisplayObjectContainer.prototype.__class__ = "egret.DisplayObjectContainer";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.Stage
     * @classdesc Stage 类代表主绘图区。
     */
    var Stage = (function (_super) {
        __extends(Stage, _super);
        function Stage(width, height) {
            if (width === void 0) { width = 480; }
            if (height === void 0) { height = 800; }
            _super.call(this);
            this.touchEnabled = true;
            this._stage = this;
            this._stageWidth = width;
            this._stageHeight = height;
        }
        /**
         * 调用 invalidate() 方法后，在显示列表下次呈现时，Egret 会向每个已注册侦听 render 事件的显示对象发送一个 render 事件。
         * 每次您希望 Egret 发送 render 事件时，都必须调用 invalidate() 方法。
         * @method egret.Stage#invalidate
         */
        Stage.prototype.invalidate = function () {
            Stage._invalidateRenderFlag = true;
        };
        Object.defineProperty(Stage.prototype, "scaleMode", {
            get: function () {
                return this._scaleMode;
            },
            set: function (value) {
                if (this._scaleMode != value) {
                    this._scaleMode = value;
                    this.setResolutionPolicy();
                }
            },
            enumerable: true,
            configurable: true
        });
        /**
         * 当屏幕尺寸改变时调用
         */
        Stage.prototype.changeSize = function () {
            //重新设置屏幕适配策略
            this.setResolutionPolicy();
            //触发Event.RESIZE事件
            this.dispatchEventWith(egret.Event.RESIZE);
        };
        /**
         * 设置屏幕适配策略
         */
        Stage.prototype.setResolutionPolicy = function () {
            var scaleModeEnum = {};
            scaleModeEnum[egret.StageScaleMode.NO_SCALE] = new egret.NoScale();
            scaleModeEnum[egret.StageScaleMode.SHOW_ALL] = new egret.ShowAll();
            scaleModeEnum[egret.StageScaleMode.NO_BORDER] = new egret.FixedWidth();
            scaleModeEnum[egret.StageScaleMode.EXACT_FIT] = new egret.FullScreen();
            var content = scaleModeEnum[this._scaleMode];
            if (!content) {
                throw new Error("使用了尚未实现的ScaleMode");
            }
            var container = new egret.EqualToFrame();
            var policy = new egret.ResolutionPolicy(container, content);
            egret.StageDelegate.getInstance()._setResolutionPolicy(policy);
            this._stageWidth = egret.StageDelegate.getInstance()._stageWidth;
            this._stageHeight = egret.StageDelegate.getInstance()._stageHeight;
        };
        Object.defineProperty(Stage.prototype, "stageWidth", {
            /**
             * 舞台宽度（坐标系宽度，非设备宽度）
             * @member {number} egret.Stage#stageWidth
             */
            get: function () {
                return this._stageWidth;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Stage.prototype, "stageHeight", {
            /**
             * 舞台高度（坐标系高度，非设备高度）
             * @member {number} egret.Stage#stageHeight
             */
            get: function () {
                return this._stageHeight;
            },
            enumerable: true,
            configurable: true
        });
        /**
         * @member egret.Stage#hitTest
         * @see egret.DisplayObject#hitTest
         * @param x
         * @param y
         * @returns {egret.DisplayObject}
         */
        Stage.prototype.hitTest = function (x, y, ignoreTouchEnabled) {
            if (ignoreTouchEnabled === void 0) { ignoreTouchEnabled = false; }
            if (!this._touchEnabled) {
                return null;
            }
            var result;
            if (!this._touchChildren) {
                return this;
            }
            var children = this._children;
            var l = children.length;
            for (var i = l - 1; i >= 0; i--) {
                var child = children[i];
                var mtx = child._getMatrix();
                var scrollRect = child._scrollRect;
                if (scrollRect) {
                    mtx.append(1, 0, 0, 1, -scrollRect.x, -scrollRect.y);
                }
                mtx.invert();
                var point = egret.Matrix.transformCoords(mtx, x, y);
                result = child.hitTest(point.x, point.y, true);
                if (result) {
                    if (result._touchEnabled) {
                        return result;
                    }
                }
            }
            return this;
        };
        /**
         * 返回舞台尺寸范围
         * @member egret.Stage#getBounds
         * @see egret.DisplayObject#getBounds
         * @param resultRect {egret.Rectangle} 可选参数，传入用于保存结果的Rectangle对象，避免重复创建对象。
         * @returns {egret.Rectangle}
         */
        Stage.prototype.getBounds = function (resultRect) {
            if (!resultRect) {
                resultRect = new egret.Rectangle();
            }
            return resultRect.initialize(0, 0, this._stageWidth, this._stageHeight);
        };
        Stage.prototype._updateTransform = function () {
            for (var i = 0, length = this._children.length; i < length; i++) {
                var child = this._children[i];
                child._updateTransform();
            }
        };
        Object.defineProperty(Stage.prototype, "focus", {
            get: function () {
                return null;
            },
            enumerable: true,
            configurable: true
        });
        Stage._invalidateRenderFlag = false;
        return Stage;
    })(egret.DisplayObjectContainer);
    egret.Stage = Stage;
    Stage.prototype.__class__ = "egret.Stage";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    /**
     * StageScaleMode 类为 Stage.scaleMode 属性提供值。
     * @class egret.StageScaleMode
     */
    var StageScaleMode = (function () {
        function StageScaleMode() {
        }
        /**
         * 指定整个应用程序填满指定区域，不会发生扭曲，但有可能会进行一些裁切，同时保持应用程序的原始高宽比。
         * @member {string} egret.StageScaleMode.NO_BORDER
         */
        StageScaleMode.NO_BORDER = "noBorder";
        /**
         * 指定应用程序的大小是固定的，因此，即使在更改播放器窗口大小时，它仍然保持不变。如果播放器窗口比内容小，则可能进行一些裁切。
         * @member {string} egret.StageScaleMode.NO_SCALE
         */
        StageScaleMode.NO_SCALE = "noScale";
        /**
         * 指定整个应用程序在指定区域中可见，且不会发生扭曲，同时保持应用程序的原始高宽比。应用程序的两侧可能会显示边框。
         * @member {string} egret.StageScaleMode.SHOW_ALL
         */
        StageScaleMode.SHOW_ALL = "showAll";
        /**
         * 指定整个应用程序在指定区域中可见，但不尝试保持原始高宽比。可能会发生扭曲。
         * @member {string} egret.StageScaleMode.EXACT_FIT
         */
        StageScaleMode.EXACT_FIT = "exactFit";
        return StageScaleMode;
    })();
    egret.StageScaleMode = StageScaleMode;
    StageScaleMode.prototype.__class__ = "egret.StageScaleMode";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.ScrollView
     * @classdesc
     * ScrollView 是用于滑动的辅助类，将一个显示对象传入构造函数即可
     * @extends egret.DisplayObjectContainer
     */
    var ScrollView = (function (_super) {
        __extends(ScrollView, _super);
        /**
         * 创建一个 egret.ScrollView 对象
         * @method egret.ScrollView#constructor
         * @param content {egret.DisplayObject} 需要滚动的对象
         */
        function ScrollView(content) {
            if (content === void 0) { content = null; }
            _super.call(this);
            this._lastTouchPosition = new egret.Point(0, 0);
            this._lastTouchTime = 0;
            this._lastTouchEvent = null;
            this._velocitys = [];
            this._content = null;
            this._verticalScrollPolicy = "auto";
            this._horizontalScrollPolicy = "auto";
            this._scrollLeft = 0;
            this._scrollTop = 0;
            this._hCanScroll = false;
            this._vCanScroll = false;
            this.touchEnabled = true;
            if (content) {
                this.setContent(content);
            }
        }
        /**
         * 设置需要滚动的对象
         * @method egret.ScrollView#setContent
         * @param content {egret.DisplayObject} 需要滚动的对象
         */
        ScrollView.prototype.setContent = function (content) {
            if (this._content === content)
                return;
            this.removeContent();
            if (content) {
                this._content = content;
                _super.prototype.addChild.call(this, content);
                this._addEvents();
            }
        };
        /**
         * 移除滚动的对象
         * @method egret.ScrollView#removeContent
         */
        ScrollView.prototype.removeContent = function () {
            if (this._content) {
                this._removeEvents();
                _super.prototype.removeChildAt.call(this, 0);
            }
            this._content = null;
        };
        Object.defineProperty(ScrollView.prototype, "verticalScrollPolicy", {
            /**
             * 垂直滚动条显示策略，on/off/auto。
             * @member egret.ScrollView#verticalScrollPolicy
             */
            get: function () {
                return this._verticalScrollPolicy;
            },
            set: function (value) {
                if (value == this._verticalScrollPolicy)
                    return;
                this._verticalScrollPolicy = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ScrollView.prototype, "horizontalScrollPolicy", {
            /**
             * 水平滚动条显示策略，on/off/auto。
             * @member egret.ScrollView#horizontalScrollPolicy
             */
            get: function () {
                return this._horizontalScrollPolicy;
            },
            set: function (value) {
                if (value == this._horizontalScrollPolicy)
                    return;
                this._horizontalScrollPolicy = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ScrollView.prototype, "scrollLeft", {
            /**
             * 获取或设置水平滚动位置,
             * @member {number} egret.ScrollView#scrollLeft
             * @returns {number}
             */
            get: function () {
                return this._scrollLeft;
            },
            set: function (value) {
                if (value == this._scrollLeft)
                    return;
                this._scrollLeft = value;
                this._validatePosition(false, true);
                this._updateContentPosition();
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ScrollView.prototype, "scrollTop", {
            /**
             * 获取或设置垂直滚动位置,
             * @member {number} egret.ScrollView#scrollTop
             * @returns {number}
             */
            get: function () {
                return this._scrollTop;
            },
            set: function (value) {
                if (value == this._scrollTop)
                    return;
                this._scrollTop = value;
                this._validatePosition(true, false);
                this._updateContentPosition();
            },
            enumerable: true,
            configurable: true
        });
        /**
         * 设置滚动位置
         * @method egret.ScrollView#setScrollPosition
         * @param top {number} 垂直滚动位置
         * @param left {number} 水平滚动位置
         * @param isOffset {boolean} 可选参数，默认是false，是否是滚动增加量，如 top=1 代表往上滚动1像素
         */
        ScrollView.prototype.setScrollPosition = function (top, left, isOffset) {
            if (isOffset === void 0) { isOffset = false; }
            if (isOffset && top == 0 && left == 0)
                return;
            if (!isOffset && this._scrollTop == top && this._scrollLeft == left)
                return;
            if (isOffset) {
                var isEdgeV = this._isOnTheEdge(true);
                var isEdgeH = this._isOnTheEdge(false);
                this._scrollTop += isEdgeV ? top / 2 : top;
                this._scrollLeft += isEdgeH ? left / 2 : left;
            }
            else {
                this._scrollTop = top;
                this._scrollLeft = left;
            }
            this._validatePosition(true, true);
            this._updateContentPosition();
        };
        ScrollView.prototype._isOnTheEdge = function (isVertical) {
            if (isVertical === void 0) { isVertical = true; }
            var top = this._scrollTop, left = this._scrollLeft;
            if (isVertical)
                return top < 0 || top > this.getMaxScrollTop();
            else
                return left < 0 || left > this.getMaxScrollLeft();
        };
        ScrollView.prototype._validatePosition = function (top, left) {
            if (top === void 0) { top = false; }
            if (left === void 0) { left = false; }
            if (top) {
                var height = this.height;
                var contentHeight = this._getContentHeight();
                this._scrollTop = Math.max(this._scrollTop, (0 - height) / 2);
                this._scrollTop = Math.min(this._scrollTop, contentHeight > height ? (contentHeight - height / 2) : contentHeight / 2);
            }
            if (left) {
                var width = this.width;
                var contentWidth = this._getContentWidth();
                this._scrollLeft = Math.max(this._scrollLeft, (0 - width) / 2);
                this._scrollLeft = Math.min(this._scrollLeft, contentWidth > width ? (contentWidth - width / 2) : contentWidth / 2);
            }
        };
        /**
         * @inheritDoc
         */
        ScrollView.prototype._setWidth = function (value) {
            if (this._explicitWidth == value)
                return;
            _super.prototype._setWidth.call(this, value);
            this._updateContentPosition();
        };
        /**
         * @inheritDoc
         */
        ScrollView.prototype._setHeight = function (value) {
            if (this._explicitHeight == value)
                return;
            _super.prototype._setHeight.call(this, value);
            this._updateContentPosition();
        };
        ScrollView.prototype._updateContentPosition = function () {
            var size = this.getBounds(egret.Rectangle.identity);
            var height = size.height;
            var width = size.width;
            this.scrollRect = new egret.Rectangle(this._scrollLeft, this._scrollTop, width, height);
            this.dispatchEvent(new egret.Event(egret.Event.CHANGE));
        };
        ScrollView.prototype._checkScrollPolicy = function () {
            var hpolicy = this._horizontalScrollPolicy;
            var hCanScroll = this.__checkScrollPolicy(hpolicy, this._getContentWidth(), this.width);
            this._hCanScroll = hCanScroll;
            var vpolicy = this._verticalScrollPolicy;
            var vCanScroll = this.__checkScrollPolicy(vpolicy, this._getContentHeight(), this.height);
            this._vCanScroll = vCanScroll;
            return hCanScroll || vCanScroll;
        };
        ScrollView.prototype.__checkScrollPolicy = function (policy, contentLength, viewLength) {
            if (policy == "on")
                return true;
            if (policy == "off")
                return false;
            return contentLength > viewLength;
        };
        ScrollView.prototype._addEvents = function () {
            this.addEventListener(egret.TouchEvent.TOUCH_BEGIN, this._onTouchBegin, this);
            this.addEventListener(egret.TouchEvent.TOUCH_BEGIN, this._onTouchBeginCapture, this, true);
            this.addEventListener(egret.TouchEvent.TOUCH_END, this._onTouchEndCapture, this, true);
        };
        ScrollView.prototype._removeEvents = function () {
            this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN, this._onTouchBegin, this);
            this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN, this._onTouchBeginCapture, this, true);
            this.removeEventListener(egret.TouchEvent.TOUCH_END, this._onTouchEndCapture, this, true);
        };
        ScrollView.prototype._onTouchBegin = function (e) {
            if (e._isDefaultPrevented)
                return;
            var canScroll = this._checkScrollPolicy();
            if (!canScroll) {
                return;
            }
            egret.Tween.removeTweens(this);
            this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE, this._onTouchMove, this);
            this.stage.addEventListener(egret.TouchEvent.TOUCH_END, this._onTouchEnd, this);
            this.stage.addEventListener(egret.TouchEvent.LEAVE_STAGE, this._onTouchEnd, this);
            this.addEventListener(egret.Event.ENTER_FRAME, this._onEnterFrame, this);
            this._logTouchEvent(e);
            e.preventDefault();
        };
        ScrollView.prototype._onTouchBeginCapture = function (event) {
            var canScroll = this._checkScrollPolicy();
            if (!canScroll) {
                return;
            }
            var target = event.target;
            while (target != this) {
                if (target instanceof ScrollView) {
                    canScroll = target._checkScrollPolicy();
                    if (canScroll) {
                        return;
                    }
                }
                target = target.parent;
            }
            event.stopPropagation();
            var evt = this.cloneTouchEvent(event);
            this.delayTouchBeginEvent = evt;
            if (!this.touchBeginTimer) {
                this.touchBeginTimer = new egret.Timer(100, 1);
                this.touchBeginTimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE, this._onTouchBeginTimer, this);
            }
            this.touchBeginTimer.start();
            this._onTouchBegin(event);
        };
        ScrollView.prototype._onTouchEndCapture = function (event) {
            if (!this.delayTouchBeginEvent) {
                return;
            }
            this._onTouchBeginTimer();
        };
        ScrollView.prototype._onTouchBeginTimer = function () {
            this.touchBeginTimer.stop();
            var event = this.delayTouchBeginEvent;
            this.delayTouchBeginEvent = null;
            this.dispatchPropagationEvent(event);
        };
        ScrollView.prototype.dispatchPropagationEvent = function (event) {
            var list = [];
            var target = event._target;
            while (target) {
                list.push(target);
                target = target.parent;
            }
            var content = this._content;
            for (var i = 1;; i += 2) {
                target = list[i];
                if (!target || target === content) {
                    break;
                }
                list.unshift(target);
            }
            this._dispatchPropagationEvent(event, list);
        };
        //todo 此处代码是为了兼容之前的实现，应该尽快更优化的实现后删除
        ScrollView.prototype._dispatchPropagationEvent = function (event, list, targetIndex) {
            var length = list.length;
            for (var i = 0; i < length; i++) {
                var currentTarget = list[i];
                event._currentTarget = currentTarget;
                event._target = this;
                if (i < targetIndex)
                    event._eventPhase = 1;
                else if (i == targetIndex)
                    event._eventPhase = 2;
                else
                    event._eventPhase = 3;
                currentTarget._notifyListener(event);
                if (event._isPropagationStopped || event._isPropagationImmediateStopped) {
                    break;
                }
            }
        };
        ScrollView.prototype._onTouchMove = function (event) {
            if (this._lastTouchPosition.x == event.stageX && this._lastTouchPosition.y == event.stageY)
                return;
            if (this.delayTouchBeginEvent) {
                this.delayTouchBeginEvent = null;
                this.touchBeginTimer.stop();
            }
            this.touchChildren = false;
            var offset = this._getPointChange(event);
            this.setScrollPosition(offset.y, offset.x, true);
            this._calcVelocitys(event);
            this._logTouchEvent(event);
        };
        ScrollView.prototype._onTouchEnd = function (event) {
            this.touchChildren = true;
            egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE, this._onTouchMove, this);
            egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_END, this._onTouchEnd, this);
            egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.LEAVE_STAGE, this._onTouchEnd, this);
            this.removeEventListener(egret.Event.ENTER_FRAME, this._onEnterFrame, this);
            this._moveAfterTouchEnd();
        };
        ScrollView.prototype._onEnterFrame = function (event) {
            var time = egret.getTimer();
            if (time - this._lastTouchTime > 100 && time - this._lastTouchTime < 300) {
                this._calcVelocitys(this._lastTouchEvent);
            }
        };
        ScrollView.prototype._logTouchEvent = function (e) {
            this._lastTouchPosition.x = e.stageX;
            this._lastTouchPosition.y = e.stageY;
            this._lastTouchEvent = this.cloneTouchEvent(e);
            this._lastTouchTime = egret.getTimer();
        };
        ScrollView.prototype._getPointChange = function (e) {
            return {
                x: this._hCanScroll === false ? 0 : (this._lastTouchPosition.x - e.stageX),
                y: this._vCanScroll === false ? 0 : (this._lastTouchPosition.y - e.stageY)
            };
        };
        ScrollView.prototype._calcVelocitys = function (e) {
            var time = egret.getTimer();
            if (this._lastTouchTime == 0) {
                this._lastTouchTime = time;
                return;
            }
            var change = this._getPointChange(e);
            var timeoffset = time - this._lastTouchTime;
            change.x /= timeoffset;
            change.y /= timeoffset;
            this._velocitys.push(change);
            if (this._velocitys.length > 5)
                this._velocitys.shift();
            this._lastTouchPosition.x = e.stageX;
            this._lastTouchPosition.y = e.stageY;
        };
        ScrollView.prototype._getContentWidth = function () {
            return this._content.explicitWidth || this._content.width;
        };
        ScrollView.prototype._getContentHeight = function () {
            return this._content.explicitHeight || this._content.height;
        };
        ScrollView.prototype.getMaxScrollLeft = function () {
            var max = this._getContentWidth() - this.width;
            return Math.max(0, max);
        };
        ScrollView.prototype.getMaxScrollTop = function () {
            var max = this._getContentHeight() - this.height;
            return Math.max(0, max);
        };
        ScrollView.prototype._moveAfterTouchEnd = function () {
            if (this._velocitys.length == 0)
                return;
            var sum = { x: 0, y: 0 }, totalW = 0;
            for (var i = 0; i < this._velocitys.length; i++) {
                var v = this._velocitys[i];
                var w = ScrollView.weight[i];
                sum.x += v.x * w;
                sum.y += v.y * w;
                totalW += w;
            }
            this._velocitys.length = 0;
            var x = sum.x / totalW, y = sum.y / totalW;
            var pixelsPerMSX = Math.abs(x), pixelsPerMSY = Math.abs(y);
            var maxLeft = this.getMaxScrollLeft();
            var maxTop = this.getMaxScrollTop();
            var datax = pixelsPerMSX > 0.02 ? this.getAnimationDatas(x, this._scrollLeft, maxLeft) : { position: this._scrollLeft, duration: 1 };
            var datay = pixelsPerMSY > 0.02 ? this.getAnimationDatas(y, this._scrollTop, maxTop) : { position: this._scrollTop, duration: 1 };
            this.setScrollLeft(datax.position, datax.duration);
            this.setScrollTop(datay.position, datay.duration);
        };
        ScrollView.prototype.setScrollTop = function (scrollTop, duration) {
            if (duration === void 0) { duration = 0; }
            var finalPosition = Math.min(this.getMaxScrollTop(), Math.max(scrollTop, 0));
            if (duration == 0) {
                this.scrollTop = finalPosition;
                return null;
            }
            var twy = egret.Tween.get(this).to({ scrollTop: scrollTop }, duration, egret.Ease.quartOut);
            if (finalPosition != scrollTop) {
                twy.to({ scrollTop: finalPosition }, 300, egret.Ease.quintOut);
            }
        };
        ScrollView.prototype.setScrollLeft = function (scrollLeft, duration) {
            if (duration === void 0) { duration = 0; }
            var finalPosition = Math.min(this.getMaxScrollLeft(), Math.max(scrollLeft, 0));
            if (duration == 0) {
                this.scrollLeft = finalPosition;
                return null;
            }
            var tw = egret.Tween.get(this).to({ scrollLeft: scrollLeft }, duration, egret.Ease.quartOut);
            if (finalPosition != scrollLeft) {
                tw.to({ scrollLeft: finalPosition }, 300, egret.Ease.quintOut);
            }
        };
        ScrollView.prototype.getAnimationDatas = function (pixelsPerMS, curPos, maxPos) {
            var absPixelsPerMS = Math.abs(pixelsPerMS);
            var extraFricition = 0.95;
            var duration = 0;
            var friction = 0.998;
            var minVelocity = 0.02;
            var posTo = curPos + pixelsPerMS * 500;
            if (posTo < 0 || posTo > maxPos) {
                posTo = curPos;
                while (Math.abs(pixelsPerMS) != Infinity && Math.abs(pixelsPerMS) > minVelocity) {
                    posTo += pixelsPerMS;
                    if (posTo < 0 || posTo > maxPos) {
                        pixelsPerMS *= friction * extraFricition;
                    }
                    else {
                        pixelsPerMS *= friction;
                    }
                    duration++;
                }
            }
            else {
                duration = -Math.log(minVelocity / absPixelsPerMS) * 500;
            }
            var result = {
                position: Math.min(maxPos + 50, Math.max(posTo, -50)),
                duration: duration
            };
            return result;
        };
        ScrollView.prototype.cloneTouchEvent = function (event) {
            var evt = new egret.TouchEvent(event._type, event._bubbles, event.cancelable);
            evt.touchPointID = event.touchPointID;
            evt._stageX = event._stageX;
            evt._stageY = event._stageY;
            evt.ctrlKey = event.ctrlKey;
            evt.altKey = event.altKey;
            evt.shiftKey = event.shiftKey;
            evt.touchDown = event.touchDown;
            evt._isDefaultPrevented = false;
            evt._target = event._target;
            return evt;
        };
        ScrollView.prototype.throwNotSupportedError = function () {
            throw new Error("此方法在ScrollView内不可用!");
        };
        /**
         * @method egret.ScrollView#addChild
         * @deprecated
         * @param child {DisplayObject}
         * @returns {DisplayObject}
         */
        ScrollView.prototype.addChild = function (child) {
            this.throwNotSupportedError();
            return null;
        };
        /**
         * @method egret.ScrollView#addChildAt
         * @deprecated
         * @param child {DisplayObject}
         * @param index {number}
         * @returns {DisplayObject}
         */
        ScrollView.prototype.addChildAt = function (child, index) {
            this.throwNotSupportedError();
            return null;
        };
        /**
         * @method egret.ScrollView#removeChild
         * @deprecated
         * @param child {DisplayObject}
         * @returns {DisplayObject}
         */
        ScrollView.prototype.removeChild = function (child) {
            this.throwNotSupportedError();
            return null;
        };
        /**
         * @method egret.ScrollView#removeChildAt
         * @deprecated
         * @param index {number}
         * @returns {DisplayObject}
         */
        ScrollView.prototype.removeChildAt = function (index) {
            this.throwNotSupportedError();
            return null;
        };
        /**
         * @method egret.ScrollView#setChildIndex
         * @deprecated
         * @param child {DisplayObject}
         * @param index {number}
         */
        ScrollView.prototype.setChildIndex = function (child, index) {
            this.throwNotSupportedError();
        };
        /**
         * @method egret.ScrollView#swapChildren
         * @deprecated
         * @param child1 {DisplayObject}
         * @param child2 {DisplayObject}
         */
        ScrollView.prototype.swapChildren = function (child1, child2) {
            this.throwNotSupportedError();
        };
        /**
         * @method egret.ScrollView#swapChildrenAt
         * @deprecated
         * @param index1 {number}
         * @param index2 {number}
         */
        ScrollView.prototype.swapChildrenAt = function (index1, index2) {
            this.throwNotSupportedError();
        };
        ScrollView.prototype.hitTest = function (x, y, ignoreTouchEnabled) {
            if (ignoreTouchEnabled === void 0) { ignoreTouchEnabled = false; }
            var childTouched = _super.prototype.hitTest.call(this, x, y, ignoreTouchEnabled);
            if (childTouched)
                return childTouched;
            return egret.DisplayObject.prototype.hitTest.call(this, x, y, ignoreTouchEnabled);
        };
        ScrollView.weight = [1, 1.33, 1.66, 2, 2.33];
        return ScrollView;
    })(egret.DisplayObjectContainer);
    egret.ScrollView = ScrollView;
    ScrollView.prototype.__class__ = "egret.ScrollView";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    /**
     * @class egret.BitmapFillMode
     * @classdesc
     * BitmapFillMode 类定义Bitmap的图像填充方式。
     * BitmapFillMode 类定义了调整大小模式的一个枚举，这些模式确定 Bitmap 如何填充由布局系统指定的尺寸。
     */
    var BitmapFillMode = (function () {
        function BitmapFillMode() {
        }
        /**
         * 重复位图以填充区域。
         * @constant {string} egret.BitmapFillMode.REPEAT
         */
        BitmapFillMode.REPEAT = "repeat";
        /**
         * 位图填充拉伸以填充区域。
         * @constant {string} egret.BitmapFillMode.SCALE
         */
        BitmapFillMode.SCALE = "scale";
        return BitmapFillMode;
    })();
    egret.BitmapFillMode = BitmapFillMode;
    BitmapFillMode.prototype.__class__ = "egret.BitmapFillMode";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.Bitmap
     * @classdesc
     * Bitmap 类表示用于表示位图图像的显示对象。
     * @extends egret.DisplayObject
     */
    var Bitmap = (function (_super) {
        __extends(Bitmap, _super);
        function Bitmap(texture) {
            _super.call(this);
            /**
             * 单个Bitmap是否开启DEBUG模式
             * @member {boolean} egret.Bitmap#debug
             * @private
             */
            this.debug = false;
            /**
             * debug边框颜色，默认值为红色
             * @member {number} egret.Bitmap#debugColor
             * @private
             */
            this.debugColor = 0xff0000;
            /**
             * 矩形区域，它定义位图对象的九个缩放区域。此属性仅当fillMode为BitmapFillMode.SCALE时有效。
             * scale9Grid的x、y、width、height分别代表九宫图中中间那块的左上点的x、y以及中间方块的宽高。
             * @member {egret.Texture} egret.Bitmap#scale9Grid
             */
            this.scale9Grid = null;
            /**
             * 确定位图填充尺寸的方式。
             * 设置为 BitmapFillMode.REPEAT时，位图将重复以填充区域；BitmapFillMode.SCALE时，位图将拉伸以填充区域。
             * 默认值：BitmapFillMode.SCALE。
             * @member {egret.Texture} egret.Bitmap#fillMode
             */
            this.fillMode = "scale";
            if (texture) {
                this._texture = texture;
                this._setSizeDirty();
            }
        }
        Object.defineProperty(Bitmap.prototype, "texture", {
            /**
             * 渲染纹理
             * @member {egret.Texture} egret.Bitmap#texture
             */
            get: function () {
                return this._texture;
            },
            set: function (value) {
                if (value == this._texture) {
                    return;
                }
                this._setSizeDirty();
                this._texture = value;
            },
            enumerable: true,
            configurable: true
        });
        Bitmap.prototype._render = function (renderContext) {
            var texture = this._texture;
            if (!texture) {
                this._texture_to_render = null;
                return;
            }
            this._texture_to_render = texture;
            var destW = this._hasWidthSet ? this._explicitWidth : texture._textureWidth;
            var destH = this._hasHeightSet ? this._explicitHeight : texture._textureHeight;
            Bitmap._drawBitmap(renderContext, destW, destH, this);
        };
        Bitmap._drawBitmap = function (renderContext, destW, destH, thisObject) {
            var texture = thisObject._texture_to_render;
            if (!texture) {
                return;
            }
            var textureWidth = texture._textureWidth;
            var textureHeight = texture._textureHeight;
            if (thisObject.fillMode == "scale") {
                var s9g = thisObject.scale9Grid || texture["scale9Grid"];
                if (s9g && textureWidth - s9g.width < destW && textureHeight - s9g.height < destH) {
                    Bitmap.drawScale9GridImage(renderContext, thisObject, s9g, destW, destH);
                }
                else {
                    var offsetX = texture._offsetX;
                    var offsetY = texture._offsetY;
                    var bitmapWidth = texture._bitmapWidth || textureWidth;
                    var bitmapHeight = texture._bitmapHeight || textureHeight;
                    var scaleX = destW / textureWidth;
                    offsetX = Math.round(offsetX * scaleX);
                    destW = Math.round(bitmapWidth * scaleX);
                    var scaleY = destH / textureHeight;
                    offsetY = Math.round(offsetY * scaleY);
                    destH = Math.round(bitmapHeight * scaleY);
                    Bitmap.renderFilter.drawImage(renderContext, thisObject, texture._bitmapX, texture._bitmapY, bitmapWidth, bitmapHeight, offsetX, offsetY, destW, destH);
                }
            }
            else {
                Bitmap.drawRepeatImage(renderContext, thisObject, destW, destH, thisObject.fillMode);
            }
        };
        /**
         * 绘制平铺位图
         */
        Bitmap.drawRepeatImage = function (renderContext, data, destWidth, destHeight, repeat) {
            var texture = data._texture_to_render;
            if (!texture) {
                return;
            }
            var textureWidth = texture._textureWidth;
            var textureHeight = texture._textureHeight;
            var sourceX = texture._bitmapX;
            var sourceY = texture._bitmapY;
            var sourceWidth = texture._bitmapWidth || textureWidth;
            var sourceHeight = texture._bitmapHeight || textureHeight;
            var destX = texture._offsetX;
            var destY = texture._offsetY;
            var renderFilter = egret.RenderFilter.getInstance();
            renderFilter.drawImage(renderContext, data, sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight, repeat);
        };
        /**
         * 绘制九宫格位图
         */
        Bitmap.drawScale9GridImage = function (renderContext, data, scale9Grid, destWidth, destHeight) {
            var texture = data._texture_to_render;
            if (!texture || !scale9Grid) {
                return;
            }
            var renderFilter = egret.RenderFilter.getInstance();
            var textureWidth = texture._textureWidth;
            var textureHeight = texture._textureHeight;
            var sourceX = texture._bitmapX;
            var sourceY = texture._bitmapY;
            var sourceWidth = texture._bitmapWidth || textureWidth;
            var sourceHeight = texture._bitmapHeight || textureHeight;
            var destX = texture._offsetX;
            var destY = texture._offsetY;
            var texture_scale_factor = egret.MainContext.instance.rendererContext.texture_scale_factor;
            var s9g = egret.Rectangle.identity.initialize(scale9Grid.x - Math.round(destX), scale9Grid.y - Math.round(destX), scale9Grid.width, scale9Grid.height);
            var roundedDrawX = Math.round(destX);
            var roundedDrawY = Math.round(destY);
            destWidth -= textureWidth - sourceWidth;
            destHeight -= textureHeight - sourceHeight;
            //防止空心的情况出现。
            if (s9g.y == s9g.bottom) {
                if (s9g.bottom < sourceHeight)
                    s9g.bottom++;
                else
                    s9g.y--;
            }
            if (s9g.x == s9g.right) {
                if (s9g.right < sourceWidth)
                    s9g.right++;
                else
                    s9g.x--;
            }
            var sourceX2 = sourceX + s9g.x;
            var sourceX3 = sourceX + s9g.right;
            var sourceRightW = sourceWidth - s9g.right;
            var sourceY2 = sourceY + s9g.y;
            var sourceY3 = sourceY + s9g.bottom;
            var sourceBottomH = sourceHeight - s9g.bottom;
            var destX1 = roundedDrawX + s9g.x;
            var destY1 = roundedDrawY + s9g.y;
            var destScaleGridBottom = destHeight - (sourceHeight - s9g.bottom);
            var destScaleGridRight = destWidth - (sourceWidth - s9g.right);
            drawImage(renderContext, data, sourceX, sourceY, s9g.x, s9g.y, roundedDrawX, roundedDrawY, s9g.x, s9g.y);
            drawImage(renderContext, data, sourceX2, sourceY, s9g.width, s9g.y, destX1, roundedDrawY, destScaleGridRight - s9g.x, s9g.y);
            drawImage(renderContext, data, sourceX3, sourceY, sourceRightW, s9g.y, roundedDrawX + destScaleGridRight, roundedDrawY, destWidth - destScaleGridRight, s9g.y);
            drawImage(renderContext, data, sourceX, sourceY2, s9g.x, s9g.height, roundedDrawX, destY1, s9g.x, destScaleGridBottom - s9g.y);
            drawImage(renderContext, data, sourceX2, sourceY2, s9g.width, s9g.height, destX1, destY1, destScaleGridRight - s9g.x, destScaleGridBottom - s9g.y);
            drawImage(renderContext, data, sourceX3, sourceY2, sourceRightW, s9g.height, roundedDrawX + destScaleGridRight, destY1, destWidth - destScaleGridRight, destScaleGridBottom - s9g.y);
            drawImage(renderContext, data, sourceX, sourceY3, s9g.x, sourceBottomH, roundedDrawX, roundedDrawY + destScaleGridBottom, s9g.x, destHeight - destScaleGridBottom);
            drawImage(renderContext, data, sourceX2, sourceY3, s9g.width, sourceBottomH, destX1, roundedDrawY + destScaleGridBottom, destScaleGridRight - s9g.x, destHeight - destScaleGridBottom);
            drawImage(renderContext, data, sourceX3, sourceY3, sourceRightW, sourceBottomH, roundedDrawX + destScaleGridRight, roundedDrawY + destScaleGridBottom, destWidth - destScaleGridRight, destHeight - destScaleGridBottom);
            function drawImage(a, b, c, d, e, f, g, h, i, j) {
                renderFilter.drawImage(a, b, c / texture_scale_factor, d / texture_scale_factor, e, f, g, h, i, j);
            }
        };
        /**
         * @see egret.DisplayObject.measureBounds
         * @returns {egret.Rectangle}
         * @private
         */
        Bitmap.prototype._measureBounds = function () {
            var texture = this._texture;
            if (!texture) {
                return _super.prototype._measureBounds.call(this);
            }
            var x = texture._offsetX;
            var y = texture._offsetY;
            var w = texture._textureWidth;
            var h = texture._textureHeight;
            return egret.Rectangle.identity.initialize(x, y, w, h);
        };
        /**
         * 全部Bitmap是否开启DEBUG模式
         * @member {boolean} egret.Bitmap.debug
         * @private
         */
        Bitmap.debug = false;
        Bitmap.renderFilter = egret.RenderFilter.getInstance();
        return Bitmap;
    })(egret.DisplayObject);
    egret.Bitmap = Bitmap;
    Bitmap.prototype.__class__ = "egret.Bitmap";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @classdesc
     * @class egret.BitmapText
     * 位图字体采用了Bitmap+SpriteSheet的方式来渲染文字。
     * @extends egret.DisplayObjectContainer
     */
    var BitmapText = (function (_super) {
        __extends(BitmapText, _super);
        function BitmapText() {
            _super.call(this);
            /**
             * 设置文本
             */
            this._text = "";
            this._textChanged = false;
            this._spriteSheet = null;
            this._spriteSheetChanged = false;
            this._bitmapPool = [];
        }
        Object.defineProperty(BitmapText.prototype, "text", {
            /**
             * 显示的文本内容
             * @member {string} egret.BitmapText#text
             *
             */
            get: function () {
                return this._text;
            },
            //        private current_rendered_text:string;
            set: function (value) {
                this._textChanged = true;
                this._text = value;
                this._setSizeDirty();
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BitmapText.prototype, "spriteSheet", {
            /**
             * BitmapTextSpriteSheet对象，缓存了所有文本的位图纹理
             * @member {egret.BitmapTextSpriteSheet} egret.BitmapText#spriteSheet
             */
            get: function () {
                return this._spriteSheet;
            },
            set: function (val) {
                if (this._spriteSheet == val)
                    return;
                this._spriteSheet = val;
                this._spriteSheetChanged = true;
                this._setSizeDirty();
            },
            enumerable: true,
            configurable: true
        });
        BitmapText.prototype._updateTransform = function () {
            if (!this.visible) {
                return;
            }
            if (this._textChanged || this._spriteSheetChanged) {
                this._renderText();
            }
            _super.prototype._updateTransform.call(this);
        };
        //todo:这里对bounds的处理和TextField非常类似，以后考虑重构
        BitmapText.prototype._renderText = function (forMeasureContentSize) {
            if (forMeasureContentSize === void 0) { forMeasureContentSize = false; }
            var tempW = 0;
            var tempH = 0;
            if (this._textChanged || this._spriteSheetChanged) {
                this.removeChildren();
            }
            for (var i = 0, l = this.text.length; i < l; i++) {
                var character = this.text.charAt(i);
                var texture = this.spriteSheet.getTexture(character);
                if (texture == null) {
                    console.log("当前没有位图文字：" + character);
                    continue;
                }
                var offsetX = texture._offsetX;
                var offsetY = texture._offsetY;
                var characterWidth = texture._textureWidth;
                if (this._textChanged || this._spriteSheetChanged) {
                    var bitmap = this._bitmapPool[i];
                    if (!bitmap) {
                        bitmap = new egret.Bitmap();
                        this._bitmapPool.push(bitmap);
                    }
                    bitmap.texture = texture;
                    this.addChild(bitmap);
                    bitmap.x = tempW;
                }
                tempW += characterWidth + offsetX;
                if (offsetY + texture._textureHeight > tempH) {
                    tempH = offsetY + texture._textureHeight;
                }
            }
            this._textChanged = false;
            this._spriteSheetChanged = false;
            var rect = egret.Rectangle.identity.initialize(0, 0, tempW, tempH);
            return rect;
        };
        BitmapText.prototype._measureBounds = function () {
            return this._renderText(true);
        };
        return BitmapText;
    })(egret.DisplayObjectContainer);
    egret.BitmapText = BitmapText;
    BitmapText.prototype.__class__ = "egret.BitmapText";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    /**
     * @class egret.Graphics
     * @classdesc
     * Graphics 类包含一组可用来创建矢量形状的方法。支持绘制的显示对象包括 Sprite 和 Shape 对象。这些类中的每一个类都包括 graphics 属性，该属性是一个 Graphics 对象。
     * 以下是为便于使用而提供的一些辅助函数：drawRect()、drawRoundRect()、drawCircle() 和 drawEllipse()。
     */
    var Graphics = (function () {
        function Graphics() {
            this._minX = 0;
            this._minY = 0;
            this._maxX = 0;
            this._maxY = 0;
            this._lastX = 0;
            this._lastY = 0;
            this.commandQueue = [];
        }
        /**
         * 指定一种简单的单一颜色填充，在绘制时该填充将在随后对其他 Graphics 方法（如 lineTo() 或 drawCircle()）的调用中使用。
         * 调用 clear() 方法会清除填充。
         * @method egret.Graphics#beginFill
         * @param color {number} 填充的颜色
         * @param alpha {number} 填充的 Alpha 值
         */
        Graphics.prototype.beginFill = function (color, alpha) {
            if (alpha === void 0) { alpha = 1; }
        };
        Graphics.prototype._setStyle = function (colorStr) {
        };
        /**
         * 绘制一个矩形
         * @method egret.Graphics#drawRect
         * @param x {number} 圆心相对于父显示对象注册点的 x 位置（以像素为单位）。
         * @param y {number} 相对于父显示对象注册点的圆心的 y 位置（以像素为单位）。
         * @param width {number} 矩形的宽度（以像素为单位）。
         * @param height {number} 矩形的高度（以像素为单位）。
         * @param r? {number} 圆的半径（以像素为单位）,不设置就为直角矩形。
         */
        Graphics.prototype.drawRect = function (x, y, width, height) {
            this.checkRect(x, y, width, height);
        };
        /**
         * 绘制一个圆。
         * @method egret.Graphics#drawCircle
         * @param x {number} 圆心相对于父显示对象注册点的 x 位置（以像素为单位）。
         * @param y {number} 相对于父显示对象注册点的圆心的 y 位置（以像素为单位）。
         * @param r {number} 圆的半径（以像素为单位）。
         */
        Graphics.prototype.drawCircle = function (x, y, r) {
            this.checkRect(x - r, y - r, 2 * r, 2 * r);
        };
        /**
         * 绘制一个圆角矩形
         * @method egret.Graphics#drawRect
         * @param x {number} 圆心相对于父显示对象注册点的 x 位置（以像素为单位）。
         * @param y {number} 相对于父显示对象注册点的圆心的 y 位置（以像素为单位）。
         * @param width {number} 矩形的宽度（以像素为单位）。
         * @param height {number} 矩形的高度（以像素为单位）。
         * @param ellipseWidth {number} 用于绘制圆角的椭圆的宽度（以像素为单位）。
         * @param ellipseHeight {number} 用于绘制圆角的椭圆的高度（以像素为单位）。 （可选）如果未指定值，则默认值与为 ellipseWidth 参数提供的值相匹配。
         */
        Graphics.prototype.drawRoundRect = function (x, y, width, height, ellipseWidth, ellipseHeight) {
            this.checkRect(x, y, width, height);
        };
        /**
         * 绘制一个椭圆。
         * @method egret.Graphics#drawEllipse
         * @param x {number} 一个表示相对于父显示对象注册点的水平位置的数字（以像素为单位）。
         * @param y {number} 一个表示相对于父显示对象注册点的垂直位置的数字（以像素为单位）。
         * @param width {number} 矩形的宽度（以像素为单位）。
         * @param height {number} 矩形的高度（以像素为单位）。
         */
        Graphics.prototype.drawEllipse = function (x, y, width, height) {
            this.checkRect(x - width, y - height, 2 * width, 2 * height);
        };
        /**
         * 指定一种线条样式以用于随后对 lineTo() 或 drawCircle() 等 Graphics 方法的调用。
         * @method egret.Graphics#lineStyle
         * @param thickness {number} 一个整数，以点为单位表示线条的粗细，有效值为 0 到 255。如果未指定数字，或者未定义该参数，则不绘制线条。如果传递的值小于 0，则默认值为 0。值 0 表示极细的粗细；最大粗细为 255。如果传递的值大于 255，则默认值为 255。
         * @param color {number} 线条的十六进制颜色值（例如，红色为 0xFF0000，蓝色为 0x0000FF 等）。如果未指明值，则默认值为 0x000000（黑色）。可选。
         * @param alpha {number} 表示线条颜色的 Alpha 值的数字；有效值为 0 到 1。如果未指明值，则默认值为 1（纯色）。如果值小于 0，则默认值为 0。如果值大于 1，则默认值为 1。
         * @param pixelHinting {boolean} 布尔型值，指定是否提示笔触采用完整像素。它同时影响曲线锚点的位置以及线条笔触大小本身。在 pixelHinting 设置为 true 的情况下，线条宽度会调整到完整像素宽度。在 pixelHinting 设置为 false 的情况下，对于曲线和直线可能会出现脱节。
         * @param scaleMode {string} 用于指定要使用的比例模式
         * @param caps {string} 用于指定线条末端处端点类型的 CapsStyle 类的值。
         * @param joints {string} 指定用于拐角的连接外观的类型。
         * @param miterLimit {number} 用于表示剪切斜接的极限值的数字。
         */
        Graphics.prototype.lineStyle = function (thickness, color, alpha, pixelHinting, scaleMode, caps, joints, miterLimit) {
            if (thickness === void 0) { thickness = NaN; }
            if (color === void 0) { color = 0; }
            if (alpha === void 0) { alpha = 1.0; }
            if (pixelHinting === void 0) { pixelHinting = false; }
            if (scaleMode === void 0) { scaleMode = "normal"; }
            if (caps === void 0) { caps = null; }
            if (joints === void 0) { joints = null; }
            if (miterLimit === void 0) { miterLimit = 3; }
        };
        /**
         * 使用当前线条样式绘制一条从当前绘图位置开始到 (x, y) 结束的直线；当前绘图位置随后会设置为 (x, y)。
         * @method egret.Graphics#lineTo
         * @param x {number} 一个表示相对于父显示对象注册点的水平位置的数字（以像素为单位）。
         * @param y {number} 一个表示相对于父显示对象注册点的垂直位置的数字（以像素为单位）。
         */
        Graphics.prototype.lineTo = function (x, y) {
            this.checkPoint(x, y);
        };
        /**
         * 使用当前线条样式和由 (controlX, controlY) 指定的控制点绘制一条从当前绘图位置开始到 (anchorX, anchorY) 结束的二次贝塞尔曲线。当前绘图位置随后设置为 (anchorX, anchorY)。
         * 如果在调用 moveTo() 方法之前调用了 curveTo() 方法，则当前绘图位置的默认值为 (0, 0)。如果缺少任何一个参数，则此方法将失败，并且当前绘图位置不改变。
         * 绘制的曲线是二次贝塞尔曲线。二次贝塞尔曲线包含两个锚点和一个控制点。该曲线内插这两个锚点，并向控制点弯曲。
         * @method egret.Graphics#curveTo
         * @param controlX {number} 一个数字，指定控制点相对于父显示对象注册点的水平位置。
         * @param controlY {number} 一个数字，指定控制点相对于父显示对象注册点的垂直位置。
         * @param anchorX {number} 一个数字，指定下一个锚点相对于父显示对象注册点的水平位置。
         * @param anchorY {number} 一个数字，指定下一个锚点相对于父显示对象注册点的垂直位置。
         */
        Graphics.prototype.curveTo = function (controlX, controlY, anchorX, anchorY) {
            this.checkPoint(controlX, controlY);
            this.checkPoint(anchorX, anchorY);
        };
        /**
         * 将当前绘图位置移动到 (x, y)。如果缺少任何一个参数，则此方法将失败，并且当前绘图位置不改变。
         * @method egret.Graphics#moveTo
         * @param x {number} 一个表示相对于父显示对象注册点的水平位置的数字（以像素为单位）。
         * @param y {number} 一个表示相对于父显示对象注册点的垂直位置的数字（以像素为单位）。
         */
        Graphics.prototype.moveTo = function (x, y) {
            this.checkPoint(x, y);
        };
        /**
         * 清除绘制到此 Graphics 对象的图形，并重置填充和线条样式设置。
         * @method egret.Graphics#clear
         */
        Graphics.prototype.clear = function () {
            this._minX = 0;
            this._minY = 0;
            this._maxX = 0;
            this._maxY = 0;
        };
        /**
         * 对从上一次调用 beginFill()方法之后添加的直线和曲线应用填充。
         * @method egret.Graphics#endFill
         */
        Graphics.prototype.endFill = function () {
        };
        Graphics.prototype._draw = function (renderContext) {
        };
        Graphics.prototype.checkRect = function (x, y, w, h) {
            this._minX = Math.min(this._minX, x);
            this._minY = Math.min(this._minY, y);
            this._maxX = Math.max(this._maxX, x + w);
            this._maxY = Math.max(this._maxY, y + h);
        };
        Graphics.prototype.checkPoint = function (x, y) {
            this._minX = Math.min(this._minX, x);
            this._minY = Math.min(this._minY, y);
            this._maxX = Math.max(this._maxX, x);
            this._maxY = Math.max(this._maxY, y);
            this._lastX = x;
            this._lastY = y;
        };
        return Graphics;
    })();
    egret.Graphics = Graphics;
    Graphics.prototype.__class__ = "egret.Graphics";
    var Command = (function () {
        function Command(method, thisObject, args) {
            this.method = method;
            this.thisObject = thisObject;
            this.args = args;
        }
        return Command;
    })();
    Command.prototype.__class__ = "egret.Command";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.Shape
     * @classdesc 此类用于使用 Egret 绘图应用程序编程接口 (API) 创建简单形状。Shape 类包括 graphics 属性，该属性使您可以从 Graphics 类访问方法。
     */
    var Shape = (function (_super) {
        __extends(Shape, _super);
        function Shape() {
            _super.call(this);
        }
        Object.defineProperty(Shape.prototype, "graphics", {
            get: function () {
                if (!this._graphics) {
                    var rendererContext = egret.MainContext.instance.rendererContext;
                    this._graphics = new egret.Graphics();
                }
                return this._graphics;
            },
            enumerable: true,
            configurable: true
        });
        Shape.prototype._render = function (renderContext) {
            if (this._graphics)
                this._graphics._draw(renderContext);
        };
        return Shape;
    })(egret.DisplayObject);
    egret.Shape = Shape;
    Shape.prototype.__class__ = "egret.Shape";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @extends egret.DisplayObjectContainer
     * @class egret.Sprite
     * @classdesc Sprite 类是基本显示列表构造块：一个可显示图形并且也可包含子项的显示列表节点。Sprite 对象与影片剪辑类似，但没有时间轴。Sprite 是不需要时间轴的对象的相应基类。例如，Sprite 将是通常不使用时间轴的用户界面 (UI) 组件的逻辑基类。
     */
    var Sprite = (function (_super) {
        __extends(Sprite, _super);
        function Sprite() {
            _super.call(this);
        }
        Object.defineProperty(Sprite.prototype, "graphics", {
            get: function () {
                if (!this._graphics) {
                    this._graphics = new egret.Graphics();
                }
                return this._graphics;
            },
            enumerable: true,
            configurable: true
        });
        Sprite.prototype._render = function (renderContext) {
            if (this._graphics)
                this._graphics._draw(renderContext);
            _super.prototype._render.call(this, renderContext);
        };
        return Sprite;
    })(egret.DisplayObjectContainer);
    egret.Sprite = Sprite;
    Sprite.prototype.__class__ = "egret.Sprite";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.TextField
     * @classdesc
     * TextField是egret的文本渲染类，采用浏览器/设备的API进行渲染，在不同的浏览器/设备中由于字体渲染方式不一，可能会有渲染差异
     * 如果开发者希望所有平台完全无差异，请使用BitmapText
     * @extends egret.DisplayObject
     */
    var TextField = (function (_super) {
        __extends(TextField, _super);
        function TextField() {
            _super.call(this);
            this._inputEnabled = false;
            /**
             * 文本字段的类型。
             * 以下 TextFieldType 常量中的任一个：TextFieldType.DYNAMIC（指定用户无法编辑的动态文本字段），或 TextFieldType.INPUT（指定用户可以编辑的输入文本字段）。
             * 默认值为 dynamic。
             * @member {string} egret.TextField#type
             */
            this._type = "";
            /**
             * 作为文本字段中当前文本的字符串
             * @member {string} egret.TextField#text
             */
            this._text = "";
            /**
             * 指定文本字段是否是密码文本字段。
             * 如果此属性的值为 true，则文本字段被视为密码文本字段，并使用星号而不是实际字符来隐藏输入的字符。如果为 false，则不会将文本字段视为密码文本字段。
             * 默认值为 false。
             * @member {boolean} egret.TextInput#displayAsPassword
             */
            this._displayAsPassword = false;
            /**
             * 使用此文本格式的文本的字体名称，以字符串形式表示。
             * 默认值 Arial。
             * @member {any} egret.TextField#fontFamily
             */
            this._fontFamily = TextField.default_fontFamily;
            /**
             * 使用此文本格式的文本的大小（以像素为单位）。
             * 默认值为 30。
             * @member {number} egret.TextField#size
             */
            this._size = 30;
            this._textColorString = "#FFFFFF";
            /**
             * 表示文本的颜色。
             * 包含三个 8 位 RGB 颜色成分的数字；例如，0xFF0000 为红色，0x00FF00 为绿色。
             * 默认值为 0xFFFFFF。
             * @member {number} egret.TextField#textColor
             */
            this._textColor = 0xFFFFFF;
            this._strokeColorString = "#000000";
            /**
             * 表示文本的描边颜色。
             * 包含三个 8 位 RGB 颜色成分的数字；例如，0xFF0000 为红色，0x00FF00 为绿色。
             * 默认值为 0x000000。
             * @member {number} egret.TextField#strokeColor
             */
            this._strokeColor = 0x000000;
            /**
             * 表示描边宽度。
             * 0为没有描边。
             * 默认值为 0。
             * @member {number} egret.TextField#stroke
             */
            this._stroke = 0;
            /**
             * 文本水平对齐方式
             * 使用HorizontalAlign定义的常量。
             * 默认值为 HorizontalAlign.LEFT。
             * @member {string} egret.TextField#textAlign
             */
            this._textAlign = "left";
            /**
             * 文本垂直对齐方式。
             * 使用VerticalAlign定义的常量。
             * 默认值为 VerticalAlign.TOP。
             * @member {string} egret.TextField#verticalAlign
             */
            this._verticalAlign = "top";
            /**
             * 文本字段中最多可包含的字符数（即用户输入的字符数）。
             * 脚本可以插入比 maxChars 允许的字符数更多的文本；maxChars 属性仅表示用户可以输入多少文本。如果此属性的值为 0，则用户可以输入无限数量的文本。
             * 默认值为 0。
             * @type {number}
             * @private
             */
            this._maxChars = 0;
            this._scrollV = -1;
            this._maxScrollV = 0;
            /**
             * 行间距
             * 一个整数，表示行与行之间的垂直间距量。
             * 默认值为 0。
             * @member {number} egret.TextField#lineSpacing
             */
            this._lineSpacing = 0;
            /**
             * 文本行数。【只读】
             * @member {number} egret.TextField#numLines
             */
            this._numLines = 0;
            /**
             * 表示字段是否为多行文本字段。注意，此属性仅在type为TextFieldType.INPUT时才有效。
             * 如果值为 true，则文本字段为多行文本字段；如果值为 false，则文本字段为单行文本字段。在类型为 TextFieldType.INPUT 的字段中，multiline 值将确定 Enter 键是否创建新行（如果值为 false，则将忽略 Enter 键）。
             * 默认值为 false。
             * @member {boolean} egret.TextField#multiline
             */
            this._multiline = false;
            this._isFlow = false;
            this._textArr = [];
            this._isArrayChanged = false;
            this._textMaxWidth = 0; //文本全部显示时宽
            this._textMaxHeight = 0; //文本全部显示时高（无行间距）
            this._linesArr = [];
        }
        TextField.prototype.isInput = function () {
            return this._type == egret.TextFieldType.INPUT;
        };
        TextField.prototype._setTouchEnabled = function (value) {
            _super.prototype._setTouchEnabled.call(this, value);
            if (this.isInput()) {
                this._inputEnabled = true;
            }
        };
        Object.defineProperty(TextField.prototype, "type", {
            get: function () {
                return this._type;
            },
            set: function (value) {
                this._setType(value);
            },
            enumerable: true,
            configurable: true
        });
        TextField.prototype._setType = function (value) {
            if (this._type != value) {
                this._type = value;
                if (this._type == egret.TextFieldType.INPUT) {
                    if (!this._hasWidthSet) {
                        this._setWidth(100);
                    }
                    if (!this._hasHeightSet) {
                        this._setHeight(30);
                    }
                    //创建stageText
                    if (this._inputUtils == null) {
                        this._inputUtils = new egret.InputController();
                    }
                    this._inputUtils.init(this);
                    this._setDirty();
                    if (this._stage) {
                        this._inputUtils._addStageText();
                    }
                }
                else {
                    if (this._inputUtils) {
                        this._inputUtils._removeStageText();
                        this._inputUtils = null;
                    }
                }
            }
        };
        Object.defineProperty(TextField.prototype, "text", {
            get: function () {
                return this._getText();
            },
            set: function (value) {
                this._setText(value);
            },
            enumerable: true,
            configurable: true
        });
        TextField.prototype._getText = function () {
            if (this._type == egret.TextFieldType.INPUT) {
                return this._inputUtils._getText();
            }
            return this._text;
        };
        TextField.prototype._setSizeDirty = function () {
            _super.prototype._setSizeDirty.call(this);
            this._isArrayChanged = true;
        };
        TextField.prototype._setTextDirty = function () {
            this._setSizeDirty();
        };
        TextField.prototype._setBaseText = function (value) {
            if (value == null) {
                value = "";
            }
            this._isFlow = false;
            if (this._text != value || this._displayAsPassword) {
                this._setTextDirty();
                this._text = value;
                var text = "";
                if (this._displayAsPassword) {
                    text = this.changeToPassText(this._text);
                }
                else {
                    text = this._text;
                }
                this.setMiddleStyle([{ text: text }]);
            }
        };
        TextField.prototype._setText = function (value) {
            if (value == null) {
                value = "";
            }
            this._setBaseText(value);
            if (this._inputUtils) {
                this._inputUtils._setText(this._text);
            }
        };
        Object.defineProperty(TextField.prototype, "displayAsPassword", {
            get: function () {
                return this._displayAsPassword;
            },
            set: function (value) {
                this._setDisplayAsPassword(value);
            },
            enumerable: true,
            configurable: true
        });
        TextField.prototype._setDisplayAsPassword = function (value) {
            if (this._displayAsPassword != value) {
                this._displayAsPassword = value;
                this._setText(this._text);
            }
        };
        Object.defineProperty(TextField.prototype, "fontFamily", {
            get: function () {
                return this._fontFamily;
            },
            set: function (value) {
                this._setFontFamily(value);
            },
            enumerable: true,
            configurable: true
        });
        TextField.prototype._setFontFamily = function (value) {
            if (this._fontFamily != value) {
                this._setTextDirty();
                this._fontFamily = value;
            }
        };
        Object.defineProperty(TextField.prototype, "size", {
            get: function () {
                return this._size;
            },
            set: function (value) {
                this._setSize(value);
            },
            enumerable: true,
            configurable: true
        });
        TextField.prototype._setSize = function (value) {
            if (this._size != value) {
                this._setTextDirty();
                this._size = value;
            }
        };
        Object.defineProperty(TextField.prototype, "italic", {
            get: function () {
                return this._italic;
            },
            set: function (value) {
                this._setItalic(value);
            },
            enumerable: true,
            configurable: true
        });
        TextField.prototype._setItalic = function (value) {
            if (this._italic != value) {
                this._setTextDirty();
                this._italic = value;
            }
        };
        Object.defineProperty(TextField.prototype, "bold", {
            get: function () {
                return this._bold;
            },
            set: function (value) {
                this._setBold(value);
            },
            enumerable: true,
            configurable: true
        });
        TextField.prototype._setBold = function (value) {
            if (this._bold != value) {
                this._setTextDirty();
                this._bold = value;
            }
        };
        Object.defineProperty(TextField.prototype, "textColor", {
            get: function () {
                return this._textColor;
            },
            set: function (value) {
                this._setTextColor(value);
            },
            enumerable: true,
            configurable: true
        });
        TextField.prototype._setTextColor = function (value) {
            if (this._textColor != value) {
                this._setTextDirty();
                this._textColor = value;
                this._textColorString = egret.toColorString(value);
            }
        };
        Object.defineProperty(TextField.prototype, "strokeColor", {
            get: function () {
                return this._strokeColor;
            },
            set: function (value) {
                this._setStrokeColor(value);
            },
            enumerable: true,
            configurable: true
        });
        TextField.prototype._setStrokeColor = function (value) {
            if (this._strokeColor != value) {
                this._setTextDirty();
                this._strokeColor = value;
                this._strokeColorString = egret.toColorString(value);
            }
        };
        Object.defineProperty(TextField.prototype, "stroke", {
            get: function () {
                return this._stroke;
            },
            set: function (value) {
                this._setStroke(value);
            },
            enumerable: true,
            configurable: true
        });
        TextField.prototype._setStroke = function (value) {
            if (this._stroke != value) {
                this._setTextDirty();
                this._stroke = value;
            }
        };
        Object.defineProperty(TextField.prototype, "textAlign", {
            get: function () {
                return this._textAlign;
            },
            set: function (value) {
                this._setTextAlign(value);
            },
            enumerable: true,
            configurable: true
        });
        TextField.prototype._setTextAlign = function (value) {
            if (this._textAlign != value) {
                this._setTextDirty();
                this._textAlign = value;
            }
        };
        Object.defineProperty(TextField.prototype, "verticalAlign", {
            get: function () {
                return this._verticalAlign;
            },
            set: function (value) {
                this._setVerticalAlign(value);
            },
            enumerable: true,
            configurable: true
        });
        TextField.prototype._setVerticalAlign = function (value) {
            if (this._verticalAlign != value) {
                this._setTextDirty();
                this._verticalAlign = value;
            }
        };
        Object.defineProperty(TextField.prototype, "maxChars", {
            get: function () {
                return this._maxChars;
            },
            set: function (value) {
                this._setMaxChars(value);
            },
            enumerable: true,
            configurable: true
        });
        TextField.prototype._setMaxChars = function (value) {
            if (this._maxChars != value) {
                this._maxChars = value;
            }
        };
        Object.defineProperty(TextField.prototype, "scrollV", {
            set: function (value) {
                this._scrollV = value;
                this._setDirty();
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TextField.prototype, "maxScrollV", {
            get: function () {
                return this._maxScrollV;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TextField.prototype, "selectionBeginIndex", {
            get: function () {
                return 0;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TextField.prototype, "selectionEndIndex", {
            get: function () {
                return 0;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TextField.prototype, "caretIndex", {
            get: function () {
                return 0;
            },
            enumerable: true,
            configurable: true
        });
        TextField.prototype._setSelection = function (beginIndex, endIndex) {
        };
        Object.defineProperty(TextField.prototype, "lineSpacing", {
            get: function () {
                return this._lineSpacing;
            },
            set: function (value) {
                this._setLineSpacing(value);
            },
            enumerable: true,
            configurable: true
        });
        TextField.prototype._setLineSpacing = function (value) {
            if (this._lineSpacing != value) {
                this._setTextDirty();
                this._lineSpacing = value;
            }
        };
        TextField.prototype._getLineHeight = function () {
            return this._lineSpacing + this._size;
        };
        Object.defineProperty(TextField.prototype, "numLines", {
            get: function () {
                return this._numLines;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TextField.prototype, "multiline", {
            get: function () {
                return this._multiline;
            },
            set: function (value) {
                this._setMultiline(value);
            },
            enumerable: true,
            configurable: true
        });
        TextField.prototype._setMultiline = function (value) {
            this._multiline = value;
            this._setDirty();
        };
        TextField.prototype.setFocus = function () {
            //todo:
            egret.Logger.warning("TextField.setFocus 没有实现");
        };
        TextField.prototype._onRemoveFromStage = function () {
            _super.prototype._onRemoveFromStage.call(this);
            if (this._type == egret.TextFieldType.INPUT) {
                this._inputUtils._removeStageText();
            }
        };
        TextField.prototype._onAddToStage = function () {
            _super.prototype._onAddToStage.call(this);
            if (this._type == egret.TextFieldType.INPUT) {
                this._inputUtils._addStageText();
            }
        };
        TextField.prototype._updateBaseTransform = function () {
            _super.prototype._updateTransform.call(this);
        };
        TextField.prototype._updateTransform = function () {
            if (this._type == egret.TextFieldType.INPUT) {
                if (this._normalDirty) {
                    this._clearDirty();
                    this._inputUtils._updateProperties();
                }
                else {
                    this._inputUtils._updateTransform();
                }
            }
            else {
                this._updateBaseTransform();
            }
        };
        /**
         * @see egret.DisplayObject._render
         * @param renderContext
         */
        TextField.prototype._render = function (renderContext) {
            this.drawText(renderContext);
            this._clearDirty();
        };
        /**
         * 测量显示对象坐标与大小
         */
        TextField.prototype._measureBounds = function () {
            return this.measureText();
        };
        Object.defineProperty(TextField.prototype, "textFlow", {
            get: function () {
                return this._textArr;
            },
            /**
             *
             */
            set: function (textArr) {
                this._isFlow = true;
                var text = "";
                if (textArr == null)
                    textArr = [];
                for (var i = 0; i < textArr.length; i++) {
                    var element = textArr[i];
                    text += element.text;
                }
                if (this._displayAsPassword) {
                    this._setBaseText(text);
                }
                else {
                    this._text = text;
                    this.setMiddleStyle(textArr);
                }
            },
            enumerable: true,
            configurable: true
        });
        TextField.prototype.changeToPassText = function (text) {
            if (this._displayAsPassword) {
                var passText = "";
                for (var i = 0, num = text.length; i < num; i++) {
                    switch (text.charAt(i)) {
                        case '\n':
                            passText += "\n";
                            break;
                        case '\r':
                            break;
                        default:
                            passText += '*';
                    }
                }
                return passText;
            }
            return text;
        };
        TextField.prototype.setMiddleStyle = function (textArr) {
            this._isArrayChanged = true;
            this._textArr = textArr;
            this._setSizeDirty();
        };
        Object.defineProperty(TextField.prototype, "textWidth", {
            get: function () {
                return this._textMaxWidth;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TextField.prototype, "textHeight", {
            get: function () {
                return this._textMaxHeight;
            },
            enumerable: true,
            configurable: true
        });
        TextField.prototype.appendText = function (text) {
            this.appendElement({ text: text });
        };
        TextField.prototype.appendElement = function (element) {
            this._textArr.push(element);
            this.setMiddleStyle(this._textArr);
        };
        TextField.prototype._getLinesArr = function () {
            if (!this._isArrayChanged) {
                return this._linesArr;
            }
            this._isArrayChanged = false;
            var text2Arr = this._textArr;
            var renderContext = egret.MainContext.instance.rendererContext;
            this._linesArr = [];
            this._textMaxHeight = 0;
            this._textMaxWidth = 0;
            //宽度被设置为0
            if (this._hasWidthSet && this._explicitWidth == 0) {
                console.warn("文本宽度被设置为0");
                this._numLines = 0;
                return [{ width: 0, height: 0, elements: [] }];
            }
            var linesArr = this._linesArr;
            var lineW = 0;
            var lineH = 0;
            var lineCount = 0;
            var lineElement;
            if (!this._isFlow) {
                renderContext.setupFont(this);
            }
            for (var i = 0; i < text2Arr.length; i++) {
                var element = text2Arr[i];
                element.style = element.style || {};
                var text = element.text.toString();
                var textArr = text.split(/(?:\r\n|\r|\n)/);
                for (var j = 0; j < textArr.length; j++) {
                    if (linesArr[lineCount] == null) {
                        lineElement = { width: 0, height: 0, elements: [] };
                        linesArr[lineCount] = lineElement;
                        lineW = 0;
                        lineH = 0;
                    }
                    if (this._type == egret.TextFieldType.INPUT) {
                        lineH = this._size;
                    }
                    else {
                        lineH = Math.max(lineH, element.style.size || this._size);
                    }
                    if (textArr[j] == "") {
                    }
                    else {
                        if (this._isFlow) {
                            renderContext.setupFont(this, element.style);
                        }
                        var w = renderContext.measureText(textArr[j]);
                        if (!this._hasWidthSet) {
                            lineW += w;
                            lineElement.elements.push({ width: w, text: textArr[j], style: element.style });
                        }
                        else {
                            if (lineW + w <= this._explicitWidth) {
                                lineElement.elements.push({ width: w, text: textArr[j], style: element.style });
                                lineW += w;
                            }
                            else {
                                var k = 0;
                                var ww = 0;
                                var word = textArr[j];
                                for (; k < word.length; k++) {
                                    w = renderContext.measureText(word.charAt(k));
                                    if (lineW + w > this._explicitWidth) {
                                        break;
                                    }
                                    ww += w;
                                    lineW += w;
                                }
                                if (k > 0) {
                                    lineElement.elements.push({ width: ww, text: word.substring(0, k), style: element.style });
                                    textArr[j] = word.substring(k);
                                }
                                j--;
                            }
                        }
                    }
                    if (j < textArr.length - 1) {
                        lineElement.width = lineW;
                        lineElement.height = lineH;
                        this._textMaxWidth = Math.max(this._textMaxWidth, lineW);
                        this._textMaxHeight += lineH;
                        if (this._type == egret.TextFieldType.INPUT && !this._multiline) {
                            this._numLines = linesArr.length;
                            return linesArr;
                        }
                        lineCount++;
                    }
                }
                if (i == text2Arr.length - 1 && lineElement) {
                    lineElement.width = lineW;
                    lineElement.height = lineH;
                    this._textMaxWidth = Math.max(this._textMaxWidth, lineW);
                    this._textMaxHeight += lineH;
                }
            }
            this._numLines = linesArr.length;
            return linesArr;
        };
        TextField.prototype.measureText = function () {
            var lines = this._getLinesArr();
            if (!lines) {
                return egret.Rectangle.identity.initialize(0, 0, 0, 0);
            }
            var maxWidth = this._hasWidthSet ? this._explicitWidth : this._textMaxWidth;
            var maxHeight = this._hasHeightSet ? this._explicitHeight : this._textMaxHeight + (this._numLines - 1) * this._lineSpacing;
            return egret.Rectangle.identity.initialize(0, 0, maxWidth, maxHeight);
        };
        /**
         * @private
         * @param renderContext
         * @returns {Rectangle}
         */
        TextField.prototype.drawText = function (renderContext) {
            var lines = this._getLinesArr();
            if (!lines) {
                return;
            }
            if (!this._isFlow) {
                renderContext.setupFont(this);
            }
            var maxWidth = this._hasWidthSet ? this._explicitWidth : this._textMaxWidth;
            var textHeight = this._textMaxHeight + (this._numLines - 1) * this._lineSpacing;
            var drawY = 0;
            var startLine = 0;
            if (this._hasHeightSet) {
                if (textHeight < this._explicitHeight) {
                    var valign = 0;
                    if (this._verticalAlign == egret.VerticalAlign.MIDDLE)
                        valign = 0.5;
                    else if (this._verticalAlign == egret.VerticalAlign.BOTTOM)
                        valign = 1;
                    drawY += valign * (this._explicitHeight - textHeight);
                }
                else if (textHeight > this._explicitHeight) {
                    startLine = Math.max(this._scrollV - 1, 0);
                    startLine = Math.min(this._numLines - 1, startLine);
                }
            }
            drawY = Math.round(drawY);
            var halign = 0;
            if (this._textAlign == egret.HorizontalAlign.CENTER) {
                halign = 0.5;
            }
            else if (this._textAlign == egret.HorizontalAlign.RIGHT) {
                halign = 1;
            }
            var drawX = 0;
            for (var i = startLine; i < this._numLines; i++) {
                var line = lines[i];
                var h = line.height;
                drawY += h / 2;
                if (i != 0 && this._hasHeightSet && drawY > this._explicitHeight) {
                    break;
                }
                drawX = Math.round((maxWidth - line.width) * halign);
                for (var j = 0; j < line.elements.length; j++) {
                    var element = line.elements[j];
                    var size = element.style.size || this._size;
                    if (this._type == egret.TextFieldType.INPUT) {
                        renderContext.drawText(this, element.text, drawX, drawY + (h - size) / 2, element.width);
                    }
                    else {
                        if (this._isFlow) {
                            renderContext.setupFont(this, element.style);
                        }
                        renderContext.drawText(this, element.text, drawX, drawY + (h - size) / 2, element.width, element.style);
                    }
                    drawX += element.width;
                }
                drawY += h / 2 + this._lineSpacing;
            }
        };
        TextField.default_fontFamily = "Arial";
        return TextField;
    })(egret.DisplayObject);
    egret.TextField = TextField;
    TextField.prototype.__class__ = "egret.TextField";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    /**
     * @class egret.HtmlTextParser
     * @classdesc
     *
     */
    var HtmlTextParser = (function () {
        function HtmlTextParser() {
            this.resutlArr = [];
        }
        HtmlTextParser.prototype.parser = function (htmltext) {
            this.stackArray = [];
            this.resutlArr = [];
            var firstIdx = 0; //文本段开始位置
            var length = htmltext.length;
            while (firstIdx < length) {
                var starIdx = htmltext.indexOf("<", firstIdx);
                if (starIdx < 0) {
                    this.addToResultArr(htmltext.substring(firstIdx));
                    firstIdx = length;
                }
                else {
                    this.addToResultArr(htmltext.substring(firstIdx, starIdx));
                    var fontEnd = htmltext.indexOf(">", starIdx);
                    if (htmltext.charAt(starIdx + 1) == "\/") {
                        this.stackArray.pop();
                    }
                    else {
                        this.addToArray(htmltext.substring(starIdx + 1, fontEnd));
                    }
                    firstIdx = fontEnd + 1;
                }
            }
            return this.resutlArr;
        };
        HtmlTextParser.prototype.addToResultArr = function (value) {
            if (value == "") {
                return;
            }
            var resutlArr = [];
            resutlArr.push(["&lt;", "<"]);
            resutlArr.push(["&gt;", ">"]);
            resutlArr.push(["&amp;", "&"]);
            resutlArr.push(["&quot;", "\""]);
            resutlArr.push(["&apos;;", "\'"]);
            for (var i = 0; i < resutlArr.length; i++) {
                var k = resutlArr[i][0];
                var v = resutlArr[i][1];
                var reg = new RegExp(k, "g");
                value.replace(reg, v);
            }
            if (this.stackArray.length > 0) {
                this.resutlArr.push({ text: value, style: this.stackArray[this.stackArray.length - 1] });
            }
            else {
                this.resutlArr.push({ text: value });
            }
        };
        //将字符数据转成Json数据
        HtmlTextParser.prototype.changeStringToObject = function (str) {
            var info = {};
            var array = str.replace(/( )+/g, " ").split(" ");
            for (var i = 0; i < array.length; i++) {
                this.addProperty(info, array[i]);
            }
            return info;
        };
        HtmlTextParser.prototype.addProperty = function (info, prV) {
            var valueArr = prV.replace(/( )*=( )*/g, "=").split("=");
            if (valueArr[1]) {
                valueArr[1] = valueArr[1].replace(/(\"|\')/g, "");
            }
            switch (valueArr[0].toLowerCase()) {
                case "color":
                    info.textColor = parseInt(valueArr[1]);
                    break;
                case "b":
                    info.bold = (valueArr[1] || "true") == "true";
                    break;
                case "i":
                    info.italic = (valueArr[1] || "true") == "true";
                    break;
                case "size":
                    info.size = parseInt(valueArr[1]);
                    break;
                case "fontFamily":
                    info.fontFamily = valueArr[1];
                    break;
            }
        };
        HtmlTextParser.prototype.addToArray = function (infoStr) {
            var info = this.changeStringToObject(infoStr);
            if (this.stackArray.length == 0) {
                this.stackArray.push(info);
            }
            else {
                var lastInfo = this.stackArray[this.stackArray.length - 1];
                for (var key in lastInfo) {
                    if (info[key] == null) {
                        info[key] = lastInfo[key];
                    }
                }
                this.stackArray.push(info);
            }
        };
        return HtmlTextParser;
    })();
    egret.HtmlTextParser = HtmlTextParser;
    HtmlTextParser.prototype.__class__ = "egret.HtmlTextParser";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    /**
     * @class egret.TextFieldType
     * @classdesc
     * TextFieldType 类是在设置 TextField 类的 type 属性时使用的常数值的枚举。
     */
    var TextFieldType = (function () {
        function TextFieldType() {
        }
        /**
         * 用于指定动态文本
         * @constant {string} egret.TextFieldType.DYNAMIC
         */
        TextFieldType.DYNAMIC = "dynamic";
        /**
         * 用于指定输入文本
         * @constant {string} egret.TextFieldType.INPUT
         */
        TextFieldType.INPUT = "input";
        return TextFieldType;
    })();
    egret.TextFieldType = TextFieldType;
    TextFieldType.prototype.__class__ = "egret.TextFieldType";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.SpriteSheet
     * @classdesc SpriteSheet是一张由多个子位图拼接而成的集合位图，它包含多个Texture对象。
     * 每一个Texture都共享SpriteSheet的集合位图，但是指向它的不同的区域。
     * 在WebGL / OpenGL上，这种做法可以显著提升性能
     * 同时，SpriteSheet可以很方便的进行素材整合，降低HTTP请求数量
     * SpriteSheet 格式的具体规范可以参见此文档  https://github.com/egret-labs/egret-core/wiki/Egret-SpriteSheet-Specification
     *
     */
    var SpriteSheet = (function (_super) {
        __extends(SpriteSheet, _super);
        function SpriteSheet(texture) {
            _super.call(this);
            var bitmapData = texture.bitmapData;
            this.bitmapData = bitmapData;
            this._textureMap = {};
            this._sourceWidth = bitmapData.width;
            this._sourceHeight = bitmapData.height;
            this._bitmapX = texture._bitmapX - texture._offsetX;
            this._bitmapY = texture._bitmapY - texture._offsetY;
        }
        /**
         * 根据指定纹理名称获取一个缓存的Texture对象
         * @method egret.SpriteSheet#getTexture
         * @param name {string} 缓存这个Texture对象所使用的名称
         * @returns {egret.Texture} Texture对象
         */
        SpriteSheet.prototype.getTexture = function (name) {
            return this._textureMap[name];
        };
        /**
         * 为SpriteSheet上的指定区域创建一个新的Texture对象并缓存它
         * @method egret.SpriteSheet#createTexture
         * @param name {string} 缓存这个Texture对象所使用的名称，如果名称已存在，将会覆盖之前的Texture对象
         * @param bitmapX {number} 纹理区域在bitmapData上的起始坐标x
         * @param bitmapY {number} 纹理区域在bitmapData上的起始坐标y
         * @param bitmapWidth {number} 纹理区域在bitmapData上的宽度
         * @param bitmapHeight {number} 纹理区域在bitmapData上的高度
         * @param offsetX {number} 原始位图的非透明区域x起始点
         * @param offsetY {number} 原始位图的非透明区域y起始点
         * @param textureWidth {number} 原始位图的高度，若不传入，则使用bitmapWidth的值。
         * @param textureHeight {number} 原始位图的宽度，若不传入，这使用bitmapHeight值。
         * @returns {egret.Texture} 创建的Texture对象
         */
        SpriteSheet.prototype.createTexture = function (name, bitmapX, bitmapY, bitmapWidth, bitmapHeight, offsetX, offsetY, textureWidth, textureHeight) {
            if (offsetX === void 0) { offsetX = 0; }
            if (offsetY === void 0) { offsetY = 0; }
            if (typeof textureWidth === "undefined") {
                textureWidth = offsetX + bitmapWidth;
            }
            if (typeof textureHeight === "undefined") {
                textureHeight = offsetY + bitmapHeight;
            }
            var texture = new egret.Texture();
            var scale = egret.MainContext.instance.rendererContext.texture_scale_factor;
            texture._bitmapData = this.bitmapData;
            texture._bitmapX = this._bitmapX + bitmapX;
            texture._bitmapY = this._bitmapY + bitmapY;
            texture._bitmapWidth = bitmapWidth * scale;
            texture._bitmapHeight = bitmapHeight * scale;
            texture._offsetX = offsetX;
            texture._offsetY = offsetY;
            texture._textureWidth = textureWidth * scale;
            texture._textureHeight = textureHeight * scale;
            texture._sourceWidth = this._sourceWidth;
            texture._sourceHeight = this._sourceHeight;
            this._textureMap[name] = texture;
            return texture;
        };
        return SpriteSheet;
    })(egret.HashObject);
    egret.SpriteSheet = SpriteSheet;
    SpriteSheet.prototype.__class__ = "egret.SpriteSheet";
})(egret || (egret = {}));
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    var InputController = (function (_super) {
        __extends(InputController, _super);
        function InputController() {
            _super.call(this);
            this._isFocus = false;
            this._isFirst = true;
            this._isFirst = true;
        }
        InputController.prototype.init = function (text) {
            this._text = text;
            this.stageText = egret.StageText.create();
            var point = this._text.localToGlobal();
            this.stageText._open(point.x, point.y, this._text._explicitWidth, this._text._explicitHeight);
        };
        InputController.prototype._addStageText = function () {
            if (!this._text._inputEnabled) {
                this._text._touchEnabled = true;
            }
            this.stageText._add();
            this.stageText._addListeners();
            this.stageText.addEventListener("blur", this.onBlurHandler, this);
            this.stageText.addEventListener("focus", this.onFocusHandler, this);
            this.stageText.addEventListener("updateText", this.updateTextHandler, this);
            this._text.addEventListener(egret.TouchEvent.TOUCH_TAP, this.onMouseDownHandler, this);
            egret.MainContext.instance.stage.addEventListener(egret.TouchEvent.TOUCH_TAP, this.onStageDownHandler, this);
        };
        InputController.prototype._removeStageText = function () {
            this.stageText._remove();
            this.stageText._removeListeners();
            if (!this._text._inputEnabled) {
                this._text._touchEnabled = false;
            }
            this.stageText.removeEventListener("blur", this.onBlurHandler, this);
            this.stageText.removeEventListener("focus", this.onFocusHandler, this);
            this.stageText.removeEventListener("updateText", this.updateTextHandler, this);
            this._text.removeEventListener(egret.TouchEvent.TOUCH_TAP, this.onMouseDownHandler, this);
            egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP, this.onStageDownHandler, this);
        };
        InputController.prototype._getText = function () {
            return this.stageText._getText();
        };
        InputController.prototype._setText = function (value) {
            this.stageText._setText(value);
        };
        InputController.prototype.onFocusHandler = function (event) {
            this.hideText();
        };
        //显示文本
        InputController.prototype.onBlurHandler = function (event) {
            this.showText();
        };
        //点中文本
        InputController.prototype.onMouseDownHandler = function (event) {
            event.stopPropagation();
            if (!this._text._visible) {
                return;
            }
            this.stageText._show();
        };
        //未点中文本
        InputController.prototype.onStageDownHandler = function (event) {
            this.stageText._hide();
            this.showText();
        };
        InputController.prototype.showText = function () {
            if (this._isFocus) {
                this._isFocus = false;
                this.resetText();
            }
        };
        InputController.prototype.hideText = function () {
            if (!this._isFocus) {
                this._text._setBaseText("");
                this._isFocus = true;
            }
        };
        InputController.prototype.updateTextHandler = function (event) {
            this.resetText();
            //抛出change事件
            this._text.dispatchEvent(new egret.Event(egret.Event.CHANGE));
        };
        InputController.prototype.resetText = function () {
            this._text._setBaseText(this.stageText._getText());
        };
        InputController.prototype._updateTransform = function () {
            //todo 等待worldTransform的性能优化完成，合并这块代码
            var oldTransFormA = this._text._worldTransform.a;
            var oldTransFormB = this._text._worldTransform.b;
            var oldTransFormC = this._text._worldTransform.c;
            var oldTransFormD = this._text._worldTransform.d;
            var oldTransFormTx = this._text._worldTransform.tx;
            var oldTransFormTy = this._text._worldTransform.ty;
            this._text._updateBaseTransform();
            var newTransForm = this._text._worldTransform;
            if (this._isFirst || oldTransFormA != newTransForm.a || oldTransFormB != newTransForm.b || oldTransFormC != newTransForm.c || oldTransFormD != newTransForm.d || oldTransFormTx != newTransForm.tx || oldTransFormTy != newTransForm.ty) {
                this._isFirst = false;
                var point = this._text.localToGlobal();
                this.stageText.changePosition(point.x, point.y);
                var self = this;
                egret.callLater(function () {
                    self.stageText._setScale(self._text._worldTransform.a, self._text._worldTransform.d);
                }, this);
            }
        };
        InputController.prototype._updateProperties = function () {
            var stage = this._text._stage;
            if (stage == null) {
                this.stageText._setVisible(false);
            }
            else {
                var item = this._text;
                var visible = item._visible;
                while (true) {
                    if (!visible) {
                        break;
                    }
                    item = item.parent;
                    if (item == stage) {
                        break;
                    }
                    visible = item._visible;
                }
                this.stageText._setVisible(visible);
            }
            this.stageText._setMultiline(this._text._multiline);
            this.stageText._setMaxChars(this._text._maxChars);
            this.stageText._setSize(this._text._size);
            this.stageText._setTextColor(this._text._textColorString);
            this.stageText._setTextFontFamily(this._text._fontFamily);
            this.stageText._setBold(this._text._bold);
            this.stageText._setItalic(this._text._italic);
            this.stageText._setTextAlign(this._text._textAlign);
            this.stageText._setWidth(this._text._getSize(egret.Rectangle.identity).width);
            this.stageText._setHeight(this._text._getSize(egret.Rectangle.identity).height);
            this.stageText._setTextType(this._text._displayAsPassword ? "password" : "text");
            this.stageText._setText(this._text._text);
            //整体修改
            this.stageText._resetStageText();
            this._updateTransform();
        };
        return InputController;
    })(egret.HashObject);
    egret.InputController = InputController;
    InputController.prototype.__class__ = "egret.InputController";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var BitmapTextSpriteSheet = (function (_super) {
        __extends(BitmapTextSpriteSheet, _super);
        function BitmapTextSpriteSheet(texture, fntText) {
            _super.call(this, texture);
            this.charList = this.parseConfig(fntText);
        }
        BitmapTextSpriteSheet.prototype.getTexture = function (name) {
            var texture = this._textureMap[name];
            if (!texture) {
                var c = this.charList[name];
                if (!c) {
                    return null;
                }
                texture = this.createTexture(name, c.x, c.y, c.width, c.height, c.offsetX, c.offsetY);
                this._textureMap[name] = texture;
            }
            return texture;
        };
        BitmapTextSpriteSheet.prototype.parseConfig = function (fntText) {
            fntText = fntText.split("\r\n").join("\n");
            var lines = fntText.split("\n");
            var charsCount = this.getConfigByKey(lines[3], "count");
            var chars = {};
            for (var i = 4; i < 4 + charsCount; i++) {
                var charText = lines[i];
                var letter = String.fromCharCode(this.getConfigByKey(charText, "id"));
                var c = {};
                chars[letter] = c;
                c["x"] = this.getConfigByKey(charText, "x");
                c["y"] = this.getConfigByKey(charText, "y");
                c["width"] = this.getConfigByKey(charText, "width");
                c["height"] = this.getConfigByKey(charText, "height");
                c["offsetX"] = this.getConfigByKey(charText, "xoffset");
                c["offsetY"] = this.getConfigByKey(charText, "yoffset");
            }
            return chars;
        };
        BitmapTextSpriteSheet.prototype.getConfigByKey = function (configText, key) {
            var itemConfigTextList = configText.split(" ");
            for (var i = 0, length = itemConfigTextList.length; i < length; i++) {
                var itemConfigText = itemConfigTextList[i];
                if (key == itemConfigText.substring(0, key.length)) {
                    var value = itemConfigText.substring(key.length + 1);
                    return parseInt(value);
                }
            }
            return 0;
        };
        return BitmapTextSpriteSheet;
    })(egret.SpriteSheet);
    egret.BitmapTextSpriteSheet = BitmapTextSpriteSheet;
    BitmapTextSpriteSheet.prototype.__class__ = "egret.BitmapTextSpriteSheet";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.MovieClip
     * @classdesc 影片剪辑，可以通过影片剪辑播放序列帧动画。
     * @extends egret.DisplayObjectContainer
     */
    var MovieClip = (function (_super) {
        __extends(MovieClip, _super);
        function MovieClip(data, texture) {
            _super.call(this);
            /**
             * 动画的播放帧频
             * @member {number} egret.MovieClip#frameRate
             */
            this.frameRate = 60;
            if (data instanceof DefaultMovieClipDelegate) {
                egret.Logger.warning("MovieClip#constructor接口参数已经变更，请尽快调整用法为 new MovieClip(data,texture)");
                this.delegate = data;
            }
            else {
                this.delegate = new DefaultMovieClipDelegate(data, texture);
            }
            this.delegate.setMovieClip(this);
        }
        /**
         * 播放指定动画
         * @method egret.MovieClip#gotoAndPlay
         * @param frameName {string} 指定帧的帧名称

         */
        MovieClip.prototype.gotoAndPlay = function (frameName) {
            this.delegate.gotoAndPlay(frameName);
        };
        /**
         * 播放并暂停指定动画
         * @method egret.MovieClip#gotoAndStop
         * @param frameName {string} 指定帧的帧名称

         */
        MovieClip.prototype.gotoAndStop = function (frameName) {
            this.delegate.gotoAndStop(frameName);
        };
        /**
         * 暂停动画
         * @method egret.MovieClip#stop
         */
        MovieClip.prototype.stop = function () {
            this.delegate.stop();
        };
        /**
         * @method egret.MovieClip#dispose
         */
        MovieClip.prototype.dispose = function () {
            this.delegate.dispose();
        };
        /**
         * 方法名改为 dispose
         * @method egret.MovieClip#release
         * @deprecated
         */
        MovieClip.prototype.release = function () {
            egret.Logger.warning("MovieClip#release方法即将废弃");
            this.dispose();
        };
        /**
         * @method egret.MovieClip#getCurrentFrameIndex
         * @deprecated
         * @returns {number}
         */
        MovieClip.prototype.getCurrentFrameIndex = function () {
            egret.Logger.warning("MovieClip#getCurrentFrameIndex方法即将废弃");
            return this.delegate["_currentFrameIndex"];
        };
        /**
         * 获取当前影片剪辑的帧频数
         * @method egret.MovieClip#getTotalFrame
         * @deprecated
         * @returns {number}
         */
        MovieClip.prototype.getTotalFrame = function () {
            egret.Logger.warning("MovieClip#getTotalFrame方法即将废弃");
            return this.delegate["_totalFrame"];
        };
        /**
         * @method egret.MovieClip#setInterval
         * @deprecated
         * @param value {number}
         */
        MovieClip.prototype.setInterval = function (value) {
            egret.Logger.warning("MovieClip#setInterval方法即将废弃,请使用MovieClip#frameRate代替");
            this.frameRate = 60 / value;
        };
        /**
         * @method egret.MovieClip#getIsPlaying
         * @deprecated
         * @returns {boolean}
         */
        MovieClip.prototype.getIsPlaying = function () {
            egret.Logger.warning("MovieClip#getIsPlaying方法即将废弃");
            return this.delegate["isPlaying"];
        };
        return MovieClip;
    })(egret.DisplayObjectContainer);
    egret.MovieClip = MovieClip;
    MovieClip.prototype.__class__ = "egret.MovieClip";
    var DefaultMovieClipDelegate = (function () {
        function DefaultMovieClipDelegate(data, texture) {
            this.data = data;
            this._totalFrame = 0;
            this._passTime = 0;
            this._currentFrameIndex = 0;
            this._isPlaying = false;
            this._frameData = data;
            this._spriteSheet = new egret.SpriteSheet(texture);
        }
        DefaultMovieClipDelegate.prototype.setMovieClip = function (movieClip) {
            this.movieClip = movieClip;
            this.bitmap = new egret.Bitmap();
            this.movieClip.addChild(this.bitmap);
        };
        DefaultMovieClipDelegate.prototype.gotoAndPlay = function (frameName) {
            this.checkHasFrame(frameName);
            this._isPlaying = true;
            this._currentFrameIndex = 0;
            this._currentFrameName = frameName;
            this._totalFrame = this._frameData.frames[frameName].totalFrame;
            this.playNextFrame();
            this._passTime = 0;
            egret.Ticker.getInstance().register(this.update, this);
        };
        DefaultMovieClipDelegate.prototype.gotoAndStop = function (frameName) {
            this.checkHasFrame(frameName);
            this.stop();
            this._passTime = 0;
            this._currentFrameIndex = 0;
            this._currentFrameName = frameName;
            this._totalFrame = this._frameData.frames[frameName].totalFrame;
            this.playNextFrame();
        };
        DefaultMovieClipDelegate.prototype.stop = function () {
            this._isPlaying = false;
            egret.Ticker.getInstance().unregister(this.update, this);
        };
        DefaultMovieClipDelegate.prototype.dispose = function () {
        };
        DefaultMovieClipDelegate.prototype.checkHasFrame = function (name) {
            if (this._frameData.frames[name] == undefined) {
                egret.Logger.fatal("MovieClip没有对应的frame：", name);
            }
        };
        DefaultMovieClipDelegate.prototype.update = function (advancedTime) {
            var oneFrameTime = 1000 / this.movieClip.frameRate;
            var last = this._passTime % oneFrameTime;
            var num = Math.floor((last + advancedTime) / oneFrameTime);
            while (num >= 1) {
                if (num == 1) {
                    this.playNextFrame();
                }
                else {
                    this.playNextFrame(false);
                }
                num--;
            }
            this._passTime += advancedTime;
        };
        DefaultMovieClipDelegate.prototype.playNextFrame = function (needShow) {
            if (needShow === void 0) { needShow = true; }
            var frameData = this._frameData.frames[this._currentFrameName].childrenFrame[this._currentFrameIndex];
            if (needShow) {
                var texture = this.getTexture(frameData.res);
                var bitmap = this.bitmap;
                bitmap.x = frameData.x;
                bitmap.y = frameData.y;
                bitmap.texture = texture;
            }
            if (frameData.action != null) {
                this.movieClip.dispatchEventWith(frameData.action);
            }
            this._currentFrameIndex++;
            if (this._currentFrameIndex == this._totalFrame) {
                this._currentFrameIndex = 0;
                if (frameData.action != egret.Event.COMPLETE) {
                    this.movieClip.dispatchEventWith(egret.Event.COMPLETE);
                }
            }
        };
        DefaultMovieClipDelegate.prototype.getTexture = function (name) {
            var resData = this._frameData.res[name];
            var texture = this._spriteSheet.getTexture(name);
            if (!texture) {
                texture = this._spriteSheet.createTexture(name, resData.x, resData.y, resData.w, resData.h);
            }
            return texture;
        };
        return DefaultMovieClipDelegate;
    })();
    egret.DefaultMovieClipDelegate = DefaultMovieClipDelegate;
    DefaultMovieClipDelegate.prototype.__class__ = "egret.DefaultMovieClipDelegate";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @classdesc
     * @extends egret.EventDispatcher
     * @private
     */
    var StageText = (function (_super) {
        __extends(StageText, _super);
        function StageText() {
            _super.call(this);
            this._scaleX = 1;
            this._scaleY = 1;
            this._size = 30;
            this._color = "#FFFFFF";
            this._fontFamily = "Arial";
            this._bold = false;
            this._italic = false;
            this._textAlign = "left";
            this._visible = false;
            this._multiline = false;
            this._maxChars = 0;
        }
        /**
         * @returns {string}
         */
        StageText.prototype._getText = function () {
            return null;
        };
        /**
         * @param value {string}
         */
        StageText.prototype._setText = function (value) {
        };
        /**
         * @param type {string}
         */
        StageText.prototype._setTextType = function (type) {
        };
        /**
         * @returns {string}
         */
        StageText.prototype._getTextType = function () {
            return null;
        };
        /**
         * @param x {number}
         * @param y {number}
         * @param width {number}
         * @param height {number}
         */
        StageText.prototype._open = function (x, y, width, height) {
            if (width === void 0) { width = 160; }
            if (height === void 0) { height = 21; }
        };
        StageText.prototype._show = function () {
        };
        StageText.prototype._add = function () {
        };
        StageText.prototype._remove = function () {
        };
        StageText.prototype._hide = function () {
        };
        StageText.prototype._addListeners = function () {
        };
        StageText.prototype._removeListeners = function () {
        };
        StageText.prototype._setScale = function (x, y) {
            this._scaleX = x;
            this._scaleY = y;
        };
        StageText.prototype.changePosition = function (x, y) {
        };
        StageText.prototype._setSize = function (value) {
            this._size = value;
        };
        StageText.prototype._setTextColor = function (value) {
            this._color = value;
        };
        StageText.prototype._setTextFontFamily = function (value) {
            this._fontFamily = value;
        };
        StageText.prototype._setBold = function (value) {
            this._bold = value;
        };
        StageText.prototype._setItalic = function (value) {
            this._italic = value;
        };
        StageText.prototype._setTextAlign = function (value) {
            this._textAlign = value;
        };
        StageText.prototype._setVisible = function (value) {
            this._visible = value;
        };
        StageText.prototype._setWidth = function (value) {
        };
        StageText.prototype._setHeight = function (value) {
        };
        StageText.prototype._setMultiline = function (value) {
            this._multiline = value;
        };
        StageText.prototype._setMaxChars = function (value) {
            this._maxChars = value;
        };
        StageText.prototype._resetStageText = function () {
        };
        StageText.create = function () {
            return null;
        };
        return StageText;
    })(egret.EventDispatcher);
    egret.StageText = StageText;
    StageText.prototype.__class__ = "egret.StageText";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    /**
     * @class egret.URLRequestMethod
     * @classdesc URLRequestMethod 类提供了一些值，这些值可指定在将数据发送到服务器时，
     * URLRequest 对象应使用 POST 方法还是 GET 方法。
     */
    var URLRequestMethod = (function () {
        function URLRequestMethod() {
        }
        /**
         * 表示 URLRequest 对象是一个 GET。
         * @constant {string} egret.URLRequestMethod.GET
         */
        URLRequestMethod.GET = "get";
        /**
         * 表示 URLRequest 对象是一个 POST。
         * @constant {string} egret.URLRequestMethod.POST
         */
        URLRequestMethod.POST = "post";
        return URLRequestMethod;
    })();
    egret.URLRequestMethod = URLRequestMethod;
    URLRequestMethod.prototype.__class__ = "egret.URLRequestMethod";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    /**
     * @class egret.URLLoaderDataFormat
     * @classdesc URLLoaderDataFormat 类提供了一些用于指定如何接收已下载数据的值。
     */
    var URLLoaderDataFormat = (function () {
        function URLLoaderDataFormat() {
        }
        /**
         * 指定以原始二进制数据形式接收下载的数据。
         * @constant {string} egret.URLLoaderDataFormat.BINARY
         */
        URLLoaderDataFormat.BINARY = "binary";
        /**
         * 指定以文本形式接收已下载的数据。
         * @constant {string} egret.URLLoaderDataFormat.TEXT
         */
        URLLoaderDataFormat.TEXT = "text";
        /**
         * 指定以 URL 编码变量形式接收下载的数据。
         * @constant {string} egret.URLLoaderDataFormat.VARIABLES
         */
        URLLoaderDataFormat.VARIABLES = "variables";
        /**
         * 指定以位图纹理形式接收已下载的数据。
         * @constant {string} egret.URLLoaderDataFormat.TEXTURE
         */
        URLLoaderDataFormat.TEXTURE = "texture";
        /**
         * 指定以声音形式接收已下载的数据。
         * @constant {string} egret.URLLoaderDataFormat.SOUND
         */
        URLLoaderDataFormat.SOUND = "sound";
        return URLLoaderDataFormat;
    })();
    egret.URLLoaderDataFormat = URLLoaderDataFormat;
    URLLoaderDataFormat.prototype.__class__ = "egret.URLLoaderDataFormat";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.URLVariables
     * @classdesc
     * 使用 URLVariables 类可以在应用程序和服务器之间传输变量。
     * 将 URLVariables 对象与 URLLoader 类的方法、URLRequest 类的 data 属性一起使用。
     * @extends egret.HashObject
     */
    var URLVariables = (function (_super) {
        __extends(URLVariables, _super);
        /**
         * @method egret.URLVariables#constructor
         * @param source {String} 包含名称/值对的 URL 编码的字符串。
         */
        function URLVariables(source) {
            if (source === void 0) { source = null; }
            _super.call(this);
            if (source !== null) {
                this.decode(source);
            }
        }
        /**
         * 将变量字符串转换为此 URLVariables.variables 对象的属性。
         * @method egret.URLVariables#decode
         * @param source {string}
         */
        URLVariables.prototype.decode = function (source) {
            if (!this.variables) {
                this.variables = {};
            }
            source = source.split("+").join(" ");
            var tokens, re = /[?&]?([^=]+)=([^&]*)/g;
            while (tokens = re.exec(source)) {
                this.variables[decodeURIComponent(tokens[1])] = decodeURIComponent(tokens[2]);
            }
        };
        /**
         * 以 MIME 内容编码格式 application/x-www-form-urlencoded 返回包含所有可枚举变量的字符串。
         * @method egret.URLVariables#toString
         */
        URLVariables.prototype.toString = function () {
            if (!this.variables) {
                return "";
            }
            var variables = this.variables;
            var str = "";
            var isFirst = true;
            for (var key in variables) {
                if (isFirst) {
                    isFirst = false;
                }
                else {
                    str += "&";
                }
                str += key + "=" + variables[key];
            }
            return str;
        };
        return URLVariables;
    })(egret.HashObject);
    egret.URLVariables = URLVariables;
    URLVariables.prototype.__class__ = "egret.URLVariables";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    var URLRequestHeader = (function () {
        function URLRequestHeader(name, value) {
            this.name = name;
            this.value = value;
        }
        return URLRequestHeader;
    })();
    egret.URLRequestHeader = URLRequestHeader;
    URLRequestHeader.prototype.__class__ = "egret.URLRequestHeader";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.URLRequest
     * @classdesc URLRequest 类可捕获单个 HTTP 请求中的所有信息。
     * @extends egret.HashObject
     */
    var URLRequest = (function (_super) {
        __extends(URLRequest, _super);
        /**
         * 实例化一个URLRequest对象
         * @method egret.URLRequest#constructor
         * @param url {string} 进行网络请求的地址
         */
        function URLRequest(url) {
            if (url === void 0) { url = null; }
            _super.call(this);
            /**
             * 请求方式，有效值为URLRequestMethod.GET 或 URLRequestMethod.POST。
             * @member {string} egret.URLRequest#method
             */
            this.method = egret.URLRequestMethod.GET;
            this.url = url;
        }
        return URLRequest;
    })(egret.HashObject);
    egret.URLRequest = URLRequest;
    URLRequest.prototype.__class__ = "egret.URLRequest";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.URLLoader
     * @classdesc
     * URLLoader 类以文本、二进制数据或 URL 编码变量的形式从 URL 下载数据。在下载文本文件、XML 或其他用于动态数据驱动应用程序的信息时，它很有用。
     * URLLoader 对象会先从 URL 中下载所有数据，然后才将数据用于应用程序中的代码。它会发出有关下载进度的通知，
     * 通过 bytesLoaded 和 bytesTotal 属性以及已调度的事件，可以监视下载进度。
     * @extends egret.EventDispatcher
     */
    var URLLoader = (function (_super) {
        __extends(URLLoader, _super);
        /**
         * @method egret.URLLoader#constructor
         * @param request {URLRequest} 一个 URLRequest 对象，指定要下载的 URL。
         * 如果省略该参数，则不开始加载操作。如果已指定参数，则立即开始加载操作
         */
        function URLLoader(request) {
            if (request === void 0) { request = null; }
            _super.call(this);
            /**
             * 控制是以文本 (URLLoaderDataFormat.TEXT)、原始二进制数据 (URLLoaderDataFormat.BINARY) 还是 URL 编码变量 (URLLoaderDataFormat.VARIABLES) 接收下载的数据。
             * 如果 dataFormat 属性的值是 URLLoaderDataFormat.TEXT，则所接收的数据是一个包含已加载文件文本的字符串。
             * 如果 dataFormat 属性的值是 URLLoaderDataFormat.BINARY，则所接收的数据是一个包含原始二进制数据的 ByteArray 对象。
             * 如果 dataFormat 属性的值是 URLLoaderDataFormat.TEXTURE，则所接收的数据是一个包含位图数据的Texture对象。
             * 如果 dataFormat 属性的值是 URLLoaderDataFormat.VARIABLES，则所接收的数据是一个包含 URL 编码变量的 URLVariables 对象。
             * 默认值:URLLoaderDataFormat.TEXT
             * @member {string} egret.URLLoader#dataFormat
             */
            this.dataFormat = egret.URLLoaderDataFormat.TEXT;
            this._status = -1;
            if (request) {
                this.load(request);
            }
        }
        /**
         * 从指定的 URL 发送和加载数据。可以以文本、原始二进制数据或 URL 编码变量格式接收数据，这取决于为 dataFormat 属性所设置的值。
         * 请注意 dataFormat 属性的默认值为文本。如果想将数据发送至指定的 URL，则可以在 URLRequest 对象中设置 data 属性。
         * @method egret.URLLoader#load
         * @param request {URLRequest}  一个 URLRequest 对象，指定要下载的 URL。
         */
        URLLoader.prototype.load = function (request) {
            this._request = request;
            this.data = null;
            egret.MainContext.instance.netContext.proceed(this);
        };
        return URLLoader;
    })(egret.EventDispatcher);
    egret.URLLoader = URLLoader;
    URLLoader.prototype.__class__ = "egret.URLLoader";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.Texture
     * @classdesc 纹理类是对不同平台不同的图片资源的封装
     * 在HTML5中，资源是一个HTMLElement对象
     * 在OpenGL / WebGL中，资源是一个提交GPU后获取的纹理id
     * Texture类封装了这些底层实现的细节，开发者只需要关心接口即可
     */
    var Texture = (function (_super) {
        __extends(Texture, _super);
        function Texture() {
            _super.call(this);
            /**
             * 表示这个纹理在bitmapData上的x起始位置
             */
            this._bitmapX = 0;
            /**
             * 表示这个纹理在bitmapData上的y起始位置
             */
            this._bitmapY = 0;
            /**
             * 表示这个纹理在bitmapData上的宽度
             */
            this._bitmapWidth = 0;
            /**
             * 表示这个纹理在bitmapData上的高度
             */
            this._bitmapHeight = 0;
            /**
             * 表示这个纹理显示了之后在x方向的渲染偏移量
             */
            this._offsetX = 0;
            /**
             * 表示这个纹理显示了之后在y方向的渲染偏移量
             */
            this._offsetY = 0;
            this._textureWidth = 0;
            this._textureHeight = 0;
        }
        Object.defineProperty(Texture.prototype, "textureWidth", {
            /**
             * 纹理宽度
             * @member {number} egret.Texture#textureWidth
             */
            get: function () {
                return this._textureWidth;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Texture.prototype, "textureHeight", {
            /**
             * 纹理高度
             * @member {number} egret.Texture#textureWidth
             */
            get: function () {
                return this._textureHeight;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Texture.prototype, "bitmapData", {
            /**
             * 纹理对象中得位图数据
             * @member {any} egret.Texture#bitmapData
             */
            get: function () {
                return this._bitmapData;
            },
            enumerable: true,
            configurable: true
        });
        Texture.prototype._setBitmapData = function (value) {
            var scale = egret.MainContext.instance.rendererContext.texture_scale_factor;
            this._bitmapData = value;
            this._sourceWidth = value.width;
            this._sourceHeight = value.height;
            this._textureWidth = this._sourceWidth * scale;
            this._textureHeight = this._sourceHeight * scale;
            this._bitmapWidth = this._textureWidth;
            this._bitmapHeight = this._textureHeight;
            this._offsetX = this._offsetY = this._bitmapX = this._bitmapY = 0;
        };
        /**
         * 获取某一点像素的颜色值
         * @method egret.Texture#getPixel32
         * @param x {number} 像素点的X轴坐标
         * @param y {number} 像素点的Y轴坐标
         * @returns {number} 指定像素点的颜色值
         */
        Texture.prototype.getPixel32 = function (x, y) {
            var result = this._bitmapData.getContext("2d").getImageData(x, y, 1, 1);
            return result.data;
        };
        return Texture;
    })(egret.HashObject);
    egret.Texture = Texture;
    Texture.prototype.__class__ = "egret.Texture";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.RenderTexture
     * @classdesc
     * RenderTexture 是动态纹理类，他实现了将显示对象及其子对象绘制成为一个纹理的功能
     * @extends egret.Texture
     */
    var RenderTexture = (function (_super) {
        __extends(RenderTexture, _super);
        function RenderTexture() {
            _super.call(this);
            this._bitmapData = document.createElement("canvas");
            this.renderContext = egret.RendererContext.createRendererContext(this._bitmapData);
        }
        /**
         * 将制定显示对象绘制为一个纹理
         * @method egret.RenderTexture#drawToTexture
         * @param displayObject {egret.DisplayObject}
         */
        RenderTexture.prototype.drawToTexture = function (displayObject) {
            var cacheCanvas = this._bitmapData;
            var bounds = displayObject.getBounds(egret.Rectangle.identity);
            if (bounds.width == 0 || bounds.height == 0) {
                egret.Logger.warning("egret.RenderTexture#drawToTexture:显示对象测量结果宽高为0，请检查");
                return false;
            }
            bounds.width = Math.floor(bounds.width);
            bounds.height = Math.floor(bounds.height);
            cacheCanvas.width = bounds.width;
            cacheCanvas.height = bounds.height;
            if (this.renderContext._cacheCanvas) {
                this.renderContext._cacheCanvas.width = bounds.width;
                this.renderContext._cacheCanvas.height = bounds.height;
            }
            RenderTexture.identityRectangle.width = bounds.width;
            RenderTexture.identityRectangle.height = bounds.height;
            displayObject._worldTransform.identity();
            displayObject.worldAlpha = 1;
            if (displayObject instanceof egret.DisplayObjectContainer) {
                var anchorOffsetX = displayObject._anchorOffsetX;
                var anchorOffsetY = displayObject._anchorOffsetY;
                if (displayObject._anchorX != 0 || displayObject._anchorY != 0) {
                    anchorOffsetX = displayObject._anchorX * bounds.width;
                    anchorOffsetY = displayObject._anchorY * bounds.height;
                }
                this._offsetX = bounds.x + anchorOffsetX;
                this._offsetY = bounds.y + anchorOffsetY;
                displayObject._worldTransform.append(1, 0, 0, 1, -this._offsetX, -this._offsetY);
                var list = displayObject._children;
                for (var i = 0, length = list.length; i < length; i++) {
                    var child = list[i];
                    child._updateTransform();
                }
            }
            var renderFilter = egret.RenderFilter.getInstance();
            var drawAreaList = renderFilter._drawAreaList.concat();
            renderFilter._drawAreaList.length = 0;
            this.renderContext.clearScreen();
            this.renderContext.onRenderStart();
            this.webGLTexture = null; //gl.deleteTexture(this.webGLTexture);
            var mask = displayObject.mask || displayObject._scrollRect;
            if (mask) {
                this.renderContext.pushMask(mask);
            }
            displayObject._render(this.renderContext);
            if (mask) {
                this.renderContext.popMask();
            }
            renderFilter.addDrawArea(RenderTexture.identityRectangle);
            this.renderContext.onRenderFinish();
            renderFilter._drawAreaList = drawAreaList;
            this._textureWidth = this._bitmapData.width;
            this._textureHeight = this._bitmapData.height;
            this._sourceWidth = this._textureWidth;
            this._sourceHeight = this._textureHeight;
            return true;
            //测试代码
            //            this.renderContext.canvasContext.setTransform(1, 0, 0, 1, 0, 0);
            //            this.renderContext.strokeRect(0, 0,cacheCanvas.width,cacheCanvas.height,"#ff0000");
            //            document.documentElement.appendChild(cacheCanvas);
        };
        RenderTexture.identityRectangle = new egret.Rectangle();
        return RenderTexture;
    })(egret.Texture);
    egret.RenderTexture = RenderTexture;
    RenderTexture.prototype.__class__ = "egret.RenderTexture";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.RendererContext
     * @classdesc
     * RenderContext是游戏的渲染上下文。
     * 这是一个抽象基类，制定主要的接口
     * @extends egret.HashObject
     * @private
     */
    var RendererContext = (function (_super) {
        __extends(RendererContext, _super);
        /**
         * @method egret.RendererContext#constructor
         */
        function RendererContext() {
            _super.call(this);
            /**
             * 渲染全部纹理的时间开销
             * @member egret.RendererContext#renderCost
             */
            this.renderCost = 0;
            /**
             * 绘制纹理的缩放比率，默认值为1
             * @member egret.RendererContext#texture_scale_factor
             */
            this.texture_scale_factor = 1;
            this.profiler = egret.Profiler.getInstance();
        }
        /**
         * @method egret.RendererContext#clearScreen
         * @private
         */
        RendererContext.prototype.clearScreen = function () {
        };
        /**
         * 清除Context的渲染区域
         * @method egret.RendererContext#clearRect
         * @param x {number}
         * @param y {number}
         * @param w {number}
         * @param h {numbe}
         */
        RendererContext.prototype.clearRect = function (x, y, w, h) {
        };
        /**
         * 绘制图片
         * @method egret.RendererContext#drawImage
         * @param texture {Texture}
         * @param sourceX {any}
         * @param sourceY {any}
         * @param sourceWidth {any}
         * @param sourceHeight {any}
         * @param destX {any}
         * @param destY {any}
         * @param destWidth {any}
         * @param destHeigh {any}
         */
        RendererContext.prototype.drawImage = function (texture, sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight, repeat) {
            if (repeat === void 0) { repeat = "no-repeat"; }
            this.profiler.onDrawImage();
        };
        /**
         * 变换Context的当前渲染矩阵
         * @method egret.RendererContext#setTransform
         * @param matrix {egret.Matri}
         */
        RendererContext.prototype.setTransform = function (matrix) {
        };
        /**
         * 设置渲染alpha
         * @method egret.RendererContext#setAlpha
         * @param value {number}
         * @param blendMode {egret.BlendMod}
         */
        RendererContext.prototype.setAlpha = function (value, blendMode) {
        };
        /**
         * 设置渲染文本参数
         * @method egret.RendererContext#setupFont
         * @param textField {TextField}
         */
        RendererContext.prototype.setupFont = function (textField, style) {
            if (style === void 0) { style = null; }
        };
        /**
         * 测量文本
         * @method egret.RendererContext#measureText
         * @param text {string}
         * @returns {number}
         * @stable B 参数很可能会需要调整，和setupFont整合
         */
        RendererContext.prototype.measureText = function (text) {
            return 0;
        };
        /**
         * 绘制文本
         * @method egret.RendererContext#drawText
         * @param textField {egret.TextField}
         * @param text {string}
         * @param x {number}
         * @param y {number}
         * @param maxWidth {numbe}
         */
        RendererContext.prototype.drawText = function (textField, text, x, y, maxWidth, style) {
            if (style === void 0) { style = null; }
            this.profiler.onDrawImage();
        };
        RendererContext.prototype.strokeRect = function (x, y, w, h, color) {
        };
        RendererContext.prototype.pushMask = function (mask) {
        };
        RendererContext.prototype.popMask = function () {
        };
        RendererContext.prototype.onRenderStart = function () {
        };
        RendererContext.prototype.onRenderFinish = function () {
        };
        RendererContext.prototype.setGlobalColorTransform = function (colorTransformMatrix) {
        };
        RendererContext.createRendererContext = function (canvas) {
            return null;
        };
        /**
         * 是否对图像使用平滑处理
         * 该特性目前只支持Canvas
         */
        RendererContext.imageSmoothingEnabled = true;
        return RendererContext;
    })(egret.HashObject);
    egret.RendererContext = RendererContext;
    RendererContext.prototype.__class__ = "egret.RendererContext";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    var InteractionMode = (function () {
        function InteractionMode() {
        }
        /**
         * 使用鼠标交互模式。
         */
        InteractionMode.MOUSE = "mouse";
        /**
         * 使用触摸交互模式。
         */
        InteractionMode.TOUCH = "touch";
        /**
         * 当前Egret使用的交互模式。
         */
        InteractionMode.mode = "touch";
        return InteractionMode;
    })();
    egret.InteractionMode = InteractionMode;
    InteractionMode.prototype.__class__ = "egret.InteractionMode";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     *
     * @class egret.TouchContext
     * @classdesc TouchContext是egret的触摸Context
     * @private
     */
    var TouchContext = (function (_super) {
        __extends(TouchContext, _super);
        function TouchContext() {
            _super.call(this);
            this._currentTouchTarget = {};
            this.maxTouches = 2;
            this.touchDownTarget = {};
            this.touchingIdentifiers = [];
            this.lastTouchX = -1;
            this.lastTouchY = -1;
        }
        /**
         * 启动触摸检测
         * @method egret.TouchContext#run
         */
        TouchContext.prototype.run = function () {
        };
        TouchContext.prototype.getTouchData = function (identifier, x, y) {
            var obj = this._currentTouchTarget[identifier];
            if (obj == null) {
                obj = {};
                this._currentTouchTarget[identifier] = obj;
            }
            obj.stageX = x;
            obj.stageY = y;
            obj.identifier = identifier;
            return obj;
        };
        TouchContext.prototype.dispatchEvent = function (type, data) {
            var touchDown = (this.touchDownTarget[data.identifier] == true);
            egret.TouchEvent.dispatchTouchEvent(data.target, type, data.identifier, data.stageX, data.stageY, false, false, false, touchDown);
        };
        TouchContext.prototype.onTouchBegan = function (x, y, identifier) {
            if (this.touchingIdentifiers.length == this.maxTouches) {
                return;
            }
            var stage = egret.MainContext.instance.stage;
            var result = stage.hitTest(x, y);
            if (result) {
                var obj = this.getTouchData(identifier, x, y);
                this.touchDownTarget[identifier] = true;
                obj.target = result;
                obj.beginTarget = result;
                this.dispatchEvent(egret.TouchEvent.TOUCH_BEGIN, obj);
            }
            this.touchingIdentifiers.push(identifier);
        };
        TouchContext.prototype.onTouchMove = function (x, y, identifier) {
            var index = this.touchingIdentifiers.indexOf(identifier);
            if (index == -1) {
                return;
            }
            if (x == this.lastTouchX && y == this.lastTouchY) {
                return;
            }
            this.lastTouchX = x;
            this.lastTouchY = y;
            var stage = egret.MainContext.instance.stage;
            var result = stage.hitTest(x, y);
            if (result) {
                var obj = this.getTouchData(identifier, x, y);
                obj.target = result;
                this.dispatchEvent(egret.TouchEvent.TOUCH_MOVE, obj);
            }
        };
        TouchContext.prototype.onTouchEnd = function (x, y, identifier) {
            var index = this.touchingIdentifiers.indexOf(identifier);
            if (index == -1) {
                return;
            }
            this.touchingIdentifiers.splice(index, 1);
            var stage = egret.MainContext.instance.stage;
            var result = stage.hitTest(x, y);
            if (result) {
                var obj = this.getTouchData(identifier, x, y);
                delete this.touchDownTarget[identifier];
                var oldTarget = obj.beginTarget;
                obj.target = result;
                this.dispatchEvent(egret.TouchEvent.TOUCH_END, obj);
                if (oldTarget == result) {
                    this.dispatchEvent(egret.TouchEvent.TOUCH_TAP, obj);
                }
                else if (obj.beginTarget) {
                    obj.target = obj.beginTarget;
                    this.dispatchEvent(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE, obj);
                }
                delete this._currentTouchTarget[obj.identifier];
            }
        };
        return TouchContext;
    })(egret.HashObject);
    egret.TouchContext = TouchContext;
    TouchContext.prototype.__class__ = "egret.TouchContext";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.NetContext
     * @classdesc
     * @extends egret.HashObject
     * @private
     */
    var NetContext = (function (_super) {
        __extends(NetContext, _super);
        function NetContext() {
            _super.call(this);
        }
        NetContext.prototype.proceed = function (loader) {
        };
        NetContext._getUrl = function (request) {
            var url = request.url;
            //get请求没有设置参数，而是设置URLVariables的情况
            if (url.indexOf("?") == -1 && request.method == egret.URLRequestMethod.GET && request.data && request.data instanceof egret.URLVariables) {
                url = url + "?" + request.data.toString();
            }
            return url;
        };
        NetContext.prototype.getChangeList = function () {
            return [];
        };
        return NetContext;
    })(egret.HashObject);
    egret.NetContext = NetContext;
    NetContext.prototype.__class__ = "egret.NetContext";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @classdesc
     * @extends egret.HashObject
     */
    var DeviceContext = (function (_super) {
        __extends(DeviceContext, _super);
        /**
         * @method egret.DeviceContext#constructor
         */
        function DeviceContext() {
            _super.call(this);
            /**
             * @member egret.DeviceContext#frameRate
             */
            this.frameRate = 60;
        }
        /**
         * @method egret.DeviceContext#executeMainLoop
         * @param callback {Function}
         * @param thisObject {any}
         */
        DeviceContext.prototype.executeMainLoop = function (callback, thisObject) {
        };
        return DeviceContext;
    })(egret.HashObject);
    egret.DeviceContext = DeviceContext;
    DeviceContext.prototype.__class__ = "egret.DeviceContext";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    var ExternalInterface = (function () {
        function ExternalInterface() {
        }
        /**
         * 将信息传递给 Egret 外层容器。
         * 如果该容器是 HTML 页，则此方法不可用。
         * 如果该容器是某个 App 容器，该容器将处理该事件。
         * @method egret.ExternalInterface#call
         * @param functionName {string}
         * @param value {string}
         */
        ExternalInterface.call = function (functionName, value) {
        };
        /**
         * 添加外层容器调用侦听，该容器将传递一个字符串给 Egret 容器
         * 如果该容器是 HTML 页，则此方法不可用。
         * @method egret.ExternalInterface#addCallBack
         * @param functionName {string}
         * @param listener {Function}
         */
        ExternalInterface.addCallback = function (functionName, listener) {
        };
        return ExternalInterface;
    })();
    egret.ExternalInterface = ExternalInterface;
    ExternalInterface.prototype.__class__ = "egret.ExternalInterface";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * 这个类是HTML5的WebWrapper的第一个版本
     */
    var Browser = (function (_super) {
        __extends(Browser, _super);
        function Browser() {
            _super.call(this);
            this.ua = navigator.userAgent.toLowerCase();
            this.trans = this._getTrans();
        }
        Browser.getInstance = function () {
            if (Browser.instance == null) {
                Browser.instance = new Browser();
            }
            return Browser.instance;
        };
        Object.defineProperty(Browser.prototype, "isMobile", {
            /**
             * @deprecated
             * @returns {boolean}
             */
            get: function () {
                egret.Logger.warning("Browser.isMobile接口参数已经变更，请尽快调整用法为 egret.MainContext.deviceType == egret.MainContext.DEVICE_MOBILE ");
                return egret.MainContext.deviceType == egret.MainContext.DEVICE_MOBILE;
            },
            enumerable: true,
            configurable: true
        });
        Browser.prototype._getHeader = function (tempStyle) {
            if ("transform" in tempStyle) {
                return "";
            }
            var transArr = ["webkit", "ms", "Moz", "O"];
            for (var i = 0; i < transArr.length; i++) {
                var transform = transArr[i] + 'Transform';
                if (transform in tempStyle)
                    return transArr[i];
            }
            return "";
        };
        Browser.prototype._getTrans = function () {
            var tempStyle = document.createElement('div').style;
            var _header = this._getHeader(tempStyle);
            var type = "transform";
            if (_header == "") {
                return type;
            }
            return _header + type.charAt(0).toUpperCase() + type.substr(1);
        };
        Browser.prototype.$new = function (x) {
            return this.$(document.createElement(x));
        };
        Browser.prototype.$ = function (x) {
            var parent = document;
            var el = (x instanceof HTMLElement) ? x : parent.querySelector(x);
            if (el) {
                el.find = el.find || this.$;
                el.hasClass = el.hasClass || function (cls) {
                    return this.className.match(new RegExp('(\\s|^)' + cls + '(\\s|$)'));
                };
                el.addClass = el.addClass || function (cls) {
                    if (!this.hasClass(cls)) {
                        if (this.className) {
                            this.className += " ";
                        }
                        this.className += cls;
                    }
                    return this;
                };
                el.removeClass = el.removeClass || function (cls) {
                    if (this.hasClass(cls)) {
                        this.className = this.className.replace(cls, '');
                    }
                    return this;
                };
                el.remove = el.remove || function () {
                    //                    if (this.parentNode)
                    //                        this.parentNode.removeChild(this);
                    //                        return this;
                };
                el.appendTo = el.appendTo || function (x) {
                    x.appendChild(this);
                    return this;
                };
                el.prependTo = el.prependTo || function (x) {
                    (x.childNodes[0]) ? x.insertBefore(this, x.childNodes[0]) : x.appendChild(this);
                    return this;
                };
                el.transforms = el.transforms || function () {
                    this.style[Browser.getInstance().trans] = Browser.getInstance().translate(this.position) + Browser.getInstance().rotate(this.rotation) + Browser.getInstance().scale(this.scale) + Browser.getInstance().skew(this.skew);
                    return this;
                };
                el.position = el.position || { x: 0, y: 0 };
                el.rotation = el.rotation || 0;
                el.scale = el.scale || { x: 1, y: 1 };
                el.skew = el.skew || { x: 0, y: 0 };
                el.translates = function (x, y) {
                    this.position.x = x;
                    this.position.y = y - egret.MainContext.instance.stage.stageHeight;
                    this.transforms();
                    return this;
                };
                el.rotate = function (x) {
                    this.rotation = x;
                    this.transforms();
                    return this;
                };
                el.resize = function (x, y) {
                    this.scale.x = x;
                    this.scale.y = y;
                    this.transforms();
                    return this;
                };
                el.setSkew = function (x, y) {
                    this.skew.x = x;
                    this.skew.y = y;
                    this.transforms();
                    return this;
                };
            }
            return el;
        };
        Browser.prototype.translate = function (a) {
            return "translate(" + a.x + "px, " + a.y + "px) ";
        };
        Browser.prototype.rotate = function (a) {
            return "rotate(" + a + "deg) ";
        };
        Browser.prototype.scale = function (a) {
            return "scale(" + a.x + ", " + a.y + ") ";
        };
        Browser.prototype.skew = function (a) {
            return "skewX(" + -a.x + "deg) skewY(" + a.y + "deg)";
        };
        return Browser;
    })(egret.HashObject);
    egret.Browser = Browser;
    Browser.prototype.__class__ = "egret.Browser";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    var localStorage;
    (function (localStorage) {
        /**
         * 读取数据
         * @method egret.localStorage.getItem
         * @param key {string} 要读取的键名称
         */
        function getItem(key) {
            return null;
        }
        localStorage.getItem = getItem;
        /**
         * 保存数据
         * @method egret.localStorage.setItem
         * @param key {string} 要保存的键名称
         * @param value {string} 要保存的值
         * @returns {boolean} 数据保存是否成功
         */
        function setItem(key, value) {
            return false;
        }
        localStorage.setItem = setItem;
        /**
         * 删除数据
         * @method egret.localStorage.removeItem
         * @param key {string} 要删除的键名称
         */
        function removeItem(key) {
        }
        localStorage.removeItem = removeItem;
        /**
         * 将所有数据清空
         * @method egret.localStorage.clear
         */
        function clear() {
        }
        localStorage.clear = clear;
    })(localStorage = egret.localStorage || (egret.localStorage = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    /**
     * @class egret.XML
     * @classdesc
     * XML文件解析工具，它将XML文件解析为标准的JSON对象返回。
     * 用法类似JSON.parse(),传入一个XML字符串给XML.parse()，将能得到一个标准JSON对象。
     * 示例：<root value="abc">
     *          <item value="item0"/>
     *          <item value="item1"/>
     *       </root>
     * 将解析为:
     * {"name":"root","$value":"abc","children":[{"name":"item","$value":"item0"},{"name":"item","$value":"item0"}]};
     * 其中XML上的属性节点都使用$+"属性名"的方式表示,子节点都存放在children属性的列表里，name表示节点名称。
     */
    var XML = (function () {
        function XML() {
        }
        /**
         * 解析一个XML字符串为JSON对象。
         * @method egret.XML.parse
         * @param value {string} 要解析的XML字符串。
         * @returns {any}
         */
        XML.parse = function (value) {
            var xmlDoc = egret.SAXParser.getInstance().parserXML(value);
            if (!xmlDoc || !xmlDoc.childNodes) {
                return null;
            }
            var length = xmlDoc.childNodes.length;
            var found = false;
            for (var i = 0; i < length; i++) {
                var node = xmlDoc.childNodes[i];
                if (node.nodeType == 1) {
                    found = true;
                    break;
                }
            }
            if (!found) {
                return null;
            }
            var xml = XML.parseNode(node);
            return xml;
        };
        XML.parseNode = function (node) {
            if (!node || node.nodeType != 1) {
                return null;
            }
            var xml = {};
            xml.localName = node.localName;
            xml.name = node.nodeName;
            if (node.namespaceURI)
                xml.namespace = node.namespaceURI;
            if (node.prefix)
                xml.prefix = node.prefix;
            var attributes = node.attributes;
            var length = attributes.length;
            for (var i = 0; i < length; i++) {
                var attrib = attributes[i];
                var key = attrib.name;
                if (key.indexOf("xmlns:") == 0) {
                    continue;
                }
                xml["$" + key] = attrib.value;
            }
            var children = node.childNodes;
            length = children.length;
            for (i = 0; i < length; i++) {
                var childNode = children[i];
                var childXML = XML.parseNode(childNode);
                if (childXML) {
                    if (!xml.children) {
                        xml.children = [];
                    }
                    childXML.parent = xml;
                    xml.children.push(childXML);
                }
            }
            if (!xml.children) {
                var text = node.textContent.trim();
                if (text) {
                    xml.text = text;
                }
            }
            return xml;
        };
        /**
         * 查找xml上符合节点路径的所有子节点。
         * @method egret.XML.findChildren
         * @param xml {any} 要查找的XML节点。
         * @param path {string} 子节点路径，例如"item.node"
         * @param result {egret.Array<any>} 可选参数，传入一个数组用于存储查找的结果。这样做能避免重复创建对象。
         * @returns {any}
         */
        XML.findChildren = function (xml, path, result) {
            if (!result) {
                result = [];
            }
            else {
                result.length = 0;
            }
            XML.findByPath(xml, path, result);
            return result;
        };
        /**
         * @method egret.XML.findByPath
         * @param xml {any}
         * @param path {string}
         * @param result {egret.Array<any>}
         */
        XML.findByPath = function (xml, path, result) {
            var index = path.indexOf(".");
            var key;
            var end;
            if (index == -1) {
                key = path;
                end = true;
            }
            else {
                key = path.substring(0, index);
                path = path.substring(index + 1);
                end = false;
            }
            var children = xml.children;
            if (!children) {
                return;
            }
            var length = children.length;
            for (var i = 0; i < length; i++) {
                var child = children[i];
                if (child.localName == key) {
                    if (end) {
                        result.push(child);
                    }
                    else {
                        XML.findByPath(child, path, result);
                    }
                }
            }
        };
        /**
         * 获取一个XML节点上的所有属性名列表
         * @method egret.XML.getAttributes
         * @param xml {any} 要查找的XML节点。
         * @param result {egret.Array<any>} 可选参数，传入一个数组用于存储查找的结果。这样做能避免重复创建对象。
         * @returns {string}
         */
        XML.getAttributes = function (xml, result) {
            if (!result) {
                result = [];
            }
            else {
                result.length = 0;
            }
            for (var key in xml) {
                if (key.charAt(0) == "$") {
                    result.push(key.substring(1));
                }
            }
            return result;
        };
        return XML;
    })();
    egret.XML = XML;
    XML.prototype.__class__ = "egret.XML";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    /**
     * Endian 类中包含一些值，它们表示用于表示多字节数字的字节顺序。
     * 字节顺序为 bigEndian（最高有效字节位于最前）或 littleEndian（最低有效字节位于最前）。
     * @class egret.Endian
     * @classdesc
     */
    var Endian = (function () {
        function Endian() {
        }
        /**
         * 表示多字节数字的最低有效字节位于字节序列的最前面。
         * 十六进制数字 0x12345678 包含 4 个字节（每个字节包含 2 个十六进制数字）。最高有效字节为 0x12。最低有效字节为 0x78。（对于等效的十进制数字 305419896，最高有效数字是 3，最低有效数字是 6）。
         * @constant {string} egret.Endian.LITTLE_ENDIAN
         */
        Endian.LITTLE_ENDIAN = "LITTLE_ENDIAN";
        /**
         * 表示多字节数字的最高有效字节位于字节序列的最前面。
         * 十六进制数字 0x12345678 包含 4 个字节（每个字节包含 2 个十六进制数字）。最高有效字节为 0x12。最低有效字节为 0x78。（对于等效的十进制数字 305419896，最高有效数字是 3，最低有效数字是 6）。
         * @constant {string} egret.Endian.BIG_ENDIAN
         */
        Endian.BIG_ENDIAN = "BIG_ENDIAN";
        return Endian;
    })();
    egret.Endian = Endian;
    Endian.prototype.__class__ = "egret.Endian";
    /**
     * @class egret.ByteArray
     * @classdesc
     * ByteArray 类提供用于优化读取、写入以及处理二进制数据的方法和属性。
     * 注意：ByteArray 类适用于需要在字节层访问数据的高级开发人员。
     * 内存中的数据是一个压缩字节数组（数据类型的最紧凑表示形式），但可以使用标准数组访问运算符来操作 ByteArray 类的实例。
     */
    var ByteArray = (function () {
        function ByteArray() {
            /**
             * 将文件指针的当前位置（以字节为单位）移动或返回到 ByteArray 对象中。
             * 下一次调用读取方法时将在此位置开始读取，或者下一次调用写入方法时将在此位置开始写入。
             * @member {number} egret.ByteArray#position
             */
            this.position = 0;
            /**
             * ByteArray 对象的长度（以字节为单位）。
             * 如果将长度设置为大于当前长度的值，则用零填充字节数组的右侧；如果将长度设置为小于当前长度的值，将会截断该字节数组。
             * @member {number} egret.ByteArray#length
             */
            this.length = 0;
            this._mode = "";
            this.maxlength = 0;
            this._endian = Endian.LITTLE_ENDIAN;
            this.isLittleEndian = false;
            this._mode = "Typed array";
            this.maxlength = 4;
            this.arraybytes = new ArrayBuffer(this.maxlength);
            this.unalignedarraybytestemp = new ArrayBuffer(16);
            this.endian = ByteArray.DEFAULT_ENDIAN;
        }
        Object.defineProperty(ByteArray.prototype, "endian", {
            /**
             * 更改或读取数据的字节顺序。
             * 请使用egret.Endian.BIG_ENDIAN 或 egret.Endian.LITTLE_ENDIAN表示。
             * @member {string} egret.ByteArray#endian
             */
            get: function () {
                return this._endian;
            },
            set: function (value) {
                this._endian = value;
                this.isLittleEndian = value == Endian.LITTLE_ENDIAN;
            },
            enumerable: true,
            configurable: true
        });
        /**
         * @param n {number}
         */
        ByteArray.prototype.ensureWriteableSpace = function (n) {
            this.ensureSpace(n + this.position);
        };
        /**
         * @param aBuffer {egret.ArrayBuffer}
         */
        ByteArray.prototype.setArrayBuffer = function (aBuffer) {
            this.ensureSpace(aBuffer.byteLength);
            this.length = aBuffer.byteLength;
            var inInt8AView = new Int8Array(aBuffer);
            var localInt8View = new Int8Array(this.arraybytes, 0, this.length);
            localInt8View.set(inInt8AView);
            this.position = 0;
        };
        Object.defineProperty(ByteArray.prototype, "bytesAvailable", {
            /**
             * 可从字节数组的当前位置到数组末尾读取的数据的字节数。【只读】
             * 每次访问 ByteArray 对象时，将 bytesAvailable 属性与读取方法结合使用，以确保读取有效的数据。
             * @method egret.ByteArray#getBytesAvailable
             * @returns {number}
             */
            get: function () {
                return (this.length) - (this.position);
            },
            enumerable: true,
            configurable: true
        });
        /**
         * @method egret.ByteArray#ensureSpace
         * @param n {number}
         */
        ByteArray.prototype.ensureSpace = function (n) {
            if (n > this.maxlength) {
                var newmaxlength = (n + 255) & (~255);
                var newarraybuffer = new ArrayBuffer(newmaxlength);
                var view = new Uint8Array(this.arraybytes, 0, this.length);
                var newview = new Uint8Array(newarraybuffer, 0, this.length);
                newview.set(view); // memcpy
                this.arraybytes = newarraybuffer;
                this.maxlength = newmaxlength;
            }
        };
        /**
         * 在字节流中写入一个字节。
         * 使用参数的低 8 位。忽略高 24 位。
         * @method egret.ByteArray#writeByte
         * @param b {number}  一个 32 位整数。低 8 位将被写入字节流。
         */
        ByteArray.prototype.writeByte = function (b) {
            this.ensureWriteableSpace(1);
            var view = new Int8Array(this.arraybytes);
            view[this.position++] = (~~b); // ~~ is cast to int in js...
            if (this.position > this.length) {
                this.length = this.position;
            }
        };
        /**
         * 从字节流中读取带符号的字节。
         * 返回值的范围是从 -128 到 127。
         * @method egret.ByteArray#readByte
         * @returns {number} 介于 -128 和 127 之间的整数。
         */
        ByteArray.prototype.readByte = function () {
            if (this.position >= this.length) {
                throw "ByteArray out of bounds read. Positon=" + this.position + ", Length=" + this.length;
            }
            var view = new Int8Array(this.arraybytes);
            return view[this.position++];
        };
        /**
         * 从字节流中读取 length 参数指定的数据字节数。从 offset 指定的位置开始，将字节读入 bytes 参数指定的 ByteArray 对象中，并将字节写入目标 ByteArray 中。
         * @method egret.ByteArray#readBytes
         * @param bytes {egret.ByteArray} 要将数据读入的 ByteArray 对象。
         * @param offset {number} bytes 中的偏移（位置），应从该位置写入读取的数据。
         * @param length {number} 要读取的字节数。默认值 0 导致读取所有可用的数据。

         */
        ByteArray.prototype.readBytes = function (bytes, offset, length) {
            if (offset === void 0) { offset = 0; }
            if (length === void 0) { length = 0; }
            if (length == null) {
                length = bytes.length;
            }
            bytes.ensureWriteableSpace(offset + length);
            var byteView = new Int8Array(bytes.arraybytes);
            var localByteView = new Int8Array(this.arraybytes);
            byteView.set(localByteView.subarray(this.position, this.position + length), offset);
            this.position += length;
            if (length + offset > bytes.length) {
                bytes.length += (length + offset) - bytes.length;
            }
        };
        /**
         * 在字节流中写入一个无符号的字节。
         * @method egret.ByteArray#writeUnsignedByte
         * @param b {number} 介于 0 到 255 之间的无符号字节。
         */
        ByteArray.prototype.writeUnsignedByte = function (b) {
            this.ensureWriteableSpace(1);
            var view = new Uint8Array(this.arraybytes);
            view[this.position++] = (~~b) & 0xff; // ~~ is cast to int in js...
            if (this.position > this.length) {
                this.length = this.position;
            }
        };
        /**
         * 从字节流中读取无符号的字节。
         * 返回值的范围是从 0 到 255。
         * @method egret.ByteArray#readUnsignedByte
         * @returns {number} 介于 0 到 255 之间的无符号字节。
         */
        ByteArray.prototype.readUnsignedByte = function () {
            if (this.position >= this.length) {
                throw "ByteArray out of bounds read. Positon=" + this.position + ", Length=" + this.length;
            }
            var view = new Uint8Array(this.arraybytes);
            return view[this.position++];
        };
        /**
         *在字节流中写入一个无符号的 16 位整数。
         * @method egret.ByteArray#writeUnsignedShort
         * @param b {number}  介于 0 到 65535 之间的无符号整数。
         */
        ByteArray.prototype.writeUnsignedShort = function (b) {
            this.ensureWriteableSpace(2);
            if ((this.position & 1) == 0) {
                var view = new Uint16Array(this.arraybytes);
                view[this.position >> 1] = (~~b) & 0xffff; // ~~ is cast to int in js...
            }
            else {
                var view = new Uint16Array(this.unalignedarraybytestemp, 0, 1);
                view[0] = (~~b) & 0xffff;
                var view2 = new Uint8Array(this.arraybytes, this.position, 2);
                var view3 = new Uint8Array(this.unalignedarraybytestemp, 0, 2);
                view2.set(view3);
            }
            this.position += 2;
            if (this.position > this.length) {
                this.length = this.position;
            }
        };
        /**
         * 从字节流中读取一个由 length 参数指定的 UTF-8 字节序列，并返回一个字符串。
         * @method egret.ByteArray#readUTFBytes
         * @param len {number} 指明 UTF-8 字节长度的无符号短整型数。
         * @returns {string} 由指定长度的 UTF-8 字节组成的字符串。
         */
        ByteArray.prototype.readUTFBytes = function (len) {
            var value = "";
            var max = this.position + len;
            var data = new DataView(this.arraybytes);
            while (this.position < max) {
                var c = data.getUint8(this.position++);
                if (c < 0x80) {
                    if (c == 0)
                        break;
                    value += String.fromCharCode(c);
                }
                else if (c < 0xE0) {
                    value += String.fromCharCode(((c & 0x3F) << 6) | (data.getUint8(this.position++) & 0x7F));
                }
                else if (c < 0xF0) {
                    var c2 = data.getUint8(this.position++);
                    value += String.fromCharCode(((c & 0x1F) << 12) | ((c2 & 0x7F) << 6) | (data.getUint8(this.position++) & 0x7F));
                }
                else {
                    var c2 = data.getUint8(this.position++);
                    var c3 = data.getUint8(this.position++);
                    value += String.fromCharCode(((c & 0x0F) << 18) | ((c2 & 0x7F) << 12) | ((c3 << 6) & 0x7F) | (data.getUint8(this.position++) & 0x7F));
                }
            }
            return value;
        };
        /**
         * 从字节流中读取一个带符号的 32 位整数。
         * 返回值的范围是从 -2147483648 到 2147483647。
         * @method egret.ByteArray#readInt
         * @returns {number} 介于 -2147483648 到 2147483647 之间的整数。
         */
        ByteArray.prototype.readInt = function () {
            var data = new DataView(this.arraybytes);
            var intNumber = data.getInt32(this.position, this.isLittleEndian);
            this.position += 4;
            return intNumber;
        };
        /**
         * 从字节流中读取一个带符号的 16 位整数。
         * 返回值的范围是从 -32768 到 32767。
         * @method egret.ByteArray#readShort
         * @returns {number} 介于 -32768 到 32767 之间的整数。
         */
        ByteArray.prototype.readShort = function () {
            var data = new DataView(this.arraybytes);
            var shortNumber = data.getInt16(this.position, this.isLittleEndian);
            this.position += 2;
            return shortNumber;
        };
        /**
         * 从字节流中读取一个 IEEE 754 双精度（64 位）浮点数。
         * @method egret.ByteArray#readDouble
         * @returns {number} 返回双精度（64 位）浮点数。
         */
        ByteArray.prototype.readDouble = function () {
            var data = new DataView(this.arraybytes);
            var doubleNumber = data.getFloat64(this.position, this.isLittleEndian);
            this.position += 8;
            return doubleNumber;
        };
        /**
         * 从字节流中读取一个无符号的 16 位整数。
         * 返回值的范围是从 0 到 65535。
         * @method egret.ByteArray#readUnsignedShort
         * @returns {number} 介于 0 到 65535 之间的无符号整数。
         */
        ByteArray.prototype.readUnsignedShort = function () {
            if (this.position > this.length + 2) {
                throw "ByteArray out of bounds read. Position=" + this.position + ", Length=" + this.length;
            }
            if ((this.position & 1) == 0) {
                var view = new Uint16Array(this.arraybytes);
                var pa = this.position >> 1;
                this.position += 2;
                return view[pa];
            }
            else {
                var view = new Uint16Array(this.unalignedarraybytestemp, 0, 1);
                var view2 = new Uint8Array(this.arraybytes, this.position, 2);
                var view3 = new Uint8Array(this.unalignedarraybytestemp, 0, 2);
                view3.set(view2);
                this.position += 2;
                return view[0];
            }
        };
        /**
         * 在字节流中写入一个无符号的 32 位整数。
         * @method egret.ByteArray#writeUnsignedInt
         * @param b {number} 介于 0 和 4294967295 之间的无符号整数。
         */
        ByteArray.prototype.writeUnsignedInt = function (b) {
            this.ensureWriteableSpace(4);
            if ((this.position & 3) == 0) {
                var view = new Uint32Array(this.arraybytes);
                view[this.position >> 2] = (~~b) & 0xffffffff; // ~~ is cast to int in js...
            }
            else {
                var view = new Uint32Array(this.unalignedarraybytestemp, 0, 1);
                view[0] = (~~b) & 0xffffffff;
                var view2 = new Uint8Array(this.arraybytes, this.position, 4);
                var view3 = new Uint8Array(this.unalignedarraybytestemp, 0, 4);
                view2.set(view3);
            }
            this.position += 4;
            if (this.position > this.length) {
                this.length = this.position;
            }
        };
        /**
         * 从字节流中读取一个无符号的 32 位整数。
         * 返回值的范围是从 0 到 4294967295。
         * @method egret.ByteArray#readUnsignedInt
         *  @returns {number} 介于 0 和 4294967295 之间的 32 位无符号整数。
         */
        ByteArray.prototype.readUnsignedInt = function () {
            if (this.position > this.length + 4) {
                throw "ByteArray out of bounds read. Position=" + this.position + ", Length=" + this.length;
            }
            if ((this.position & 3) == 0) {
                var view = new Uint32Array(this.arraybytes);
                var pa = this.position >> 2;
                this.position += 4;
                return view[pa];
            }
            else {
                var view = new Uint32Array(this.unalignedarraybytestemp, 0, 1);
                var view2 = new Uint8Array(this.arraybytes, this.position, 4);
                var view3 = new Uint8Array(this.unalignedarraybytestemp, 0, 4);
                view3.set(view2);
                this.position += 4;
                return view[0];
            }
        };
        /**
         * 在字节流中写入一个 IEEE 754 单精度（32 位）浮点数。
         * @method egret.ByteArray#writeFloat
         * @param b {number} 单精度（32 位）浮点数。
         */
        ByteArray.prototype.writeFloat = function (b) {
            this.ensureWriteableSpace(4);
            if ((this.position & 3) == 0) {
                var view = new Float32Array(this.arraybytes);
                view[this.position >> 2] = b;
            }
            else {
                var view = new Float32Array(this.unalignedarraybytestemp, 0, 1);
                view[0] = b;
                var view2 = new Uint8Array(this.arraybytes, this.position, 4);
                var view3 = new Uint8Array(this.unalignedarraybytestemp, 0, 4);
                view2.set(view3);
            }
            this.position += 4;
            if (this.position > this.length) {
                this.length = this.position;
            }
        };
        /**
         * 从字节流中读取一个 IEEE 754 单精度（32 位）浮点数。
         * @method egret.ByteArray#readFloat
         * @returns {number} 单精度（32 位）浮点数。
         */
        ByteArray.prototype.readFloat = function () {
            if (this.position > this.length + 4) {
                throw "ByteArray out of bounds read. Positon=" + this.position + ", Length=" + this.length;
            }
            if ((this.position & 3) == 0) {
                var view = new Float32Array(this.arraybytes);
                var pa = this.position >> 2;
                this.position += 4;
                return view[pa];
            }
            else {
                var view = new Float32Array(this.unalignedarraybytestemp, 0, 1);
                var view2 = new Uint8Array(this.arraybytes, this.position, 4);
                var view3 = new Uint8Array(this.unalignedarraybytestemp, 0, 4);
                view3.set(view2);
                this.position += 4;
                return view[0];
            }
        };
        /**
         * 默认表示多字节数字的字节顺序的常量
         * @constant {string} egret.ByteArray.DEFAULT_ENDIAN
         */
        ByteArray.DEFAULT_ENDIAN = Endian.BIG_ENDIAN;
        return ByteArray;
    })();
    egret.ByteArray = ByteArray;
    ByteArray.prototype.__class__ = "egret.ByteArray";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.Tween
     * @classdesc
     * Tween是Egret的动画缓动类
     * @extends egret.EventDispatcher
     */
    var Tween = (function (_super) {
        __extends(Tween, _super);
        function Tween(target, props, pluginData) {
            _super.call(this);
            this._target = null;
            this._useTicks = false;
            this.ignoreGlobalPause = false;
            this.loop = false;
            this.pluginData = null;
            this._steps = null;
            this._actions = null;
            this.paused = false;
            this.duration = 0;
            this._prevPos = -1;
            this.position = null;
            this._prevPosition = 0;
            this._stepPosition = 0;
            this.passive = false;
            this.initialize(target, props, pluginData);
        }
        /**
         * 激活一个显示对象，对其添加 Tween 动画
         * @method egret.Tween.get
         * @param target {egret.DisplayObject} 要激活的显示对象
         */
        Tween.get = function (target, props, pluginData, override) {
            if (props === void 0) { props = null; }
            if (pluginData === void 0) { pluginData = null; }
            if (override === void 0) { override = false; }
            if (override) {
                Tween.removeTweens(target);
            }
            return new Tween(target, props, pluginData);
        };
        /**
         * 删除一个显示对象上的全部 Tween 动画
         * @method egret.Tween.removeTweens
         * @param target {egret.DisplayObject}
         */
        Tween.removeTweens = function (target) {
            if (!target.tween_count) {
                return;
            }
            var tweens = Tween._tweens;
            for (var i = tweens.length - 1; i >= 0; i--) {
                if (tweens[i]._target == target) {
                    tweens[i].paused = true;
                    tweens.splice(i, 1);
                }
            }
            target.tween_count = 0;
        };
        /**
         * 暂停某个元件的所有缓动
         * @param target
         */
        Tween.pauseTweens = function (target) {
            if (!target.tween_count) {
                return;
            }
            var tweens = egret.Tween._tweens;
            for (var i = tweens.length - 1; i >= 0; i--) {
                if (tweens[i]._target == target) {
                    tweens[i].paused = true;
                }
            }
        };
        /**
         * 继续播放某个元件的所有缓动
         * @param target
         */
        Tween.resumeTweens = function (target) {
            if (!target.tween_count) {
                return;
            }
            var tweens = egret.Tween._tweens;
            for (var i = tweens.length - 1; i >= 0; i--) {
                if (tweens[i]._target == target) {
                    tweens[i].paused = false;
                }
            }
        };
        Tween.tick = function (delta, paused) {
            if (paused === void 0) { paused = false; }
            var tweens = Tween._tweens.concat();
            for (var i = tweens.length - 1; i >= 0; i--) {
                var tween = tweens[i];
                if ((paused && !tween.ignoreGlobalPause) || tween.paused) {
                    continue;
                }
                tween.tick(tween._useTicks ? 1 : delta);
            }
        };
        Tween._register = function (tween, value) {
            var target = tween._target;
            var tweens = Tween._tweens;
            if (value) {
                if (target) {
                    target.tween_count = target.tween_count ? target.tween_count + 1 : 1;
                }
                tweens.push(tween);
                if (!Tween._inited) {
                    egret.Ticker.getInstance().register(Tween.tick, null);
                    Tween._inited = true;
                }
            }
            else {
                if (target) {
                    target.tween_count--;
                }
                var i = tweens.length;
                while (i--) {
                    if (tweens[i] == tween) {
                        tweens.splice(i, 1);
                        return;
                    }
                }
            }
        };
        /**
         * @method egret.Tween.removeAllTweens
         */
        Tween.removeAllTweens = function () {
            var tweens = Tween._tweens;
            for (var i = 0, l = tweens.length; i < l; i++) {
                var tween = tweens[i];
                tween.paused = true;
                tween._target.tweenjs_count = 0;
            }
            tweens.length = 0;
        };
        Tween.prototype.initialize = function (target, props, pluginData) {
            this._target = target;
            if (props) {
                this._useTicks = props.useTicks;
                this.ignoreGlobalPause = props.ignoreGlobalPause;
                this.loop = props.loop;
                props.onChange && this.addEventListener("change", props.onChange, props.onChangeObj);
                if (props.override) {
                    Tween.removeTweens(target);
                }
            }
            this.pluginData = pluginData || {};
            this._curQueueProps = {};
            this._initQueueProps = {};
            this._steps = [];
            this._actions = [];
            if (props && props.paused) {
                this.paused = true;
            }
            else {
                Tween._register(this, true);
            }
            if (props && props.position != null) {
                this.setPosition(props.position, Tween.NONE);
            }
        };
        Tween.prototype.setPosition = function (value, actionsMode) {
            if (actionsMode === void 0) { actionsMode = 1; }
            if (value < 0) {
                value = 0;
            }
            //正常化位置
            var t = value;
            var end = false;
            if (t >= this.duration) {
                if (this.loop) {
                    t = t % this.duration;
                }
                else {
                    t = this.duration;
                    end = true;
                }
            }
            if (t == this._prevPos) {
                return end;
            }
            var prevPos = this._prevPos;
            this.position = this._prevPos = t;
            this._prevPosition = value;
            if (this._target) {
                if (end) {
                    //结束
                    this._updateTargetProps(null, 1);
                }
                else if (this._steps.length > 0) {
                    for (var i = 0, l = this._steps.length; i < l; i++) {
                        if (this._steps[i].t > t) {
                            break;
                        }
                    }
                    var step = this._steps[i - 1];
                    this._updateTargetProps(step, (this._stepPosition = t - step.t) / step.d);
                }
            }
            //执行actions
            if (actionsMode != 0 && this._actions.length > 0) {
                if (this._useTicks) {
                    this._runActions(t, t);
                }
                else if (actionsMode == 1 && t < prevPos) {
                    if (prevPos != this.duration) {
                        this._runActions(prevPos, this.duration);
                    }
                    this._runActions(0, t, true);
                }
                else {
                    this._runActions(prevPos, t);
                }
            }
            if (end) {
                this.setPaused(true);
            }
            this.dispatchEventWith("change");
            return end;
        };
        Tween.prototype._runActions = function (startPos, endPos, includeStart) {
            if (includeStart === void 0) { includeStart = false; }
            var sPos = startPos;
            var ePos = endPos;
            var i = -1;
            var j = this._actions.length;
            var k = 1;
            if (startPos > endPos) {
                //把所有的倒置
                sPos = endPos;
                ePos = startPos;
                i = j;
                j = k = -1;
            }
            while ((i += k) != j) {
                var action = this._actions[i];
                var pos = action.t;
                if (pos == ePos || (pos > sPos && pos < ePos) || (includeStart && pos == startPos)) {
                    action.f.apply(action.o, action.p);
                }
            }
        };
        Tween.prototype._updateTargetProps = function (step, ratio) {
            var p0, p1, v, v0, v1, arr;
            if (!step && ratio == 1) {
                this.passive = false;
                p0 = p1 = this._curQueueProps;
            }
            else {
                this.passive = !!step.v;
                //不更新props.
                if (this.passive) {
                    return;
                }
                //使用ease
                if (step.e) {
                    ratio = step.e(ratio, 0, 1, 1);
                }
                p0 = step.p0;
                p1 = step.p1;
            }
            for (var n in this._initQueueProps) {
                if ((v0 = p0[n]) == null) {
                    p0[n] = v0 = this._initQueueProps[n];
                }
                if ((v1 = p1[n]) == null) {
                    p1[n] = v1 = v0;
                }
                if (v0 == v1 || ratio == 0 || ratio == 1 || (typeof (v0) != "number")) {
                    v = ratio == 1 ? v1 : v0;
                }
                else {
                    v = v0 + (v1 - v0) * ratio;
                }
                var ignore = false;
                if (arr = Tween._plugins[n]) {
                    for (var i = 0, l = arr.length; i < l; i++) {
                        var v2 = arr[i].tween(this, n, v, p0, p1, ratio, !!step && p0 == p1, !step);
                        if (v2 == Tween.IGNORE) {
                            ignore = true;
                        }
                        else {
                            v = v2;
                        }
                    }
                }
                if (!ignore) {
                    this._target[n] = v;
                }
            }
        };
        /**
         * @method egret.Tween#setPaused
         * @param value {boolean}
         * @returns {egret.Tween}
         */
        Tween.prototype.setPaused = function (value) {
            this.paused = value;
            Tween._register(this, !value);
            return this;
        };
        Tween.prototype._cloneProps = function (props) {
            var o = {};
            for (var n in props) {
                o[n] = props[n];
            }
            return o;
        };
        Tween.prototype._addStep = function (o) {
            if (o.d > 0) {
                this._steps.push(o);
                o.t = this.duration;
                this.duration += o.d;
            }
            return this;
        };
        Tween.prototype._appendQueueProps = function (o) {
            var arr, oldValue, i, l, injectProps;
            for (var n in o) {
                if (this._initQueueProps[n] === undefined) {
                    oldValue = this._target[n];
                    //设置plugins
                    if (arr = Tween._plugins[n]) {
                        for (i = 0, l = arr.length; i < l; i++) {
                            oldValue = arr[i].init(this, n, oldValue);
                        }
                    }
                    this._initQueueProps[n] = this._curQueueProps[n] = (oldValue === undefined) ? null : oldValue;
                }
                else {
                    oldValue = this._curQueueProps[n];
                }
            }
            for (var n in o) {
                oldValue = this._curQueueProps[n];
                if (arr = Tween._plugins[n]) {
                    injectProps = injectProps || {};
                    for (i = 0, l = arr.length; i < l; i++) {
                        if (arr[i].step) {
                            arr[i].step(this, n, oldValue, o[n], injectProps);
                        }
                    }
                }
                this._curQueueProps[n] = o[n];
            }
            if (injectProps) {
                this._appendQueueProps(injectProps);
            }
            return this._curQueueProps;
        };
        Tween.prototype._addAction = function (o) {
            o.t = this.duration;
            this._actions.push(o);
            return this;
        };
        Tween.prototype._set = function (props, o) {
            for (var n in props) {
                o[n] = props[n];
            }
        };
        /**
         * 等待指定毫秒后执行下一个动画
         * @method egret.Tween#wait
         * @param duration {number} 要等待的时间，以毫秒为单位
         * @param passive {boolean}
         * @returns {egret.Tween}
         */
        Tween.prototype.wait = function (duration, passive) {
            if (duration == null || duration <= 0) {
                return this;
            }
            var o = this._cloneProps(this._curQueueProps);
            return this._addStep({ d: duration, p0: o, p1: o, v: passive });
        };
        /**
         * 将指定显示对象的属性修改为指定值
         * @method egret.Tween#to
         * @param props {Object} 对象的属性集合
         * @param duration {number} 持续时间
         * @param ease {egret.Ease} 缓动算法
         * @returns {egret.Tween}
         */
        Tween.prototype.to = function (props, duration, ease) {
            if (ease === void 0) { ease = undefined; }
            if (isNaN(duration) || duration < 0) {
                duration = 0;
            }
            return this._addStep({ d: duration || 0, p0: this._cloneProps(this._curQueueProps), e: ease, p1: this._cloneProps(this._appendQueueProps(props)) });
        };
        /**
         * 执行回调函数
         * @method egret.Tween#call
         * @param callback {Function}
         * @param thisObj {Object}
         * @param params {Object}
         * @returns {egret.Tween}
         */
        Tween.prototype.call = function (callback, thisObj, params) {
            if (thisObj === void 0) { thisObj = undefined; }
            if (params === void 0) { params = undefined; }
            return this._addAction({ f: callback, p: params ? params : [], o: thisObj ? thisObj : this._target });
        };
        Tween.prototype.set = function (props, target) {
            if (target === void 0) { target = null; }
            return this._addAction({ f: this._set, o: this, p: [props, target ? target : this._target] });
        };
        /**
         * @method egret.Tween#play
         * @param tween {egret.Tween}
         * @returns {egret.Tween}
         */
        Tween.prototype.play = function (tween) {
            if (!tween) {
                tween = this;
            }
            return this.call(tween.setPaused, tween, [false]);
        };
        /**
         * @method egret.Tween#pause
         * @param tween {egret.Tween}
         * @returns {egret.Tween}
         */
        Tween.prototype.pause = function (tween) {
            if (!tween) {
                tween = this;
            }
            return this.call(tween.setPaused, tween, [true]);
        };
        /**
         * @method egret.Tween#tick
         * @param delta {number}
         */
        Tween.prototype.tick = function (delta) {
            if (this.paused) {
                return;
            }
            this.setPosition(this._prevPosition + delta);
        };
        /**
         * 不做特殊处理
         * @constant {number} egret.Tween.NONE
         */
        Tween.NONE = 0;
        /**
         * 循环
         * @constant {number} egret.Tween.LOOP
         */
        Tween.LOOP = 1;
        /**
         * 倒序
         * @constant {number} egret.Tween.REVERSE
         */
        Tween.REVERSE = 2;
        Tween._tweens = [];
        Tween.IGNORE = {};
        Tween._plugins = {};
        Tween._inited = false;
        return Tween;
    })(egret.EventDispatcher);
    egret.Tween = Tween;
    Tween.prototype.__class__ = "egret.Tween";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    var Ease = (function () {
        function Ease() {
            egret.Logger.fatal("Ease不能被实例化");
        }
        Ease.get = function (amount) {
            if (amount < -1) {
                amount = -1;
            }
            if (amount > 1) {
                amount = 1;
            }
            return function (t) {
                if (amount == 0) {
                    return t;
                }
                if (amount < 0) {
                    return t * (t * -amount + 1 + amount);
                }
                return t * ((2 - t) * amount + (1 - amount));
            };
        };
        Ease.getPowIn = function (pow) {
            return function (t) {
                return Math.pow(t, pow);
            };
        };
        Ease.getPowOut = function (pow) {
            return function (t) {
                return 1 - Math.pow(1 - t, pow);
            };
        };
        Ease.getPowInOut = function (pow) {
            return function (t) {
                if ((t *= 2) < 1)
                    return 0.5 * Math.pow(t, pow);
                return 1 - 0.5 * Math.abs(Math.pow(2 - t, pow));
            };
        };
        Ease.sineIn = function (t) {
            return 1 - Math.cos(t * Math.PI / 2);
        };
        Ease.sineOut = function (t) {
            return Math.sin(t * Math.PI / 2);
        };
        Ease.sineInOut = function (t) {
            return -0.5 * (Math.cos(Math.PI * t) - 1);
        };
        Ease.getBackIn = function (amount) {
            return function (t) {
                return t * t * ((amount + 1) * t - amount);
            };
        };
        Ease.getBackOut = function (amount) {
            return function (t) {
                return (--t * t * ((amount + 1) * t + amount) + 1);
            };
        };
        Ease.getBackInOut = function (amount) {
            amount *= 1.525;
            return function (t) {
                if ((t *= 2) < 1)
                    return 0.5 * (t * t * ((amount + 1) * t - amount));
                return 0.5 * ((t -= 2) * t * ((amount + 1) * t + amount) + 2);
            };
        };
        Ease.circIn = function (t) {
            return -(Math.sqrt(1 - t * t) - 1);
        };
        Ease.circOut = function (t) {
            return Math.sqrt(1 - (--t) * t);
        };
        Ease.circInOut = function (t) {
            if ((t *= 2) < 1) {
                return -0.5 * (Math.sqrt(1 - t * t) - 1);
            }
            return 0.5 * (Math.sqrt(1 - (t -= 2) * t) + 1);
        };
        Ease.bounceIn = function (t) {
            return 1 - Ease.bounceOut(1 - t);
        };
        Ease.bounceOut = function (t) {
            if (t < 1 / 2.75) {
                return (7.5625 * t * t);
            }
            else if (t < 2 / 2.75) {
                return (7.5625 * (t -= 1.5 / 2.75) * t + 0.75);
            }
            else if (t < 2.5 / 2.75) {
                return (7.5625 * (t -= 2.25 / 2.75) * t + 0.9375);
            }
            else {
                return (7.5625 * (t -= 2.625 / 2.75) * t + 0.984375);
            }
        };
        Ease.bounceInOut = function (t) {
            if (t < 0.5)
                return Ease.bounceIn(t * 2) * .5;
            return Ease.bounceOut(t * 2 - 1) * 0.5 + 0.5;
        };
        Ease.getElasticIn = function (amplitude, period) {
            var pi2 = Math.PI * 2;
            return function (t) {
                if (t == 0 || t == 1)
                    return t;
                var s = period / pi2 * Math.asin(1 / amplitude);
                return -(amplitude * Math.pow(2, 10 * (t -= 1)) * Math.sin((t - s) * pi2 / period));
            };
        };
        Ease.getElasticOut = function (amplitude, period) {
            var pi2 = Math.PI * 2;
            return function (t) {
                if (t == 0 || t == 1)
                    return t;
                var s = period / pi2 * Math.asin(1 / amplitude);
                return (amplitude * Math.pow(2, -10 * t) * Math.sin((t - s) * pi2 / period) + 1);
            };
        };
        Ease.getElasticInOut = function (amplitude, period) {
            var pi2 = Math.PI * 2;
            return function (t) {
                var s = period / pi2 * Math.asin(1 / amplitude);
                if ((t *= 2) < 1)
                    return -0.5 * (amplitude * Math.pow(2, 10 * (t -= 1)) * Math.sin((t - s) * pi2 / period));
                return amplitude * Math.pow(2, -10 * (t -= 1)) * Math.sin((t - s) * pi2 / period) * 0.5 + 1;
            };
        };
        Ease.quadIn = Ease.getPowIn(2);
        Ease.quadOut = Ease.getPowOut(2);
        Ease.quadInOut = Ease.getPowInOut(2);
        Ease.cubicIn = Ease.getPowIn(3);
        Ease.cubicOut = Ease.getPowOut(3);
        Ease.cubicInOut = Ease.getPowInOut(3);
        Ease.quartIn = Ease.getPowIn(4);
        Ease.quartOut = Ease.getPowOut(4);
        Ease.quartInOut = Ease.getPowInOut(4);
        Ease.quintIn = Ease.getPowIn(5);
        Ease.quintOut = Ease.getPowOut(5);
        Ease.quintInOut = Ease.getPowInOut(5);
        Ease.backIn = Ease.getBackIn(1.7);
        Ease.backOut = Ease.getBackOut(1.7);
        Ease.backInOut = Ease.getBackInOut(1.7);
        Ease.elasticIn = Ease.getElasticIn(1, 0.3);
        Ease.elasticOut = Ease.getElasticOut(1, 0.3);
        Ease.elasticInOut = Ease.getElasticInOut(1, 0.3 * 1.5);
        return Ease;
    })();
    egret.Ease = Ease;
    Ease.prototype.__class__ = "egret.Ease";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    /**
     * @class egret.Sound
     * @classdesc Sound 类允许您在应用程序中使用声音。
     */
    var Sound = (function () {
        function Sound() {
            this.type = Sound.EFFECT;
        }
        /**
         * 播放声音
         * @method egret.Sound#play
         * @param loop {boolean} 是否循环播放，默认为false
         */
        Sound.prototype.play = function (loop) {
            if (loop === void 0) { loop = false; }
            var sound = this.audio;
            if (!sound) {
                return;
            }
            if (!isNaN(sound.duration)) {
                sound.currentTime = 0;
            }
            sound.loop = loop;
            sound.play();
        };
        /**
         * 暂停声音
         * @method egret.Sound#pause
         */
        Sound.prototype.pause = function () {
            var sound = this.audio;
            if (!sound) {
                return;
            }
            sound.pause();
        };
        /**
         * 重新加载声音
         * @method egret.Sound#load
         */
        Sound.prototype.load = function () {
            var sound = this.audio;
            if (!sound) {
                return;
            }
            sound.load();
        };
        /**
         * 添加事件监听
         * @param type 事件类型
         * @param listener 监听函数
         */
        Sound.prototype.addEventListener = function (type, listener) {
            var sound = this.audio;
            if (!sound) {
                return;
            }
            this.audio.addEventListener(type, listener, false);
        };
        /**
         * 移除事件监听
         * @param type 事件类型
         * @param listener 监听函数
         */
        Sound.prototype.removeEventListener = function (type, listener) {
            var sound = this.audio;
            if (!sound) {
                return;
            }
            this.audio.removeEventListener(type, listener, false);
        };
        /**
         * 设置音量
         * @param value 值需大于0 小于等于 1
         */
        Sound.prototype.setVolume = function (value) {
            var sound = this.audio;
            if (!sound) {
                return;
            }
            sound.volume = value;
        };
        /**
         * 获取当前音量值
         * @returns number
         */
        Sound.prototype.getVolume = function () {
            return this.audio ? this.audio.volume : 0;
        };
        Sound.prototype.preload = function (type) {
            this.type = type;
        };
        Sound.prototype._setAudio = function (value) {
            this.audio = value;
        };
        Sound.MUSIC = "music";
        Sound.EFFECT = "effect";
        return Sound;
    })();
    egret.Sound = Sound;
    Sound.prototype.__class__ = "egret.Sound";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    var NumberUtils = (function () {
        function NumberUtils() {
        }
        NumberUtils.isNumber = function (value) {
            return typeof (value) === "number" && !isNaN(value);
        };
        NumberUtils.sin = function (value) {
            value = Math.round(value);
            value = value % 360;
            if (value < 0) {
                value += 360;
            }
            if (value < 90) {
                return egret_sin_map[value];
            }
            if (value < 180) {
                return egret_cos_map[value - 90];
            }
            if (value < 270) {
                return -egret_sin_map[value - 180];
            }
            return -egret_cos_map[value - 270];
        };
        NumberUtils.cos = function (value) {
            value = Math.round(value);
            value = value % 360;
            if (value < 0) {
                value += 360;
            }
            if (value < 90) {
                return egret_cos_map[value];
            }
            if (value < 180) {
                return -egret_sin_map[value - 90];
            }
            if (value < 270) {
                return -egret_cos_map[value - 180];
            }
            return egret_sin_map[value - 270];
        };
        return NumberUtils;
    })();
    egret.NumberUtils = NumberUtils;
    NumberUtils.prototype.__class__ = "egret.NumberUtils";
})(egret || (egret = {}));
var egret_sin_map = {};
var egret_cos_map = {};
for (var i = 0; i <= 90; i++) {
    egret_sin_map[i] = Math.sin(i * egret.Matrix.DEG_TO_RAD);
    egret_cos_map[i] = Math.cos(i * egret.Matrix.DEG_TO_RAD);
}
//对未提供bind的浏览器实现bind机制
if (!Function.prototype.bind) {
    Function.prototype.bind = function (oThis) {
        if (typeof this !== "function") {
            throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");
        }
        var aArgs = Array.prototype.slice.call(arguments, 1), fToBind = this, fNOP = function () {
        }, fBound = function () {
            return fToBind.apply(this instanceof fNOP && oThis ? this : oThis, aArgs.concat(Array.prototype.slice.call(arguments)));
        };
        fNOP.prototype = this.prototype;
        fBound.prototype = new fNOP();
        return fBound;
    };
}
/**
 * Copyright (c) Egret-Labs.org. Permission is hereby granted, free of charge,
 * to any person obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish, distribute,
 * sublicense, and/or sell copies of the Software, and to permit persons to whom
 * the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included
 * in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
 * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
 * PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE
 * FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
 * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var RES;
(function (RES) {
    /**
     * @class RES.ResourceEvent
     * @classdesc
     * @extends egret.Event
     */
    var ResourceEvent = (function (_super) {
        __extends(ResourceEvent, _super);
        /**
         * 构造函数
         * @method RES.ResourceEvent#constructor
         * @param type {string}
         * @param bubbles {boolean}
         * @param cancelable {boolean}
         */
        function ResourceEvent(type, bubbles, cancelable) {
            if (bubbles === void 0) { bubbles = false; }
            if (cancelable === void 0) { cancelable = false; }
            _super.call(this, type, bubbles, cancelable);
            /**
             * 已经加载的文件数
             * @member {number} RES.ResourceEvent#itemsLoaded
             */
            this.itemsLoaded = 0;
            /**
             * 要加载的总文件数
             * @member {number} RES.ResourceEvent#itemsTotal
             */
            this.itemsTotal = 0;
        }
        /**
         * 使用指定的EventDispatcher对象来抛出事件对象。抛出的对象将会缓存在对象池上，供下次循环复用。
         * @method RES.ResourceEvent.dispatchResourceEvent
         * @param target {egret.IEventDispatcher}
         * @param type {string}
         * @param groupName {string}
         * @param resItem {egret.ResourceItem}
         * @param itemsLoaded {number}
         * @param itemsTotal {number}
         */
        ResourceEvent.dispatchResourceEvent = function (target, type, groupName, resItem, itemsLoaded, itemsTotal) {
            if (groupName === void 0) { groupName = ""; }
            if (resItem === void 0) { resItem = null; }
            if (itemsLoaded === void 0) { itemsLoaded = 0; }
            if (itemsTotal === void 0) { itemsTotal = 0; }
            var eventClass = ResourceEvent;
            var props = egret.Event._getPropertyData(eventClass);
            props.groupName = groupName;
            props.resItem = resItem;
            props.itemsLoaded = itemsLoaded;
            props.itemsTotal = itemsTotal;
            egret.Event._dispatchByTarget(eventClass, target, type, props);
        };
        /**
         * 一个加载项加载失败事件。
         * @constant {string} RES.ResourceEvent.ITEM_LOAD_ERROR
         */
        ResourceEvent.ITEM_LOAD_ERROR = "itemLoadError";
        /**
         * 配置文件加载并解析完成事件。注意：若有配置文件加载失败，将不会抛出此事件，若要处理配置加载失败，请同时监听CONFIG_LOAD_ERROR事件。
         * @constant {string} RES.ResourceEvent.CONFIG_COMPLETE
         */
        ResourceEvent.CONFIG_COMPLETE = "configComplete";
        /**
         * 配置文件加载失败事件
         * @constant {string} RES.ResourceEvent.CONFIG_COMPLETE
         */
        ResourceEvent.CONFIG_LOAD_ERROR = "configLoadError";
        /**
         * 延迟加载组资源加载进度事件
         * @constant {string} RES.ResourceEvent.GROUP_PROGRESS
         */
        ResourceEvent.GROUP_PROGRESS = "groupProgress";
        /**
         * 延迟加载组资源加载完成事件。注意：若组内有资源项加载失败，将不会抛出此事件，若要处理组加载失败，请同时监听GROUP_LOAD_ERROR事件。
         * @constant {string} RES.ResourceEvent.GROUP_COMPLETE
         */
        ResourceEvent.GROUP_COMPLETE = "groupComplete";
        /**
         * 延迟加载组资源加载失败事件
         * @constant {string} RES.ResourceEvent.GROUP_LOAD_ERROR
         */
        ResourceEvent.GROUP_LOAD_ERROR = "groupLoadError";
        return ResourceEvent;
    })(egret.Event);
    RES.ResourceEvent = ResourceEvent;
    ResourceEvent.prototype.__class__ = "RES.ResourceEvent";
})(RES || (RES = {}));
/**
 * Copyright (c) Egret-Labs.org. Permission is hereby granted, free of charge,
 * to any person obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish, distribute,
 * sublicense, and/or sell copies of the Software, and to permit persons to whom
 * the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included
 * in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
 * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
 * PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE
 * FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
 * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
var RES;
(function (RES) {
    /**
     * @class RES.ResourceItem
     * @classdesc
     */
    var ResourceItem = (function () {
        /**
         * 构造函数
         * @method RES.ResourceItem#constructor
         * @param name {string} 加载项名称
         * @param url {string} 要加载的文件地址
         * @param type {string} 加载项文件类型
         */
        function ResourceItem(name, url, type) {
            this._loaded = false;
            this.name = name;
            this.url = url;
            this.type = type;
        }
        Object.defineProperty(ResourceItem.prototype, "loaded", {
            /**
             * 加载完成的标志
             * @member {boolean} RES.ResourceItem#loaded
             */
            get: function () {
                return this.data ? this.data.loaded : this._loaded;
            },
            set: function (value) {
                if (this.data)
                    this.data.loaded = value;
                this._loaded = value;
            },
            enumerable: true,
            configurable: true
        });
        /**
         * @method RES.ResourceItem#toString
         * @returns {string}
         */
        ResourceItem.prototype.toString = function () {
            return "[ResourceItem name=\"" + this.name + "\" url=\"" + this.url + "\" type=\"" + this.type + "\"]";
        };
        /**
         * XML文件
         * @constant {string} RES.ResourceItem.TYPE_XML
         */
        ResourceItem.TYPE_XML = "xml";
        /**
         * 图片文件
         * @constant {string} RES.ResourceItem.TYPE_IMAGE
         */
        ResourceItem.TYPE_IMAGE = "image";
        /**
         * 二进制流文件
         * @constant {string} RES.ResourceItem.TYPE_BIN
         */
        ResourceItem.TYPE_BIN = "bin";
        /**
         * 文本文件(解析为字符串)
         * @constant {string} RES.ResourceItem.TYPE_TEXT
         */
        ResourceItem.TYPE_TEXT = "text";
        /**
         * JSON文件
         * @constant {string} RES.ResourceItem.TYPE_JSON
         */
        ResourceItem.TYPE_JSON = "json";
        /**
         * SpriteSheet文件
         * @constant {string} RES.ResourceItem.TYPE_SHEET
         */
        ResourceItem.TYPE_SHEET = "sheet";
        /**
         * BitmapTextSpriteSheet文件
         * @constant {string} RES.ResourceItem.TYPE_FONT
         */
        ResourceItem.TYPE_FONT = "font";
        /**
         * 声音文件
         * @constant {string} RES.ResourceItem.TYPE_SOUND
         */
        ResourceItem.TYPE_SOUND = "sound";
        return ResourceItem;
    })();
    RES.ResourceItem = ResourceItem;
    ResourceItem.prototype.__class__ = "RES.ResourceItem";
})(RES || (RES = {}));
/**
 * Copyright (c) Egret-Labs.org. Permission is hereby granted, free of charge,
 * to any person obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish, distribute,
 * sublicense, and/or sell copies of the Software, and to permit persons to whom
 * the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included
 * in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
 * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
 * PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE
 * FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
 * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
var RES;
(function (RES) {
    /**
     * @class RES.ResourceConfig
     * @classdesc
     */
    var ResourceConfig = (function () {
        function ResourceConfig() {
            /**
             * 一级键名字典
             */
            this.keyMap = {};
            /**
             * 加载组字典
             */
            this.groupDic = {};
            RES["configInstance"] = this;
        }
        /**
         * 根据组名获取组加载项列表
         * @method RES.ResourceConfig#getGroupByName
         * @param name {string} 组名
         * @returns {Array<egret.ResourceItem>}
         */
        ResourceConfig.prototype.getGroupByName = function (name) {
            var group = new Array();
            if (!this.groupDic[name])
                return group;
            var list = this.groupDic[name];
            var length = list.length;
            for (var i = 0; i < length; i++) {
                var obj = list[i];
                group.push(this.parseResourceItem(obj));
            }
            return group;
        };
        /**
         * 根据组名获取原始的组加载项列表
         * @method RES.ResourceConfig#getRawGroupByName
         * @param name {string} 组名
         * @returns {Array<any>}
         */
        ResourceConfig.prototype.getRawGroupByName = function (name) {
            if (this.groupDic[name])
                return this.groupDic[name];
            return [];
        };
        /**
         * 创建自定义的加载资源组,注意：此方法仅在资源配置文件加载完成后执行才有效。
         * 可以监听ResourceEvent.CONFIG_COMPLETE事件来确认配置加载完成。
         * @method RES.ResourceConfig#createGroup
         * @param name {string} 要创建的加载资源组的组名
         * @param keys {egret.Array<string>} 要包含的键名列表，key对应配置文件里的name属性或sbuKeys属性的一项或一个资源组名。
         * @param override {boolean} 是否覆盖已经存在的同名资源组,默认false。
         * @returns {boolean}
         */
        ResourceConfig.prototype.createGroup = function (name, keys, override) {
            if (override === void 0) { override = false; }
            if ((!override && this.groupDic[name]) || !keys || keys.length == 0)
                return false;
            var groupDic = this.groupDic;
            var group = [];
            var length = keys.length;
            for (var i = 0; i < length; i++) {
                var key = keys[i];
                var g = groupDic[key];
                if (g) {
                    var len = g.length;
                    for (var j = 0; j < len; j++) {
                        var item = g[j];
                        if (group.indexOf(item) == -1)
                            group.push(item);
                    }
                }
                else {
                    item = this.keyMap[key];
                    if (item && group.indexOf(item) == -1)
                        group.push(item);
                }
            }
            if (group.length == 0)
                return false;
            this.groupDic[name] = group;
            return true;
        };
        /**
         * 解析一个配置文件
         * @method RES.ResourceConfig#parseConfig
         * @param data {any} 配置文件数据
         * @param folder {string} 加载项的路径前缀。
         */
        ResourceConfig.prototype.parseConfig = function (data, folder) {
            if (!data)
                return;
            var resources = data["resources"];
            if (resources) {
                var length = resources.length;
                for (var i = 0; i < length; i++) {
                    var item = resources[i];
                    var url = item.url;
                    if (url && url.indexOf("://") == -1)
                        item.url = folder + url;
                    this.addItemToKeyMap(item);
                }
            }
            var groups = data["groups"];
            if (groups) {
                length = groups.length;
                for (i = 0; i < length; i++) {
                    var group = groups[i];
                    var list = [];
                    var keys = group.keys.split(",");
                    var l = keys.length;
                    for (var j = 0; j < l; j++) {
                        var name = keys[j].trim();
                        item = this.keyMap[name];
                        if (item && list.indexOf(item) == -1) {
                            list.push(item);
                        }
                    }
                    this.groupDic[group.name] = list;
                }
            }
        };
        /**
         * 添加一个二级键名到配置列表。
         * @method RES.ResourceConfig#addSubkey
         * @param subkey {string} 要添加的二级键名
         * @param name {string} 二级键名所属的资源name属性
         */
        ResourceConfig.prototype.addSubkey = function (subkey, name) {
            var item = this.keyMap[name];
            if (item && !this.keyMap[subkey]) {
                this.keyMap[subkey] = item;
            }
        };
        /**
         * 添加一个加载项数据到列表
         */
        ResourceConfig.prototype.addItemToKeyMap = function (item) {
            if (!this.keyMap[item.name])
                this.keyMap[item.name] = item;
            if (item.hasOwnProperty("subkeys")) {
                var subkeys = (item.subkeys).split(",");
                item.subkeys = subkeys;
                var length = subkeys.length;
                for (var i = 0; i < length; i++) {
                    var key = subkeys[i];
                    if (this.keyMap[key] != null)
                        continue;
                    this.keyMap[key] = item;
                }
            }
        };
        /**
         * 获取加载项的name属性
         * @method RES.ResourceConfig#getType
         * @param key {string} 对应配置文件里的name属性或sbuKeys属性的一项。
         * @returns {string}
         */
        ResourceConfig.prototype.getName = function (key) {
            var data = this.keyMap[key];
            return data ? data.name : "";
        };
        /**
         * 获取加载项类型。
         * @method RES.ResourceConfig#getType
         * @param key {string} 对应配置文件里的name属性或sbuKeys属性的一项。
         * @returns {string}
         */
        ResourceConfig.prototype.getType = function (key) {
            var data = this.keyMap[key];
            return data ? data.type : "";
        };
        ResourceConfig.prototype.getRawResourceItem = function (key) {
            return this.keyMap[key];
        };
        /**
         * 获取加载项信息对象
         * @method RES.ResourceConfig#getResourceItem
         * @param key {string} 对应配置文件里的key属性或sbuKeys属性的一项。
         * @returns {egret.ResourceItem}
         */
        ResourceConfig.prototype.getResourceItem = function (key) {
            var data = this.keyMap[key];
            if (data)
                return this.parseResourceItem(data);
            return null;
        };
        /**
         * 转换Object数据为ResourceItem对象
         */
        ResourceConfig.prototype.parseResourceItem = function (data) {
            var resItem = new RES.ResourceItem(data.name, data.url, data.type);
            resItem.data = data;
            return resItem;
        };
        return ResourceConfig;
    })();
    RES.ResourceConfig = ResourceConfig;
    ResourceConfig.prototype.__class__ = "RES.ResourceConfig";
})(RES || (RES = {}));
/**
 * Copyright (c) Egret-Labs.org. Permission is hereby granted, free of charge,
 * to any person obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish, distribute,
 * sublicense, and/or sell copies of the Software, and to permit persons to whom
 * the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included
 * in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
 * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
 * PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE
 * FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
 * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var RES;
(function (RES) {
    /**
     * @class RES.ResourceLoader
     * @classdesc
     * @extends egret.EventDispatcher
     */
    var ResourceLoader = (function (_super) {
        __extends(ResourceLoader, _super);
        /**
         * 构造函数
         * @method RES.ResourceLoader#constructor
         */
        function ResourceLoader() {
            _super.call(this);
            /**
             * 最大并发加载数
             */
            this.thread = 2;
            /**
             * 正在加载的线程计数
             */
            this.loadingCount = 0;
            /**
             * 当前组加载的项总个数,key为groupName
             */
            this.groupTotalDic = {};
            /**
             * 已经加载的项个数,key为groupName
             */
            this.numLoadedDic = {};
            /**
             * 正在加载的组列表,key为groupName
             */
            this.itemListDic = {};
            /**
             * 加载失败的组,key为groupName
             */
            this.groupErrorDic = {};
            this.retryTimesDic = {};
            this.maxRetryTimes = 3;
            this.failedList = new Array();
            /**
             * 优先级队列,key为priority，value为groupName列表
             */
            this.priorityQueue = {};
            /**
             * 延迟加载队列
             */
            this.lazyLoadList = new Array();
            /**
             * 资源解析库字典类
             */
            this.analyzerDic = {};
            /**
             * 当前应该加载同优先级队列的第几列
             */
            this.queueIndex = 0;
        }
        /**
         * 检查指定的组是否正在加载中
         * @method RES.ResourceLoader#isGroupInLoading
         * @param groupName {string}
         * @returns {boolean}
         */
        ResourceLoader.prototype.isGroupInLoading = function (groupName) {
            return this.itemListDic[groupName] !== undefined;
        };
        /**
         * 开始加载一组文件
         * @method RES.ResourceLoader#loadGroup
         * @param list {egret.Array<ResourceItem>} 加载项列表
         * @param groupName {string} 组名
         * @param priority {number} 加载优先级
         */
        ResourceLoader.prototype.loadGroup = function (list, groupName, priority) {
            if (priority === void 0) { priority = 0; }
            if (this.itemListDic[groupName] || !groupName)
                return;
            if (!list || list.length == 0) {
                egret.Logger.warning("RES加载了不存在或空的资源组：\"" + groupName + "\"");
                var event = new RES.ResourceEvent(RES.ResourceEvent.GROUP_LOAD_ERROR);
                event.groupName = groupName;
                this.dispatchEvent(event);
                return;
            }
            if (this.priorityQueue[priority])
                this.priorityQueue[priority].push(groupName);
            else
                this.priorityQueue[priority] = [groupName];
            this.itemListDic[groupName] = list;
            var length = list.length;
            for (var i = 0; i < length; i++) {
                var resItem = list[i];
                resItem.groupName = groupName;
            }
            this.groupTotalDic[groupName] = list.length;
            this.numLoadedDic[groupName] = 0;
            this.next();
        };
        /**
         * 加载一个文件
         * @method RES.ResourceLoader#loadItem
         * @param resItem {egret.ResourceItem} 要加载的项
         */
        ResourceLoader.prototype.loadItem = function (resItem) {
            this.lazyLoadList.push(resItem);
            resItem.groupName = "";
            this.next();
        };
        /**
         * 加载下一项
         */
        ResourceLoader.prototype.next = function () {
            while (this.loadingCount < this.thread) {
                var resItem = this.getOneResourceItem();
                if (!resItem)
                    break;
                this.loadingCount++;
                if (resItem.loaded) {
                    this.onItemComplete(resItem);
                }
                else {
                    var analyzer = this.analyzerDic[resItem.type];
                    if (!analyzer) {
                        analyzer = this.analyzerDic[resItem.type] = egret.Injector.getInstance(RES.AnalyzerBase, resItem.type);
                    }
                    analyzer.loadFile(resItem, this.onItemComplete, this);
                }
            }
        };
        /**
         * 获取下一个待加载项
         */
        ResourceLoader.prototype.getOneResourceItem = function () {
            if (this.failedList.length > 0)
                return this.failedList.shift();
            var maxPriority = Number.NEGATIVE_INFINITY;
            for (var p in this.priorityQueue) {
                maxPriority = Math.max(maxPriority, p);
            }
            var queue = this.priorityQueue[maxPriority];
            if (!queue || queue.length == 0) {
                if (this.lazyLoadList.length == 0)
                    return null;
                //后请求的先加载，以便更快获取当前需要的资源
                return this.lazyLoadList.pop();
            }
            var length = queue.length;
            var list;
            for (var i = 0; i < length; i++) {
                if (this.queueIndex >= length)
                    this.queueIndex = 0;
                list = this.itemListDic[queue[this.queueIndex]];
                if (list.length > 0)
                    break;
                this.queueIndex++;
            }
            if (list.length == 0)
                return null;
            return list.shift();
        };
        /**
         * 加载结束
         */
        ResourceLoader.prototype.onItemComplete = function (resItem) {
            this.loadingCount--;
            var groupName = resItem.groupName;
            if (!resItem.loaded) {
                var times = this.retryTimesDic[resItem.name] || 1;
                if (times > this.maxRetryTimes) {
                    delete this.retryTimesDic[resItem.name];
                    RES.ResourceEvent.dispatchResourceEvent(this.resInstance, RES.ResourceEvent.ITEM_LOAD_ERROR, groupName, resItem);
                }
                else {
                    this.retryTimesDic[resItem.name] = times + 1;
                    this.failedList.push(resItem);
                    this.next();
                    return;
                }
            }
            if (groupName) {
                this.numLoadedDic[groupName]++;
                var itemsLoaded = this.numLoadedDic[groupName];
                var itemsTotal = this.groupTotalDic[groupName];
                if (!resItem.loaded) {
                    this.groupErrorDic[groupName] = true;
                }
                RES.ResourceEvent.dispatchResourceEvent(this.resInstance, RES.ResourceEvent.GROUP_PROGRESS, groupName, resItem, itemsLoaded, itemsTotal);
                if (itemsLoaded == itemsTotal) {
                    var groupError = this.groupErrorDic[groupName];
                    this.removeGroupName(groupName);
                    delete this.groupTotalDic[groupName];
                    delete this.numLoadedDic[groupName];
                    delete this.itemListDic[groupName];
                    delete this.groupErrorDic[groupName];
                    if (groupError) {
                        RES.ResourceEvent.dispatchResourceEvent(this, RES.ResourceEvent.GROUP_LOAD_ERROR, groupName);
                    }
                    else {
                        RES.ResourceEvent.dispatchResourceEvent(this, RES.ResourceEvent.GROUP_COMPLETE, groupName);
                    }
                }
            }
            else {
                this.callBack.call(this.resInstance, resItem);
            }
            this.next();
        };
        /**
         * 从优先级队列中移除指定的组名
         */
        ResourceLoader.prototype.removeGroupName = function (groupName) {
            for (var p in this.priorityQueue) {
                var queue = this.priorityQueue[p];
                var length = queue.length;
                var index = 0;
                var found = false;
                var length = queue.length;
                for (var i = 0; i < length; i++) {
                    var name = queue[i];
                    if (name == groupName) {
                        queue.splice(index, 1);
                        found = true;
                        break;
                    }
                    index++;
                }
                if (found) {
                    if (queue.length == 0) {
                        delete this.priorityQueue[p];
                    }
                    break;
                }
            }
        };
        return ResourceLoader;
    })(egret.EventDispatcher);
    RES.ResourceLoader = ResourceLoader;
    ResourceLoader.prototype.__class__ = "RES.ResourceLoader";
})(RES || (RES = {}));
/**
 * Copyright (c) Egret-Labs.org. Permission is hereby granted, free of charge,
 * to any person obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish, distribute,
 * sublicense, and/or sell copies of the Software, and to permit persons to whom
 * the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included
 * in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
 * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
 * PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE
 * FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
 * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var RES;
(function (RES) {
    var AnalyzerBase = (function (_super) {
        __extends(AnalyzerBase, _super);
        function AnalyzerBase() {
            _super.call(this);
            this.resourceConfig = (RES["configInstance"]);
        }
        /**
         * 添加一个二级键名到配置列表。
         * @method RES.ResourceConfig#addSubkey
         * @param subkey {string} 要添加的二级键名
         * @param name {string} 二级键名所属的资源name属性
         */
        AnalyzerBase.prototype.addSubkey = function (subkey, name) {
            this.resourceConfig.addSubkey(subkey, name);
        };
        /**
         * 加载一个资源文件
         * @param resItem 加载项信息
         * @param compFunc 加载完成回调函数,示例:compFunc(resItem:ResourceItem):void;
         * @param thisObject 加载完成回调函数的this引用
         */
        AnalyzerBase.prototype.loadFile = function (resItem, compFunc, thisObject) {
        };
        /**
         * 同步方式获取解析完成的数据
         * @param name 对应配置文件里的name属性。
         */
        AnalyzerBase.prototype.getRes = function (name) {
        };
        /**
         * 销毁某个资源文件的二进制数据,返回是否删除成功。
         * @param name 配置文件中加载项的name属性
         */
        AnalyzerBase.prototype.destroyRes = function (name) {
            return false;
        };
        /**
         * 读取一个字符串里第一个点之前的内容。
         * @param name {string} 要读取的字符串
         */
        AnalyzerBase.getStringPrefix = function (name) {
            if (!name) {
                return "";
            }
            var index = name.indexOf(".");
            if (index != -1) {
                return name.substring(0, index);
            }
            return "";
        };
        /**
         * 读取一个字符串里第一个点之后的内容。
         * @param name {string} 要读取的字符串
         */
        AnalyzerBase.getStringTail = function (name) {
            if (!name) {
                return "";
            }
            var index = name.indexOf(".");
            if (index != -1) {
                return name.substring(index + 1);
            }
            return "";
        };
        return AnalyzerBase;
    })(egret.HashObject);
    RES.AnalyzerBase = AnalyzerBase;
    AnalyzerBase.prototype.__class__ = "RES.AnalyzerBase";
})(RES || (RES = {}));
/**
 * Copyright (c) Egret-Labs.org. Permission is hereby granted, free of charge,
 * to any person obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish, distribute,
 * sublicense, and/or sell copies of the Software, and to permit persons to whom
 * the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included
 * in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
 * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
 * PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE
 * FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
 * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var RES;
(function (RES) {
    var BinAnalyzer = (function (_super) {
        __extends(BinAnalyzer, _super);
        /**
         * 构造函数
         */
        function BinAnalyzer() {
            _super.call(this);
            /**
             * 字节流数据缓存字典
             */
            this.fileDic = {};
            /**
             * 加载项字典
             */
            this.resItemDic = [];
            this._dataFormat = egret.URLLoaderDataFormat.BINARY;
            /**
             * URLLoader对象池
             */
            this.recycler = new egret.Recycler();
        }
        /**
         * @inheritDoc
         */
        BinAnalyzer.prototype.loadFile = function (resItem, compFunc, thisObject) {
            if (this.fileDic[resItem.name]) {
                compFunc.call(thisObject, resItem);
                return;
            }
            var loader = this.getLoader();
            this.resItemDic[loader.hashCode] = { item: resItem, func: compFunc, thisObject: thisObject };
            loader.load(new egret.URLRequest(resItem.url));
        };
        /**
         * 获取一个URLLoader对象
         */
        BinAnalyzer.prototype.getLoader = function () {
            var loader = this.recycler.pop();
            if (!loader) {
                loader = new egret.URLLoader();
                loader.addEventListener(egret.Event.COMPLETE, this.onLoadFinish, this);
                loader.addEventListener(egret.IOErrorEvent.IO_ERROR, this.onLoadFinish, this);
            }
            loader.dataFormat = this._dataFormat;
            return loader;
        };
        /**
         * 一项加载结束
         */
        BinAnalyzer.prototype.onLoadFinish = function (event) {
            var loader = (event.target);
            var data = this.resItemDic[loader.hashCode];
            delete this.resItemDic[loader.hashCode];
            this.recycler.push(loader);
            var resItem = data.item;
            var compFunc = data.func;
            resItem.loaded = (event.type == egret.Event.COMPLETE);
            if (resItem.loaded) {
                this.analyzeData(resItem, loader.data);
            }
            compFunc.call(data.thisObject, resItem);
        };
        /**
         * 解析并缓存加载成功的数据
         */
        BinAnalyzer.prototype.analyzeData = function (resItem, data) {
            var name = resItem.name;
            if (this.fileDic[name] || !data) {
                return;
            }
            this.fileDic[name] = data;
        };
        /**
         * @inheritDoc
         */
        BinAnalyzer.prototype.getRes = function (name) {
            return this.fileDic[name];
        };
        /**
         * @inheritDoc
         */
        BinAnalyzer.prototype.hasRes = function (name) {
            var res = this.getRes(name);
            return res != null;
        };
        /**
         * @inheritDoc
         */
        BinAnalyzer.prototype.destroyRes = function (name) {
            if (this.fileDic[name]) {
                delete this.fileDic[name];
                return true;
            }
            return false;
        };
        return BinAnalyzer;
    })(RES.AnalyzerBase);
    RES.BinAnalyzer = BinAnalyzer;
    BinAnalyzer.prototype.__class__ = "RES.BinAnalyzer";
})(RES || (RES = {}));
/**
 * Copyright (c) Egret-Labs.org. Permission is hereby granted, free of charge,
 * to any person obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish, distribute,
 * sublicense, and/or sell copies of the Software, and to permit persons to whom
 * the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included
 * in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
 * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
 * PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE
 * FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
 * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var RES;
(function (RES) {
    var ImageAnalyzer = (function (_super) {
        __extends(ImageAnalyzer, _super);
        function ImageAnalyzer() {
            _super.call(this);
            this._dataFormat = egret.URLLoaderDataFormat.TEXTURE;
        }
        /**
         * 解析并缓存加载成功的数据
         */
        ImageAnalyzer.prototype.analyzeData = function (resItem, data) {
            var name = resItem.name;
            if (this.fileDic[name] || !data) {
                return;
            }
            this.fileDic[name] = data;
            var config = resItem.data;
            if (config && config["scale9grid"]) {
                var str = config["scale9grid"];
                var list = str.split(",");
                data["scale9Grid"] = new egret.Rectangle(parseInt(list[0]), parseInt(list[1]), parseInt(list[2]), parseInt(list[3]));
            }
        };
        return ImageAnalyzer;
    })(RES.BinAnalyzer);
    RES.ImageAnalyzer = ImageAnalyzer;
    ImageAnalyzer.prototype.__class__ = "RES.ImageAnalyzer";
})(RES || (RES = {}));
/**
 * Copyright (c) Egret-Labs.org. Permission is hereby granted, free of charge,
 * to any person obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish, distribute,
 * sublicense, and/or sell copies of the Software, and to permit persons to whom
 * the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included
 * in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
 * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
 * PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE
 * FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
 * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var RES;
(function (RES) {
    var JsonAnalyzer = (function (_super) {
        __extends(JsonAnalyzer, _super);
        function JsonAnalyzer() {
            _super.call(this);
            this._dataFormat = egret.URLLoaderDataFormat.TEXT;
        }
        /**
         * 解析并缓存加载成功的数据
         */
        JsonAnalyzer.prototype.analyzeData = function (resItem, data) {
            var name = resItem.name;
            if (this.fileDic[name] || !data) {
                return;
            }
            try {
                var str = data;
                this.fileDic[name] = JSON.parse(str);
            }
            catch (e) {
                egret.Logger.warning("JSON文件格式不正确: " + resItem.url + "\ndata:" + data);
            }
        };
        return JsonAnalyzer;
    })(RES.BinAnalyzer);
    RES.JsonAnalyzer = JsonAnalyzer;
    JsonAnalyzer.prototype.__class__ = "RES.JsonAnalyzer";
})(RES || (RES = {}));
/**
 * Copyright (c) Egret-Labs.org. Permission is hereby granted, free of charge,
 * to any person obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish, distribute,
 * sublicense, and/or sell copies of the Software, and to permit persons to whom
 * the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included
 * in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
 * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
 * PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE
 * FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
 * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var RES;
(function (RES) {
    var TextAnalyzer = (function (_super) {
        __extends(TextAnalyzer, _super);
        function TextAnalyzer() {
            _super.call(this);
            this._dataFormat = egret.URLLoaderDataFormat.TEXT;
        }
        return TextAnalyzer;
    })(RES.BinAnalyzer);
    RES.TextAnalyzer = TextAnalyzer;
    TextAnalyzer.prototype.__class__ = "RES.TextAnalyzer";
})(RES || (RES = {}));
/**
 * Copyright (c) Egret-Labs.org. Permission is hereby granted, free of charge,
 * to any person obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish, distribute,
 * sublicense, and/or sell copies of the Software, and to permit persons to whom
 * the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included
 * in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
 * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
 * PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE
 * FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
 * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var RES;
(function (RES) {
    /**
     * SpriteSheet解析器
     */
    var SheetAnalyzer = (function (_super) {
        __extends(SheetAnalyzer, _super);
        function SheetAnalyzer() {
            _super.call(this);
            this.sheetMap = {};
            this.textureMap = {};
            this._dataFormat = egret.URLLoaderDataFormat.TEXT;
        }
        /**
         * @inheritDoc
         */
        SheetAnalyzer.prototype.getRes = function (name) {
            var res = this.fileDic[name];
            if (!res) {
                res = this.textureMap[name];
            }
            if (!res) {
                var prefix = RES.AnalyzerBase.getStringPrefix(name);
                res = this.fileDic[prefix];
                if (res) {
                    var tail = RES.AnalyzerBase.getStringTail(name);
                    res = res.getTexture(tail);
                }
            }
            return res;
        };
        /**
         * 一项加载结束
         */
        SheetAnalyzer.prototype.onLoadFinish = function (event) {
            var loader = (event.target);
            var data = this.resItemDic[loader.hashCode];
            delete this.resItemDic[loader.hashCode];
            this.recycler.push(loader);
            var resItem = data.item;
            var compFunc = data.func;
            resItem.loaded = (event.type == egret.Event.COMPLETE);
            if (resItem.loaded) {
                this.analyzeData(resItem, loader.data);
            }
            if (typeof (loader.data) == "string") {
                this._dataFormat = egret.URLLoaderDataFormat.TEXTURE;
                this.loadFile(resItem, compFunc, data.thisObject);
                this._dataFormat = egret.URLLoaderDataFormat.TEXT;
            }
            else {
                compFunc.call(data.thisObject, resItem);
            }
        };
        /**
         * 解析并缓存加载成功的数据
         */
        SheetAnalyzer.prototype.analyzeData = function (resItem, data) {
            var name = resItem.name;
            if (this.fileDic[name] || !data) {
                return;
            }
            var config;
            if (typeof (data) == "string") {
                try {
                    var str = data;
                    config = JSON.parse(str);
                }
                catch (e) {
                    egret.Logger.warning("JSON文件格式不正确: " + resItem.url);
                }
                if (!config) {
                    return;
                }
                this.sheetMap[name] = config;
                resItem.loaded = false;
                resItem.url = this.getRelativePath(resItem.url, config["file"]);
            }
            else {
                var texture = data;
                config = this.sheetMap[name];
                delete this.sheetMap[name];
                if (texture) {
                    var targetName = resItem.data && resItem.data.subkeys ? "" : name;
                    var spriteSheet = this.parseSpriteSheet(texture, config, targetName);
                    this.fileDic[name] = spriteSheet;
                }
            }
        };
        SheetAnalyzer.prototype.getRelativePath = function (url, file) {
            url = url.split("\\").join("/");
            var index = url.lastIndexOf("/");
            if (index != -1) {
                url = url.substring(0, index + 1) + file;
            }
            else {
                url = file;
            }
            return url;
        };
        SheetAnalyzer.prototype.parseSpriteSheet = function (texture, data, name) {
            var frames = data.frames;
            if (!frames) {
                return null;
            }
            var spriteSheet = new egret.SpriteSheet(texture);
            var textureMap = this.textureMap;
            for (var subkey in frames) {
                var config = frames[subkey];
                var texture = spriteSheet.createTexture(subkey, config.x, config.y, config.w, config.h, config.offX, config.offY, config.sourceW, config.sourceH);
                if (config["scale9grid"]) {
                    var str = config["scale9grid"];
                    var list = str.split(",");
                    texture["scale9Grid"] = new egret.Rectangle(parseInt(list[0]), parseInt(list[1]), parseInt(list[2]), parseInt(list[3]));
                }
                if (textureMap[subkey] == null) {
                    textureMap[subkey] = texture;
                    if (name) {
                        this.addSubkey(subkey, name);
                    }
                }
            }
            return spriteSheet;
        };
        return SheetAnalyzer;
    })(RES.BinAnalyzer);
    RES.SheetAnalyzer = SheetAnalyzer;
    SheetAnalyzer.prototype.__class__ = "RES.SheetAnalyzer";
})(RES || (RES = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var RES;
(function (RES) {
    var FontAnalyzer = (function (_super) {
        __extends(FontAnalyzer, _super);
        function FontAnalyzer() {
            _super.call(this);
        }
        /**
         * 解析并缓存加载成功的数据
         */
        FontAnalyzer.prototype.analyzeData = function (resItem, data) {
            var name = resItem.name;
            if (this.fileDic[name] || !data) {
                return;
            }
            var config;
            if (typeof (data) == "string") {
                config = data;
                this.sheetMap[name] = config;
                resItem.loaded = false;
                resItem.url = this.getTexturePath(resItem.url, config);
            }
            else {
                var texture = data;
                config = this.sheetMap[name];
                delete this.sheetMap[name];
                if (texture) {
                    var spriteSheet = new egret.BitmapTextSpriteSheet(texture, config);
                    this.fileDic[name] = spriteSheet;
                }
            }
        };
        FontAnalyzer.prototype.getTexturePath = function (url, fntText) {
            var file = "";
            var lines = fntText.split("\n");
            var pngLine = lines[2];
            var index = pngLine.indexOf("file=\"");
            if (index != -1) {
                pngLine = pngLine.substring(index + 6);
                index = pngLine.indexOf("\"");
                file = pngLine.substring(0, index);
            }
            url = url.split("\\").join("/");
            var index = url.lastIndexOf("/");
            if (index != -1) {
                url = url.substring(0, index + 1) + file;
            }
            else {
                url = file;
            }
            return url;
        };
        return FontAnalyzer;
    })(RES.SheetAnalyzer);
    RES.FontAnalyzer = FontAnalyzer;
    FontAnalyzer.prototype.__class__ = "RES.FontAnalyzer";
})(RES || (RES = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var RES;
(function (RES) {
    var SoundAnalyzer = (function (_super) {
        __extends(SoundAnalyzer, _super);
        function SoundAnalyzer() {
            _super.call(this);
            this._dataFormat = egret.URLLoaderDataFormat.SOUND;
        }
        SoundAnalyzer.prototype.analyzeData = function (resItem, data) {
            var name = resItem.name;
            if (this.fileDic[name] || !data) {
                return;
            }
            this.fileDic[name] = data;
            var config = resItem.data;
            if (config && config["soundType"]) {
                data.preload(config.soundType);
            }
            else {
                data.preload(egret.Sound.EFFECT);
            }
        };
        return SoundAnalyzer;
    })(RES.BinAnalyzer);
    RES.SoundAnalyzer = SoundAnalyzer;
    SoundAnalyzer.prototype.__class__ = "RES.SoundAnalyzer";
})(RES || (RES = {}));
/**
 * Copyright (c) Egret-Labs.org. Permission is hereby granted, free of charge,
 * to any person obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish, distribute,
 * sublicense, and/or sell copies of the Software, and to permit persons to whom
 * the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included
 * in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
 * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
 * PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE
 * FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
 * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var RES;
(function (RES) {
    var XMLAnalyzer = (function (_super) {
        __extends(XMLAnalyzer, _super);
        function XMLAnalyzer() {
            _super.call(this);
            this._dataFormat = egret.URLLoaderDataFormat.TEXT;
        }
        /**
         * 解析并缓存加载成功的数据
         */
        XMLAnalyzer.prototype.analyzeData = function (resItem, data) {
            var name = resItem.name;
            if (this.fileDic[name] || !data) {
                return;
            }
            try {
                var xmlStr = data;
                var xml = egret.XML.parse(xmlStr);
                this.fileDic[name] = xml;
            }
            catch (e) {
            }
        };
        return XMLAnalyzer;
    })(RES.BinAnalyzer);
    RES.XMLAnalyzer = XMLAnalyzer;
    XMLAnalyzer.prototype.__class__ = "RES.XMLAnalyzer";
})(RES || (RES = {}));
/**
 * Copyright (c) Egret-Labs.org. Permission is hereby granted, free of charge,
 * to any person obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish, distribute,
 * sublicense, and/or sell copies of the Software, and to permit persons to whom
 * the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included
 * in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
 * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
 * PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE
 * FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
 * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var RES;
(function (RES) {
    /**
     * 加载配置文件并解析
     * @method RES.loadConfig
     * @param url {string} 配置文件路径(resource.json的路径)
     * @param resourceRoot {string} 资源根路径。配置中的所有url都是这个路径的相对值。最终url是这个字符串与配置里资源项的url相加的值。
     * @param type {string} 配置文件的格式。确定要用什么解析器来解析配置文件。默认"json"
     */
    function loadConfig(url, resourceRoot, type) {
        if (resourceRoot === void 0) { resourceRoot = ""; }
        if (type === void 0) { type = "json"; }
        instance.loadConfig(url, resourceRoot, type);
    }
    RES.loadConfig = loadConfig;
    /**
     * 根据组名加载一组资源
     * @method RES.loadGroup
     * @param name {string} 要加载资源组的组名
     * @param priority {number} 加载优先级,可以为负数,默认值为0。
     * 低优先级的组必须等待高优先级组完全加载结束才能开始，同一优先级的组会同时加载。
     */
    function loadGroup(name, priority) {
        if (priority === void 0) { priority = 0; }
        instance.loadGroup(name, priority);
    }
    RES.loadGroup = loadGroup;
    /**
     * 检查某个资源组是否已经加载完成
     * @method RES.isGroupLoaded
     * @param name {string} 组名
     * @returns {boolean}
     */
    function isGroupLoaded(name) {
        return instance.isGroupLoaded(name);
    }
    RES.isGroupLoaded = isGroupLoaded;
    /**
     * 根据组名获取组加载项列表
     * @method RES.getGroupByName
     * @param name {string} 组名
     * @returns {egret.ResourceItem}
     */
    function getGroupByName(name) {
        return instance.getGroupByName(name);
    }
    RES.getGroupByName = getGroupByName;
    /**
     * 创建自定义的加载资源组,注意：此方法仅在资源配置文件加载完成后执行才有效。
     * 可以监听ResourceEvent.CONFIG_COMPLETE事件来确认配置加载完成。
     * @method RES.createGroup
     * @param name {string} 要创建的加载资源组的组名
     * @param keys {egret.Array<string>} 要包含的键名列表，key对应配置文件里的name属性或sbuKeys属性的一项或一个资源组名。
     * @param override {boolean} 是否覆盖已经存在的同名资源组,默认false。
     * @returns {boolean}
     */
    function createGroup(name, keys, override) {
        if (override === void 0) { override = false; }
        return instance.createGroup(name, keys, override);
    }
    RES.createGroup = createGroup;
    /**
     * 检查配置文件里是否含有指定的资源
     * @method RES.hasRes
     * @param key {string} 对应配置文件里的name属性或sbuKeys属性的一项。
     * @returns {boolean}
     */
    function hasRes(key) {
        return instance.hasRes(key);
    }
    RES.hasRes = hasRes;
    /**
     * 同步方式获取缓存的已经加载成功的资源。<br/>
     * @method RES.getRes
     * @param key {string} 对应配置文件里的name属性或sbuKeys属性的一项。
     * @returns {any}
     */
    function getRes(key) {
        return instance.getRes(key);
    }
    RES.getRes = getRes;
    /**
     * 异步方式获取配置里的资源。只要是配置文件里存在的资源，都可以通过异步方式获取。
     * @method RES.getResAsync
     * @param key {string} 对应配置文件里的name属性或sbuKeys属性的一项。
     * @param compFunc {Function} 回调函数。示例：compFunc(data,key):void。
     * @param thisObject {any} 回调函数的this引用
     */
    function getResAsync(key, compFunc, thisObject) {
        instance.getResAsync(key, compFunc, thisObject);
    }
    RES.getResAsync = getResAsync;
    /**
     * 通过完整URL方式获取外部资源。
     * @method RES.getResByUrl
     * @param url {string} 要加载文件的外部路径。
     * @param compFunc {Function} 回调函数。示例：compFunc(data,url):void。
     * @param thisObject {any} 回调函数的this引用
     * @param type {string} 文件类型(可选)。请使用ResourceItem类中定义的静态常量。若不设置将根据文件扩展名生成。
     */
    function getResByUrl(url, compFunc, thisObject, type) {
        if (type === void 0) { type = ""; }
        instance.getResByUrl(url, compFunc, thisObject, type);
    }
    RES.getResByUrl = getResByUrl;
    /**
     * 销毁单个资源文件或一组资源的缓存数据,返回是否删除成功。
     * @method RES.destroyRes
     * @param name {string} 配置文件中加载项的name属性或资源组名
     * @returns {boolean}
     */
    function destroyRes(name) {
        return instance.destroyRes(name);
    }
    RES.destroyRes = destroyRes;
    /**
     * 设置最大并发加载线程数量，默认值是2.
     * @method RES.setMaxLoadingThread
     * @param thread {number} 要设置的并发加载数。
     */
    function setMaxLoadingThread(thread) {
        instance.setMaxLoadingThread(thread);
    }
    RES.setMaxLoadingThread = setMaxLoadingThread;
    /**
     * 添加事件侦听器,参考ResourceEvent定义的常量。
     * @method RES.addEventListener
     * @param type {string} 事件的类型。
     * @param listener {Function} 处理事件的侦听器函数。此函数必须接受 Event 对象作为其唯一的参数，并且不能返回任何结果，
     * 如下面的示例所示： function(evt:Event):void 函数可以有任何名称。
     * @param thisObject {any} 侦听函数绑定的this对象
     * @param useCapture {boolean} 确定侦听器是运行于捕获阶段还是运行于目标和冒泡阶段。如果将 useCapture 设置为 true，
     * 则侦听器只在捕获阶段处理事件，而不在目标或冒泡阶段处理事件。如果 useCapture 为 false，则侦听器只在目标或冒泡阶段处理事件。
     * 要在所有三个阶段都侦听事件，请调用 addEventListener 两次：一次将 useCapture 设置为 true，一次将 useCapture 设置为 false。
     * @param priority {number} 事件侦听器的优先级。优先级由一个带符号的 32 位整数指定。数字越大，优先级越高。优先级为 n 的所有侦听器会在
     * 优先级为 n -1 的侦听器之前得到处理。如果两个或更多个侦听器共享相同的优先级，则按照它们的添加顺序进行处理。默认优先级为 0。
     */
    function addEventListener(type, listener, thisObject, useCapture, priority) {
        if (useCapture === void 0) { useCapture = false; }
        if (priority === void 0) { priority = 0; }
        instance.addEventListener(type, listener, thisObject, useCapture, priority);
    }
    RES.addEventListener = addEventListener;
    /**
     * 移除事件侦听器,参考ResourceEvent定义的常量。
     * @method RES.removeEventListener
     * @param type {string} 事件名
     * @param listener {Function} 侦听函数
     * @param thisObject {any} 侦听函数绑定的this对象
     * @param useCapture {boolean} 是否使用捕获，这个属性只在显示列表中生效。
     */
    function removeEventListener(type, listener, thisObject, useCapture) {
        if (useCapture === void 0) { useCapture = false; }
        instance.removeEventListener(type, listener, thisObject, useCapture);
    }
    RES.removeEventListener = removeEventListener;
    var Resource = (function (_super) {
        __extends(Resource, _super);
        /**
         * 构造函数
         * @method RES.constructor
         */
        function Resource() {
            _super.call(this);
            /**
             * 解析器字典
             */
            this.analyzerDic = {};
            this.configItemList = [];
            this.callLaterFlag = false;
            /**
             * 配置文件加载解析完成标志
             */
            this.configComplete = false;
            /**
             * 已经加载过组名列表
             */
            this.loadedGroups = [];
            this.groupNameList = [];
            /**
             * 异步获取资源参数缓存字典
             */
            this.asyncDic = {};
            this.init();
        }
        /**
         * 根据type获取对应的文件解析库
         */
        Resource.prototype.getAnalyzerByType = function (type) {
            var analyzer = this.analyzerDic[type];
            if (!analyzer) {
                analyzer = this.analyzerDic[type] = egret.Injector.getInstance(RES.AnalyzerBase, type);
            }
            return analyzer;
        };
        /**
         * 初始化
         */
        Resource.prototype.init = function () {
            if (!egret.Injector.hasMapRule(RES.AnalyzerBase, RES.ResourceItem.TYPE_BIN))
                egret.Injector.mapClass(RES.AnalyzerBase, RES.BinAnalyzer, RES.ResourceItem.TYPE_BIN);
            if (!egret.Injector.hasMapRule(RES.AnalyzerBase, RES.ResourceItem.TYPE_IMAGE))
                egret.Injector.mapClass(RES.AnalyzerBase, RES.ImageAnalyzer, RES.ResourceItem.TYPE_IMAGE);
            if (!egret.Injector.hasMapRule(RES.AnalyzerBase, RES.ResourceItem.TYPE_TEXT))
                egret.Injector.mapClass(RES.AnalyzerBase, RES.TextAnalyzer, RES.ResourceItem.TYPE_TEXT);
            if (!egret.Injector.hasMapRule(RES.AnalyzerBase, RES.ResourceItem.TYPE_JSON))
                egret.Injector.mapClass(RES.AnalyzerBase, RES.JsonAnalyzer, RES.ResourceItem.TYPE_JSON);
            if (!egret.Injector.hasMapRule(RES.AnalyzerBase, RES.ResourceItem.TYPE_SHEET))
                egret.Injector.mapClass(RES.AnalyzerBase, RES.SheetAnalyzer, RES.ResourceItem.TYPE_SHEET);
            if (!egret.Injector.hasMapRule(RES.AnalyzerBase, RES.ResourceItem.TYPE_FONT))
                egret.Injector.mapClass(RES.AnalyzerBase, RES.FontAnalyzer, RES.ResourceItem.TYPE_FONT);
            if (!egret.Injector.hasMapRule(RES.AnalyzerBase, RES.ResourceItem.TYPE_SOUND))
                egret.Injector.mapClass(RES.AnalyzerBase, RES.SoundAnalyzer, RES.ResourceItem.TYPE_SOUND);
            if (!egret.Injector.hasMapRule(RES.AnalyzerBase, RES.ResourceItem.TYPE_XML))
                egret.Injector.mapClass(RES.AnalyzerBase, RES.XMLAnalyzer, RES.ResourceItem.TYPE_XML);
            this.resConfig = new RES.ResourceConfig();
            this.resLoader = new RES.ResourceLoader();
            this.resLoader.callBack = this.onResourceItemComp;
            this.resLoader.resInstance = this;
            this.resLoader.addEventListener(RES.ResourceEvent.GROUP_COMPLETE, this.onGroupComp, this);
            this.resLoader.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR, this.onGroupError, this);
        };
        /**
         * 开始加载配置
         * @method RES.loadConfig
         * @param url {string}
         * @param resourceRoot {string}
         * @param type {string}
         */
        Resource.prototype.loadConfig = function (url, resourceRoot, type) {
            if (type === void 0) { type = "json"; }
            var configItem = { url: url, resourceRoot: resourceRoot, type: type };
            this.configItemList.push(configItem);
            if (!this.callLaterFlag) {
                egret.callLater(this.startLoadConfig, this);
                this.callLaterFlag = true;
            }
        };
        Resource.prototype.startLoadConfig = function () {
            this.callLaterFlag = false;
            var configList = this.configItemList;
            this.configItemList = [];
            this.loadingConfigList = configList;
            var length = configList.length;
            var itemList = [];
            for (var i = 0; i < length; i++) {
                var item = configList[i];
                var resItem = new RES.ResourceItem(item.url, item.url, item.type);
                itemList.push(resItem);
            }
            this.resLoader.loadGroup(itemList, Resource.GROUP_CONFIG, Number.MAX_VALUE);
        };
        /**
         * 检查某个资源组是否已经加载完成
         * @method RES.isGroupLoaded
         * @param name {string}
         * @returns {boolean}
         */
        Resource.prototype.isGroupLoaded = function (name) {
            return this.loadedGroups.indexOf(name) != -1;
        };
        /**
         * 根据组名获取组加载项列表
         * @method RES.getGroupByName
         * @param name {string}
         * @returns {Array<egret.ResourceItem>}
         */
        Resource.prototype.getGroupByName = function (name) {
            return this.resConfig.getGroupByName(name);
        };
        /**
         * 根据组名加载一组资源
         * @method RES.loadGroup
         * @param name {string}
         * @param priority {number}
         */
        Resource.prototype.loadGroup = function (name, priority) {
            if (priority === void 0) { priority = 0; }
            if (this.loadedGroups.indexOf(name) != -1) {
                RES.ResourceEvent.dispatchResourceEvent(this, RES.ResourceEvent.GROUP_COMPLETE, name);
                return;
            }
            if (this.resLoader.isGroupInLoading(name))
                return;
            if (this.configComplete) {
                var group = this.resConfig.getGroupByName(name);
                this.resLoader.loadGroup(group, name, priority);
            }
            else {
                this.groupNameList.push({ name: name, priority: priority });
            }
        };
        /**
         * 创建自定义的加载资源组,注意：此方法仅在资源配置文件加载完成后执行才有效。
         * 可以监听ResourceEvent.CONFIG_COMPLETE事件来确认配置加载完成。
         * @method RES.ResourceConfig#createGroup
         * @param name {string} 要创建的加载资源组的组名
         * @param keys {egret.Array<string>} 要包含的键名列表，key对应配置文件里的name属性或一个资源组名。
         * @param override {boolean} 是否覆盖已经存在的同名资源组,默认false。
         * @returns {boolean}
         */
        Resource.prototype.createGroup = function (name, keys, override) {
            if (override === void 0) { override = false; }
            if (override) {
                var index = this.loadedGroups.indexOf(name);
                if (index != -1) {
                    this.loadedGroups.splice(index, 1);
                }
            }
            return this.resConfig.createGroup(name, keys, override);
        };
        /**
         * 队列加载完成事件
         */
        Resource.prototype.onGroupComp = function (event) {
            if (event.groupName == Resource.GROUP_CONFIG) {
                var length = this.loadingConfigList.length;
                for (var i = 0; i < length; i++) {
                    var config = this.loadingConfigList[i];
                    var resolver = this.getAnalyzerByType(config.type);
                    var data = resolver.getRes(config.url);
                    resolver.destroyRes(config.url);
                    this.resConfig.parseConfig(data, config.resourceRoot);
                }
                this.configComplete = true;
                this.loadingConfigList = null;
                RES.ResourceEvent.dispatchResourceEvent(this, RES.ResourceEvent.CONFIG_COMPLETE);
                var groupNameList = this.groupNameList;
                var length = groupNameList.length;
                for (var i = 0; i < length; i++) {
                    var item = groupNameList[i];
                    this.loadGroup(item.name, item.priority);
                }
                this.groupNameList = [];
            }
            else {
                this.loadedGroups.push(event.groupName);
                this.dispatchEvent(event);
            }
        };
        /**
         * 队列加载失败事件
         */
        Resource.prototype.onGroupError = function (event) {
            if (event.groupName == Resource.GROUP_CONFIG) {
                this.loadingConfigList = null;
                RES.ResourceEvent.dispatchResourceEvent(this, RES.ResourceEvent.CONFIG_LOAD_ERROR);
            }
            else {
                this.dispatchEvent(event);
            }
        };
        /**
         * 检查配置文件里是否含有指定的资源
         * @method RES.hasRes
         * @param key {string} 对应配置文件里的name属性或sbuKeys属性的一项。
         * @returns {boolean}
         */
        Resource.prototype.hasRes = function (key) {
            var type = this.resConfig.getType(key);
            if (type == "") {
                var prefix = RES.AnalyzerBase.getStringPrefix(key);
                type = this.resConfig.getType(prefix);
                if (type == "") {
                    return false;
                }
            }
            return true;
        };
        /**
         * 通过key同步获取资源
         * @method RES.getRes
         * @param key {string}
         * @returns {any}
         */
        Resource.prototype.getRes = function (key) {
            var type = this.resConfig.getType(key);
            if (type == "") {
                var prefix = RES.AnalyzerBase.getStringPrefix(key);
                type = this.resConfig.getType(prefix);
                if (type == "") {
                    return null;
                }
            }
            var analyzer = this.getAnalyzerByType(type);
            return analyzer.getRes(key);
        };
        /**
         * 通过key异步获取资源
         * @method RES.getResAsync
         * @param key {string}
         * @param compFunc {Function} 回调函数。示例：compFunc(data,url):void。
         * @param thisObject {any}
         */
        Resource.prototype.getResAsync = function (key, compFunc, thisObject) {
            var type = this.resConfig.getType(key);
            var name = this.resConfig.getName(key);
            if (type == "") {
                name = RES.AnalyzerBase.getStringPrefix(key);
                type = this.resConfig.getType(name);
                if (type == "") {
                    compFunc.call(thisObject, null);
                    return;
                }
            }
            var analyzer = this.getAnalyzerByType(type);
            var res = analyzer.getRes(key);
            if (res) {
                compFunc.call(thisObject, res);
                return;
            }
            var args = { key: key, compFunc: compFunc, thisObject: thisObject };
            if (this.asyncDic[name]) {
                this.asyncDic[name].push(args);
            }
            else {
                this.asyncDic[name] = [args];
                var resItem = this.resConfig.getResourceItem(name);
                this.resLoader.loadItem(resItem);
            }
        };
        /**
         * 通过url获取资源
         * @method RES.getResByUrl
         * @param url {string}
         * @param compFunc {Function}
         * @param thisObject {any}
         * @param type {string}
         */
        Resource.prototype.getResByUrl = function (url, compFunc, thisObject, type) {
            if (type === void 0) { type = ""; }
            if (!url) {
                compFunc.call(thisObject, null);
                return;
            }
            if (!type)
                type = this.getTypeByUrl(url);
            var analyzer = this.getAnalyzerByType(type);
            var name = url;
            var res = analyzer.getRes(name);
            if (res) {
                compFunc.call(thisObject, res);
                return;
            }
            var args = { key: name, compFunc: compFunc, thisObject: thisObject };
            if (this.asyncDic[name]) {
                this.asyncDic[name].push(args);
            }
            else {
                this.asyncDic[name] = [args];
                var resItem = new RES.ResourceItem(name, url, type);
                this.resLoader.loadItem(resItem);
            }
        };
        /**
         * 通过url获取文件类型
         */
        Resource.prototype.getTypeByUrl = function (url) {
            var suffix = url.substr(url.lastIndexOf(".") + 1);
            if (suffix) {
                suffix = suffix.toLowerCase();
            }
            var type;
            switch (suffix) {
                case RES.ResourceItem.TYPE_XML:
                case RES.ResourceItem.TYPE_JSON:
                case RES.ResourceItem.TYPE_SHEET:
                    type = suffix;
                    break;
                case "png":
                case "jpg":
                case "gif":
                    type = RES.ResourceItem.TYPE_IMAGE;
                    break;
                case "fnt":
                    type = RES.ResourceItem.TYPE_FONT;
                    break;
                case "txt":
                    type = RES.ResourceItem.TYPE_TEXT;
                    break;
                case "mp3":
                case "ogg":
                case "mpeg":
                case "wav":
                case "m4a":
                case "mp4":
                case "aiff":
                case "wma":
                case "mid":
                    type = RES.ResourceItem.TYPE_SOUND;
                    break;
                default:
                    type = RES.ResourceItem.TYPE_BIN;
                    break;
            }
            return type;
        };
        /**
         * 一个加载项加载完成
         */
        Resource.prototype.onResourceItemComp = function (item) {
            var argsList = this.asyncDic[item.name];
            delete this.asyncDic[item.name];
            var analyzer = this.getAnalyzerByType(item.type);
            var length = argsList.length;
            for (var i = 0; i < length; i++) {
                var args = argsList[i];
                var res = analyzer.getRes(args.key);
                args.compFunc.call(args.thisObject, res, args.key);
            }
        };
        /**
         * 销毁单个资源文件或一组资源的缓存数据,返回是否删除成功。
         * @method RES.destroyRes
         * @param name {string} 配置文件中加载项的name属性或资源组名
         * @returns {boolean}
         */
        Resource.prototype.destroyRes = function (name) {
            var group = this.resConfig.getRawGroupByName(name);
            if (group) {
                var index = this.loadedGroups.indexOf(name);
                if (index != -1) {
                    this.loadedGroups.splice(index, 1);
                }
                var length = group.length;
                for (var i = 0; i < length; i++) {
                    var item = group[i];
                    item.loaded = false;
                    var analyzer = this.getAnalyzerByType(item.type);
                    analyzer.destroyRes(item.name);
                }
                return true;
            }
            else {
                var type = this.resConfig.getType(name);
                if (type == "")
                    return false;
                item = this.resConfig.getRawResourceItem(name);
                item.loaded = false;
                analyzer = this.getAnalyzerByType(type);
                return analyzer.destroyRes(name);
            }
        };
        /**
         * 设置最大并发加载线程数量，默认值是2.
         * @method RES.setMaxLoadingThread
         * @param thread {number} 要设置的并发加载数。
         */
        Resource.prototype.setMaxLoadingThread = function (thread) {
            if (thread < 1) {
                thread = 1;
            }
            this.resLoader.thread = thread;
        };
        /**
         * 配置文件组组名
         */
        Resource.GROUP_CONFIG = "RES__CONFIG";
        return Resource;
    })(egret.EventDispatcher);
    Resource.prototype.__class__ = "RES.Resource";
    /**
     * Resource单例
     */
    var instance = new Resource();
})(RES || (RES = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.LayoutManager
         * @classdesc
         * 布局管理器
         * @extends egret.EventDispatcher
         */
        var LayoutManager = (function (_super) {
            __extends(LayoutManager, _super);
            /**
             * @method egret.gui.LayoutManager#constructor
             */
            function LayoutManager() {
                _super.call(this);
                this.targetLevel = Number.MAX_VALUE;
                /**
                 * 需要抛出组件初始化完成事件的对象
                 */
                this.updateCompleteQueue = new gui.DepthQueue();
                this.invalidatePropertiesFlag = false;
                this.invalidateClientPropertiesFlag = false;
                this.invalidatePropertiesQueue = new gui.DepthQueue();
                this.invalidateSizeFlag = false;
                this.invalidateClientSizeFlag = false;
                this.invalidateSizeQueue = new gui.DepthQueue();
                this.invalidateDisplayListFlag = false;
                this.invalidateDisplayListQueue = new gui.DepthQueue();
                /**
                 * 是否已经添加了事件监听
                 */
                this.listenersAttached = false;
            }
            /**
             * 标记组件提交过属性
             * @method egret.gui.LayoutManager#invalidateProperties
             * @param client {ILayoutManagerClient}
             */
            LayoutManager.prototype.invalidateProperties = function (client) {
                if (!this.invalidatePropertiesFlag) {
                    this.invalidatePropertiesFlag = true;
                    if (!this.listenersAttached)
                        this.attachListeners();
                }
                if (this.targetLevel <= client.nestLevel)
                    this.invalidateClientPropertiesFlag = true;
                this.invalidatePropertiesQueue.insert(client);
            };
            /**
             * 使提交的属性生效
             */
            LayoutManager.prototype.validateProperties = function () {
                var client = this.invalidatePropertiesQueue.shift();
                while (client) {
                    if (client.parent) {
                        client.validateProperties();
                        if (!client.updateCompletePendingFlag) {
                            this.updateCompleteQueue.insert(client);
                            client.updateCompletePendingFlag = true;
                        }
                    }
                    client = this.invalidatePropertiesQueue.shift();
                }
                if (this.invalidatePropertiesQueue.isEmpty())
                    this.invalidatePropertiesFlag = false;
            };
            /**
             * 标记需要重新测量尺寸
             * @method egret.gui.LayoutManager#invalidateSize
             * @param client {ILayoutManagerClient}
             */
            LayoutManager.prototype.invalidateSize = function (client) {
                if (!this.invalidateSizeFlag) {
                    this.invalidateSizeFlag = true;
                    if (!this.listenersAttached)
                        this.attachListeners();
                }
                if (this.targetLevel <= client.nestLevel)
                    this.invalidateClientSizeFlag = true;
                this.invalidateSizeQueue.insert(client);
            };
            /**
             * 测量属性
             */
            LayoutManager.prototype.validateSize = function () {
                var client = this.invalidateSizeQueue.pop();
                while (client) {
                    if (client.parent) {
                        client.validateSize();
                        if (!client.updateCompletePendingFlag) {
                            this.updateCompleteQueue.insert(client);
                            client.updateCompletePendingFlag = true;
                        }
                    }
                    client = this.invalidateSizeQueue.pop();
                }
                if (this.invalidateSizeQueue.isEmpty())
                    this.invalidateSizeFlag = false;
            };
            /**
             * 标记需要重新测量尺寸
             * @method egret.gui.LayoutManager#invalidateDisplayList
             * @param client {ILayoutManagerClient}
             */
            LayoutManager.prototype.invalidateDisplayList = function (client) {
                if (!this.invalidateDisplayListFlag) {
                    this.invalidateDisplayListFlag = true;
                    if (!this.listenersAttached)
                        this.attachListeners();
                }
                this.invalidateDisplayListQueue.insert(client);
            };
            /**
             * 测量属性
             */
            LayoutManager.prototype.validateDisplayList = function () {
                var client = this.invalidateDisplayListQueue.shift();
                while (client) {
                    if (client.parent) {
                        client.validateDisplayList();
                        if (!client.updateCompletePendingFlag) {
                            this.updateCompleteQueue.insert(client);
                            client.updateCompletePendingFlag = true;
                        }
                    }
                    client = this.invalidateDisplayListQueue.shift();
                }
                if (this.invalidateDisplayListQueue.isEmpty())
                    this.invalidateDisplayListFlag = false;
            };
            /**
             * 添加事件监听
             */
            LayoutManager.prototype.attachListeners = function () {
                gui.UIGlobals.stage.addEventListener(egret.Event.ENTER_FRAME, this.doPhasedInstantiationCallBack, this);
                gui.UIGlobals.stage.addEventListener(egret.Event.RENDER, this.doPhasedInstantiationCallBack, this);
                gui.UIGlobals.stage.invalidate();
                this.listenersAttached = true;
            };
            /**
             * 执行属性应用
             */
            LayoutManager.prototype.doPhasedInstantiationCallBack = function (event) {
                if (event === void 0) { event = null; }
                gui.UIGlobals.stage.removeEventListener(egret.Event.ENTER_FRAME, this.doPhasedInstantiationCallBack, this);
                gui.UIGlobals.stage.removeEventListener(egret.Event.RENDER, this.doPhasedInstantiationCallBack, this);
                this.doPhasedInstantiation();
            };
            LayoutManager.prototype.doPhasedInstantiation = function () {
                if (this.invalidatePropertiesFlag) {
                    this.validateProperties();
                }
                if (this.invalidateSizeFlag) {
                    this.validateSize();
                }
                if (this.invalidateDisplayListFlag) {
                    this.validateDisplayList();
                }
                if (this.invalidatePropertiesFlag || this.invalidateSizeFlag || this.invalidateDisplayListFlag) {
                    this.attachListeners();
                }
                else {
                    this.listenersAttached = false;
                    var client = this.updateCompleteQueue.pop();
                    while (client) {
                        if (!client.initialized)
                            client.initialized = true;
                        if (client.hasEventListener(gui.UIEvent.UPDATE_COMPLETE))
                            gui.UIEvent.dispatchUIEvent(client, gui.UIEvent.UPDATE_COMPLETE);
                        client.updateCompletePendingFlag = false;
                        client = this.updateCompleteQueue.pop();
                    }
                    gui.UIEvent.dispatchUIEvent(this, gui.UIEvent.UPDATE_COMPLETE);
                }
            };
            /**
             * 立即应用所有延迟的属性
             * @method egret.gui.LayoutManager#validateNow
             */
            LayoutManager.prototype.validateNow = function () {
                var infiniteLoopGuard = 0;
                while (this.listenersAttached && infiniteLoopGuard++ < 100)
                    this.doPhasedInstantiationCallBack();
            };
            /**
             * 使大于等于指定组件层级的元素立即应用属性
             * @method egret.gui.LayoutManager#validateClient
             * @param target {ILayoutManagerClient} 要立即应用属性的组件
             * @param skipDisplayList {boolean} 是否跳过更新显示列表阶段
             */
            LayoutManager.prototype.validateClient = function (target, skipDisplayList) {
                if (skipDisplayList === void 0) { skipDisplayList = false; }
                var obj;
                var i = 0;
                var done = false;
                var oldTargetLevel = this.targetLevel;
                if (this.targetLevel == Number.MAX_VALUE)
                    this.targetLevel = target.nestLevel;
                while (!done) {
                    done = true;
                    obj = (this.invalidatePropertiesQueue.removeSmallestChild(target));
                    while (obj) {
                        if (obj.parent) {
                            obj.validateProperties();
                            if (!obj.updateCompletePendingFlag) {
                                this.updateCompleteQueue.insert(obj);
                                obj.updateCompletePendingFlag = true;
                            }
                        }
                        obj = (this.invalidatePropertiesQueue.removeSmallestChild(target));
                    }
                    if (this.invalidatePropertiesQueue.isEmpty()) {
                        this.invalidatePropertiesFlag = false;
                    }
                    this.invalidateClientPropertiesFlag = false;
                    obj = (this.invalidateSizeQueue.removeLargestChild(target));
                    while (obj) {
                        if (obj.parent) {
                            obj.validateSize();
                            if (!obj.updateCompletePendingFlag) {
                                this.updateCompleteQueue.insert(obj);
                                obj.updateCompletePendingFlag = true;
                            }
                        }
                        if (this.invalidateClientPropertiesFlag) {
                            obj = (this.invalidatePropertiesQueue.removeSmallestChild(target));
                            if (obj) {
                                this.invalidatePropertiesQueue.insert(obj);
                                done = false;
                                break;
                            }
                        }
                        obj = (this.invalidateSizeQueue.removeLargestChild(target));
                    }
                    if (this.invalidateSizeQueue.isEmpty()) {
                        this.invalidateSizeFlag = false;
                    }
                    this.invalidateClientPropertiesFlag = false;
                    this.invalidateClientSizeFlag = false;
                    if (!skipDisplayList) {
                        obj = (this.invalidateDisplayListQueue.removeSmallestChild(target));
                        while (obj) {
                            if (obj.parent) {
                                obj.validateDisplayList();
                                if (!obj.updateCompletePendingFlag) {
                                    this.updateCompleteQueue.insert(obj);
                                    obj.updateCompletePendingFlag = true;
                                }
                            }
                            if (this.invalidateClientPropertiesFlag) {
                                obj = (this.invalidatePropertiesQueue.removeSmallestChild(target));
                                if (obj) {
                                    this.invalidatePropertiesQueue.insert(obj);
                                    done = false;
                                    break;
                                }
                            }
                            if (this.invalidateClientSizeFlag) {
                                obj = (this.invalidateSizeQueue.removeLargestChild(target));
                                if (obj) {
                                    this.invalidateSizeQueue.insert(obj);
                                    done = false;
                                    break;
                                }
                            }
                            obj = (this.invalidateDisplayListQueue.removeSmallestChild(target));
                        }
                        if (this.invalidateDisplayListQueue.isEmpty()) {
                            this.invalidateDisplayListFlag = false;
                        }
                    }
                }
                if (oldTargetLevel == Number.MAX_VALUE) {
                    this.targetLevel = Number.MAX_VALUE;
                    if (!skipDisplayList) {
                        obj = (this.updateCompleteQueue.removeLargestChild(target));
                        while (obj) {
                            if (!obj.initialized)
                                obj.initialized = true;
                            if (obj.hasEventListener(gui.UIEvent.UPDATE_COMPLETE))
                                gui.UIEvent.dispatchUIEvent(obj, gui.UIEvent.UPDATE_COMPLETE);
                            obj.updateCompletePendingFlag = false;
                            obj = (this.updateCompleteQueue.removeLargestChild(target));
                        }
                    }
                }
            };
            return LayoutManager;
        })(egret.EventDispatcher);
        gui.LayoutManager = LayoutManager;
        LayoutManager.prototype.__class__ = "egret.gui.LayoutManager";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.DepthQueue
         * @classdesc
         * 显示列表嵌套深度排序队列
         */
        var DepthQueue = (function () {
            /**
             * @method egret.gui.DepthQueue#constructor
             */
            function DepthQueue() {
                /**
                 * 深度队列
                 */
                this.depthBins = [];
                /**
                 * 最小深度
                 */
                this.minDepth = 0;
                /**
                 * 最大深度
                 */
                this.maxDepth = -1;
            }
            /**
             * 插入一个元素
             * @method egret.gui.DepthQueue#insert
             * @param client {ILayoutManagerClient}
             */
            DepthQueue.prototype.insert = function (client) {
                var depth = client.nestLevel;
                var hashCode = client.hashCode;
                if (this.maxDepth < this.minDepth) {
                    this.minDepth = this.maxDepth = depth;
                }
                else {
                    if (depth < this.minDepth)
                        this.minDepth = depth;
                    if (depth > this.maxDepth)
                        this.maxDepth = depth;
                }
                var bin = this.depthBins[depth];
                if (!bin) {
                    bin = new DepthBin();
                    this.depthBins[depth] = bin;
                    bin.items[hashCode] = client;
                    bin.length++;
                }
                else {
                    if (bin.items[hashCode] == null) {
                        bin.items[hashCode] = client;
                        bin.length++;
                    }
                }
            };
            /**
             * 从队列尾弹出深度最大的一个对象
             * @method egret.gui.DepthQueue#pop
             * @returns {ILayoutManagerClient}
             */
            DepthQueue.prototype.pop = function () {
                var client = null;
                if (this.minDepth <= this.maxDepth) {
                    var bin = this.depthBins[this.maxDepth];
                    while (!bin || bin.length == 0) {
                        this.maxDepth--;
                        if (this.maxDepth < this.minDepth)
                            return null;
                        bin = this.depthBins[this.maxDepth];
                    }
                    var items = bin.items;
                    for (var key in items) {
                        client = items[key];
                        this.remove(client, this.maxDepth);
                        break;
                    }
                    while (!bin || bin.length == 0) {
                        this.maxDepth--;
                        if (this.maxDepth < this.minDepth)
                            break;
                        bin = this.depthBins[this.maxDepth];
                    }
                }
                return client;
            };
            /**
             * 从队列首弹出深度最小的一个对象
             * @method egret.gui.DepthQueue#shift
             * @returns {ILayoutManagerClient}
             */
            DepthQueue.prototype.shift = function () {
                var client = null;
                if (this.minDepth <= this.maxDepth) {
                    var bin = this.depthBins[this.minDepth];
                    while (!bin || bin.length == 0) {
                        this.minDepth++;
                        if (this.minDepth > this.maxDepth)
                            return null;
                        bin = this.depthBins[this.minDepth];
                    }
                    var items = bin.items;
                    for (var key in items) {
                        client = items[key];
                        this.remove(client, this.minDepth);
                        break;
                    }
                    while (!bin || bin.length == 0) {
                        this.minDepth++;
                        if (this.minDepth > this.maxDepth)
                            break;
                        bin = this.depthBins[this.minDepth];
                    }
                }
                return client;
            };
            /**
             * 移除大于等于指定组件层级的元素中最大的元素
             * @method egret.gui.DepthQueue#removeLargestChild
             * @param client {ILayoutManagerClient}
             * @returns {any}
             */
            DepthQueue.prototype.removeLargestChild = function (client) {
                var max = this.maxDepth;
                var min = client.nestLevel;
                var hashCode = client.hashCode;
                while (min <= max) {
                    var bin = this.depthBins[max];
                    if (bin && bin.length > 0) {
                        if (max == client.nestLevel) {
                            if (bin.items[hashCode]) {
                                this.remove(client, max);
                                return client;
                            }
                        }
                        else {
                            var items = bin.items;
                            for (var key in items) {
                                var value = items[key];
                                if ((value instanceof egret.DisplayObject) && (client instanceof egret.DisplayObjectContainer) && client.contains(value)) {
                                    this.remove(value, max);
                                    return value;
                                }
                            }
                        }
                        max--;
                    }
                    else {
                        if (max == this.maxDepth)
                            this.maxDepth--;
                        max--;
                        if (max < min)
                            break;
                    }
                }
                return null;
            };
            /**
             * 移除大于等于指定组件层级的元素中最小的元素
             * @method egret.gui.DepthQueue#removeSmallestChild
             * @param client {ILayoutManagerClient}
             * @returns {any}
             */
            DepthQueue.prototype.removeSmallestChild = function (client) {
                var min = client.nestLevel;
                var hashCode = client.hashCode;
                while (min <= this.maxDepth) {
                    var bin = this.depthBins[min];
                    if (bin && bin.length > 0) {
                        if (min == client.nestLevel) {
                            if (bin.items[hashCode]) {
                                this.remove(client, min);
                                return client;
                            }
                        }
                        else {
                            var items = bin.items;
                            for (var key in items) {
                                var value = items[key];
                                if ((value instanceof egret.DisplayObject) && (client instanceof egret.DisplayObjectContainer) && client.contains(value)) {
                                    this.remove(value, min);
                                    return value;
                                }
                            }
                        }
                        min++;
                    }
                    else {
                        if (min == this.minDepth)
                            this.minDepth++;
                        min++;
                        if (min > this.maxDepth)
                            break;
                    }
                }
                return null;
            };
            /**
             * 移除一个元素
             * @method egret.gui.DepthQueue#remove
             * @param client {ILayoutManagerClient}
             * @param level {number}
             * @returns {ILayoutManagerClient}
             */
            DepthQueue.prototype.remove = function (client, level) {
                if (level === void 0) { level = -1; }
                var depth = (level >= 0) ? level : client.nestLevel;
                var hashCode = client.hashCode;
                var bin = this.depthBins[depth];
                if (bin && bin.items[hashCode] != null) {
                    delete bin.items[hashCode];
                    bin.length--;
                    return client;
                }
                return null;
            };
            /**
             * 清空队列
             * @method egret.gui.DepthQueue#removeAll
             */
            DepthQueue.prototype.removeAll = function () {
                this.depthBins.length = 0;
                this.minDepth = 0;
                this.maxDepth = -1;
            };
            /**
             * 队列是否为空
             * @method egret.gui.DepthQueue#isEmpty
             * @returns {boolean}
             */
            DepthQueue.prototype.isEmpty = function () {
                return this.minDepth > this.maxDepth;
            };
            return DepthQueue;
        })();
        gui.DepthQueue = DepthQueue;
        DepthQueue.prototype.__class__ = "egret.gui.DepthQueue";
        /**
         * 列表项
         */
        var DepthBin = (function () {
            function DepthBin() {
                this.length = 0;
                this.items = [];
            }
            return DepthBin;
        })();
        gui.DepthBin = DepthBin;
        DepthBin.prototype.__class__ = "egret.gui.DepthBin";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.UIGlobals
         * @classdesc
         */
        var UIGlobals = (function () {
            function UIGlobals() {
            }
            Object.defineProperty(UIGlobals, "stage", {
                /**
                 * 舞台引用，当第一个UIComponent添加到舞台时此属性被自动赋值
                 * @member egret.gui.UIGlobals.stage
                 */
                get: function () {
                    return UIGlobals._stage;
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 初始化管理器
             * @param stage {Stage}
             */
            UIGlobals._initlize = function (stage) {
                if (UIGlobals.initlized)
                    return;
                UIGlobals._stage = stage;
                UIGlobals._layoutManager = new gui.LayoutManager();
                UIGlobals.initlized = true;
            };
            Object.defineProperty(UIGlobals, "uiStage", {
                /**
                 * 顶级应用容器
                 * @member egret.gui.UIGlobals.uiStage
                 */
                get: function () {
                    return UIGlobals._uiStage;
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 已经初始化完成标志
             */
            UIGlobals.initlized = false;
            return UIGlobals;
        })();
        gui.UIGlobals = UIGlobals;
        UIGlobals.prototype.__class__ = "egret.gui.UIGlobals";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.UIComponent
         * @classdesc
         * 显示对象基类
         * @extends egret.DisplayObjectContainer
         * @implements egret.gui.IUIComponent
         * @implements egret.gui.ILayoutManagerClient
         * @implements egret.gui.ILayoutElement
         * @implements egret.gui.IInvalidating
         * @implements egret.gui.IVisualElement
         */
        var UIComponent = (function (_super) {
            __extends(UIComponent, _super);
            /**
             * 构造函数
             * @method egret.gui.UIComponent#constructor
             */
            function UIComponent() {
                _super.call(this);
                this._updateCompletePendingFlag = false;
                this._initialized = false;
                /**
                 * _initialize()方法被调用过的标志。
                 */
                this.initializeCalled = false;
                this._nestLevel = 0;
                /**
                 * 是否已经创建了自身的样式原型链
                 */
                this._hasOwnStyleChain = false;
                /**
                 * 样式原型链引用
                 */
                this._styleProtoChain = null;
                /**
                 * 一个性能优化的标志变量。某些子类可以设置为true显式表明自己不含有可设置样式的子项。
                 */
                this._hasNoStyleChild = false;
                this._enabled = true;
                this._width = 0;
                this._height = 0;
                this._minWidth = 0;
                this._maxWidth = 10000;
                this._minHeight = 0;
                this._maxHeight = 10000;
                this._measuredWidth = 0;
                this._measuredHeight = 0;
                /**
                 * @member egret.gui.UIComponent#_invalidatePropertiesFlag
                 */
                this._invalidatePropertiesFlag = false;
                /**
                 * @member egret.gui.UIComponent#_invalidateSizeFlag
                 */
                this._invalidateSizeFlag = false;
                this._invalidateDisplayListFlag = false;
                this._validateNowFlag = false;
                this._includeInLayout = true;
                /**
                 * 父级布局管理器设置了组件的宽度标志，尺寸设置优先级：自动布局>显式设置>自动测量
                 * @member egret.gui.UIComponent#_layoutWidthExplicitlySet
                 */
                this._layoutWidthExplicitlySet = false;
                /**
                 * 父级布局管理器设置了组件的高度标志，尺寸设置优先级：自动布局>显式设置>自动测量
                 * @member egret.gui.UIComponent#_layoutHeightExplicitlySet
                 */
                this._layoutHeightExplicitlySet = false;
                this.touchEnabled = true;
                this.addEventListener(egret.Event.ADDED_TO_STAGE, this.onAddedToStage, this);
                this.addEventListener(egret.Event.ADDED_TO_STAGE, this.checkInvalidateFlag, this);
                if (UIComponent.prototypeCanSet === undefined) {
                    var chain = {};
                    UIComponent.prototypeCanSet = (chain.__proto__ !== undefined);
                }
            }
            /**
             * 添加到舞台
             */
            UIComponent.prototype.onAddedToStage = function (e) {
                this.removeEventListener(egret.Event.ADDED_TO_STAGE, this.onAddedToStage, this);
                this._initialize();
                gui.UIGlobals._initlize(this.stage);
                if (this._nestLevel > 0)
                    this.checkInvalidateFlag();
            };
            Object.defineProperty(UIComponent.prototype, "id", {
                /**
                 * 组件 ID。此值将作为对象的实例名称，因此不应包含任何空格或特殊字符。应用程序中的每个组件都应具有唯一的 ID。
                 * @constant egret.gui.UIComponent#id
                 */
                get: function () {
                    return this._id;
                },
                set: function (value) {
                    this._id = value;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(UIComponent.prototype, "isPopUp", {
                /**
                 * @member egret.gui.UIComponent#isPopUp
                 */
                get: function () {
                    return this._isPopUp;
                },
                set: function (value) {
                    this._isPopUp = value;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(UIComponent.prototype, "owner", {
                /**
                 * @member egret.gui.UIComponent#owner
                 */
                get: function () {
                    return this._owner ? this._owner : this.parent;
                },
                enumerable: true,
                configurable: true
            });
            /**
             * @method egret.gui.UIComponent#ownerChanged
             * @param value {any}
             */
            UIComponent.prototype.ownerChanged = function (value) {
                this._owner = value;
            };
            Object.defineProperty(UIComponent.prototype, "updateCompletePendingFlag", {
                /**
                 * @member egret.gui.UIComponent#updateCompletePendingFlag
                 */
                get: function () {
                    return this._updateCompletePendingFlag;
                },
                set: function (value) {
                    this._updateCompletePendingFlag = value;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(UIComponent.prototype, "initialized", {
                /**
                 * @member egret.gui.UIComponent#initialized
                 */
                get: function () {
                    return this._initialized;
                },
                set: function (value) {
                    if (this._initialized == value)
                        return;
                    this._initialized = value;
                    if (value) {
                        this.childrenCreated();
                        gui.UIEvent.dispatchUIEvent(this, gui.UIEvent.CREATION_COMPLETE);
                    }
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 初始化组件
             * @method egret.gui.UIComponent#_initialize
             */
            UIComponent.prototype._initialize = function () {
                if (this.initializeCalled)
                    return;
                if (gui.UIGlobals.stage) {
                    this.removeEventListener(egret.Event.ADDED_TO_STAGE, this.onAddedToStage, this);
                }
                this.initializeCalled = true;
                gui.UIEvent.dispatchUIEvent(this, gui.UIEvent.INITIALIZE);
                this.createChildren();
                this.invalidateProperties();
                this.invalidateSize();
                this.invalidateDisplayList();
            };
            /**
             * 创建子项,子类覆盖此方法以完成组件子项的初始化操作，
             * 请务必调用super.createChildren()以完成父类组件的初始化
             * @method egret.gui.UIComponent#createChildren
             */
            UIComponent.prototype.createChildren = function () {
            };
            /**
             * 子项创建完成
             * @method egret.gui.UIComponent#childrenCreated
             */
            UIComponent.prototype.childrenCreated = function () {
            };
            Object.defineProperty(UIComponent.prototype, "nestLevel", {
                /**
                 * @member egret.gui.UIComponent#nestLevel
                 */
                get: function () {
                    return this._nestLevel;
                },
                set: function (value) {
                    if (this._nestLevel == value)
                        return;
                    this._nestLevel = value;
                    if (this._nestLevel == 0)
                        this.addEventListener(egret.Event.ADDED_TO_STAGE, this.checkInvalidateFlag, this);
                    else
                        this.removeEventListener(egret.Event.ADDED_TO_STAGE, this.checkInvalidateFlag, this);
                    this._updateChildrenNestLevel();
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 更新子项的nestLevel属性
             */
            UIComponent.prototype._updateChildrenNestLevel = function () {
                for (var i = this.numChildren - 1; i >= 0; i--) {
                    var child = (this.getChildAt(i));
                    if (child && "nestLevel" in child) {
                        child.nestLevel = this._nestLevel + 1;
                    }
                }
            };
            /**
             * 获取指定的名称的样式属性值
             */
            UIComponent.prototype.getStyle = function (styleProp) {
                var chain = this._styleProtoChain;
                if (!chain) {
                    return undefined;
                }
                return chain[styleProp];
            };
            /**
             * 对此组件实例设置样式属性。在此组件上设置的样式会覆盖父级容器的同名样式。推荐在子项较少的组件上使用，尽量避免在全局调用此方法，有可能造成性能问题。
             */
            UIComponent.prototype.setStyle = function (styleProp, newValue) {
                var chain = this._styleProtoChain;
                if (!this._hasOwnStyleChain) {
                    chain = this._createOwnStyleProtoChain(chain);
                }
                chain[styleProp] = newValue;
                this.styleChanged(styleProp);
                this.notifyStyleChangeInChildren(styleProp);
            };
            UIComponent.prototype.styleChanged = function (styleProp) {
            };
            /**
             * 通知子项列表样式发生改变
             */
            UIComponent.prototype.notifyStyleChangeInChildren = function (styleProp) {
                if (this._hasNoStyleChild) {
                    return;
                }
                for (var i = this.numChildren - 1; i >= 0; i--) {
                    var child = (this.getChildAt(i));
                    if (!child) {
                        continue;
                    }
                    if ("styleChanged" in child) {
                        child.styleChanged(styleProp);
                        child.notifyStyleChangeInChildren(styleProp);
                    }
                }
            };
            UIComponent.prototype._createOwnStyleProtoChain = function (chain) {
                this._hasOwnStyleChain = true;
                if (UIComponent.prototypeCanSet) {
                    this._styleProtoChain = {};
                    this._styleProtoChain.__proto__ = chain ? chain : UIComponent.emptyStyleChain;
                }
                else {
                    this._styleProtoChain = this.createProtoChain(chain);
                }
                chain = this._styleProtoChain;
                if (!this._hasNoStyleChild) {
                    for (var i = this.numChildren - 1; i >= 0; i--) {
                        var child = (this.getChildAt(i));
                        if (child && "regenerateStyleCache" in child) {
                            child["regenerateStyleCache"](chain);
                        }
                    }
                }
                return chain;
            };
            /**
             * 创建一个原型链节点
             */
            UIComponent.prototype.createProtoChain = function (parentChain) {
                function factory() {
                }
                ;
                factory.prototype = parentChain;
                var childChain = new factory();
                factory.prototype = null;
                return childChain;
            };
            /**
             * 清除在此组件实例上设置过的指定样式名。
             */
            UIComponent.prototype.clearStyle = function (styleProp) {
                if (!this._hasOwnStyleChain) {
                    return;
                }
                var chain = this._styleProtoChain;
                delete chain[styleProp];
                this.styleChanged(styleProp);
                this.notifyStyleChangeInChildren(styleProp);
            };
            /**
             * 重新生成自身以及所有子项的原型链
             */
            UIComponent.prototype.regenerateStyleCache = function (parentChain) {
                if (!UIComponent.prototypeCanSet) {
                    this.regenerateStyleCacheForIE(parentChain);
                    return;
                }
                if (this._hasOwnStyleChain) {
                    this._styleProtoChain.__proto__ = parentChain ? parentChain : UIComponent.emptyStyleChain;
                }
                else if (this._styleProtoChain != parentChain) {
                    this._styleProtoChain = parentChain;
                    for (var i = this.numChildren - 1; i >= 0; i--) {
                        var child = (this.getChildAt(i));
                        if (child && "regenerateStyleCache" in child) {
                            child.regenerateStyleCache(parentChain);
                        }
                    }
                }
            };
            /**
             * 兼容IE9，10的写法。
             */
            UIComponent.prototype.regenerateStyleCacheForIE = function (parentChain) {
                if (this._hasOwnStyleChain) {
                    var chain = this._styleProtoChain;
                    var childChain = this.createProtoChain(parentChain);
                    for (var key in chain) {
                        if (chain.hasOwnProperty(key)) {
                            childChain[key] = chain[key];
                        }
                    }
                    this._styleProtoChain = childChain;
                    parentChain = childChain;
                }
                else {
                    this._styleProtoChain = parentChain;
                }
                if (!this._hasNoStyleChild) {
                    for (var i = this.numChildren - 1; i >= 0; i--) {
                        var child = this.getChildAt(i);
                        if (child && "regenerateStyleCacheForIE" in child) {
                            child["regenerateStyleCacheForIE"](parentChain);
                        }
                    }
                }
            };
            /**
             * 添加对象到显示列表,此接口仅预留给框架内部使用
             * 如果需要管理子项，若有，请使用容器的addElement()方法，非法使用有可能造成无法自动布局。
             */
            UIComponent.prototype._addToDisplayList = function (child, notifyListeners) {
                if (notifyListeners === void 0) { notifyListeners = true; }
                var index = this.numChildren;
                if (child.parent == this)
                    index--;
                this._addingChild(child);
                this._doAddChild(child, index, notifyListeners);
                this._childAdded(child);
                return child;
            };
            /**
             * 添加对象到显示列表,此接口仅预留给框架内部使用
             * 如果需要管理子项，若有，请使用容器的addElementAt()方法，非法使用有可能造成无法自动布局。
             */
            UIComponent.prototype._addToDisplayListAt = function (child, index, notifyListeners) {
                if (notifyListeners === void 0) { notifyListeners = true; }
                this._addingChild(child);
                this._doAddChild(child, index, notifyListeners);
                this._childAdded(child);
                return child;
            };
            /**
             * 添加对象到显示列表,此接口仅预留给框架内部使用
             * 如果需要管理子项，若有，请使用容器的removeElement()方法,非法使用有可能造成无法自动布局。
             */
            UIComponent.prototype._removeFromDisplayList = function (child, notifyListeners) {
                if (notifyListeners === void 0) { notifyListeners = true; }
                var index = this._children.indexOf(child);
                if (index >= 0) {
                    this._doRemoveChild(index, notifyListeners);
                    this._childRemoved(child);
                    return child;
                }
                else {
                    egret.Logger.fatal("child未被addChild到该parent");
                    return null;
                }
            };
            /**
             * 从显示列表移除指定索引的子项,此接口仅预留给框架内部使用
             * 如果需要管理子项，若有，请使用容器的removeElementAt()方法,非法使用有可能造成无法自动布局。
             */
            UIComponent.prototype._removeFromDisplayListAt = function (index, notifyListeners) {
                if (notifyListeners === void 0) { notifyListeners = true; }
                if (index >= 0 && index < this._children.length) {
                    var child = this._doRemoveChild(index, notifyListeners);
                    this._childRemoved(child);
                    return child;
                }
                else {
                    egret.Logger.fatal("提供的索引超出范围");
                    return null;
                }
            };
            /**
             * GUI范围内，请不要调用任何addChild方法，若是容器，请用addElement,若需要包装普通显示对象，请把显示对象赋值给UIAsset.source。
             * @deprecated
             * @method egret.gui.UIComponent#addChild
             * @param child {DisplayObject}
             * @returns {DisplayObject}
             */
            UIComponent.prototype.addChild = function (child) {
                this._addingChild(child);
                _super.prototype.addChild.call(this, child);
                this._childAdded(child);
                return child;
            };
            /**
             * GUI范围内，请不要调用任何addChildAt方法，若是容器，请用addElementAt,若需要包装普通显示对象，请把显示对象赋值给UIAsset.source。
             * @deprecated
             * @method egret.gui.UIComponent#addChildAt
             * @param child {DisplayObject}
             * @param index {number}
             * @returns {DisplayObject}
             */
            UIComponent.prototype.addChildAt = function (child, index) {
                this._addingChild(child);
                _super.prototype.addChildAt.call(this, child, index);
                this._childAdded(child);
                return child;
            };
            /**
             * 即将添加一个子项
             */
            UIComponent.prototype._addingChild = function (child) {
                if (!child) {
                    return;
                }
                if ("nestLevel" in child) {
                    child.nestLevel = this._nestLevel + 1;
                }
                if ("styleChanged" in child) {
                    var chain = this._styleProtoChain;
                    if (chain || child["_styleProtoChain"]) {
                        child["regenerateStyleCache"](chain);
                        child["styleChanged"](null);
                        child["notifyStyleChangeInChildren"](null);
                    }
                }
            };
            /**
             * 已经添加一个子项
             */
            UIComponent.prototype._childAdded = function (child) {
                if (child instanceof UIComponent) {
                    child._initialize();
                    child.checkInvalidateFlag();
                }
            };
            /**
             * GUI范围内，请不要调用任何removeChild方法，若是容器，请用removeElement
             * @deprecated
             * @method egret.gui.UIComponent#removeChild
             * @param child {DisplayObject}
             * @returns {DisplayObject}
             */
            UIComponent.prototype.removeChild = function (child) {
                _super.prototype.removeChild.call(this, child);
                this._childRemoved(child);
                return child;
            };
            /**
             * GUI范围内，请不要调用任何removeChildAt方法，若是容器，请用removeElementAt
             * @deprecated
             * @method egret.gui.UIComponent#removeChildAt
             * @param index {number}
             * @returns {DisplayObject}
             */
            UIComponent.prototype.removeChildAt = function (index) {
                var child = _super.prototype.removeChildAt.call(this, index);
                this._childRemoved(child);
                return child;
            };
            /**
             * 已经移除一个子项
             */
            UIComponent.prototype._childRemoved = function (child) {
                if (!child) {
                    return;
                }
                if ("nestLevel" in child) {
                    child.nestLevel = 0;
                }
            };
            /**
             * 检查属性失效标记并应用
             */
            UIComponent.prototype.checkInvalidateFlag = function (event) {
                if (event === void 0) { event = null; }
                if (!gui.UIGlobals._layoutManager)
                    return;
                if (this._invalidatePropertiesFlag) {
                    gui.UIGlobals._layoutManager.invalidateProperties(this);
                }
                if (this._invalidateSizeFlag) {
                    gui.UIGlobals._layoutManager.invalidateSize(this);
                }
                if (this._invalidateDisplayListFlag) {
                    gui.UIGlobals._layoutManager.invalidateDisplayList(this);
                }
                if (this._validateNowFlag) {
                    gui.UIGlobals._layoutManager.validateClient(this);
                    this._validateNowFlag = false;
                }
            };
            Object.defineProperty(UIComponent.prototype, "enabled", {
                /**
                 * @member egret.gui.UIComponent#enabled
                 */
                get: function () {
                    return this._enabled;
                },
                set: function (value) {
                    this._enabled = value;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(UIComponent.prototype, "width", {
                /**
                 * @member egret.gui.UIComponent#width
                 */
                get: function () {
                    return this._width;
                },
                /**
                 * 组件宽度,默认值为NaN,设置为NaN将使用组件的measure()方法自动计算尺寸
                 */
                set: function (value) {
                    this._setWidth(value);
                },
                enumerable: true,
                configurable: true
            });
            UIComponent.prototype._setWidth = function (value) {
                if (this._width == value && this._explicitWidth == value)
                    return;
                _super.prototype._setWidth.call(this, value);
                if (isNaN(value))
                    this.invalidateSize();
                else
                    this._width = value;
                this.invalidateProperties();
                this.invalidateDisplayList();
                this.invalidateParentSizeAndDisplayList();
            };
            Object.defineProperty(UIComponent.prototype, "height", {
                /**
                 * @member egret.gui.UIComponent#height
                 */
                get: function () {
                    return this._height;
                },
                /**
                 * 组件高度,默认值为NaN,设置为NaN将使用组件的measure()方法自动计算尺寸
                 */
                set: function (value) {
                    this._setHeight(value);
                },
                enumerable: true,
                configurable: true
            });
            UIComponent.prototype._setHeight = function (value) {
                if (this._height == value && this._explicitHeight == value)
                    return;
                _super.prototype._setHeight.call(this, value);
                if (isNaN(value))
                    this.invalidateSize();
                else
                    this._height = value;
                this.invalidateProperties();
                this.invalidateDisplayList();
                this.invalidateParentSizeAndDisplayList();
            };
            Object.defineProperty(UIComponent.prototype, "scaleX", {
                /**
                 * @member egret.gui.UIComponent#scaleX
                 */
                get: function () {
                    return this._scaleX;
                },
                /**
                 * @inheritDoc
                 */
                set: function (value) {
                    this._setScaleX(value);
                },
                enumerable: true,
                configurable: true
            });
            UIComponent.prototype._setScaleX = function (value) {
                if (this._scaleX == value)
                    return;
                this._scaleX = value;
                this.invalidateParentSizeAndDisplayList();
            };
            Object.defineProperty(UIComponent.prototype, "scaleY", {
                /**
                 * @member egret.gui.UIComponent#scaleY
                 */
                get: function () {
                    return this._scaleY;
                },
                /**
                 * @inheritDoc
                 */
                set: function (value) {
                    this._setScaleY(value);
                },
                enumerable: true,
                configurable: true
            });
            UIComponent.prototype._setScaleY = function (value) {
                if (this._scaleY == value)
                    return;
                this._scaleY = value;
                this.invalidateParentSizeAndDisplayList();
            };
            Object.defineProperty(UIComponent.prototype, "minWidth", {
                /**
                 * @member egret.gui.UIComponent#minWidth
                 */
                get: function () {
                    return this._minWidth;
                },
                set: function (value) {
                    if (this._minWidth == value)
                        return;
                    this._minWidth = value;
                    this.invalidateSize();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(UIComponent.prototype, "maxWidth", {
                /**
                 * @member egret.gui.UIComponent#maxWidth
                 */
                get: function () {
                    return this._maxWidth;
                },
                set: function (value) {
                    if (this._maxWidth == value)
                        return;
                    this._maxWidth = value;
                    this.invalidateSize();
                },
                enumerable: true,
                configurable: true
            });
            UIComponent.prototype._getMaxWidth = function () {
                return this._maxWidth;
            };
            Object.defineProperty(UIComponent.prototype, "minHeight", {
                /**
                 * @member egret.gui.UIComponent#minHeight
                 */
                get: function () {
                    return this._minHeight;
                },
                set: function (value) {
                    if (this._minHeight == value)
                        return;
                    this._minHeight = value;
                    this.invalidateSize();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(UIComponent.prototype, "maxHeight", {
                /**
                 * @member egret.gui.UIComponent#maxHeight
                 */
                get: function () {
                    return this._maxHeight;
                },
                set: function (value) {
                    if (this._maxHeight == value)
                        return;
                    this._maxHeight = value;
                    this.invalidateSize();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(UIComponent.prototype, "measuredWidth", {
                /**
                 * 组件的默认宽度（以像素为单位）。此值由 measure() 方法设置。
                 * @member egret.gui.UIComponent#measuredWidth
                 */
                get: function () {
                    return this._measuredWidth;
                },
                set: function (value) {
                    this._measuredWidth = value;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(UIComponent.prototype, "measuredHeight", {
                /**
                 * 组件的默认高度（以像素为单位）。此值由 measure() 方法设置。
                 * @member egret.gui.UIComponent#measuredHeight
                 */
                get: function () {
                    return this._measuredHeight;
                },
                set: function (value) {
                    this._measuredHeight = value;
                },
                enumerable: true,
                configurable: true
            });
            /**
             * @method egret.gui.UIComponent#setActualSize
             * @param w {number}
             * @param h {number}
             */
            UIComponent.prototype.setActualSize = function (w, h) {
                var change = false;
                if (this._width != w) {
                    this._width = w;
                    change = true;
                }
                if (this._height != h) {
                    this._height = h;
                    change = true;
                }
                if (change) {
                    this.invalidateDisplayList();
                    this.dispatchResizeEvent();
                }
            };
            Object.defineProperty(UIComponent.prototype, "x", {
                /**
                 * @constant egret.gui.UIComponent#x
                 */
                get: function () {
                    return this._x;
                },
                /**
                 * @inheritDoc
                 */
                set: function (value) {
                    if (this._x == value)
                        return;
                    this._setX(value);
                    this.invalidateProperties();
                    if (this._includeInLayout && this.parent && this.parent instanceof UIComponent)
                        (this.parent)._childXYChanged();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(UIComponent.prototype, "y", {
                /**
                 * @constant egret.gui.UIComponent#y
                 */
                get: function () {
                    return this._y;
                },
                /**
                 * @inheritDoc
                 */
                set: function (value) {
                    if (this._y == value)
                        return;
                    this._setY(value);
                    this.invalidateProperties();
                    if (this._includeInLayout && this.parent && this.parent instanceof UIComponent)
                        (this.parent)._childXYChanged();
                },
                enumerable: true,
                configurable: true
            });
            /**
             * @method egret.gui.UIComponent#invalidateProperties
             */
            UIComponent.prototype.invalidateProperties = function () {
                if (!this._invalidatePropertiesFlag) {
                    this._invalidatePropertiesFlag = true;
                    if (this.parent && gui.UIGlobals._layoutManager)
                        gui.UIGlobals._layoutManager.invalidateProperties(this);
                }
            };
            /**
             * @method egret.gui.UIComponent#validateProperties
             */
            UIComponent.prototype.validateProperties = function () {
                if (this._invalidatePropertiesFlag) {
                    this.commitProperties();
                    this._invalidatePropertiesFlag = false;
                }
            };
            /**
             * @method egret.gui.UIComponent#invalidateSize
             */
            UIComponent.prototype.invalidateSize = function () {
                if (!this._invalidateSizeFlag) {
                    this._invalidateSizeFlag = true;
                    if (this.parent && gui.UIGlobals._layoutManager)
                        gui.UIGlobals._layoutManager.invalidateSize(this);
                }
            };
            /**
             * @method egret.gui.UIComponent#validateSize
             * @param recursive {boolean}
             */
            UIComponent.prototype.validateSize = function (recursive) {
                if (recursive === void 0) { recursive = false; }
                if (recursive) {
                    for (var i = 0; i < this.numChildren; i++) {
                        var child = this.getChildAt(i);
                        if ("validateSize" in child)
                            child.validateSize(true);
                    }
                }
                if (this._invalidateSizeFlag) {
                    var changed = this.measureSizes();
                    if (changed) {
                        this.invalidateDisplayList();
                        this.invalidateParentSizeAndDisplayList();
                    }
                    this._invalidateSizeFlag = false;
                }
            };
            /**
             * 测量组件尺寸，返回尺寸是否发生变化
             */
            UIComponent.prototype.measureSizes = function () {
                var changed = false;
                if (!this._invalidateSizeFlag)
                    return changed;
                if (!this.canSkipMeasurement()) {
                    this.measure();
                    if (this.measuredWidth < this.minWidth) {
                        this.measuredWidth = this.minWidth;
                    }
                    if (this.measuredWidth > this.maxWidth) {
                        this.measuredWidth = this.maxWidth;
                    }
                    if (this.measuredHeight < this.minHeight) {
                        this.measuredHeight = this.minHeight;
                    }
                    if (this.measuredHeight > this.maxHeight) {
                        this.measuredHeight = this.maxHeight;
                    }
                }
                if (isNaN(this._oldPreferWidth)) {
                    this._oldPreferWidth = this.preferredWidth;
                    this._oldPreferHeight = this.preferredHeight;
                    changed = true;
                }
                else {
                    if (this.preferredWidth != this._oldPreferWidth || this.preferredHeight != this._oldPreferHeight)
                        changed = true;
                    this._oldPreferWidth = this.preferredWidth;
                    this._oldPreferHeight = this.preferredHeight;
                }
                return changed;
            };
            /**
             * @method egret.gui.UIComponent#invalidateDisplayList
             */
            UIComponent.prototype.invalidateDisplayList = function () {
                if (!this._invalidateDisplayListFlag) {
                    this._invalidateDisplayListFlag = true;
                    if (this.parent && gui.UIGlobals._layoutManager)
                        gui.UIGlobals._layoutManager.invalidateDisplayList(this);
                    this._setSizeDirty();
                }
            };
            /**
             * @method egret.gui.UIComponent#validateDisplayList
             */
            UIComponent.prototype.validateDisplayList = function () {
                if (this._invalidateDisplayListFlag) {
                    var unscaledWidth = 0;
                    var unscaledHeight = 0;
                    if (this._layoutWidthExplicitlySet) {
                        unscaledWidth = this._width;
                    }
                    else if (!isNaN(this.explicitWidth)) {
                        unscaledWidth = this._explicitWidth;
                    }
                    else {
                        unscaledWidth = this.measuredWidth;
                    }
                    if (this._layoutHeightExplicitlySet) {
                        unscaledHeight = this._height;
                    }
                    else if (!isNaN(this.explicitHeight)) {
                        unscaledHeight = this._explicitHeight;
                    }
                    else {
                        unscaledHeight = this.measuredHeight;
                    }
                    if (isNaN(unscaledWidth))
                        unscaledWidth = 0;
                    if (isNaN(unscaledHeight))
                        unscaledHeight = 0;
                    this.setActualSize(unscaledWidth, unscaledHeight);
                    this.updateDisplayList(unscaledWidth, unscaledHeight);
                    this._invalidateDisplayListFlag = false;
                }
            };
            /**
             * @method egret.gui.UIComponent#validateNow
             * @param skipDisplayList {boolean}
             */
            UIComponent.prototype.validateNow = function (skipDisplayList) {
                if (skipDisplayList === void 0) { skipDisplayList = false; }
                if (!this._validateNowFlag && gui.UIGlobals._layoutManager != null)
                    gui.UIGlobals._layoutManager.validateClient(this, skipDisplayList);
                else
                    this._validateNowFlag = true;
            };
            /**
             * 标记父级容器的尺寸和显示列表为失效
             * @method egret.gui.UIComponent#invalidateParentSizeAndDisplayList
             */
            UIComponent.prototype.invalidateParentSizeAndDisplayList = function () {
                if (!this.parent || !this._includeInLayout || !("invalidateSize" in this.parent))
                    return;
                var p = (this.parent);
                p.invalidateSize();
                p.invalidateDisplayList();
            };
            /**
             * 更新显示列表
             * @method egret.gui.UIComponent#updateDisplayList
             * @param unscaledWidth {number}
             * @param unscaledHeight {number}
             */
            UIComponent.prototype.updateDisplayList = function (unscaledWidth, unscaledHeight) {
            };
            /**
             * 是否可以跳过测量尺寸阶段,返回true则不执行measure()方法
             */
            UIComponent.prototype.canSkipMeasurement = function () {
                return !isNaN(this._explicitWidth) && !isNaN(this._explicitHeight);
            };
            /**
             * 提交属性，子类在调用完invalidateProperties()方法后，应覆盖此方法以应用属性
             */
            UIComponent.prototype.commitProperties = function () {
                if (this.oldWidth != this._width || this.oldHeight != this._height) {
                    this.dispatchResizeEvent();
                }
                if (this.oldX != this.x || this.oldY != this.y) {
                    this.dispatchMoveEvent();
                }
            };
            /**
             * 测量组件尺寸
             * @method egret.gui.UIComponent#measure
             */
            UIComponent.prototype.measure = function () {
                this._measuredHeight = 0;
                this._measuredWidth = 0;
            };
            /**
             *  抛出移动事件
             */
            UIComponent.prototype.dispatchMoveEvent = function () {
                if (this.hasEventListener(gui.MoveEvent.MOVE)) {
                    gui.MoveEvent.dispatchMoveEvent(this, this.oldX, this.oldY);
                }
                this.oldX = this.x;
                this.oldY = this.y;
            };
            /**
             * 子项的xy位置发生改变
             */
            UIComponent.prototype._childXYChanged = function () {
            };
            /**
             *  抛出尺寸改变事件
             */
            UIComponent.prototype.dispatchResizeEvent = function () {
                if (this.hasEventListener(gui.ResizeEvent.RESIZE)) {
                    gui.ResizeEvent.dispatchResizeEvent(this, this.oldWidth, this.oldHeight);
                }
                this.oldWidth = this._width;
                this.oldHeight = this._height;
            };
            Object.defineProperty(UIComponent.prototype, "includeInLayout", {
                /**
                 * @member egret.gui.UIComponent#includeInLayout
                 */
                get: function () {
                    return this._includeInLayout;
                },
                set: function (value) {
                    if (this._includeInLayout == value)
                        return;
                    this._includeInLayout = true;
                    this.invalidateParentSizeAndDisplayList();
                    this._includeInLayout = value;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(UIComponent.prototype, "left", {
                /**
                 * @member egret.gui.UIComponent#left
                 */
                get: function () {
                    return this._left;
                },
                set: function (value) {
                    if (this._left == value)
                        return;
                    this._left = value;
                    this.invalidateParentSizeAndDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(UIComponent.prototype, "right", {
                /**
                 * @member egret.gui.UIComponent#right
                 */
                get: function () {
                    return this._right;
                },
                set: function (value) {
                    if (this._right == value)
                        return;
                    this._right = value;
                    this.invalidateParentSizeAndDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(UIComponent.prototype, "top", {
                /**
                 * @member egret.gui.UIComponent#top
                 */
                get: function () {
                    return this._top;
                },
                set: function (value) {
                    if (this._top == value)
                        return;
                    this._top = value;
                    this.invalidateParentSizeAndDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(UIComponent.prototype, "bottom", {
                /**
                 * @member egret.gui.UIComponent#bottom
                 */
                get: function () {
                    return this._bottom;
                },
                set: function (value) {
                    if (this._bottom == value)
                        return;
                    this._bottom = value;
                    this.invalidateParentSizeAndDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(UIComponent.prototype, "horizontalCenter", {
                /**
                 * @member egret.gui.UIComponent#horizontalCenter
                 */
                get: function () {
                    return this._horizontalCenter;
                },
                set: function (value) {
                    if (this._horizontalCenter == value)
                        return;
                    this._horizontalCenter = value;
                    this.invalidateParentSizeAndDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(UIComponent.prototype, "verticalCenter", {
                /**
                 * @member egret.gui.UIComponent#verticalCenter
                 */
                get: function () {
                    return this._verticalCenter;
                },
                set: function (value) {
                    if (this._verticalCenter == value)
                        return;
                    this._verticalCenter = value;
                    this.invalidateParentSizeAndDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(UIComponent.prototype, "percentWidth", {
                /**
                 * @member egret.gui.UIComponent#percentWidth
                 */
                get: function () {
                    return this._percentWidth;
                },
                set: function (value) {
                    if (this._percentWidth == value)
                        return;
                    this._percentWidth = value;
                    this.invalidateParentSizeAndDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(UIComponent.prototype, "percentHeight", {
                /**
                 * @member egret.gui.UIComponent#percentHeight
                 */
                get: function () {
                    return this._percentHeight;
                },
                set: function (value) {
                    if (this._percentHeight == value)
                        return;
                    this._percentHeight = value;
                    this.invalidateParentSizeAndDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            /**
             * @method egret.gui.UIComponent#setLayoutBoundsSize
             * @param layoutWidth {number}
             * @param layoutHeight {number}
             */
            UIComponent.prototype.setLayoutBoundsSize = function (layoutWidth, layoutHeight) {
                if (isNaN(layoutWidth)) {
                    this._layoutWidthExplicitlySet = false;
                    layoutWidth = this.preferredWidth;
                }
                else {
                    this._layoutWidthExplicitlySet = true;
                }
                if (isNaN(layoutHeight)) {
                    this._layoutHeightExplicitlySet = false;
                    layoutHeight = this.preferredHeight;
                }
                else {
                    this._layoutHeightExplicitlySet = true;
                }
                this.setActualSize(layoutWidth / this._scaleX, layoutHeight / this._scaleY);
            };
            /**
             * @method egret.gui.UIComponent#setLayoutBoundsPosition
             * @param x {number}
             * @param y {number}
             */
            UIComponent.prototype.setLayoutBoundsPosition = function (x, y) {
                if (this._scaleX < 0) {
                    x += this.layoutBoundsWidth;
                }
                if (this._scaleY < 0) {
                    y += this.layoutBoundsHeight;
                }
                var changed = false;
                if (this._x != x) {
                    this._setX(x);
                    changed = true;
                }
                if (this._y != y) {
                    this._setY(y);
                    changed = true;
                }
                if (changed) {
                    this.dispatchMoveEvent();
                }
            };
            Object.defineProperty(UIComponent.prototype, "preferredWidth", {
                /**
                 * @member egret.gui.UIComponent#preferredWidth
                 */
                get: function () {
                    var w = this._hasWidthSet ? this._explicitWidth : this._measuredWidth;
                    var scaleX = this._scaleX;
                    if (scaleX < 0) {
                        scaleX = -scaleX;
                    }
                    return w * scaleX;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(UIComponent.prototype, "preferredHeight", {
                /**
                 * @member egret.gui.UIComponent#preferredHeight
                 */
                get: function () {
                    var h = this._hasHeightSet ? this._explicitHeight : this._measuredHeight;
                    var scaleY = this._scaleY;
                    if (scaleY < 0) {
                        scaleY = -scaleY;
                    }
                    return h * scaleY;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(UIComponent.prototype, "preferredX", {
                /**
                 * @member egret.gui.UIComponent#preferredX
                 */
                get: function () {
                    if (this._scaleX >= 0) {
                        return this._x;
                    }
                    var w = this.preferredWidth;
                    return this._x - w;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(UIComponent.prototype, "preferredY", {
                /**
                 * @member egret.gui.UIComponent#preferredY
                 */
                get: function () {
                    if (this._scaleY >= 0) {
                        return this._y;
                    }
                    var h = this.preferredHeight;
                    return this._y - h;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(UIComponent.prototype, "layoutBoundsX", {
                /**
                 * @member egret.gui.UIComponent#layoutBoundsX
                 */
                get: function () {
                    if (this._scaleX >= 0) {
                        return this._x;
                    }
                    var w = this.layoutBoundsWidth;
                    return this._x - w;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(UIComponent.prototype, "layoutBoundsY", {
                /**
                 * @member egret.gui.UIComponent#layoutBoundsY
                 */
                get: function () {
                    if (this._scaleY >= 0) {
                        return this._y;
                    }
                    var h = this.layoutBoundsHeight;
                    return this._y - h;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(UIComponent.prototype, "layoutBoundsWidth", {
                /**
                 * @member egret.gui.UIComponent#layoutBoundsWidth
                 */
                get: function () {
                    var w = 0;
                    if (this._layoutWidthExplicitlySet) {
                        w = this._width;
                    }
                    else if (this._hasWidthSet) {
                        w = this._explicitWidth;
                    }
                    else {
                        w = this._measuredWidth;
                    }
                    var scaleX = this._scaleX;
                    if (scaleX < 0) {
                        scaleX = -scaleX;
                    }
                    return w * scaleX;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(UIComponent.prototype, "layoutBoundsHeight", {
                /**
                 * 组件的布局高度,常用于父级的updateDisplayList()方法中
                 * 按照：布局高度>外部显式设置高度>测量高度 的优先级顺序返回高度
                 * @member egret.gui.UIComponent#layoutBoundsHeight
                 */
                get: function () {
                    var h = 0;
                    if (this._layoutHeightExplicitlySet) {
                        h = this._height;
                    }
                    else if (this._hasHeightSet) {
                        h = this._explicitHeight;
                    }
                    else {
                        h = this._measuredHeight;
                    }
                    var scaleY = this.scaleY;
                    if (scaleY < 0) {
                        scaleY = -scaleY;
                    }
                    return h * scaleY;
                },
                enumerable: true,
                configurable: true
            });
            UIComponent.emptyStyleChain = {};
            return UIComponent;
        })(egret.DisplayObjectContainer);
        gui.UIComponent = UIComponent;
        UIComponent.prototype.__class__ = "egret.gui.UIComponent";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.PopUpPosition
         * @classdesc
         * 定义弹出位置的常量值。
         * 该常量决定目标对象相对于父级组件的弹出位置。
         */
        var PopUpPosition = (function () {
            function PopUpPosition() {
            }
            /**
             * 在组件上方弹出
             * @constant egret.gui.PopUpPosition.ABOVE
             */
            PopUpPosition.ABOVE = "above";
            /**
             * 在组件下方弹出
             * @constant egret.gui.PopUpPosition.BELOW
             */
            PopUpPosition.BELOW = "below";
            /**
             * 在组件中心弹出
             * @constant egret.gui.PopUpPosition.CENTER
             */
            PopUpPosition.CENTER = "center";
            /**
             * 在组件左上角弹出
             * @constant egret.gui.PopUpPosition.TOP_LEFT
             */
            PopUpPosition.TOP_LEFT = "topLeft";
            /**
             * 在组件左边弹出
             * @constant egret.gui.PopUpPosition.LEFT
             */
            PopUpPosition.LEFT = "left";
            /**
             * 在组件右边弹出
             * @constant egret.gui.PopUpPosition.RIGHT
             */
            PopUpPosition.RIGHT = "right";
            return PopUpPosition;
        })();
        gui.PopUpPosition = PopUpPosition;
        PopUpPosition.prototype.__class__ = "egret.gui.PopUpPosition";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.ClassFactory
         * @classdesc ClassFactory 实例是一个“工厂对象”，Egret 可用其生成其他类的实例，每个实例拥有相同的属性。
         * @extends egret.HashObject
         */
        var ClassFactory = (function (_super) {
            __extends(ClassFactory, _super);
            /**
             * @method egret.gui.ClassFactory#constructor
             * @param generator {any} newInstance() 方法根据工厂对象生成对象时使用的 Class。
             */
            function ClassFactory(generator) {
                if (generator === void 0) { generator = null; }
                _super.call(this);
                this.generator = generator;
            }
            /**
             * 生产一个新的实例
             * @method egret.egret#newInstance
             * @returns {any}
             */
            ClassFactory.prototype.newInstance = function () {
                var instance = new this.generator();
                return instance;
            };
            return ClassFactory;
        })(egret.HashObject);
        gui.ClassFactory = ClassFactory;
        ClassFactory.prototype.__class__ = "egret.gui.ClassFactory";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        var NavigationUnit = (function () {
            function NavigationUnit() {
            }
            NavigationUnit.DOWN = 40;
            NavigationUnit.END = 35;
            NavigationUnit.HOME = 36;
            NavigationUnit.LEFT = 37;
            NavigationUnit.PAGE_DOWN = 34;
            NavigationUnit.PAGE_LEFT = 0x2397;
            NavigationUnit.PAGE_RIGHT = 0x2398;
            NavigationUnit.PAGE_UP = 33;
            NavigationUnit.RIGHT = 39;
            NavigationUnit.UP = 38;
            return NavigationUnit;
        })();
        gui.NavigationUnit = NavigationUnit;
        NavigationUnit.prototype.__class__ = "egret.gui.NavigationUnit";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.OverrideBase
         * @classdesc
         * OverrideBase 类是视图状态所用的 override 类的基类。
         * @extends egret.HashObject
         * @implements egret.gui.IOverride
         */
        var OverrideBase = (function (_super) {
            __extends(OverrideBase, _super);
            function OverrideBase() {
                _super.call(this);
            }
            OverrideBase.prototype.initialize = function (parent) {
            };
            OverrideBase.prototype.apply = function (parent) {
            };
            OverrideBase.prototype.remove = function (parent) {
                if (parent === null) {
                }
            };
            /**
             * 从对象初始化，这是一个便利方法
             * @method egret.gui.OverrideBase#initializeFromObject
             * @param properties {any}
             * @returns {any}
             */
            OverrideBase.prototype.initializeFromObject = function (properties) {
                for (var p in properties) {
                    this[p] = properties[p];
                }
                return this;
            };
            return OverrideBase;
        })(egret.HashObject);
        gui.OverrideBase = OverrideBase;
        OverrideBase.prototype.__class__ = "egret.gui.OverrideBase";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.AddItems
         * @classdesc
         * 添加显示元素
         * @extends egret.gui.OverrideBase
         */
        var AddItems = (function (_super) {
            __extends(AddItems, _super);
            /**
             * 构造函数
             * @method egret.gui.AddItems#constructor
             */
            function AddItems(target, propertyName, position, relativeTo) {
                _super.call(this);
                /**
                 * 要添加到的属性
                 * @member egret.gui.AddItems#propertyName
                 */
                this.propertyName = "";
                /**
                 * 添加的位置
                 * @member egret.gui.AddItems#position
                 */
                this.position = AddItems.LAST;
                this.target = target;
                this.propertyName = propertyName;
                this.position = position;
                this.relativeTo = relativeTo;
            }
            /**
             * @method egret.gui.AddItems#initialize
             * @param parent {IStateClient}
             */
            AddItems.prototype.initialize = function (parent) {
                var targetElement = (parent[this.target]);
                if (!targetElement || targetElement instanceof gui.SkinnableComponent)
                    return;
                //让UIAsset等素材组件立即开始初始化，防止延迟闪一下或首次点击失效的问题。
                if ("_initialize" in targetElement) {
                    try {
                        targetElement["_initialize"]();
                    }
                    catch (e) {
                    }
                }
            };
            /**
             * @method egret.gui.AddItems#apply
             * @param parent {IContainer}
             */
            AddItems.prototype.apply = function (parent) {
                var index;
                var relative;
                try {
                    relative = (parent[this.relativeTo]);
                }
                catch (e) {
                }
                var targetElement = (parent[this.target]);
                var dest = (this.propertyName ? parent[this.propertyName] : parent);
                if (!targetElement || !dest)
                    return;
                switch (this.position) {
                    case AddItems.FIRST:
                        index = 0;
                        break;
                    case AddItems.LAST:
                        index = -1;
                        break;
                    case AddItems.BEFORE:
                        index = dest.getElementIndex(relative);
                        break;
                    case AddItems.AFTER:
                        index = dest.getElementIndex(relative) + 1;
                        break;
                }
                if (index == -1)
                    index = dest.numElements;
                dest.addElementAt(targetElement, index);
            };
            /**
             * @method egret.gui.AddItems#remove
             * @param parent {IContainer}
             */
            AddItems.prototype.remove = function (parent) {
                var dest = this.propertyName == null || this.propertyName == "" ? parent : parent[this.propertyName];
                var targetElement = (parent[this.target]);
                if (!targetElement || !dest)
                    return;
                if (dest.getElementIndex(targetElement) != -1) {
                    dest.removeElement(targetElement);
                }
            };
            /**
             * 添加父级容器的底层
             * @constant egret.gui.AddItems.FIRST
             */
            AddItems.FIRST = "first";
            /**
             * 添加在父级容器的顶层
             * @constant egret.gui.AddItems.LAST
             */
            AddItems.LAST = "last";
            /**
             * 添加在相对对象之前
             * @constant egret.gui.AddItems.BEFORE
             */
            AddItems.BEFORE = "before";
            /**
             * 添加在相对对象之后
             * @constant egret.gui.AddItems.AFTER
             */
            AddItems.AFTER = "after";
            return AddItems;
        })(gui.OverrideBase);
        gui.AddItems = AddItems;
        AddItems.prototype.__class__ = "egret.gui.AddItems";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.SetProperty
         * @classdesc
         * 设置属性
         * @extends egret.gui.OverrideBase
         */
        var SetProperty = (function (_super) {
            __extends(SetProperty, _super);
            /**
             * 构造函数
             * @method egret.gui.SetProperty#constructor
             */
            function SetProperty(target, name, value) {
                _super.call(this);
                this.target = target;
                this.name = name;
                this.value = value;
            }
            /**
             * @method egret.gui.SetProperty#apply
             * @param parent {IContainer}
             */
            SetProperty.prototype.apply = function (parent) {
                var obj = this.target == null || this.target == "" ? parent : parent[this.target];
                if (obj == null)
                    return;
                this.oldValue = obj[this.name];
                this.setPropertyValue(obj, this.name, this.value, this.oldValue);
            };
            /**
             * @method egret.gui.SetProperty#remove
             * @param parent {IContainer}
             */
            SetProperty.prototype.remove = function (parent) {
                var obj = this.target == null || this.target == "" ? parent : parent[this.target];
                if (obj == null)
                    return;
                this.setPropertyValue(obj, this.name, this.oldValue, this.oldValue);
                this.oldValue = null;
            };
            /**
             * 设置属性值
             */
            SetProperty.prototype.setPropertyValue = function (obj, name, value, valueForType) {
                if (value === undefined || value === null)
                    obj[name] = value;
                else if (typeof (valueForType) == "number")
                    obj[name] = parseFloat(value);
                else if (typeof (valueForType) == "boolean")
                    obj[name] = this.toBoolean(value);
                else
                    obj[name] = value;
            };
            /**
             * 转成Boolean值
             */
            SetProperty.prototype.toBoolean = function (value) {
                if (typeof (value) == "string")
                    return value.toLowerCase() == "true";
                return value != false;
            };
            return SetProperty;
        })(gui.OverrideBase);
        gui.SetProperty = SetProperty;
        SetProperty.prototype.__class__ = "egret.gui.SetProperty";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.SetProperty
         * @classdesc
         * 设置属性
         * @extends egret.gui.OverrideBase
         */
        var SetStyle = (function (_super) {
            __extends(SetStyle, _super);
            /**
             * 构造函数
             * @method egret.gui.SetProperty#constructor
             */
            function SetStyle(target, name, value) {
                _super.call(this);
                this.target = target;
                this.name = name;
                this.value = value;
            }
            /**
             * @method egret.gui.SetProperty#apply
             * @param parent {IContainer}
             */
            SetStyle.prototype.apply = function (parent) {
                var obj = this.target == null || this.target == "" ? parent : parent[this.target];
                if (obj == null)
                    return;
                this.oldValue = obj["getStyle"](this.name);
                this.setStyleValue(obj, this.name, this.value, this.oldValue);
            };
            /**
             * @method egret.gui.SetProperty#remove
             * @param parent {IContainer}
             */
            SetStyle.prototype.remove = function (parent) {
                var obj = this.target == null || this.target == "" ? parent : parent[this.target];
                if (obj == null)
                    return;
                this.setStyleValue(obj, this.name, this.oldValue, this.oldValue);
                this.oldValue = null;
            };
            /**
             * 设置属性值
             */
            SetStyle.prototype.setStyleValue = function (obj, name, value, valueForType) {
                if (value === undefined) {
                    obj["clearStyle"](name);
                }
                else if (value === null)
                    obj["setStyle"](name, value);
                else if (typeof (valueForType) == "number")
                    obj["setStyle"](name, parseFloat(value));
                else if (typeof (valueForType) == "boolean")
                    obj["setStyle"](name, this.toBoolean(value));
                else
                    obj["setStyle"](name, value);
            };
            /**
             * 转成Boolean值
             */
            SetStyle.prototype.toBoolean = function (value) {
                if (typeof (value) == "string")
                    return value.toLowerCase() == "true";
                return value != false;
            };
            return SetStyle;
        })(gui.OverrideBase);
        gui.SetStyle = SetStyle;
        SetStyle.prototype.__class__ = "egret.gui.SetStyle";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.State
         * @classdesc
         * State 类定义视图状态，即组件的特定视图。
         * @extends egret.HashObject
         */
        var State = (function (_super) {
            __extends(State, _super);
            /**
             * @method egret.gui.State#constructor
             * @param properties {any}
             */
            function State(name, overrides) {
                _super.call(this);
                /**
                 * 已经初始化标志
                 */
                this.initialized = false;
                this.name = name;
                this.overrides = overrides;
            }
            /**
             * 初始化视图
             * @method egret.gui.State#initialize
             * @param parent {IStateClient}
             */
            State.prototype.initialize = function (parent) {
                if (!this.initialized) {
                    this.initialized = true;
                    for (var i = 0; i < this.overrides.length; i++) {
                        (this.overrides[i]).initialize(parent);
                    }
                }
            };
            return State;
        })(egret.HashObject);
        gui.State = State;
        State.prototype.__class__ = "egret.gui.State";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        var rectangleCache = {};
        /**
         * 返回字符串所对应的全局唯一Rectangle对象。此方法主要为了减少scale9Grid属性的实例个数。
         * 参数的相同的九宫格数据使用此方法可以全局共享同一个Rectangle对象。
         * @param value {string} 以字符串形式表示Rectangle构造函数的四个参数:x，y，width，height。例如："7,7,46,46"。
         * @returns {string} 字符串对应的Rectangle实例。
         */
        function getScale9Grid(value) {
            if (rectangleCache[value]) {
                return rectangleCache[value];
            }
            if (!value) {
                return null;
            }
            var arr = value.split(",");
            var rect = new egret.Rectangle(parseInt(arr[0]), parseInt(arr[1]), parseInt(arr[2]), parseInt(arr[3]));
            rectangleCache[value] = rect;
            return rect;
        }
        gui.getScale9Grid = getScale9Grid;
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * 设置键值对的简便方法。此方法仅供exmlc编译器内部使用。
         */
        function setProperties(target, keys, values) {
            var length = keys.length;
            for (var i = 0; i < length; i++) {
                var key = keys[i];
                target[key] = values[i];
            }
            return target;
        }
        gui.setProperties = setProperties;
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.UIAsset
         * @classdesc
         * 素材包装器。<p/>
         * 注意：UIAsset仅在添content时测量一次初始尺寸， 请不要在外部直接修改content尺寸，
         * 若做了引起content尺寸发生变化的操作, 需手动调用UIAsset的invalidateSize()进行重新测量。
         * @extends egret.gui.UIComponent
         * @implements egret.gui.ISkinnableClient
         */
        var UIAsset = (function (_super) {
            __extends(UIAsset, _super);
            /**
             * @method egret.gui.UIAsset#constructor
             * @param source {any} 素材标识符
             */
            function UIAsset(source, autoScale) {
                if (autoScale === void 0) { autoScale = true; }
                _super.call(this);
                /**
                 * 确定位图填充尺寸的方式。默认值：BitmapFillMode.SCALE。
                 * 设置为 BitmapFillMode.REPEAT时，位图将重复以填充区域。
                 * 设置为 BitmapFillMode.SCALE时，位图将拉伸以填充区域。
                 * 注意:此属性仅在source的解析结果为Texture时有效
                 * @member {egret.Texture} egret.gui.UIAsset#fillMode
                 */
                this.fillMode = "scale";
                this.sourceChanged = false;
                this.createChildrenCalled = false;
                this.contentReused = false;
                /**
                 * 是自动否缩放content对象，以符合UIAsset的尺寸。默认值true。
                 */
                this.autoScale = true;
                this.touchChildren = false;
                if (source) {
                    this.source = source;
                }
                this.autoScale = autoScale;
            }
            Object.defineProperty(UIAsset.prototype, "source", {
                /**
                 * 素材标识符。可以为Class,String,或DisplayObject实例等任意类型，具体规则由项目注入的素材适配器决定，
                 * 适配器根据此属性值解析获取对应的显示对象，并赋值给content属性。
                 * @member egret.gui.UIAsset#source
                 */
                get: function () {
                    return this._source;
                },
                set: function (value) {
                    if (this._source == value)
                        return;
                    this._source = value;
                    if (this.createChildrenCalled) {
                        this.parseSource();
                    }
                    else {
                        this.sourceChanged = true;
                    }
                    this._setSizeDirty();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(UIAsset.prototype, "content", {
                /**
                 * 解析source得到的对象，通常为显示对象或Texture。
                 * @member egret.gui.UIAsset#content
                 */
                get: function () {
                    return this._content;
                },
                enumerable: true,
                configurable: true
            });
            /**
             */
            UIAsset.prototype.createChildren = function () {
                _super.prototype.createChildren.call(this);
                if (this.sourceChanged) {
                    this.parseSource();
                }
                this.createChildrenCalled = true;
            };
            /**
             * 解析source
             */
            UIAsset.prototype.parseSource = function () {
                this.sourceChanged = false;
                var adapter = UIAsset.assetAdapter;
                if (!adapter) {
                    adapter = this.getAdapter();
                }
                if (!this._source) {
                    this.contentChanged(null, null);
                }
                else {
                    var reuseContent = this.contentReused ? null : this._content;
                    this.contentReused = true;
                    adapter.getAsset(this._source, this.contentChanged, this, reuseContent);
                }
            };
            /**
             * 获取资源适配器
             */
            UIAsset.prototype.getAdapter = function () {
                var adapter;
                try {
                    adapter = egret.Injector.getInstance("egret.gui.IAssetAdapter");
                }
                catch (e) {
                    adapter = new gui.DefaultAssetAdapter();
                }
                UIAsset.assetAdapter = adapter;
                return adapter;
            };
            /**
             * 皮肤发生改变
             */
            UIAsset.prototype.contentChanged = function (content, source) {
                if (source !== this._source)
                    return;
                var oldContent = this._content;
                this._content = content;
                if (oldContent !== content) {
                    if (oldContent instanceof egret.DisplayObject) {
                        if (oldContent.parent == this) {
                            this._removeFromDisplayList(oldContent);
                        }
                    }
                    if (content instanceof egret.DisplayObject) {
                        this._addToDisplayListAt(content, 0);
                    }
                }
                this.invalidateSize();
                this.invalidateDisplayList();
                this.contentReused = false;
                if (this.hasEventListener(gui.UIEvent.CONTENT_CHANGED)) {
                    gui.UIEvent.dispatchUIEvent(this, gui.UIEvent.CONTENT_CHANGED);
                }
            };
            UIAsset.prototype.measure = function () {
                _super.prototype.measure.call(this);
                var content = this._content;
                if (content instanceof egret.DisplayObject) {
                    if ("preferredWidth" in content) {
                        this.measuredWidth = (content).preferredWidth;
                        this.measuredHeight = (content).preferredHeight;
                    }
                    else {
                        this.measuredWidth = content.width * content.scaleX;
                        this.measuredHeight = content.height * content.scaleY;
                    }
                }
                else if (content instanceof egret.Texture) {
                    this.measuredWidth = content._textureWidth;
                    this.measuredHeight = content._textureHeight;
                }
            };
            /**
             * @param unscaledWidth {number}
             * @param unscaledHeight {number}
             */
            UIAsset.prototype.updateDisplayList = function (unscaledWidth, unscaledHeight) {
                _super.prototype.updateDisplayList.call(this, unscaledWidth, unscaledHeight);
                var content = this._content;
                if (this.autoScale && content instanceof egret.DisplayObject) {
                    if ("setLayoutBoundsSize" in content) {
                        (content).setLayoutBoundsSize(unscaledWidth, unscaledHeight);
                    }
                    else {
                        content.width = unscaledWidth / content.scaleX;
                        content.height = unscaledHeight / content.scaleY;
                    }
                }
                this._setSizeDirty();
            };
            UIAsset.prototype._render = function (renderContext) {
                if (this._content instanceof egret.Texture) {
                    var texture = this._content;
                    this._texture_to_render = texture;
                    var w;
                    var h;
                    if (this.autoScale) {
                        w = this._width;
                        h = this._height;
                    }
                    else {
                        w = texture._textureWidth;
                        h = texture._textureHeight;
                    }
                    egret.Bitmap._drawBitmap(renderContext, w, h, this);
                }
                else {
                    this._texture_to_render = null;
                }
                _super.prototype._render.call(this, renderContext);
            };
            /**
             * @returns {Rectangle}
             * @private
             */
            UIAsset.prototype._measureBounds = function () {
                if (this._content instanceof egret.Texture) {
                    var texture = this._content;
                    var textureW = texture._textureWidth;
                    var textureH = texture._textureHeight;
                    var w = this.width;
                    var h = this.height;
                    var x = Math.floor(texture._offsetX * w / textureW);
                    var y = Math.floor(texture._offsetY * h / textureH);
                    return egret.Rectangle.identity.initialize(x, y, w, h);
                }
                return _super.prototype._measureBounds.call(this);
            };
            /**
             * @deprecated
             * @param child {DisplayObject}
             * @returns {DisplayObject}
             */
            UIAsset.prototype.addChild = function (child) {
                throw (new Error("addChild()" + UIAsset.errorStr + "addElement()代替"));
            };
            /**
             * @deprecated
             * @param child {DisplayObject}
             * @param index {number}
             * @returns {DisplayObject}
             */
            UIAsset.prototype.addChildAt = function (child, index) {
                throw (new Error("addChildAt()" + UIAsset.errorStr + "addElementAt()代替"));
            };
            /**
             * @deprecated
             * @param child {DisplayObject}
             * @returns {DisplayObject}
             */
            UIAsset.prototype.removeChild = function (child) {
                throw (new Error("removeChild()" + UIAsset.errorStr + "removeElement()代替"));
            };
            /**
             * @deprecated
             * @param index {number}
             * @returns {DisplayObject}
             */
            UIAsset.prototype.removeChildAt = function (index) {
                throw (new Error("removeChildAt()" + UIAsset.errorStr + "removeElementAt()代替"));
            };
            /**
             * @deprecated
             * @param child {DisplayObject}
             * @param index {number}
             */
            UIAsset.prototype.setChildIndex = function (child, index) {
                throw (new Error("setChildIndex()" + UIAsset.errorStr + "setElementIndex()代替"));
            };
            /**
             * @deprecated
             * @param child1 {DisplayObject}
             * @param child2 {DisplayObject}
             */
            UIAsset.prototype.swapChildren = function (child1, child2) {
                throw (new Error("swapChildren()" + UIAsset.errorStr + "swapElements()代替"));
            };
            /**
             * @deprecated
             * @param index1 {number}
             * @param index2 {number}
             */
            UIAsset.prototype.swapChildrenAt = function (index1, index2) {
                throw (new Error("swapChildrenAt()" + UIAsset.errorStr + "swapElementsAt()代替"));
            };
            UIAsset.errorStr = "在此组件中不可用，若此组件为容器类，请使用";
            return UIAsset;
        })(gui.UIComponent);
        gui.UIAsset = UIAsset;
        UIAsset.prototype.__class__ = "egret.gui.UIAsset";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.SkinnableComponent
         * @classdesc
         * 复杂可设置外观组件的基类，接受ISkin类或任何显示对象作为皮肤。
         * 当皮肤为ISkin时，将自动匹配两个实例内同名的公开属性(显示对象)，
         * 并将皮肤的属性引用赋值到此类定义的同名属性(必须没有默认值)上,
         * 如果要对公共属性添加事件监听或其他操作，
         * 请覆盖partAdded()和partRemoved()方法
         * @extends egret.gui.UIComponent
         */
        var SkinnableComponent = (function (_super) {
            __extends(SkinnableComponent, _super);
            /**
             * 构造函数
             * @method egret.gui.SkinnableComponent#constructor
             */
            function SkinnableComponent() {
                _super.call(this);
                /**
                 * 主机组件标识符。用于唯一确定一个组件的名称。
                 * 用户自定义的组件若不对此属性赋值，将会继承父级的标识符定义。
                 * @member {string} egret.gui.SkinnableComponent#hostComponentKey
                 */
                this.hostComponentKey = null;
                /**
                 * 外部显式设置了皮肤名
                 */
                this._skinNameExplicitlySet = false;
                this.createChildrenCalled = false;
                this.skinLayoutEnabled = false;
                //========================皮肤视图状态=====================start=======================
                this.stateIsDirty = false;
                this._autoMouseEnabled = true;
                /**
                 * 外部显式设置的mouseChildren属性值
                 */
                this.explicitMouseChildren = true;
                /**
                 * 外部显式设置的mouseEnabled属性值
                 */
                this.explicitMouseEnabled = true;
            }
            Object.defineProperty(SkinnableComponent.prototype, "skinName", {
                /**
                 * 皮肤标识符。可以为Class,String,或DisplayObject实例等任意类型，具体规则由项目注入的素材适配器决定，
                 * 适配器根据此属性值解析获取对应的显示对象，并赋值给skin属性。
                 * @member {string} egret.gui.SkinnableComponent#skinName
                 */
                get: function () {
                    return this._skinName;
                },
                set: function (value) {
                    if (this._skinName == value)
                        return;
                    this._skinName = value;
                    this._skinNameExplicitlySet = true;
                    if (this.createChildrenCalled) {
                        this.parseSkinName();
                    }
                },
                enumerable: true,
                configurable: true
            });
            /**
             * @method egret.gui.SkinnableComponent#createChildren
             */
            SkinnableComponent.prototype.createChildren = function () {
                _super.prototype.createChildren.call(this);
                this.parseSkinName();
                this.createChildrenCalled = true;
            };
            /**
             * 解析skinName
             */
            SkinnableComponent.prototype.parseSkinName = function () {
                var adapter = SkinnableComponent.skinAdapter;
                if (!adapter) {
                    adapter = this.getSkinAdapter();
                }
                var key = this.hostComponentKey || egret.getQualifiedClassName(this);
                var skin = adapter.getSkin(this._skinName, key);
                if (!skin) {
                    var theme = SkinnableComponent._defaultTheme;
                    if (theme) {
                        skin = theme.getDefaultSkin(this);
                    }
                }
                this._setSkin(skin);
            };
            /**
             * 获取皮肤适配器
             */
            SkinnableComponent.prototype.getSkinAdapter = function () {
                var adapter;
                try {
                    adapter = egret.Injector.getInstance("egret.gui.ISkinAdapter");
                }
                catch (e) {
                    adapter = new gui.DefaultSkinAdapter();
                }
                SkinnableComponent.skinAdapter = adapter;
                return adapter;
            };
            Object.defineProperty(SkinnableComponent.prototype, "skin", {
                /**
                 * 皮肤对象实例。
                 * @member egret.gui.SkinnableComponent#skin
                 */
                get: function () {
                    return this._skin;
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 设置皮肤
             */
            SkinnableComponent.prototype._setSkin = function (skin) {
                var oldSkin = this._skin;
                this.detachSkin(oldSkin);
                if (oldSkin instanceof egret.DisplayObject) {
                    this._removeFromDisplayList(oldSkin);
                }
                this._skin = skin;
                if (skin instanceof egret.DisplayObject) {
                    this._addToDisplayListAt(this._skin, 0);
                }
                this.attachSkin(skin);
                this.invalidateSkinState();
                this.invalidateSize();
                this.invalidateDisplayList();
                if (this.hasEventListener(gui.UIEvent.SKIN_CHANGED)) {
                    gui.UIEvent.dispatchUIEvent(this, gui.UIEvent.SKIN_CHANGED);
                }
            };
            /**
             * 附加皮肤
             * @method egret.gui.SkinnableComponent#attachSkin
             * @param skin {any}
             */
            SkinnableComponent.prototype.attachSkin = function (skin) {
                if (skin && "hostComponent" in skin) {
                    var newSkin = skin;
                    newSkin.hostComponent = this;
                    this.findSkinParts();
                }
                if (skin && !(skin instanceof egret.DisplayObject))
                    this.skinLayoutEnabled = true;
                else
                    this.skinLayoutEnabled = false;
            };
            /**
             * 匹配皮肤和主机组件的公共变量，并完成实例的注入。此方法在附加皮肤时会自动执行一次。
             * 若皮肤中含有延迟实例化的子部件，在子部件实例化完成时需要从外部再次调用此方法,完成注入。
             * @method egret.gui.SkinnableComponent#findSkinParts
             */
            SkinnableComponent.prototype.findSkinParts = function () {
                var skin = this._skin;
                if (skin && "skinParts" in skin) {
                    var skinParts = skin.skinParts;
                    var length = skinParts.length;
                    for (var i = 0; i < length; i++) {
                        var partName = skinParts[i];
                        if ((partName in skin)) {
                            try {
                                this[partName] = skin[partName];
                                this.partAdded(partName, skin[partName]);
                            }
                            catch (e) {
                            }
                        }
                    }
                }
            };
            /**
             * 卸载皮肤
             * @method egret.gui.SkinnableComponent#detachSkin
             * @param skin {any}
             */
            SkinnableComponent.prototype.detachSkin = function (skin) {
                if (skin && "skinParts" in skin) {
                    var skinParts = skin.skinParts;
                    var length = skinParts.length;
                    for (var i = 0; i < length; i++) {
                        var partName = skinParts[i];
                        if (!(partName in this))
                            continue;
                        if (this[partName] != null) {
                            this.partRemoved(partName, this[partName]);
                        }
                        this[partName] = null;
                    }
                    skin.hostComponent = null;
                }
            };
            /**
             * 若皮肤是ISkin,则调用此方法附加皮肤中的公共部件
             * @method egret.gui.SkinnableComponent#partAdded
             * @param partName {string}
             * @param instance {any}
             */
            SkinnableComponent.prototype.partAdded = function (partName, instance) {
                gui.SkinPartEvent.dispatchSkinPartEvent(this, gui.SkinPartEvent.PART_ADDED, partName, instance);
            };
            /**
             * 若皮肤是ISkin，则调用此方法卸载皮肤之前注入的公共部件
             * @method egret.gui.SkinnableComponent#partRemoved
             * @param partName {string}
             * @param instance {any}
             */
            SkinnableComponent.prototype.partRemoved = function (partName, instance) {
                gui.SkinPartEvent.dispatchSkinPartEvent(this, gui.SkinPartEvent.PART_REMOVED, partName, instance);
            };
            /**
             * 标记当前需要重新验证皮肤状态
             * @method egret.gui.SkinnableComponent#invalidateSkinState
             */
            SkinnableComponent.prototype.invalidateSkinState = function () {
                if (this.stateIsDirty)
                    return;
                this.stateIsDirty = true;
                this.invalidateProperties();
            };
            /**
             * 子类覆盖此方法,应用当前的皮肤状态
             * @method egret.gui.SkinnableComponent#validateSkinState
             */
            SkinnableComponent.prototype.validateSkinState = function () {
                var curState = this.getCurrentSkinState();
                var skin = this._skin;
                if (skin && "currentState" in skin) {
                    skin.currentState = curState;
                }
                if (this.hasEventListener("stateChanged"))
                    this.dispatchEventWith("stateChanged");
            };
            Object.defineProperty(SkinnableComponent.prototype, "autoTouchEnabled", {
                /**
                 * 在enabled属性发生改变时是否自动开启或禁用鼠标事件的响应。默认值为true。
                 * @member egret.gui.SkinnableComponent#autoTouchEnabled
                 */
                get: function () {
                    return this._autoMouseEnabled;
                },
                set: function (value) {
                    if (this._autoMouseEnabled == value)
                        return;
                    this._autoMouseEnabled = value;
                    if (this._autoMouseEnabled) {
                        this._touchChildren = this.enabled ? this.explicitMouseChildren : false;
                        this._touchEnabled = this.enabled ? this.explicitMouseEnabled : false;
                    }
                    else {
                        this._touchChildren = this.explicitMouseChildren;
                        this._touchEnabled = this.explicitMouseEnabled;
                    }
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(SkinnableComponent.prototype, "touchChildren", {
                /**
                 * @member egret.gui.SkinnableComponent#touchChildren
                 */
                get: function () {
                    return this._touchChildren;
                },
                /**
                 * @inheritDoc
                 */
                set: function (value) {
                    if (this.enabled)
                        this._touchChildren = value;
                    this.explicitMouseChildren = value;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(SkinnableComponent.prototype, "touchEnabled", {
                /**
                 * @member egret.gui.SkinnableComponent#touchEnabled
                 */
                get: function () {
                    return this._touchEnabled;
                },
                /**
                 * @inheritDoc
                 */
                set: function (value) {
                    if (this.enabled)
                        this._touchEnabled = value;
                    this.explicitMouseEnabled = value;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(SkinnableComponent.prototype, "enabled", {
                /**
                 * @member egret.gui.SkinnableComponent#enabled
                 */
                get: function () {
                    return this._enabled;
                },
                /**
                 * @inheritDoc
                 */
                set: function (value) {
                    this._setEnabled(value);
                },
                enumerable: true,
                configurable: true
            });
            SkinnableComponent.prototype._setEnabled = function (value) {
                if (this._enabled == value)
                    return;
                this._enabled = value;
                if (this._autoMouseEnabled) {
                    this._touchChildren = value ? this.explicitMouseChildren : false;
                    this._touchEnabled = value ? this.explicitMouseEnabled : false;
                }
                this.invalidateSkinState();
            };
            /**
             * 返回组件当前的皮肤状态名称,子类覆盖此方法定义各种状态名
             * @method egret.gui.SkinnableComponent#getCurrentSkinState
             * @returns {string}
             */
            SkinnableComponent.prototype.getCurrentSkinState = function () {
                return this.enabled ? "normal" : "disabled";
            };
            //========================皮肤视图状态===================end========================
            /**
             * @method egret.gui.SkinnableComponent#commitProperties
             */
            SkinnableComponent.prototype.commitProperties = function () {
                _super.prototype.commitProperties.call(this);
                if (this.stateIsDirty) {
                    this.stateIsDirty = false;
                    this.validateSkinState();
                }
            };
            SkinnableComponent.prototype._childXYChanged = function () {
                if (this.skinLayoutEnabled) {
                    this.invalidateSize();
                    this.invalidateDisplayList();
                }
            };
            SkinnableComponent.prototype.measure = function () {
                _super.prototype.measure.call(this);
                var skin = this._skin;
                if (!skin)
                    return;
                if (this.skinLayoutEnabled) {
                    skin.measure();
                    this.measuredWidth = skin.preferredWidth;
                    this.measuredHeight = skin.preferredHeight;
                }
                else {
                    if ("preferredWidth" in skin) {
                        this.measuredWidth = skin.preferredWidth;
                        this.measuredHeight = skin.preferredHeight;
                    }
                    else {
                        this.measuredWidth = skin.width;
                        this.measuredHeight = skin.height;
                    }
                }
            };
            /**
             * @method egret.gui.SkinnableComponent#updateDisplayList
             * @param unscaledWidth {number}
             * @param unscaledHeight {number}
             */
            SkinnableComponent.prototype.updateDisplayList = function (unscaledWidth, unscaledHeight) {
                _super.prototype.updateDisplayList.call(this, unscaledWidth, unscaledHeight);
                var skin = this._skin;
                if (skin) {
                    if (this.skinLayoutEnabled) {
                        skin.updateDisplayList(unscaledWidth, unscaledHeight);
                    }
                    else if ("setLayoutBoundsSize" in skin) {
                        (skin).setLayoutBoundsSize(unscaledWidth, unscaledHeight);
                    }
                    else if (skin instanceof egret.DisplayObject) {
                        skin.scaleX = skin.width == 0 ? 1 : unscaledWidth / skin.width;
                        skin.scaleY = skin.height == 0 ? 1 : unscaledHeight / skin.height;
                    }
                }
            };
            /**
             * @method egret.gui.SkinnableComponent#addChild
             * @deprecated
             * @param child {DisplayObject}
             * @returns {DisplayObject}
             */
            SkinnableComponent.prototype.addChild = function (child) {
                throw (new Error("addChild()" + SkinnableComponent.errorStr + "addElement()代替"));
            };
            /**
             * @method egret.gui.SkinnableComponent#addChildAt
             * @deprecated
             * @param child {DisplayObject}
             * @param index {number}
             * @returns {DisplayObject}
             */
            SkinnableComponent.prototype.addChildAt = function (child, index) {
                throw (new Error("addChildAt()" + SkinnableComponent.errorStr + "addElementAt()代替"));
            };
            /**
             * @method egret.gui.SkinnableComponent#removeChild
             * @deprecated
             * @param child {DisplayObject}
             * @returns {DisplayObject}
             */
            SkinnableComponent.prototype.removeChild = function (child) {
                throw (new Error("removeChild()" + SkinnableComponent.errorStr + "removeElement()代替"));
            };
            /**
             * @method egret.gui.SkinnableComponent#removeChildAt
             * @deprecated
             * @param index {number}
             * @returns {DisplayObject}
             */
            SkinnableComponent.prototype.removeChildAt = function (index) {
                throw (new Error("removeChildAt()" + SkinnableComponent.errorStr + "removeElementAt()代替"));
            };
            /**
             * @method egret.gui.SkinnableComponent#setChildIndex
             * @deprecated
             * @param child {DisplayObject}
             * @param index {number}
             */
            SkinnableComponent.prototype.setChildIndex = function (child, index) {
                throw (new Error("setChildIndex()" + SkinnableComponent.errorStr + "setElementIndex()代替"));
            };
            /**
             * @method egret.gui.SkinnableComponent#swapChildren
             * @deprecated
             * @param child1 {DisplayObject}
             * @param child2 {DisplayObject}
             */
            SkinnableComponent.prototype.swapChildren = function (child1, child2) {
                throw (new Error("swapChildren()" + SkinnableComponent.errorStr + "swapElements()代替"));
            };
            /**
             * @method egret.gui.SkinnableComponent#swapChildrenAt
             * @deprecated
             * @param index1 {number}
             * @param index2 {number}
             */
            SkinnableComponent.prototype.swapChildrenAt = function (index1, index2) {
                throw (new Error("swapChildrenAt()" + SkinnableComponent.errorStr + "swapElementsAt()代替"));
            };
            SkinnableComponent.errorStr = "在此组件中不可用，若此组件为容器类，请使用";
            return SkinnableComponent;
        })(gui.UIComponent);
        gui.SkinnableComponent = SkinnableComponent;
        SkinnableComponent.prototype.__class__ = "egret.gui.SkinnableComponent";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.DefaultSkinAdapter
         * @classdesc
         * 默认的ISkinAdapter接口实现
         * @implements egret.gui.ISkinAdapter
         */
        var DefaultSkinAdapter = (function () {
            /**
             * 构造函数
             * @method egret.gui.DefaultSkinAdapter#constructor
             */
            function DefaultSkinAdapter() {
            }
            /**
             * 获取皮肤显示对象
             * @method egret.gui.ISkinAdapter#getSkin
             * @param skinName {any} 待解析的皮肤标识符
             * @param hostComponentKey {string} 主机组件标识符
             * @returns {any} 皮肤对象实例
             */
            DefaultSkinAdapter.prototype.getSkin = function (skinName, hostComponentKey) {
                if (!skinName)
                    return null;
                if (skinName.prototype) {
                    return new skinName();
                }
                else if (typeof (skinName) == "string") {
                    var clazz = egret.getDefinitionByName(skinName);
                    if (clazz) {
                        return new clazz();
                    }
                    else {
                        return null;
                    }
                }
                else {
                    return skinName;
                }
            };
            return DefaultSkinAdapter;
        })();
        gui.DefaultSkinAdapter = DefaultSkinAdapter;
        DefaultSkinAdapter.prototype.__class__ = "egret.gui.DefaultSkinAdapter";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.DefaultAssetAdapter
         * @classdesc
         * 默认的IAssetAdapter接口实现
         * @implements egret.gui.IAssetAdapter
         */
        var DefaultAssetAdapter = (function () {
            /**
             * 构造函数
             * @method egret.gui.DefaultSkinAdapter#constructor
             */
            function DefaultAssetAdapter() {
            }
            /**
             * 解析素材
             * @method egret.gui.DefaultAssetAdapter#getAsset
             * @param source {any} 待解析的新素材标识符
             * @param compFunc {Function} 解析完成回调函数，示例：compFunc(content:any,source:any):void;
             * 回调参数content接受两种类型：DisplayObject或Texture。
             * @param thisObject {any} compFunc的this引用
             * @param oldContent any 旧的内容对象,传入值有可能为null。
             * 对于某些类型素材，例如MovieClip，可以重用传入的显示对象,只修改其数据再返回。
             */
            DefaultAssetAdapter.prototype.getAsset = function (source, compFunc, thisObject, oldContent) {
                var content = source;
                if (source.prototype) {
                    content = new source();
                }
                if (content instanceof egret.DisplayObject || content instanceof egret.Texture) {
                    compFunc.call(thisObject, content, source);
                }
                else if (typeof (source) == "string") {
                    var url = source;
                    var loader = new egret.URLLoader();
                    loader.dataFormat = egret.URLLoaderDataFormat.TEXTURE;
                    loader.addEventListener(egret.Event.COMPLETE, function (event) {
                        content = loader.data;
                        compFunc.call(thisObject, content, source);
                    }, this);
                    loader.load(new egret.URLRequest(url));
                }
                else {
                    compFunc.call(thisObject, content, source);
                }
            };
            return DefaultAssetAdapter;
        })();
        gui.DefaultAssetAdapter = DefaultAssetAdapter;
        DefaultAssetAdapter.prototype.__class__ = "egret.gui.DefaultAssetAdapter";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        var Theme = (function () {
            /**
             * 构造函数
             * @method egret.gui.PopUpManager#constructor
             */
            function Theme(configURL) {
                this.delyList = [];
                this.loadConfig(configURL);
            }
            Theme.load = function (configURL) {
                if (this.initialized) {
                    return;
                }
                this.initialized = true;
                gui.SkinnableComponent._defaultTheme = new Theme(configURL);
            };
            Theme.prototype.loadConfig = function (configURL) {
                var loader = new egret.URLLoader();
                loader.addEventListener(egret.Event.COMPLETE, this.onLoadComplete, this);
                loader.addEventListener(egret.IOErrorEvent.IO_ERROR, this.onLoadError, this);
                loader.dataFormat = egret.URLLoaderDataFormat.TEXT;
                loader.load(new egret.URLRequest(configURL));
            };
            Theme.prototype.onLoadComplete = function (event) {
                var loader = (event.target);
                try {
                    var str = loader.data;
                    var data = JSON.parse(str);
                    this.skinMap = data.skins;
                }
                catch (e) {
                    egret.Logger.warning("JSON文件格式不正确: " + loader._request.url + "\ndata:" + loader.data);
                }
                this.handleDelyList();
            };
            Theme.prototype.onLoadError = function (event) {
                var loader = (event.target);
                egret.Logger.warning("主题配置文件加载失败: " + loader._request.url);
                this.handleDelyList();
            };
            Theme.prototype.handleDelyList = function () {
                if (!this.skinMap) {
                    this.skinMap = {};
                    this.delyList = [];
                    return;
                }
                var list = this.delyList;
                this.delyList = [];
                var length = list.length;
                for (var i = 0; i < length; i++) {
                    var client = list[i];
                    if (!client._skin) {
                        var skin = this.getDefaultSkin(client);
                        client._setSkin(skin);
                    }
                }
            };
            Theme.prototype.getDefaultSkin = function (client) {
                var skinMap = this.skinMap;
                if (!skinMap) {
                    if (this.delyList.indexOf(client) == -1) {
                        this.delyList.push(client);
                    }
                    return null;
                }
                var skinName;
                var hostKey = client.hostComponentKey;
                if (hostKey) {
                    skinName = skinMap[hostKey];
                }
                else {
                    var superClass = client;
                    while (superClass) {
                        hostKey = egret.getQualifiedClassName(superClass);
                        skinName = skinMap[hostKey];
                        if (skinName) {
                            break;
                        }
                        superClass = egret.getDefinitionByName(egret.getQualifiedSuperclassName(superClass));
                    }
                }
                if (!skinName) {
                    return null;
                }
                var skinClass = egret.getDefinitionByName(skinName);
                if (!skinClass) {
                    egret.Logger.warning("找不到主题中所配置的皮肤类名: " + skinName);
                    return null;
                }
                return new skinClass();
            };
            Theme.initialized = false;
            return Theme;
        })();
        gui.Theme = Theme;
        Theme.prototype.__class__ = "egret.gui.Theme";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.SkinBasicLayout
         * @classdesc
         * 皮肤简单布局类。
         * @extends egret.HashObject
         */
        var SkinBasicLayout = (function (_super) {
            __extends(SkinBasicLayout, _super);
            /**
             * @method egret.gui.SkinBasicLayout#constructor
             */
            function SkinBasicLayout() {
                _super.call(this);
            }
            Object.defineProperty(SkinBasicLayout.prototype, "target", {
                /**
                 * 目标布局对象
                 * @member egret.gui.SkinBasicLayout#target
                 */
                get: function () {
                    return this._target;
                },
                set: function (value) {
                    this._target = value;
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 测量组件尺寸大小
             * @method egret.gui.SkinBasicLayout#measure
             */
            SkinBasicLayout.prototype.measure = function () {
                if (this.target == null)
                    return;
                var measureW = 0;
                var measureH = 0;
                var target = this._target;
                var count = target.numElements;
                for (var i = 0; i < count; i++) {
                    var layoutElement = target.getElementAt(i);
                    if (!layoutElement || !layoutElement.includeInLayout)
                        continue;
                    var hCenter = layoutElement.horizontalCenter;
                    var vCenter = layoutElement.verticalCenter;
                    var left = layoutElement.left;
                    var right = layoutElement.right;
                    var top = layoutElement.top;
                    var bottom = layoutElement.bottom;
                    var extX;
                    var extY;
                    if (!isNaN(left) && !isNaN(right)) {
                        extX = left + right;
                    }
                    else if (!isNaN(hCenter)) {
                        extX = Math.abs(hCenter) * 2;
                    }
                    else if (!isNaN(left) || !isNaN(right)) {
                        extX = isNaN(left) ? 0 : left;
                        extX += isNaN(right) ? 0 : right;
                    }
                    else {
                        extX = layoutElement.preferredX;
                    }
                    if (!isNaN(top) && !isNaN(bottom)) {
                        extY = top + bottom;
                    }
                    else if (!isNaN(vCenter)) {
                        extY = Math.abs(vCenter) * 2;
                    }
                    else if (!isNaN(top) || !isNaN(bottom)) {
                        extY = isNaN(top) ? 0 : top;
                        extY += isNaN(bottom) ? 0 : bottom;
                    }
                    else {
                        extY = layoutElement.preferredY;
                    }
                    var preferredWidth = layoutElement.preferredWidth;
                    var preferredHeight = layoutElement.preferredHeight;
                    measureW = Math.ceil(Math.max(measureW, extX + preferredWidth));
                    measureH = Math.ceil(Math.max(measureH, extY + preferredHeight));
                }
                this.target.measuredWidth = measureW;
                this.target.measuredHeight = measureH;
            };
            /**
             * 更新显示列表
             * @method egret.gui.SkinBasicLayout#updateDisplayList
             * @param unscaledWidth {number}
             * @param unscaledHeight {number}
             */
            SkinBasicLayout.prototype.updateDisplayList = function (unscaledWidth, unscaledHeight) {
                if (this.target == null)
                    return;
                var count = this.target.numElements;
                for (var i = 0; i < count; i++) {
                    var layoutElement = this.target.getElementAt(i);
                    if (layoutElement == null || !layoutElement.includeInLayout)
                        continue;
                    var hCenter = layoutElement.horizontalCenter;
                    var vCenter = layoutElement.verticalCenter;
                    var left = layoutElement.left;
                    var right = layoutElement.right;
                    var top = layoutElement.top;
                    var bottom = layoutElement.bottom;
                    var percentWidth = layoutElement.percentWidth;
                    var percentHeight = layoutElement.percentHeight;
                    var childWidth = NaN;
                    var childHeight = NaN;
                    if (!isNaN(left) && !isNaN(right)) {
                        childWidth = unscaledWidth - right - left;
                    }
                    else if (!isNaN(percentWidth)) {
                        childWidth = Math.round(unscaledWidth * Math.min(percentWidth * 0.01, 1));
                    }
                    if (!isNaN(top) && !isNaN(bottom)) {
                        childHeight = unscaledHeight - bottom - top;
                    }
                    else if (!isNaN(percentHeight)) {
                        childHeight = Math.round(unscaledHeight * Math.min(percentHeight * 0.01, 1));
                    }
                    layoutElement.setLayoutBoundsSize(childWidth, childHeight);
                    var elementWidth = layoutElement.layoutBoundsWidth;
                    var elementHeight = layoutElement.layoutBoundsHeight;
                    var childX = NaN;
                    var childY = NaN;
                    if (!isNaN(hCenter))
                        childX = Math.round((unscaledWidth - elementWidth) / 2 + hCenter);
                    else if (!isNaN(left))
                        childX = left;
                    else if (!isNaN(right))
                        childX = unscaledWidth - elementWidth - right;
                    else
                        childX = layoutElement.layoutBoundsX;
                    if (!isNaN(vCenter))
                        childY = Math.round((unscaledHeight - elementHeight) / 2 + vCenter);
                    else if (!isNaN(top))
                        childY = top;
                    else if (!isNaN(bottom))
                        childY = unscaledHeight - elementHeight - bottom;
                    else
                        childY = layoutElement.layoutBoundsY;
                    layoutElement.setLayoutBoundsPosition(childX, childY);
                }
            };
            return SkinBasicLayout;
        })(egret.HashObject);
        gui.SkinBasicLayout = SkinBasicLayout;
        SkinBasicLayout.prototype.__class__ = "egret.gui.SkinBasicLayout";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.ButtonBase
         * @classdesc
         * 按钮组件基类
         * @extends egret.gui.SkinnableComponent
         */
        var ButtonBase = (function (_super) {
            __extends(ButtonBase, _super);
            /**
             * 构造函数
             * @method egret.gui.ButtonBase#constructor
             */
            function ButtonBase() {
                _super.call(this);
                /**
                 * 已经开始过不断抛出buttonDown事件的标志
                 */
                this._downEventFired = false;
                this._autoRepeat = false;
                this._repeatDelay = 35;
                this._repeatInterval = 35;
                this._hovered = false;
                this._keepDown = false;
                this._label = "";
                this._mouseCaptured = false;
                this._stickyHighlighting = false;
                this.touchChildren = false;
                this.addHandlers();
            }
            Object.defineProperty(ButtonBase.prototype, "autoRepeat", {
                /**
                 * 指定在用户按住鼠标按键时是否重复分派 buttonDown 事件。
                 * @member egret.gui.ButtonBase#autoRepeat
                 */
                get: function () {
                    return this._autoRepeat;
                },
                set: function (value) {
                    if (value == this._autoRepeat)
                        return;
                    this._autoRepeat = value;
                    this.checkAutoRepeatTimerConditions(this.isDown());
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(ButtonBase.prototype, "repeatDelay", {
                /**
                 * 在第一个 buttonDown 事件之后，以及相隔每个 repeatInterval 重复一次 buttonDown 事件之前，需要等待的毫秒数。
                 * @member egret.gui.ButtonBase#repeatDelay
                 */
                get: function () {
                    return this._repeatDelay;
                },
                set: function (value) {
                    this._repeatDelay = value;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(ButtonBase.prototype, "repeatInterval", {
                /**
                 * 用户在按钮上按住鼠标时，buttonDown 事件之间相隔的毫秒数。
                 * @member egret.gui.ButtonBase#repeatInterval
                 */
                get: function () {
                    return this._repeatInterval;
                },
                set: function (value) {
                    this._repeatInterval = value;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(ButtonBase.prototype, "hovered", {
                /**
                 * 指示鼠标指针是否位于按钮上。
                 * @member egret.gui.ButtonBase#hovered
                 */
                get: function () {
                    return this._hovered;
                },
                set: function (value) {
                    if (value == this._hovered)
                        return;
                    this._hovered = value;
                    this.invalidateSkinState();
                    this.checkButtonDownConditions();
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 强制让按钮停在鼠标按下状态,此方法不会导致重复抛出buttonDown事件,仅影响皮肤State。
             * @method egret.gui.ButtonBase#_keepDown
             * @param down {boolean} 是否按下
             */
            ButtonBase.prototype._setKeepDown = function (down) {
                if (this._keepDown == down)
                    return;
                this._keepDown = down;
                this.invalidateSkinState();
            };
            Object.defineProperty(ButtonBase.prototype, "label", {
                /**
                 * 要在按钮上显示的文本
                 * @member egret.gui.ButtonBase#label
                 */
                get: function () {
                    return this._getLabel();
                },
                set: function (value) {
                    this._setLabel(value);
                },
                enumerable: true,
                configurable: true
            });
            ButtonBase.prototype._getLabel = function () {
                if (this.labelDisplay) {
                    return this.labelDisplay.text;
                }
                else {
                    return this._label;
                }
            };
            ButtonBase.prototype._setLabel = function (value) {
                this._label = value;
                if (this.labelDisplay) {
                    this.labelDisplay.text = value;
                }
            };
            Object.defineProperty(ButtonBase.prototype, "mouseCaptured", {
                /**
                 * 指示第一次分派 MouseEvent.MOUSE_DOWN 时，是否按下鼠标以及鼠标指针是否在按钮上。
                 * @member egret.gui.ButtonBase#mouseCaptured
                 */
                get: function () {
                    return this._mouseCaptured;
                },
                set: function (value) {
                    if (value == this._mouseCaptured)
                        return;
                    this._mouseCaptured = value;
                    this.invalidateSkinState();
                    if (!value)
                        this.removeStageMouseHandlers();
                    this.checkButtonDownConditions();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(ButtonBase.prototype, "stickyHighlighting", {
                /**
                 * 如果为 false，则按钮会在用户按下它时显示其鼠标按下时的外观，但在用户将鼠标拖离它时将改为显示鼠标经过的外观。
                 * 如果为 true，则按钮会在用户按下它时显示其鼠标按下时的外观，并在用户将鼠标拖离时继续显示此外观。
                 * @member egret.gui.ButtonBase#stickyHighlighting
                 */
                get: function () {
                    return this._stickyHighlighting;
                },
                set: function (value) {
                    if (value == this._stickyHighlighting)
                        return;
                    this._stickyHighlighting = value;
                    this.invalidateSkinState();
                    this.checkButtonDownConditions();
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 开始抛出buttonDown事件
             */
            ButtonBase.prototype.checkButtonDownConditions = function () {
                var isCurrentlyDown = this.isDown();
                if (this._downEventFired != isCurrentlyDown) {
                    if (isCurrentlyDown) {
                        gui.UIEvent.dispatchUIEvent(this, gui.UIEvent.BUTTON_DOWN);
                    }
                    this._downEventFired = isCurrentlyDown;
                    this.checkAutoRepeatTimerConditions(isCurrentlyDown);
                }
            };
            /**
             * 添加鼠标事件监听
             * @method egret.gui.ButtonBase#addHandlers
             */
            ButtonBase.prototype.addHandlers = function () {
                this.addEventListener(egret.TouchEvent.TOUCH_ROLL_OVER, this.mouseEventHandler, this);
                this.addEventListener(egret.TouchEvent.TOUCH_ROLL_OUT, this.mouseEventHandler, this);
                this.addEventListener(egret.TouchEvent.TOUCH_BEGIN, this.mouseEventHandler, this);
                this.addEventListener(egret.TouchEvent.TOUCH_END, this.mouseEventHandler, this);
                this.addEventListener(egret.TouchEvent.TOUCH_TAP, this.mouseEventHandler, this);
            };
            /**
             * 添加舞台鼠标弹起事件监听
             */
            ButtonBase.prototype.addStageMouseHandlers = function () {
                gui.UIGlobals.stage.addEventListener(egret.TouchEvent.TOUCH_END, this.stage_mouseUpHandler, this);
                gui.UIGlobals.stage.addEventListener(egret.Event.LEAVE_STAGE, this.stage_mouseUpHandler, this);
            };
            /**
             * 移除舞台鼠标弹起事件监听
             */
            ButtonBase.prototype.removeStageMouseHandlers = function () {
                gui.UIGlobals.stage.removeEventListener(egret.TouchEvent.TOUCH_END, this.stage_mouseUpHandler, this);
                gui.UIGlobals.stage.removeEventListener(egret.Event.LEAVE_STAGE, this.stage_mouseUpHandler, this);
            };
            /**
             * 按钮是否是按下的状态
             */
            ButtonBase.prototype.isDown = function () {
                if (!this.enabled)
                    return false;
                if (this.mouseCaptured && (this.hovered || this.stickyHighlighting))
                    return true;
                return false;
            };
            /**
             * 检查需要启用还是关闭重发计时器
             */
            ButtonBase.prototype.checkAutoRepeatTimerConditions = function (buttonDown) {
                var needsTimer = this.autoRepeat && buttonDown;
                var hasTimer = this.autoRepeatTimer != null;
                if (needsTimer == hasTimer)
                    return;
                if (needsTimer)
                    this.startTimer();
                else
                    this.stopTimer();
            };
            /**
             * 启动重发计时器
             */
            ButtonBase.prototype.startTimer = function () {
                this.autoRepeatTimer = new egret.Timer(1);
                this.autoRepeatTimer.delay = this._repeatDelay;
                this.autoRepeatTimer.addEventListener(egret.TimerEvent.TIMER, this.autoRepeat_timerDelayHandler, this);
                this.autoRepeatTimer.start();
            };
            /**
             * 停止重发计时器
             */
            ButtonBase.prototype.stopTimer = function () {
                this.autoRepeatTimer.stop();
                this.autoRepeatTimer = null;
            };
            /**
             * 鼠标事件处理
             * @method egret.gui.ButtonBase#mouseEventHandler
             * @param event {Event}
             */
            ButtonBase.prototype.mouseEventHandler = function (event) {
                var touchEvent = event;
                switch (event.type) {
                    case egret.TouchEvent.TOUCH_ROLL_OVER:
                        {
                            if (touchEvent.touchDown && !this.mouseCaptured)
                                return;
                            this.hovered = true;
                            break;
                        }
                    case egret.TouchEvent.TOUCH_ROLL_OUT:
                        {
                            this.hovered = false;
                            break;
                        }
                    case egret.TouchEvent.TOUCH_BEGIN:
                        {
                            this.addStageMouseHandlers();
                            if (egret.InteractionMode.mode == egret.InteractionMode.TOUCH)
                                this.hovered = true;
                            this.mouseCaptured = true;
                            break;
                        }
                    case egret.TouchEvent.TOUCH_END:
                        {
                            if (event.target == this) {
                                this.hovered = true;
                                if (this.mouseCaptured) {
                                    this.buttonReleased();
                                    this.mouseCaptured = false;
                                }
                            }
                            break;
                        }
                    case egret.TouchEvent.TOUCH_TAP:
                        {
                            if (!this.enabled)
                                event.stopImmediatePropagation();
                            else
                                this.clickHandler(event);
                            return;
                        }
                }
            };
            /**
             * 按钮弹起事件
             * @method egret.gui.ButtonBase#buttonReleased
             */
            ButtonBase.prototype.buttonReleased = function () {
            };
            /**
             * 按钮点击事件
             * @method egret.gui.ButtonBase#clickHandler
             * @param event {TouchEvent}
             */
            ButtonBase.prototype.clickHandler = function (event) {
            };
            /**
             * 舞台上鼠标弹起事件
             */
            ButtonBase.prototype.stage_mouseUpHandler = function (event) {
                if (event.target == this)
                    return;
                this.mouseCaptured = false;
            };
            /**
             * 自动重发计时器首次延迟结束事件
             */
            ButtonBase.prototype.autoRepeat_timerDelayHandler = function (event) {
                this.autoRepeatTimer.reset();
                this.autoRepeatTimer.removeEventListener(egret.TimerEvent.TIMER, this.autoRepeat_timerDelayHandler, this);
                this.autoRepeatTimer.delay = this._repeatInterval;
                this.autoRepeatTimer.addEventListener(egret.TimerEvent.TIMER, this.autoRepeat_timerHandler, this);
                this.autoRepeatTimer.start();
            };
            /**
             * 自动重发buttonDown事件
             */
            ButtonBase.prototype.autoRepeat_timerHandler = function (event) {
                gui.UIEvent.dispatchUIEvent(this, gui.UIEvent.BUTTON_DOWN);
            };
            /**
             * @method egret.gui.ButtonBase#getCurrentSkinState
             * @returns {string}
             */
            ButtonBase.prototype.getCurrentSkinState = function () {
                if (!this.enabled)
                    return _super.prototype.getCurrentSkinState.call(this);
                if (this.isDown() || this._keepDown)
                    return "down";
                if (egret.InteractionMode.mode == egret.InteractionMode.MOUSE && (this.hovered || this.mouseCaptured))
                    return "over";
                return "up";
            };
            ButtonBase.prototype.partAdded = function (partName, instance) {
                _super.prototype.partAdded.call(this, partName, instance);
                if (instance == this.labelDisplay) {
                    this.labelDisplay.text = this._label;
                }
            };
            return ButtonBase;
        })(gui.SkinnableComponent);
        gui.ButtonBase = ButtonBase;
        ButtonBase.prototype.__class__ = "egret.gui.ButtonBase";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.ToggleButtonBase
         * @classdesc
         * 切换按钮组件基类
         * @extends egret.gui.ButtonBase
         */
        var ToggleButtonBase = (function (_super) {
            __extends(ToggleButtonBase, _super);
            /**
             * @method egret.gui.ToggleButtonBase#constructor
             */
            function ToggleButtonBase() {
                _super.call(this);
                /**
                 * 是否根据鼠标事件自动变换选中状态,默认true。仅框架内使用。
                 */
                this._autoSelected = true;
            }
            Object.defineProperty(ToggleButtonBase.prototype, "selected", {
                /**
                 * 按钮处于按下状态时为 true，而按钮处于弹起状态时为 false。
                 * @member egret.gui.ToggleButtonBase#selected
                 */
                get: function () {
                    return this._selected;
                },
                set: function (value) {
                    this._setSelected(value);
                },
                enumerable: true,
                configurable: true
            });
            ToggleButtonBase.prototype._setSelected = function (value) {
                if (value == this._selected)
                    return;
                this._selected = value;
                gui.UIEvent.dispatchUIEvent(this, gui.UIEvent.VALUE_COMMIT);
                ;
                this.invalidateSkinState();
            };
            /**
             * @method egret.gui.ToggleButtonBase#getCurrentSkinState
             * @returns {string}
             */
            ToggleButtonBase.prototype.getCurrentSkinState = function () {
                var state = _super.prototype.getCurrentSkinState.call(this);
                if (!this.selected) {
                    return state;
                }
                else {
                    var selectedState = state + "AndSelected";
                    var skin = this.skin;
                    if (skin && skin.hasState(selectedState)) {
                        return selectedState;
                    }
                    return state == "disabled" ? "disabled" : "down";
                }
            };
            ToggleButtonBase.prototype.buttonReleased = function () {
                _super.prototype.buttonReleased.call(this);
                if (!this._autoSelected || !this.enabled)
                    return;
                this.selected = !this.selected;
                this.dispatchEventWith(egret.Event.CHANGE);
            };
            return ToggleButtonBase;
        })(gui.ButtonBase);
        gui.ToggleButtonBase = ToggleButtonBase;
        ToggleButtonBase.prototype.__class__ = "egret.gui.ToggleButtonBase";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.TextBase
         * @classdesc
         * 文本基类,实现对文本的自动布局，样式属性设置。
         * @extends egret.gui.UIComponent
         * @implements egret.gui.IDisplayText
         */
        var TextBase = (function (_super) {
            __extends(TextBase, _super);
            /**
             * @method egret.gui.TextBase#constructor
             */
            function TextBase() {
                _super.call(this);
                this.allStyleChanged = false;
                this._fontFamily = "SimSun";
                this._size = 30;
                this._focusEnabled = true;
                this._bold = false;
                this._italic = false;
                this._textAlign = egret.HorizontalAlign.LEFT;
                this._verticalAlign = egret.VerticalAlign.TOP;
                this._lineSpacing = 0;
                this._textColor = 0xFFFFFF;
                this._text = "";
                this._textFlow = null;
                this._textFlowChanged = false;
                this._hasNoStyleChild = true;
            }
            TextBase.prototype.styleChanged = function (styleProp) {
                if (this.allStyleChanged) {
                    return;
                }
                if (styleProp) {
                    switch (styleProp) {
                        case "textColor":
                            this.textColorChanged = true;
                            break;
                        case "fontFamily":
                            this.fontFamilyChanged = true;
                            break;
                        case "size":
                            this._sizeChanged = true;
                            break;
                        case "bold":
                            this.boldChanged = true;
                            break;
                        case "italic":
                            this.italicChanged = true;
                            break;
                        case "textAlign":
                            this.textAlignChanged = true;
                            break;
                        case "verticalAlign":
                            this.verticalAlignChanged = true;
                            break;
                    }
                }
                else {
                    this.allStyleChanged = true;
                }
                this.invalidateProperties();
                this.invalidateSize();
                this.invalidateDisplayList();
            };
            Object.defineProperty(TextBase.prototype, "fontFamily", {
                /**
                 * 字体名称 。默认值：SimSun
                 * @member egret.gui.TextBase#fontFamily
                 */
                get: function () {
                    var chain = this._styleProtoChain;
                    if (chain && chain["fontFamily"] !== undefined) {
                        return chain["fontFamily"];
                    }
                    return this._fontFamily;
                },
                set: function (value) {
                    this.setStyle("fontFamily", value);
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TextBase.prototype, "size", {
                /**
                 * 字号大小,默认值30 。
                 * @member egret.gui.TextBase#size
                 */
                get: function () {
                    var chain = this._styleProtoChain;
                    if (chain && chain["size"] !== undefined) {
                        return chain["size"];
                    }
                    return this._size;
                },
                set: function (value) {
                    if (value === undefined)
                        value = 0;
                    this.setStyle("size", value);
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TextBase.prototype, "focusEnabled", {
                get: function () {
                    return this._focusEnabled;
                },
                set: function (value) {
                    this._focusEnabled = value;
                },
                enumerable: true,
                configurable: true
            });
            /**
             * @inheritDoc
             */
            TextBase.prototype.setFocus = function () {
                if (this._focusEnabled == false)
                    return;
                if (this._textField)
                    this._textField.setFocus();
                //else
                //	super.setFocus();
            };
            Object.defineProperty(TextBase.prototype, "bold", {
                /**
                 * 是否显示为粗体，默认false。
                 * @member egret.gui.TextBase#bold
                 */
                get: function () {
                    var chain = this._styleProtoChain;
                    if (chain && chain["bold"] !== undefined) {
                        return chain["bold"];
                    }
                    return this._bold;
                },
                set: function (value) {
                    this.setStyle("bold", value);
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TextBase.prototype, "italic", {
                /**
                 * 是否显示为粗体，默认false。
                 * @member egret.gui.TextBase#italic
                 */
                get: function () {
                    var chain = this._styleProtoChain;
                    if (chain && chain["italic"] !== undefined) {
                        return chain["italic"];
                    }
                    return this._italic;
                },
                set: function (value) {
                    this.setStyle("italic", value);
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TextBase.prototype, "textAlign", {
                /**
                 * 文字的水平对齐方式 ,请使用HorizontalAlign中定义的常量。
                 * 默认值：HorizontalAlign.LEFT。
                 * @member egret.gui.TextBase#textAlign
                 */
                get: function () {
                    var chain = this._styleProtoChain;
                    if (chain && chain["textAlign"] !== undefined) {
                        return chain["textAlign"];
                    }
                    return this._textAlign;
                },
                set: function (value) {
                    this.setStyle("textAlign", value);
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TextBase.prototype, "verticalAlign", {
                /**
                 * 文字的垂直对齐方式 ,请使用VerticalAlign中定义的常量。
                 * 默认值：VerticalAlign.TOP。
                 * @member egret.gui.TextBase#verticalAlign
                 */
                get: function () {
                    var chain = this._styleProtoChain;
                    if (chain && chain["verticalAlign"] !== undefined) {
                        return chain["verticalAlign"];
                    }
                    return this._verticalAlign;
                },
                set: function (value) {
                    this.setStyle("verticalAlign", value);
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TextBase.prototype, "lineSpacing", {
                /**
                 * 行间距
                 * @member egret.gui.TextBase#lineSpacing
                 */
                get: function () {
                    return this._getLineSpacing();
                },
                set: function (value) {
                    this._setLineSpacing(value);
                },
                enumerable: true,
                configurable: true
            });
            TextBase.prototype._getLineSpacing = function () {
                return this._lineSpacing;
            };
            TextBase.prototype._setLineSpacing = function (value) {
                if (this._lineSpacing == value)
                    return;
                this._lineSpacing = value;
                this.lineSpacingChanged = true;
                this.invalidateProperties();
                this.invalidateSize();
                this.invalidateDisplayList();
            };
            Object.defineProperty(TextBase.prototype, "textColor", {
                /**
                 * @member egret.gui.TextBase#textColor
                 */
                get: function () {
                    var chain = this._styleProtoChain;
                    if (chain && chain["textColor"] !== undefined) {
                        return chain["textColor"];
                    }
                    return this._textColor;
                },
                set: function (value) {
                    this.setStyle("textColor", value);
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TextBase.prototype, "text", {
                /**
                 * @member egret.gui.TextBase#text
                 */
                get: function () {
                    if (this._textField)
                        return this._textField.text;
                    return this._text;
                },
                set: function (value) {
                    if (value == this._text)
                        return;
                    this._text = value || "";
                    this._textChanged = true;
                    this._textFlow = null;
                    this._textFlowChanged = false;
                    this.invalidateProperties();
                    this.invalidateSize();
                    this.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TextBase.prototype, "textFlow", {
                get: function () {
                    if (this._textField)
                        return this._textField.textFlow;
                    return this._textFlow;
                },
                set: function (value) {
                    this._textFlow = value || [];
                    this._textFlowChanged = true;
                    this._text = null;
                    this._textChanged = false;
                    this.invalidateProperties();
                    this.invalidateSize();
                    this.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            TextBase.prototype.createChildren = function () {
                _super.prototype.createChildren.call(this);
                if (!this._textField) {
                    this.checkTextField();
                }
            };
            TextBase.prototype.commitProperties = function () {
                _super.prototype.commitProperties.call(this);
                if (!this._textField) {
                    this.checkTextField();
                }
                if (this.allStyleChanged) {
                    this.allStyleChanged = false;
                    this.textColorChanged = true;
                    this.fontFamilyChanged = true;
                    this._sizeChanged = true;
                    this.boldChanged = true;
                    this.italicChanged = true;
                    this.textAlignChanged = true;
                    this.verticalAlignChanged = true;
                }
                if (this.fontFamilyChanged) {
                    this._textField.fontFamily = this.fontFamily;
                    this.fontFamilyChanged = false;
                }
                if (this._sizeChanged) {
                    this._textField.size = this.size;
                    this._sizeChanged = false;
                }
                if (this.boldChanged) {
                    this._textField.bold = this.bold;
                    this.boldChanged = false;
                }
                if (this.italic) {
                    this._textField.italic = this.italic;
                    this.italicChanged = false;
                }
                if (this.textAlignChanged) {
                    this._textField.textAlign = this.textAlign;
                    this.textAlignChanged = false;
                }
                if (this.verticalAlignChanged) {
                    this._textField.verticalAlign = this.verticalAlign;
                    this.verticalAlignChanged = false;
                }
                if (this.lineSpacingChanged) {
                    this._textField.lineSpacing = this._lineSpacing;
                    this.lineSpacingChanged = false;
                }
                if (this.textColorChanged) {
                    this._textField.textColor = this.textColor;
                    this.textColorChanged = false;
                }
                if (this._textChanged) {
                    this._textField.text = this._text;
                    this._textChanged = false;
                }
                if (this._textFlowChanged) {
                    this._textField.textFlow = this._textFlow;
                    this._textFlowChanged = false;
                }
            };
            /**
             * 检查是否创建了textField对象，没有就创建一个。
             */
            TextBase.prototype.checkTextField = function () {
                if (!this._textField) {
                    this._createTextField();
                    if (this._text) {
                        this._textField.text = this._text;
                        this._textChanged = true;
                    }
                    if (this._textFlow) {
                        this._textField.textFlow = this._textFlow;
                        this._textFlowChanged = true;
                    }
                    this.invalidateProperties();
                }
            };
            TextBase.prototype._createTextField = function () {
                this._textField = new egret.TextField;
                this._textField.fontFamily = this.fontFamily;
                this._textField.size = this.size;
                this._textField.textAlign = this.textAlign;
                this._textField.verticalAlign = this.verticalAlign;
                this._textField.lineSpacing = this._lineSpacing;
                this._textField.textColor = this.textColor;
                this._textField.multiline = true;
                this._addToDisplayList(this._textField);
            };
            TextBase.prototype.measure = function () {
                _super.prototype.measure.call(this);
                this.measuredWidth = TextBase.DEFAULT_MEASURED_WIDTH;
                this.measuredHeight = TextBase.DEFAULT_MEASURED_HEIGHT;
            };
            /**
             * 更新显示列表
             * @param unscaledWidth {number}
             * @param unscaledHeight {number}
             */
            TextBase.prototype.$updateDisplayList = function (unscaledWidth, unscaledHeight) {
                _super.prototype.updateDisplayList.call(this, unscaledWidth, unscaledHeight);
            };
            /**
             * @param unscaledWidth {number}
             * @param unscaledHeight {number}
             */
            TextBase.prototype.updateDisplayList = function (unscaledWidth, unscaledHeight) {
                _super.prototype.updateDisplayList.call(this, unscaledWidth, unscaledHeight);
                this._textField.width = unscaledWidth;
                this._textField.height = unscaledHeight;
            };
            TextBase.prototype.dispatchPropertyChangeEvent = function (propertyName, oldValue, value) {
                if (this.hasEventListener("propertyChange"))
                    gui.PropertyChangeEvent.dispatchPropertyChangeEvent(this, gui.PropertyChangeEventKind.UPDATE, propertyName, oldValue, value, this);
            };
            /**
             * 默认的文本测量宽度
             * @constant egret.gui.TextBase.DEFAULT_MEASURED_WIDTH
             */
            TextBase.DEFAULT_MEASURED_WIDTH = 160;
            /**
             * 默认的文本测量高度
             * @constant egret.gui.TextBase.DEFAULT_MEASURED_HEIGHT
             */
            TextBase.DEFAULT_MEASURED_HEIGHT = 22;
            return TextBase;
        })(gui.UIComponent);
        gui.TextBase = TextBase;
        TextBase.prototype.__class__ = "egret.gui.TextBase";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.GroupBase
         * @classdesc
         * 自动布局容器基类
         * @extends egret.gui.UIComponent
         * @implements egret.gui.IViewport
         */
        var GroupBase = (function (_super) {
            __extends(GroupBase, _super);
            /**
             * @method egret.gui.GroupBase#constructor
             */
            function GroupBase() {
                _super.call(this);
                this._contentWidth = 0;
                this._contentHeight = 0;
                this._clipAndEnableScrolling = false;
                this._horizontalScrollPosition = 0;
                this._verticalScrollPosition = 0;
                /**
                 * 在更新显示列表时是否需要更新布局标志
                 */
                this._layoutInvalidateDisplayListFlag = false;
                /**
                 * 在测量尺寸时是否需要测量布局的标志
                 */
                this._layoutInvalidateSizeFlag = false;
                this.touchEnabled = false;
            }
            /**
             * @method egret.gui.GroupBase#createChildren
             */
            GroupBase.prototype.createChildren = function () {
                _super.prototype.createChildren.call(this);
                if (!this._layout) {
                    this.layout = new gui.BasicLayout;
                }
            };
            Object.defineProperty(GroupBase.prototype, "contentWidth", {
                /**
                 * @member egret.gui.GroupBase#contentWidth
                 */
                get: function () {
                    return this._contentWidth;
                },
                enumerable: true,
                configurable: true
            });
            GroupBase.prototype.setContentWidth = function (value) {
                if (value == this._contentWidth)
                    return;
                var oldValue = this._contentWidth;
                this._contentWidth = value;
                if (this.hasEventListener("propertyChange"))
                    gui.PropertyChangeEvent.dispatchPropertyChangeEvent(this, gui.PropertyChangeEventKind.UPDATE, "contentWidth", oldValue, value, this);
            };
            Object.defineProperty(GroupBase.prototype, "contentHeight", {
                /**
                 * @member egret.gui.GroupBase#contentHeight
                 */
                get: function () {
                    return this._contentHeight;
                },
                enumerable: true,
                configurable: true
            });
            GroupBase.prototype.setContentHeight = function (value) {
                if (value == this._contentHeight)
                    return;
                var oldValue = this._contentHeight;
                this._contentHeight = value;
                if (this.hasEventListener("propertyChange"))
                    gui.PropertyChangeEvent.dispatchPropertyChangeEvent(this, gui.PropertyChangeEventKind.UPDATE, "contentHeight", oldValue, value, this);
            };
            /**
             * 设置 contentWidth 和 contentHeight 属性，此方法由Layout类调用
             * @method egret.gui.GroupBase#setContentSize
             * @private
             *
             * @param width {number}
             * @param height {number}
             */
            GroupBase.prototype.setContentSize = function (width, height) {
                if ((width == this._contentWidth) && (height == this._contentHeight))
                    return;
                this.setContentWidth(width);
                this.setContentHeight(height);
            };
            Object.defineProperty(GroupBase.prototype, "layout", {
                /**
                 * 此容器的布局对象
                 * @member egret.gui.GroupBase#layout
                 */
                get: function () {
                    return this._layout;
                },
                set: function (value) {
                    this._setLayout(value);
                },
                enumerable: true,
                configurable: true
            });
            GroupBase.prototype._setLayout = function (value) {
                if (this._layout == value)
                    return;
                if (this._layout) {
                    this._layout.target = null;
                }
                this._layout = value;
                if (this._layout) {
                    this._layout.target = this;
                }
                this.invalidateSize();
                this.invalidateDisplayList();
                this.dispatchEventWith("layoutChanged");
            };
            Object.defineProperty(GroupBase.prototype, "clipAndEnableScrolling", {
                /**
                 * 如果为 true，指定将子代剪切到视区的边界。如果为 false，则容器子代会从容器边界扩展过去，而不管组件的大小规范。默认false
                 * @member egret.gui.GroupBase#clipAndEnableScrolling
                 */
                get: function () {
                    return this._clipAndEnableScrolling;
                },
                set: function (value) {
                    if (value == this._clipAndEnableScrolling)
                        return;
                    this._clipAndEnableScrolling = value;
                    if (this._clipAndEnableScrolling) {
                        this.scrollRect = new egret.Rectangle(this._horizontalScrollPosition, this._verticalScrollPosition, this.width, this.height);
                    }
                    else {
                        this.scrollRect = null;
                    }
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(GroupBase.prototype, "horizontalScrollPosition", {
                /**
                 * 可视区域水平方向起始点
                 * @member egret.gui.GroupBase#horizontalScrollPosition
                 */
                get: function () {
                    return this._horizontalScrollPosition;
                },
                set: function (value) {
                    if (value == this._horizontalScrollPosition)
                        return;
                    var oldValue = this._horizontalScrollPosition;
                    this._horizontalScrollPosition = value;
                    this.scrollPositionChanged();
                    gui.PropertyChangeEvent.dispatchPropertyChangeEvent(this, gui.PropertyChangeEventKind.UPDATE, "horizontalScrollPosition", oldValue, value, this);
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(GroupBase.prototype, "verticalScrollPosition", {
                /**
                 * 可视区域竖直方向起始点
                 * @member egret.gui.GroupBase#verticalScrollPosition
                 */
                get: function () {
                    return this._verticalScrollPosition;
                },
                set: function (value) {
                    if (value == this._verticalScrollPosition)
                        return;
                    var oldValue = this._verticalScrollPosition;
                    this._verticalScrollPosition = value;
                    this.scrollPositionChanged();
                    gui.PropertyChangeEvent.dispatchPropertyChangeEvent(this, gui.PropertyChangeEventKind.UPDATE, "verticalScrollPosition", oldValue, value, this);
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 滚动条位置改变
             */
            GroupBase.prototype.scrollPositionChanged = function () {
                if (!this._clipAndEnableScrolling) {
                    return;
                }
                this.updateScrollRect(this.width, this.height);
                this._invalidateDisplayListExceptLayout();
                if (this._layout) {
                    this._layout.scrollPositionChanged();
                }
            };
            /**
             * 更新可视区域
             * @param w {number}
             * @param h {number}
             */
            GroupBase.prototype.updateScrollRect = function (w, h) {
                var rect = this._scrollRect;
                if (this._clipAndEnableScrolling) {
                    if (rect) {
                        rect.x = this._horizontalScrollPosition;
                        rect.y = this._verticalScrollPosition;
                        rect.width = w;
                        rect.height = h;
                    }
                    else {
                        this._scrollRect = new egret.Rectangle(this._horizontalScrollPosition, this._verticalScrollPosition, w, h);
                    }
                }
                else if (rect) {
                    this._scrollRect = null;
                }
            };
            /**
             * @method egret.gui.GroupBase#measure
             */
            GroupBase.prototype.measure = function () {
                if (!this._layout || !this._layoutInvalidateSizeFlag)
                    return;
                _super.prototype.measure.call(this);
                this._layout.measure();
            };
            /**
             * 标记需要更新显示列表但不需要更新布局
             */
            GroupBase.prototype._invalidateDisplayListExceptLayout = function () {
                _super.prototype.invalidateDisplayList.call(this);
            };
            /**
             * @method egret.gui.GroupBase#invalidateDisplayList
             */
            GroupBase.prototype.invalidateDisplayList = function () {
                _super.prototype.invalidateDisplayList.call(this);
                this._layoutInvalidateDisplayListFlag = true;
            };
            GroupBase.prototype._childXYChanged = function () {
                this.invalidateSize();
                this.invalidateDisplayList();
            };
            /**
             * 标记需要更新显示列表但不需要更新布局
             */
            GroupBase.prototype._invalidateSizeExceptLayout = function () {
                _super.prototype.invalidateSize.call(this);
            };
            /**
             * @method egret.gui.GroupBase#invalidateSize
             */
            GroupBase.prototype.invalidateSize = function () {
                _super.prototype.invalidateSize.call(this);
                this._layoutInvalidateSizeFlag = true;
            };
            GroupBase.prototype.updateDisplayList = function (unscaledWidth, unscaledHeight) {
                _super.prototype.updateDisplayList.call(this, unscaledWidth, unscaledHeight);
                if (this._layoutInvalidateDisplayListFlag && this._layout) {
                    this._layoutInvalidateDisplayListFlag = false;
                    this._layout.updateDisplayList(unscaledWidth, unscaledHeight);
                    this.updateScrollRect(unscaledWidth, unscaledHeight);
                }
            };
            Object.defineProperty(GroupBase.prototype, "numElements", {
                /**
                 * 此容器中的可视元素的数量。
                 * @member egret.gui.GroupBase#numElements
                 */
                get: function () {
                    return -1;
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 返回指定索引处的可视元素。
             * @method egret.gui.GroupBase#getElementAt
             * @param index {number} 要检索的元素的索引。
             * @throws RangeError 如果在子列表中不存在该索引位置。
             * @returns {IVisualElement}
             */
            GroupBase.prototype.getElementAt = function (index) {
                return null;
            };
            /**
             * 返回可视元素的索引位置。若不存在，则返回-1。
             * @method egret.gui.GroupBase#getElementIndex
             * @param element {IVisualElement} 可视元素。
             * @returns {number}
             */
            GroupBase.prototype.getElementIndex = function (element) {
                return -1;
            };
            /**
             * 返回在容器可视区域内的布局元素索引列表,此方法忽略不是布局元素的普通的显示对象
             * @method egret.gui.GroupBase#getElementIndicesInView
             * @returns {number}
             */
            GroupBase.prototype.getElementIndicesInView = function () {
                var visibleIndices = [];
                var index;
                if (!this.scrollRect) {
                    for (index = 0; index < this.numChildren; index++) {
                        visibleIndices.push(index);
                    }
                }
                else {
                    for (index = 0; index < this.numChildren; index++) {
                        var layoutElement = (this.getChildAt(index));
                        if (!layoutElement)
                            continue;
                        var eltR = new egret.Rectangle();
                        eltR.x = layoutElement.layoutBoundsX;
                        eltR.y = layoutElement.layoutBoundsY;
                        eltR.width = layoutElement.layoutBoundsWidth;
                        eltR.height = layoutElement.layoutBoundsHeight;
                        if (this.scrollRect.intersects(eltR))
                            visibleIndices.push(index);
                    }
                }
                return visibleIndices;
            };
            /**
             * 在支持虚拟布局的容器中，设置容器内可见的子元素索引范围。此方法在不支持虚拟布局的容器中无效。
             * 通常在即将连续调用getVirtualElementAt()之前需要显式设置一次，以便容器提前释放已经不可见的子元素。
             * @method egret.gui.GroupBase#setVirtualElementIndicesInView
             * @param startIndex {number} 可视元素起始索引
             * @param endIndex {number} 可视元素结束索引
             */
            GroupBase.prototype.setVirtualElementIndicesInView = function (startIndex, endIndex) {
            };
            /**
             * 支持useVirtualLayout属性的布局类在updateDisplayList()中使用此方法来获取“处于视图中”的布局元素
             * @method egret.gui.GroupBase#getVirtualElementAt
             * @param index {number} 要检索的元素的索引。
             * @returns {IVisualElement}
             */
            GroupBase.prototype.getVirtualElementAt = function (index) {
                return this.getElementAt(index);
            };
            return GroupBase;
        })(gui.UIComponent);
        gui.GroupBase = GroupBase;
        GroupBase.prototype.__class__ = "egret.gui.GroupBase";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.ItemRenderer
         * @classdesc
         * 项呈示器基类
         * @extends egret.gui.ButtonBase
         * @implements egret.gui.IItemRenderer
         */
        var ItemRenderer = (function (_super) {
            __extends(ItemRenderer, _super);
            /**
             * @method egret.gui.ItemRenderer#constructor
             */
            function ItemRenderer() {
                _super.call(this);
                this.dataChangedFlag = false;
                this._selected = false;
                this._itemIndex = -1;
                this.touchChildren = true;
            }
            Object.defineProperty(ItemRenderer.prototype, "data", {
                /**
                 * @member egret.gui.ItemRenderer#data
                 */
                get: function () {
                    return this._data;
                },
                set: function (value) {
                    //这里不能加if(_data==value)return;的判断，会导致数据源无法刷新的问题
                    this._data = value;
                    if (this.initialized || this.parent) {
                        this.dataChangedFlag = false;
                        this.dataChanged();
                    }
                    else {
                        this.dataChangedFlag = true;
                        this.invalidateProperties();
                    }
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 子类复写此方法以在data数据源发生改变时跟新显示列表。
             * 与直接复写_data的setter方法不同，它会确保在皮肤已经附加完成后再被调用。
             * @method egret.gui.ItemRenderer#dataChanged
             */
            ItemRenderer.prototype.dataChanged = function () {
            };
            Object.defineProperty(ItemRenderer.prototype, "selected", {
                /**
                 * @member egret.gui.ItemRenderer#selected
                 */
                get: function () {
                    return this._selected;
                },
                set: function (value) {
                    if (this._selected == value)
                        return;
                    this._selected = value;
                    this.invalidateSkinState();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(ItemRenderer.prototype, "itemIndex", {
                /**
                 * @member egret.gui.ItemRenderer#itemIndex
                 */
                get: function () {
                    return this._itemIndex;
                },
                set: function (value) {
                    this._itemIndex = value;
                },
                enumerable: true,
                configurable: true
            });
            /**
             * @method egret.gui.ItemRenderer#commitProperties
             */
            ItemRenderer.prototype.commitProperties = function () {
                _super.prototype.commitProperties.call(this);
                if (this.dataChangedFlag) {
                    this.dataChangedFlag = false;
                    this.dataChanged();
                }
            };
            /**
             * @method egret.gui.ItemRenderer#getCurrentSkinState
             * @returns {string}
             */
            ItemRenderer.prototype.getCurrentSkinState = function () {
                if (this._selected)
                    return "down";
                return _super.prototype.getCurrentSkinState.call(this);
            };
            return ItemRenderer;
        })(gui.ButtonBase);
        gui.ItemRenderer = ItemRenderer;
        ItemRenderer.prototype.__class__ = "egret.gui.ItemRenderer";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.Animation
         * @classdesc
         * 数值缓动工具类
         */
        var Animation = (function () {
            /**
             * 构造函数
             * @method egret.gui.Animation#constructor
             * @param updateFunction {Function} 动画更新时的回调函数,updateFunction(animation:Animation):void
             * @param thisObject {an}
             */
            function Animation(updateFunction, thisObject) {
                /**
                 * 此动画的缓动行为。设置为null意味着不使用缓动，默认值为Ease.sineInOut()
                 * @member egret.gui.Animation#easerFunction
                 */
                this.easerFunction = egret.Ease.sineInOut;
                this._duration = 500;
                this._startDelay = 0;
                this._repeatCount = 1;
                this._repeatDelay = 0;
                /**
                 * 随着时间的推移Animation将设置动画的属性和值的列表。对象示例:{p:"x",f:10,t:100}表示，属性名"x"从10改变到100。
                 * @member egret.gui.Animation#motionPaths
                 */
                this.motionPaths = [];
                this._currentValue = {};
                this.pauseTime = 0;
                this._isPaused = false;
                /**
                 * 动画启动时刻
                 */
                this.startTime = 0;
                this._started = false;
                /**
                 * 已经播放的次数。
                 */
                this.playedTimes = 0;
                this.updateFunction = updateFunction;
                this.thisObject = thisObject;
            }
            Object.defineProperty(Animation.prototype, "isPlaying", {
                /**
                 * 是否正在播放动画，不包括延迟等待和暂停的阶段
                 * @member egret.gui.Animation#isPlaying
                 */
                get: function () {
                    return this._isPlaying;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Animation.prototype, "duration", {
                /**
                 * 动画持续时间,单位毫秒，默认值500
                 * @member egret.gui.Animation#duration
                 */
                get: function () {
                    return this._duration;
                },
                set: function (value) {
                    this._duration = value;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Animation.prototype, "startDelay", {
                /**
                 * 动画开始播放前的延时时间,单位毫秒,默认0。
                 * @member egret.gui.Animation#startDelay
                 */
                get: function () {
                    return this._startDelay;
                },
                set: function (value) {
                    this._startDelay = value;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Animation.prototype, "repeatCount", {
                /**
                 * 动画重复的次数，0代表无限制重复。默认值为1。
                 * @member egret.gui.Animation#repeatCount
                 */
                get: function () {
                    return this._repeatCount;
                },
                set: function (value) {
                    this._repeatCount = value;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Animation.prototype, "repeatDelay", {
                /**
                 * 每次重复播放之间的间隔。第二次及以后的播放开始之前的延迟毫秒数。若要设置第一次之前的延迟时间，请使用startDelay属性。
                 * @member egret.gui.Animation#repeatDelay
                 */
                get: function () {
                    return this._repeatDelay;
                },
                set: function (value) {
                    this._repeatDelay = value;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Animation.prototype, "currentValue", {
                /**
                 * 动画到当前时间对应的值。以MotionPath.property为键存储各个MotionPath的当前值。
                 * @member egret.gui.Animation#currentValue
                 */
                get: function () {
                    return this._currentValue;
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 开始正向播放动画,无论何时调用都重新从零时刻开始，若设置了延迟会首先进行等待。
             * @method egret.gui.Animation#play
             */
            Animation.prototype.play = function () {
                this.stopAnimation();
                this.start();
            };
            /**
             * 立即跳到指定百分比的动画位置
             */
            Animation.prototype.seek = function (runningTime) {
                runningTime = Math.min(runningTime, this.duration);
                var fraction = runningTime / this.duration;
                this.caculateCurrentValue(fraction);
                this.startTime = egret.getTimer() - runningTime - this._startDelay;
                if (this.updateFunction != null)
                    this.updateFunction.call(this.thisObject, this);
            };
            /**
             * 开始播放动画
             */
            Animation.prototype.start = function () {
                this.playedTimes = 0;
                this._started = true;
                this._isPlaying = false;
                this._currentValue = {};
                this.caculateCurrentValue(0);
                this.startTime = egret.getTimer();
                Animation.currentTime = this.startTime;
                this.doInterval();
                Animation.addAnimation(this);
            };
            /**
             * 直接跳到动画结尾
             * @method egret.gui.Animation#end
             */
            Animation.prototype.end = function () {
                if (!this._started) {
                    this.caculateCurrentValue(0);
                    if (this.startFunction != null) {
                        this.startFunction.call(this.thisObject, this);
                    }
                    if (this.updateFunction != null) {
                        this.updateFunction.call(this.thisObject, this);
                    }
                }
                this.caculateCurrentValue(1);
                if (this.updateFunction != null) {
                    this.updateFunction.call(this.thisObject, this);
                }
                this.stopAnimation();
                if (this.endFunction != null) {
                    this.endFunction.call(this.thisObject, this);
                }
            };
            /**
             * 停止播放动画
             * @method egret.gui.Animation#stop
             */
            Animation.prototype.stop = function () {
                this.stopAnimation();
                if (this.stopFunction != null)
                    this.stopFunction.call(this.thisObject, this);
            };
            /**
             * 仅停止播放动画，而不调用stopFunction。
             */
            Animation.prototype.stopAnimation = function () {
                this.playedTimes = 0;
                this._isPlaying = false;
                this.startTime = 0;
                this._started = false;
                Animation.removeAnimation(this);
            };
            Object.defineProperty(Animation.prototype, "isPaused", {
                /**
                 * 正在暂停中
                 * @member egret.gui.Animation#isPaused
                 */
                get: function () {
                    return this._isPaused;
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 暂停播放
             * @method egret.gui.Animation#pause
             */
            Animation.prototype.pause = function () {
                if (!this._started)
                    return;
                this._isPaused = true;
                this.pauseTime = egret.getTimer();
                this._isPlaying = false;
                Animation.removeAnimation(this);
            };
            /**
             * 继续播放
             * @method egret.gui.Animation#resume
             */
            Animation.prototype.resume = function () {
                if (!this._started || !this._isPaused)
                    return;
                this._isPaused = false;
                this.startTime += egret.getTimer() - this.pauseTime;
                this.pauseTime = -1;
                Animation.addAnimation(this);
            };
            Object.defineProperty(Animation.prototype, "started", {
                /**
                 * 动画已经开始的标志，包括延迟等待和暂停的阶段。
                 * @member egret.gui.Animation#started
                 */
                get: function () {
                    return this._started;
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 计算当前值并返回动画是否结束
             */
            Animation.prototype.doInterval = function () {
                var delay = this.playedTimes > 0 ? this._repeatDelay : this._startDelay;
                var runningTime = Animation.currentTime - this.startTime - delay;
                if (runningTime < 0) {
                    return false;
                }
                if (!this._isPlaying) {
                    this._isPlaying = true;
                    if (this.playedTimes == 0) {
                        if (this.startFunction != null)
                            this.startFunction.call(this.thisObject, this);
                    }
                }
                var fraction = this._duration == 0 ? 1 : Math.min(runningTime, this._duration) / this._duration;
                this.caculateCurrentValue(fraction);
                if (this.updateFunction != null)
                    this.updateFunction.call(this.thisObject, this);
                var isEnded = runningTime >= this._duration;
                if (isEnded) {
                    this.playedTimes++;
                    this._isPlaying = false;
                    this.startTime = Animation.currentTime;
                    if (this._repeatCount == 0 || this.playedTimes < this._repeatCount) {
                        isEnded = false;
                    }
                    else {
                        Animation.removeAnimation(this);
                        this._started = false;
                        this.playedTimes = 0;
                    }
                }
                if (isEnded && this.endFunction != null) {
                    this.endFunction.call(this.thisObject, this);
                }
                return isEnded;
            };
            /**
             * 计算当前值
             */
            Animation.prototype.caculateCurrentValue = function (fraction) {
                if (this.easerFunction)
                    fraction = this.easerFunction(fraction);
                var paths = this.motionPaths;
                var length = paths.length;
                for (var i = 0; i < length; i++) {
                    var motion = paths[i];
                    this.currentValue[motion.prop] = motion.from + (motion.to - motion.from) * fraction;
                }
            };
            /**
             * 添加动画到队列
             */
            Animation.addAnimation = function (animation) {
                if (Animation.activeAnimations.indexOf(animation) == -1) {
                    Animation.activeAnimations.push(animation);
                    if (!Animation.registered) {
                        Animation.registered = true;
                        egret.Ticker.getInstance().register(Animation.onEnterFrame, null);
                    }
                }
            };
            /**
             * 从队列移除动画,返回移除前的索引
             */
            Animation.removeAnimation = function (animation) {
                var index = Animation.activeAnimations.indexOf(animation);
                if (index != -1) {
                    Animation.activeAnimations.splice(index, 1);
                    if (index <= Animation.currentIntervalIndex)
                        Animation.currentIntervalIndex--;
                }
                if (Animation.activeAnimations.length == 0 && Animation.registered) {
                    Animation.registered = false;
                    egret.Ticker.getInstance().unregister(Animation.onEnterFrame, null);
                }
            };
            /**
             * 计时器触发函数
             */
            Animation.onEnterFrame = function (frameTime, currentTime) {
                Animation.currentTime = egret.getTimer();
                Animation.currentIntervalIndex = 0;
                while (Animation.currentIntervalIndex < Animation.activeAnimations.length) {
                    var animation = Animation.activeAnimations[Animation.currentIntervalIndex];
                    var isEnded = animation.doInterval();
                    Animation.currentIntervalIndex++;
                }
                Animation.currentIntervalIndex = -1;
                if (Animation.activeAnimations.length == 0 && Animation.registered) {
                    Animation.registered = false;
                    egret.Ticker.getInstance().unregister(Animation.onEnterFrame, null);
                }
            };
            /**
             * 总时间轴的当前时间
             */
            Animation.currentTime = 0;
            Animation.TIMER_RESOLUTION = 1000 / 60; // 60 fps
            /**
             * 正在活动的动画
             */
            Animation.activeAnimations = [];
            /**
             * 当前正在执行动画的索引
             */
            Animation.currentIntervalIndex = -1;
            return Animation;
        })();
        gui.Animation = Animation;
        Animation.prototype.__class__ = "egret.gui.Animation";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.Range
         * @classdesc
         * 范围选取组件,该组件包含一个值和这个值所允许的最大最小约束范围。
         * @extends egret.gui.SkinnableComponent
         */
        var Range = (function (_super) {
            __extends(Range, _super);
            /**
             * 构造函数
             * @method egret.gui.Range#constructor
             */
            function Range() {
                _super.call(this);
                this._maximum = 100;
                /**
                 * 最大有效值改变标志
                 */
                this.maxChanged = false;
                this._minimum = 0;
                /**
                 * 最小有效值改变标志
                 */
                this.minChanged = false;
                this._stepSize = 1;
                /**
                 * 单步大小改变的标志
                 */
                this.stepSizeChanged = false;
                this._value = 0;
                this._changedValue = 0;
                /**
                 * 此范围的当前值改变标志
                 */
                this.valueChanged = false;
                this._snapInterval = 1;
                this.snapIntervalChanged = false;
                this._explicitSnapInterval = false;
            }
            Object.defineProperty(Range.prototype, "maximum", {
                /**
                 * 最大有效值
                 * @member egret.gui.Range#maximum
                 */
                get: function () {
                    return this._maximum;
                },
                set: function (value) {
                    this._setMaximun(value);
                },
                enumerable: true,
                configurable: true
            });
            Range.prototype._setMaximun = function (value) {
                if (value == this._maximum)
                    return;
                this._maximum = value;
                this.maxChanged = true;
                this.invalidateProperties();
            };
            Object.defineProperty(Range.prototype, "minimum", {
                /**
                 * 最小有效值
                 * @member egret.gui.Range#minimum
                 */
                get: function () {
                    return this._minimum;
                },
                set: function (value) {
                    this._setMinimun(value);
                },
                enumerable: true,
                configurable: true
            });
            Range.prototype._setMinimun = function (value) {
                if (value == this._minimum)
                    return;
                this._minimum = value;
                this.minChanged = true;
                this.invalidateProperties();
            };
            Object.defineProperty(Range.prototype, "stepSize", {
                /**
                 * 调用 changeValueByStep() 方法时 value 属性更改的单步大小。默认值为 1。<br/>
                 * 除非 snapInterval 为 0，否则它必须是 snapInterval 的倍数。<br/>
                 * 如果 stepSize 不是倍数，则会将它近似到大于或等于 snapInterval 的最近的倍数。<br/>
                 * @member egret.gui.Range#stepSize
                 */
                get: function () {
                    return this._stepSize;
                },
                set: function (value) {
                    if (value == this._stepSize)
                        return;
                    this._stepSize = value;
                    this.stepSizeChanged = true;
                    this.invalidateProperties();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Range.prototype, "value", {
                /**
                 * 此范围的当前值。
                 * @member egret.gui.Range#value
                 */
                get: function () {
                    return this._getValue();
                },
                set: function (newValue) {
                    this._setValue(newValue);
                },
                enumerable: true,
                configurable: true
            });
            Range.prototype._setValue = function (newValue) {
                if (newValue == this.value)
                    return;
                this._changedValue = newValue;
                this.valueChanged = true;
                this.invalidateProperties();
            };
            Range.prototype._getValue = function () {
                return (this.valueChanged) ? this._changedValue : this._value;
            };
            Object.defineProperty(Range.prototype, "snapInterval", {
                /**
                 * snapInterval 属性定义 value 属性的有效值。如果为非零，则有效值为 minimum 与此属性的整数倍数之和，且小于或等于 maximum。 <br/>
                 * 例如，如果 minimum 为 10，maximum 为 20，而此属性为 3，则可能的有效值为 10、13、16、19 和 20。<br/>
                 * 如果此属性的值为零，则仅会将有效值约束到介于 minimum 和 maximum 之间（包括两者）。<br/>
                 * 此属性还约束 stepSize 属性（如果设置）的有效值。如果未显式设置此属性，但设置了 stepSize，则 snapInterval 将默认为 stepSize。<br/>
                 * @member egret.gui.Range#snapInterval
                 */
                get: function () {
                    return this._snapInterval;
                },
                set: function (value) {
                    this._explicitSnapInterval = true;
                    if (value == this._snapInterval)
                        return;
                    if (isNaN(value)) {
                        this._snapInterval = 1;
                        this._explicitSnapInterval = false;
                    }
                    else {
                        this._snapInterval = value;
                    }
                    this.snapIntervalChanged = true;
                    this.stepSizeChanged = true;
                    this.invalidateProperties();
                },
                enumerable: true,
                configurable: true
            });
            /**
             * @method egret.gui.Range#commitProperties
             */
            Range.prototype.commitProperties = function () {
                _super.prototype.commitProperties.call(this);
                if (this.minimum > this.maximum) {
                    if (!this.maxChanged)
                        this._minimum = this._maximum;
                    else
                        this._maximum = this._minimum;
                }
                if (this.valueChanged || this.maxChanged || this.minChanged || this.snapIntervalChanged) {
                    var currentValue = (this.valueChanged) ? this._changedValue : this._value;
                    this.valueChanged = false;
                    this.maxChanged = false;
                    this.minChanged = false;
                    this.snapIntervalChanged = false;
                    this.setValue(this.nearestValidValue(currentValue, this.snapInterval));
                }
                if (this.stepSizeChanged) {
                    if (this._explicitSnapInterval) {
                        this._stepSize = this.nearestValidSize(this._stepSize);
                    }
                    else {
                        this._snapInterval = this._stepSize;
                        this.setValue(this.nearestValidValue(this._value, this.snapInterval));
                    }
                    this.stepSizeChanged = false;
                }
            };
            /**
             * 修正stepSize到最接近snapInterval的整数倍
             */
            Range.prototype.nearestValidSize = function (size) {
                var interval = this.snapInterval;
                if (interval == 0)
                    return size;
                var validSize = Math.round(size / interval) * interval;
                return (Math.abs(validSize) < interval) ? interval : validSize;
            };
            /**
             * 修正输入的值为有效值
             * @method egret.gui.Range#nearestValidValue
             * @param value {number} 输入值。
             * @param interval {number} snapInterval 的值，或 snapInterval 的整数倍数。
             * @returns {number}
             */
            Range.prototype.nearestValidValue = function (value, interval) {
                if (interval == 0)
                    return Math.max(this.minimum, Math.min(this.maximum, value));
                var maxValue = this.maximum - this.minimum;
                var scale = 1;
                value -= this.minimum;
                if (interval != Math.round(interval)) {
                    var parts = ((1 + interval).toString()).split(".");
                    scale = Math.pow(10, parts[1].length);
                    maxValue *= scale;
                    value = Math.round(value * scale);
                    interval = Math.round(interval * scale);
                }
                var lower = Math.max(0, Math.floor(value / interval) * interval);
                var upper = Math.min(maxValue, Math.floor((value + interval) / interval) * interval);
                var validValue = ((value - lower) >= ((upper - lower) / 2)) ? upper : lower;
                return (validValue / scale) + this.minimum;
            };
            /**
             * 设置当前值。此方法假定调用者已经使用了 nearestValidValue() 方法来约束 value 参数
             * @method egret.gui.Range#setValue
             * @param value {number} value属性的新值
             */
            Range.prototype.setValue = function (value) {
                if (this._value == value)
                    return;
                if (isNaN(value))
                    value = 0;
                if (!isNaN(this.maximum) && !isNaN(this.minimum) && (this.maximum > this.minimum))
                    this._value = Math.min(this.maximum, Math.max(this.minimum, value));
                else
                    this._value = value;
                this.valueChanged = false;
            };
            /**
             * 按 stepSize增大或减小当前值
             * @method egret.gui.Range#changeValueByStep
             * @param increase {boolean} 若为 true，则向value增加stepSize，否则减去它。
             */
            Range.prototype.changeValueByStep = function (increase) {
                if (increase === void 0) { increase = true; }
                if (this.stepSize == 0)
                    return;
                var newValue = (increase) ? this.value + this.stepSize : this.value - this.stepSize;
                this.setValue(this.nearestValidValue(newValue, this.snapInterval));
            };
            return Range;
        })(gui.SkinnableComponent);
        gui.Range = Range;
        Range.prototype.__class__ = "egret.gui.Range";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.TrackBase
         * @classdesc
         * TrackBase类是具有一个轨道和一个或多个滑块按钮的组件的一个基类，如 Slider 和 ScrollBar。
         * @extends egret.gui.Range
         */
        var TrackBase = (function (_super) {
            __extends(TrackBase, _super);
            /**
             * @method egret.gui.TrackBase#constructor
             */
            function TrackBase() {
                _super.call(this);
                this._slideDuration = 300;
                /**
                 * 当鼠标拖动thumb时，需要更新value的标记。
                 */
                this.needUpdateValue = false;
                this.addEventListener(egret.Event.ADDED_TO_STAGE, this.addedToStageHandler, this);
                this.addEventListener(egret.TouchEvent.TOUCH_BEGIN, this.mouseDownHandler, this);
            }
            Object.defineProperty(TrackBase.prototype, "slideDuration", {
                /**
                 * 在轨道上单击以移动滑块时，滑动动画持续的时间（以毫秒为单位）。<br/>
                 * 此属性用于 Slider 和 ScrollBar。对于 Slider，在轨道上的任何单击将导致生成使用此样式的一个动画，同时滑块将移到单击的位置。<br/>
                 * 对于 ScrollBar，仅当按住 Shift 键并单击轨道时才使用此样式，这会导致滑块移到单击的位置。<br/>
                 * 未按下 Shift 键时单击 ScrollBar 轨道将导致出现分页行为。<br/>
                 * 按住 Shift 键并单击时，必须也对 ScrollBar 设置 smoothScrolling 属性才可以实现动画行为。<br/>
                 * 此持续时间是整个滑过轨道的总时间，实际滚动会根据距离相应缩短。
                 * @member egret.gui.TrackBase#slideDuration
                 */
                get: function () {
                    return this._slideDuration;
                },
                set: function (value) {
                    this._slideDuration = value;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TrackBase.prototype, "maximum", {
                /**
                 * 最大有效值
                 * @member egret.gui.TrackBase#maximum
                 */
                get: function () {
                    return this._maximum;
                },
                /**
                 * @inheritDoc
                 */
                set: function (value) {
                    if (value == this._maximum)
                        return;
                    this._setMaximun(value);
                    this.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TrackBase.prototype, "minimum", {
                /**
                 * 最小有效值
                 * @member egret.gui.TrackBase#minimum
                 */
                get: function () {
                    return this._minimum;
                },
                /**
                 * @inheritDoc
                 */
                set: function (value) {
                    if (value == this._minimum)
                        return;
                    this._setMinimun(value);
                    this.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TrackBase.prototype, "value", {
                /**
                 * 此范围的当前值。
                 * @member egret.gui.TrackBase#value
                 */
                get: function () {
                    return this._getValue();
                },
                /**
                 * @inheritDoc
                 */
                set: function (newValue) {
                    if (newValue == this._getValue())
                        return;
                    this._setValue(newValue);
                    this.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            /**
             * @method egret.gui.TrackBase#setValue
             * @param value {number}
             */
            TrackBase.prototype.setValue = function (value) {
                _super.prototype.setValue.call(this, value);
                this.invalidateDisplayList();
            };
            /**
             * 将相对于轨道的 x,y 像素位置转换为介于最小值和最大值（包括两者）之间的一个值。
             * @method egret.gui.TrackBase#pointToValue
             * @param x {number} 相对于轨道原点的位置的x坐标。
             * @param y {number} 相对于轨道原点的位置的y坐标。
             * @returns {number}
             */
            TrackBase.prototype.pointToValue = function (x, y) {
                return this.minimum;
            };
            /**
             * @method egret.gui.TrackBase#changeValueByStep
             * @param increase {boolean}
             */
            TrackBase.prototype.changeValueByStep = function (increase) {
                if (increase === void 0) { increase = true; }
                var prevValue = this.value;
                _super.prototype.changeValueByStep.call(this, increase);
                if (this.value != prevValue)
                    this.dispatchEventWith(egret.Event.CHANGE);
            };
            /**
             * @method egret.gui.TrackBase#partAdded
             * @param partName {string}
             * @param instance {any}
             */
            TrackBase.prototype.partAdded = function (partName, instance) {
                _super.prototype.partAdded.call(this, partName, instance);
                if (instance == this.thumb) {
                    this.thumb.addEventListener(egret.TouchEvent.TOUCH_BEGIN, this.thumb_mouseDownHandler, this);
                    this.thumb.addEventListener(gui.ResizeEvent.RESIZE, this.thumb_resizeHandler, this);
                    this.thumb.addEventListener(gui.UIEvent.UPDATE_COMPLETE, this.thumb_updateCompleteHandler, this);
                    this.thumb.stickyHighlighting = true;
                }
                else if (instance == this.track) {
                    this.track.addEventListener(egret.TouchEvent.TOUCH_BEGIN, this.track_mouseDownHandler, this);
                    this.track.addEventListener(gui.ResizeEvent.RESIZE, this.track_resizeHandler, this);
                }
            };
            /**
             * @method egret.gui.TrackBase#partRemoved
             * @param partName {string}
             * @param instance {any}
             */
            TrackBase.prototype.partRemoved = function (partName, instance) {
                _super.prototype.partRemoved.call(this, partName, instance);
                if (instance == this.thumb) {
                    this.thumb.removeEventListener(egret.TouchEvent.TOUCH_BEGIN, this.thumb_mouseDownHandler, this);
                    this.thumb.removeEventListener(gui.ResizeEvent.RESIZE, this.thumb_resizeHandler, this);
                    this.thumb.removeEventListener(gui.UIEvent.UPDATE_COMPLETE, this.thumb_updateCompleteHandler, this);
                }
                else if (instance == this.track) {
                    this.track.removeEventListener(egret.TouchEvent.TOUCH_BEGIN, this.track_mouseDownHandler, this);
                    this.track.removeEventListener(gui.ResizeEvent.RESIZE, this.track_resizeHandler, this);
                }
            };
            /**
             * @method egret.gui.TrackBase#updateDisplayList
             * @param w {number}
             * @param h {number}
             */
            TrackBase.prototype.updateDisplayList = function (w, h) {
                _super.prototype.updateDisplayList.call(this, w, h);
                this.updateSkinDisplayList();
            };
            /**
             * 更新皮肤部件（通常为滑块）的大小和可见性。<br/>
             * 子类覆盖此方法以基于 minimum、maximum 和 value 属性更新滑块的大小、位置和可见性。
             * @method egret.gui.TrackBase#updateSkinDisplayList
             */
            TrackBase.prototype.updateSkinDisplayList = function () {
            };
            /**
             * 添加到舞台时
             */
            TrackBase.prototype.addedToStageHandler = function (event) {
                this.updateSkinDisplayList();
            };
            /**
             * 轨道尺寸改变事件
             */
            TrackBase.prototype.track_resizeHandler = function (event) {
                this.updateSkinDisplayList();
            };
            /**
             * 滑块尺寸改变事件
             */
            TrackBase.prototype.thumb_resizeHandler = function (event) {
                this.updateSkinDisplayList();
            };
            /**
             * 滑块三个阶段的延迟布局更新完毕事件
             */
            TrackBase.prototype.thumb_updateCompleteHandler = function (event) {
                this.updateSkinDisplayList();
                this.thumb.removeEventListener(gui.UIEvent.UPDATE_COMPLETE, this.thumb_updateCompleteHandler, this);
            };
            /**
             * 滑块按下事件
             * @method egret.gui.TrackBase#thumb_mouseDownHandler
             * @param event {TouchEvent}
             */
            TrackBase.prototype.thumb_mouseDownHandler = function (event) {
                gui.UIGlobals.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE, this.stage_mouseMoveHandler, this);
                gui.UIGlobals.stage.addEventListener(egret.TouchEvent.TOUCH_END, this.stage_mouseUpHandler, this);
                gui.UIGlobals.stage.addEventListener(egret.Event.LEAVE_STAGE, this.stage_mouseUpHandler, this);
                this.addEventListener(egret.Event.ENTER_FRAME, this.onEnterFrame, this);
                var clickOffset = this.thumb.globalToLocal(event.stageX, event.stageY, egret.Point.identity);
                this._clickOffsetX = clickOffset.x;
                this._clickOffsetY = clickOffset.y;
                gui.TrackBaseEvent.dispatchTrackBaseEvent(this, gui.TrackBaseEvent.THUMB_PRESS);
                gui.UIEvent.dispatchUIEvent(this, gui.UIEvent.CHANGE_START);
            };
            /**
             * 拖动thumb过程中触发的EnterFrame事件
             */
            TrackBase.prototype.onEnterFrame = function (event) {
                if (!this.needUpdateValue || !this.track)
                    return;
                this.updateWhenMouseMove();
                this.needUpdateValue = false;
            };
            /**
             * 当thumb被拖动时更新值，此方法每帧只被调用一次，比直接在鼠标移动事件里更新性能更高。
             * @method egret.gui.TrackBase#updateWhenMouseMove
             */
            TrackBase.prototype.updateWhenMouseMove = function () {
                if (!this.track)
                    return;
                var p = this.track.globalToLocal(this._moveStageX, this._moveStageY, egret.Point.identity);
                var newValue = this.pointToValue(p.x - this._clickOffsetX, p.y - this._clickOffsetY);
                newValue = this.nearestValidValue(newValue, this.snapInterval);
                if (newValue != this.value) {
                    this.setValue(newValue);
                    this.validateDisplayList();
                    gui.TrackBaseEvent.dispatchTrackBaseEvent(this, gui.TrackBaseEvent.THUMB_DRAG);
                    this.dispatchEventWith(egret.Event.CHANGE);
                }
            };
            /**
             * 鼠标移动事件
             * @method egret.gui.TrackBase#stage_mouseMoveHandler
             * @param event {TouchEvent}
             */
            TrackBase.prototype.stage_mouseMoveHandler = function (event) {
                this._moveStageX = event.stageX;
                this._moveStageY = event.stageY;
                if (this.needUpdateValue)
                    return;
                this.needUpdateValue = true;
            };
            /**
             * 鼠标弹起事件
             * @method egret.gui.TrackBase#stage_mouseUpHandler
             * @param event {Event}
             */
            TrackBase.prototype.stage_mouseUpHandler = function (event) {
                gui.UIGlobals.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE, this.stage_mouseMoveHandler, this);
                gui.UIGlobals.stage.removeEventListener(egret.TouchEvent.TOUCH_END, this.stage_mouseUpHandler, this);
                gui.UIGlobals.stage.removeEventListener(egret.Event.LEAVE_STAGE, this.stage_mouseUpHandler, this);
                this.removeEventListener(egret.Event.ENTER_FRAME, this.updateWhenMouseMove, this);
                if (this.needUpdateValue) {
                    this.updateWhenMouseMove();
                    this.needUpdateValue = false;
                }
                gui.TrackBaseEvent.dispatchTrackBaseEvent(this, gui.TrackBaseEvent.THUMB_RELEASE);
                gui.UIEvent.dispatchUIEvent(this, gui.UIEvent.CHANGE_END);
            };
            /**
             * 轨道被按下事件
             * @method egret.gui.TrackBase#track_mouseDownHandler
             * @param event {TouchEvent}
             */
            TrackBase.prototype.track_mouseDownHandler = function (event) {
            };
            /**
             * 当在组件上按下鼠标时记录被按下的子显示对象
             */
            TrackBase.prototype.mouseDownHandler = function (event) {
                gui.UIGlobals.stage.addEventListener(egret.TouchEvent.TOUCH_END, this.stage_mouseUpSomewhereHandler, this);
                gui.UIGlobals.stage.addEventListener(egret.Event.LEAVE_STAGE, this.stage_mouseUpSomewhereHandler, this);
                this.mouseDownTarget = (event.target);
            };
            /**
             * 当鼠标弹起时，若不是在mouseDownTarget上弹起，而是另外的子显示对象上弹起时，额外抛出一个鼠标单击事件。
             */
            TrackBase.prototype.stage_mouseUpSomewhereHandler = function (event) {
                gui.UIGlobals.stage.removeEventListener(egret.TouchEvent.TOUCH_END, this.stage_mouseUpSomewhereHandler, this);
                gui.UIGlobals.stage.removeEventListener(egret.Event.LEAVE_STAGE, this.stage_mouseUpSomewhereHandler, this);
                if (this.mouseDownTarget != event.target && event instanceof egret.TouchEvent && this.contains((event.target))) {
                    var mEvent = event;
                    var mousePoint = (event.target).localToGlobal(mEvent.localX, mEvent.localY);
                    egret.TouchEvent.dispatchTouchEvent(this, egret.TouchEvent.TOUCH_TAP, mEvent.touchPointID, mousePoint.x, mousePoint.y, mEvent.ctrlKey, mEvent.altKey, mEvent.shiftKey, mEvent.touchDown);
                }
                this.mouseDownTarget = null;
            };
            return TrackBase;
        })(gui.Range);
        gui.TrackBase = TrackBase;
        TrackBase.prototype.__class__ = "egret.gui.TrackBase";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.SliderBase
         * @classdesc
         * 滑块控件基类
         * @extends egret.gui.TrackBase
         */
        var SliderBase = (function (_super) {
            __extends(SliderBase, _super);
            /**
             * 构造函数
             * @method egret.gui.SliderBase#constructor
             */
            function SliderBase() {
                _super.call(this);
                this._showTrackHighlight = true;
                this._pendingValue = 0;
                this._liveDragging = true;
                this.maximum = 10;
            }
            Object.defineProperty(SliderBase.prototype, "showTrackHighlight", {
                /**
                 * 是否启用轨道高亮效果。默认值为true。
                 * 注意，皮肤里的子部件trackHighlight要同时为非空才能显示高亮效果。
                 * @member egret.gui.SliderBase#showTrackHighlight
                 */
                get: function () {
                    return this._showTrackHighlight;
                },
                set: function (value) {
                    if (this._showTrackHighlight == value)
                        return;
                    this._showTrackHighlight = value;
                    if (this.trackHighlight)
                        this.trackHighlight.visible = value;
                    this.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(SliderBase.prototype, "pendingValue", {
                /**
                 * 释放鼠标按键时滑块将具有的值。无论liveDragging是否为true，在滑块拖动期间始终更新此属性。
                 * 而value属性在当liveDragging为false时，只在鼠标释放时更新一次。
                 * @member egret.gui.SliderBase#pendingValue
                 */
                get: function () {
                    return this._pendingValue;
                },
                set: function (value) {
                    if (value == this._pendingValue)
                        return;
                    this._pendingValue = value;
                    this.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            /**
             * @method egret.gui.SliderBase#setValue
             * @param value {number}
             */
            SliderBase.prototype.setValue = function (value) {
                this._pendingValue = value;
                _super.prototype.setValue.call(this, value);
            };
            /**
             * 动画播放更新数值
             */
            SliderBase.prototype._animationUpdateHandler = function (animation) {
                this.pendingValue = animation.currentValue["value"];
            };
            /**
             * 动画播放完毕
             */
            SliderBase.prototype.animationEndHandler = function (animation) {
                this.setValue(this.slideToValue);
                this.dispatchEventWith(egret.Event.CHANGE);
                gui.UIEvent.dispatchUIEvent(this, gui.UIEvent.CHANGE_END);
            };
            /**
             * 停止播放动画
             */
            SliderBase.prototype.stopAnimation = function () {
                this.animator.stop();
                this.setValue(this.nearestValidValue(this.pendingValue, this.snapInterval));
                this.dispatchEventWith(egret.Event.CHANGE);
                gui.UIEvent.dispatchUIEvent(this, gui.UIEvent.CHANGE_END);
            };
            /**
             * @method egret.gui.SliderBase#thumb_mouseDownHandler
             * @param event {TouchEvent}
             */
            SliderBase.prototype.thumb_mouseDownHandler = function (event) {
                if (this.animator && this.animator.isPlaying)
                    this.stopAnimation();
                _super.prototype.thumb_mouseDownHandler.call(this, event);
            };
            Object.defineProperty(SliderBase.prototype, "liveDragging", {
                /**
                 * 如果为 true，则将在沿着轨道拖动滑块时，而不是在释放滑块按钮时，提交此滑块的值。
                 * @member egret.gui.SliderBase#liveDragging
                 */
                get: function () {
                    return this._liveDragging;
                },
                set: function (value) {
                    this._liveDragging = value;
                },
                enumerable: true,
                configurable: true
            });
            /**
             * @method egret.gui.SliderBase#updateWhenMouseMove
             */
            SliderBase.prototype.updateWhenMouseMove = function () {
                if (!this.track)
                    return;
                var pos = this.track.globalToLocal(this._moveStageX, this._moveStageY, egret.Point.identity);
                var newValue = this.pointToValue(pos.x - this._clickOffsetX, pos.y - this._clickOffsetY);
                newValue = this.nearestValidValue(newValue, this.snapInterval);
                if (newValue != this.pendingValue) {
                    gui.TrackBaseEvent.dispatchTrackBaseEvent(this, gui.TrackBaseEvent.THUMB_DRAG);
                    if (this.liveDragging == true) {
                        this.setValue(newValue);
                        this.dispatchEventWith(egret.Event.CHANGE);
                    }
                    else {
                        this.pendingValue = newValue;
                    }
                }
            };
            /**
             * @method egret.gui.SliderBase#stage_mouseUpHandler
             * @param event {Event}
             */
            SliderBase.prototype.stage_mouseUpHandler = function (event) {
                _super.prototype.stage_mouseUpHandler.call(this, event);
                if ((this.liveDragging == false) && (this.value != this.pendingValue)) {
                    this.setValue(this.pendingValue);
                    this.dispatchEventWith(egret.Event.CHANGE);
                }
            };
            /**
             * @method egret.gui.SliderBase#track_mouseDownHandler
             * @param event {TouchEvent}
             */
            SliderBase.prototype.track_mouseDownHandler = function (event) {
                if (!this.enabled)
                    return;
                var thumbW = (this.thumb) ? this.thumb.width : 0;
                var thumbH = (this.thumb) ? this.thumb.height : 0;
                var offsetX = event.stageX - (thumbW / 2);
                var offsetY = event.stageY - (thumbH / 2);
                var p = this.track.globalToLocal(offsetX, offsetY, egret.Point.identity);
                var newValue = this.pointToValue(p.x, p.y);
                newValue = this.nearestValidValue(newValue, this.snapInterval);
                if (newValue != this.pendingValue) {
                    if (this.slideDuration != 0) {
                        if (!this.animator) {
                            this.animator = new gui.Animation(this._animationUpdateHandler, this);
                            this.animator.endFunction = this.animationEndHandler;
                        }
                        if (this.animator.isPlaying)
                            this.stopAnimation();
                        this.slideToValue = newValue;
                        this.animator.duration = this.slideDuration * (Math.abs(this.pendingValue - this.slideToValue) / (this.maximum - this.minimum));
                        this.animator.motionPaths = [{ prop: "value", from: this.pendingValue, to: this.slideToValue }];
                        gui.UIEvent.dispatchUIEvent(this, gui.UIEvent.CHANGE_START);
                        this.animator.play();
                    }
                    else {
                        this.setValue(newValue);
                        this.dispatchEventWith(egret.Event.CHANGE);
                    }
                }
            };
            /**
             * @method egret.gui.SliderBase#partAdded
             * @param partName {string}
             * @param instance {any}
             */
            SliderBase.prototype.partAdded = function (partName, instance) {
                _super.prototype.partAdded.call(this, partName, instance);
                if (instance == this.trackHighlight) {
                    this.trackHighlight.touchEnabled = false;
                    if (this.trackHighlight instanceof egret.DisplayObjectContainer)
                        (this.trackHighlight).touchChildren = false;
                    this.trackHighlight.visible = this._showTrackHighlight;
                }
            };
            return SliderBase;
        })(gui.TrackBase);
        gui.SliderBase = SliderBase;
        SliderBase.prototype.__class__ = "egret.gui.SliderBase";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.Label
         * @classdesc
         * 一行或多行不可编辑的文本控件
         * @extends egret.gui.TextBase
         */
        var Label = (function (_super) {
            __extends(Label, _super);
            /**
             * @method egret.gui.Label#constructor
             */
            function Label() {
                _super.call(this);
                this._maxDisplayedLines = 0;
                /**
                 * 上一次测量的宽度
                 */
                this.lastUnscaledWidth = NaN;
                this.strokeColorChanged = false;
                this._strokeColor = 0x000000;
                /**
                 * 表示描边宽度。
                 * 0为没有描边。
                 * 默认值为 0。
                 * @member {number} egret.TextField#stroke
                 */
                this._stroke = 0;
                this.strokeChanged = false;
                this._padding = 0;
                this._paddingLeft = NaN;
                this._paddingRight = NaN;
                this._paddingTop = NaN;
                this._paddingBottom = NaN;
                this.addEventListener(gui.UIEvent.UPDATE_COMPLETE, this.updateCompleteHandler, this);
            }
            /**
             * 一个验证阶段完成
             */
            Label.prototype.updateCompleteHandler = function (event) {
                this.lastUnscaledWidth = NaN;
            };
            Object.defineProperty(Label.prototype, "maxDisplayedLines", {
                /**
                 * 最大显示行数,0或负值代表不限制。
                 * @member egret.gui.Label#maxDisplayedLines
                 */
                get: function () {
                    return this._maxDisplayedLines;
                },
                set: function (value) {
                    if (this._maxDisplayedLines == value)
                        return;
                    this._maxDisplayedLines = value;
                    this.invalidateSize();
                    this.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Label.prototype, "strokeColor", {
                /**
                 * 表示文本的描边颜色。
                 * 包含三个 8 位 RGB 颜色成分的数字；例如，0xFF0000 为红色，0x00FF00 为绿色。
                 * 默认值为 0x000000。
                 * @member {number} egret.TextField#strokeColor
                 */
                get: function () {
                    return this._strokeColor;
                },
                set: function (value) {
                    this._setStrokeColor(value);
                },
                enumerable: true,
                configurable: true
            });
            Label.prototype._setStrokeColor = function (value) {
                if (this._strokeColor == value) {
                    return;
                }
                this._strokeColor = value;
                this.strokeColorChanged = true;
                this.invalidateProperties();
            };
            Object.defineProperty(Label.prototype, "stroke", {
                get: function () {
                    return this._stroke;
                },
                set: function (value) {
                    if (this._stroke == value) {
                        return;
                    }
                    this._stroke = value;
                    this.strokeChanged = true;
                    this.invalidateProperties();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Label.prototype, "padding", {
                /**
                 * 四个边缘的共同内边距。若单独设置了任一边缘的内边距，则该边缘的内边距以单独设置的值为准。
                 * 此属性主要用于快速设置多个边缘的相同内边距。默认值：0。
                 * @member egret.gui.Label#padding
                 */
                get: function () {
                    return this._padding;
                },
                set: function (value) {
                    if (this._padding == value)
                        return;
                    this._padding = value;
                    this.invalidateSize();
                    this.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Label.prototype, "paddingLeft", {
                /**
                 * 文字距离左边缘的空白像素,若为NaN将使用padding的值，默认值：NaN。
                 * @member egret.gui.Label#paddingLeft
                 */
                get: function () {
                    return this._paddingLeft;
                },
                set: function (value) {
                    if (this._paddingLeft == value)
                        return;
                    this._paddingLeft = value;
                    this.invalidateSize();
                    this.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Label.prototype, "paddingRight", {
                /**
                 * 文字距离右边缘的空白像素,若为NaN将使用padding的值，默认值：NaN。
                 * @member egret.gui.Label#paddingRight
                 */
                get: function () {
                    return this._paddingRight;
                },
                set: function (value) {
                    if (this._paddingRight == value)
                        return;
                    this._paddingRight = value;
                    this.invalidateSize();
                    this.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Label.prototype, "paddingTop", {
                /**
                 * 文字距离顶部边缘的空白像素,若为NaN将使用padding的值，默认值：NaN。
                 * @member egret.gui.Label#paddingTop
                 */
                get: function () {
                    return this._paddingTop;
                },
                set: function (value) {
                    if (this._paddingTop == value)
                        return;
                    this._paddingTop = value;
                    this.invalidateSize();
                    this.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Label.prototype, "paddingBottom", {
                /**
                 * 文字距离底部边缘的空白像素,若为NaN将使用padding的值，默认值：NaN。
                 * @member egret.gui.Label#paddingBottom
                 */
                get: function () {
                    return this._paddingBottom;
                },
                set: function (value) {
                    if (this._paddingBottom == value)
                        return;
                    this._paddingBottom = value;
                    this.invalidateSize();
                    this.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            /**
             * @method egret.gui.TextBase#commitProperties
             */
            Label.prototype.commitProperties = function () {
                _super.prototype.commitProperties.call(this);
                if (this.strokeColorChanged) {
                    this._textField.strokeColor = this._strokeColor;
                    this.strokeColorChanged = false;
                }
                if (this.strokeChanged) {
                    this._textField.stroke = this._stroke;
                    this.strokeChanged = false;
                }
            };
            /**
             * @method egret.gui.Label#measure
             */
            Label.prototype.measure = function () {
                //先提交属性，防止样式发生改变导致的测量不准确问题。
                if (this._invalidatePropertiesFlag)
                    this.validateProperties();
                if (this.isSpecialCase()) {
                    if (isNaN(this.lastUnscaledWidth)) {
                        this._oldPreferWidth = NaN;
                        this._oldPreferHeight = NaN;
                    }
                    else {
                        this.measureUsingWidth(this.lastUnscaledWidth);
                        return;
                    }
                }
                var availableWidth;
                if (!isNaN(this.explicitWidth))
                    availableWidth = this.explicitWidth;
                else if (this.maxWidth != 10000)
                    availableWidth = this.maxWidth;
                this.measureUsingWidth(availableWidth);
            };
            /**
             * 特殊情况，组件尺寸由父级决定，要等到父级UpdateDisplayList的阶段才能测量
             */
            Label.prototype.isSpecialCase = function () {
                return this._maxDisplayedLines != 1 && (!isNaN(this.percentWidth) || (!isNaN(this.left) && !isNaN(this.right))) && isNaN(this.explicitHeight) && isNaN(this.percentHeight);
            };
            /**
             * 使用指定的宽度进行测量
             */
            Label.prototype.measureUsingWidth = function (w) {
                if (this._textChanged) {
                    this._textField.text = this._text;
                }
                if (this._textFlowChanged) {
                    this._textField.textFlow = this._textFlow;
                }
                var padding = isNaN(this._padding) ? 0 : this._padding;
                var paddingL = isNaN(this._paddingLeft) ? padding : this._paddingLeft;
                var paddingR = isNaN(this._paddingRight) ? padding : this._paddingRight;
                var paddingT = isNaN(this._paddingTop) ? padding : this._paddingTop;
                var paddingB = isNaN(this._paddingBottom) ? padding : this._paddingBottom;
                this._textField.width = NaN;
                this._textField.height = NaN;
                if (!isNaN(w)) {
                    this._textField.width = w - paddingL - paddingR;
                    this.measuredWidth = Math.ceil(this._textField.measuredWidth);
                    this.measuredHeight = Math.ceil(this._textField.measuredHeight);
                }
                else {
                    this.measuredWidth = Math.ceil(this._textField.measuredWidth);
                    this.measuredHeight = Math.ceil(this._textField.measuredHeight);
                }
                if (this._maxDisplayedLines > 0 && this._textField.numLines > this._maxDisplayedLines) {
                    var size = this._textField.size;
                    var lineSpacing = this._textField.lineSpacing;
                    this.measuredHeight = (size + lineSpacing) * this._maxDisplayedLines - lineSpacing;
                }
                this.measuredWidth += paddingL + paddingR;
                this.measuredHeight += paddingT + paddingB;
            };
            /**
             * @method egret.gui.Label#updateDisplayList
             * @param unscaledWidth {number}
             * @param unscaledHeight {number}
             */
            Label.prototype.updateDisplayList = function (unscaledWidth, unscaledHeight) {
                this.$updateDisplayList(unscaledWidth, unscaledHeight);
                var padding = isNaN(this._padding) ? 0 : this._padding;
                var paddingL = isNaN(this._paddingLeft) ? padding : this._paddingLeft;
                var paddingR = isNaN(this._paddingRight) ? padding : this._paddingRight;
                var paddingT = isNaN(this._paddingTop) ? padding : this._paddingTop;
                var paddingB = isNaN(this._paddingBottom) ? padding : this._paddingBottom;
                this._textField.x = paddingL;
                this._textField.y = paddingT;
                if (this.isSpecialCase()) {
                    var firstTime = isNaN(this.lastUnscaledWidth) || this.lastUnscaledWidth != unscaledWidth;
                    this.lastUnscaledWidth = unscaledWidth;
                    if (firstTime) {
                        this._oldPreferWidth = NaN;
                        this._oldPreferHeight = NaN;
                        this.invalidateSize();
                        return;
                    }
                }
                //防止在父级validateDisplayList()阶段改变的text属性值，
                //接下来直接调用自身的updateDisplayList()而没有经过measure(),使用的测量尺寸是上一次的错误值。
                if (this._invalidateSizeFlag)
                    this.validateSize();
                if (!this._textField.visible)
                    this._textField.visible = true;
                this._textField.width = unscaledWidth - paddingL - paddingR;
                var unscaledTextHeight = unscaledHeight - paddingT - paddingB;
                this._textField.height = unscaledTextHeight;
                if (this._maxDisplayedLines > 0 && this._textField.numLines > this._maxDisplayedLines) {
                    var size = this._textField.size;
                    var lineSpacing = this._textField.lineSpacing;
                    var h = (size + lineSpacing) * this._maxDisplayedLines - lineSpacing;
                    this._textField.height = Math.min(unscaledTextHeight, h);
                }
            };
            return Label;
        })(gui.TextBase);
        gui.Label = Label;
        Label.prototype.__class__ = "egret.gui.Label";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.Rect
         * @classdesc
         * 矩形绘图元素。此组件可响应鼠标事件。
         * @extends egret.gui.UIComponent
         */
        var Rect = (function (_super) {
            __extends(Rect, _super);
            /**
             * 构造函数
             * @method egret.gui.Rect#constructor
             */
            function Rect() {
                _super.call(this);
                this._fillColor = 0xFFFFFF;
                this._fillAlpha = 1;
                this._strokeColor = 0x444444;
                this._strokeAlpha = 0;
                this._strokeWeight = 1;
                this.touchChildren = false;
            }
            Object.defineProperty(Rect.prototype, "graphics", {
                get: function () {
                    if (!this._graphics) {
                        this._graphics = new egret.Graphics();
                    }
                    return this._graphics;
                },
                enumerable: true,
                configurable: true
            });
            Rect.prototype._render = function (renderContext) {
                if (this._graphics)
                    this._graphics._draw(renderContext);
                _super.prototype._render.call(this, renderContext);
            };
            Object.defineProperty(Rect.prototype, "fillColor", {
                /**
                 * 填充颜色
                 * @member egret.gui.Rect#fillColor
                 */
                get: function () {
                    return this._fillColor;
                },
                set: function (value) {
                    if (this._fillColor == value)
                        return;
                    this._fillColor = value;
                    this.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Rect.prototype, "fillAlpha", {
                /**
                 * 填充透明度,默认值为0。
                 * @member egret.gui.Rect#fillAlpha
                 */
                get: function () {
                    return this._fillAlpha;
                },
                set: function (value) {
                    if (this._fillAlpha == value)
                        return;
                    this._fillAlpha = value;
                    this.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Rect.prototype, "strokeColor", {
                /**
                 * 边框颜色,注意：当strokeAlpha为0时，不显示边框。
                 * @member egret.gui.Rect#strokeColor
                 */
                get: function () {
                    return this._strokeColor;
                },
                set: function (value) {
                    if (this._strokeColor == value)
                        return;
                    this._strokeColor = value;
                    this.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Rect.prototype, "strokeAlpha", {
                /**
                 * 边框透明度，默认值为0。
                 * @member egret.gui.Rect#strokeAlpha
                 */
                get: function () {
                    return this._strokeAlpha;
                },
                set: function (value) {
                    if (this._strokeAlpha == value)
                        return;
                    this._strokeAlpha = value;
                    this.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Rect.prototype, "strokeWeight", {
                /**
                 * 边框粗细(像素),注意：当strokeAlpha为0时，不显示边框。
                 * @member egret.gui.Rect#strokeWeight
                 */
                get: function () {
                    return this._strokeWeight;
                },
                set: function (value) {
                    if (this._strokeWeight == value)
                        return;
                    this._strokeWeight = value;
                    this.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            /**
             * @see egret.DisplayObject.measureBounds
             * @returns {Rectangle}
             * @private
             */
            Rect.prototype._measureBounds = function () {
                var bounds = _super.prototype._measureBounds.call(this);
                var w = this.width;
                var h = this.height;
                var x = 0;
                var y = 0;
                if (x < bounds.x) {
                    bounds.x = x;
                }
                if (y < bounds.y) {
                    bounds.y = y;
                }
                if (x + w > bounds.right) {
                    bounds.right = x + w;
                }
                if (y + h > bounds.bottom) {
                    bounds.bottom = y + h;
                }
                return bounds;
            };
            /**
             * @method egret.gui.Rect#updateDisplayList
             * @param unscaledWidth {number}
             * @param unscaledHeight {number}
             */
            Rect.prototype.updateDisplayList = function (unscaledWidth, unscaledHeight) {
                _super.prototype.updateDisplayList.call(this, unscaledWidth, unscaledWidth);
                var g = this.graphics;
                g.clear();
                g.beginFill(this._fillColor, this._fillAlpha);
                if (this._strokeAlpha > 0) {
                    g.lineStyle(this._strokeWeight, this._strokeColor, this._strokeAlpha, true, "normal", "square", "miter");
                }
                g.drawRect(0, 0, unscaledWidth, unscaledHeight);
                g.endFill();
            };
            return Rect;
        })(gui.UIComponent);
        gui.Rect = Rect;
        Rect.prototype.__class__ = "egret.gui.Rect";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.Button
         * @classdesc
         * 按钮控件
         * @extends egret.gui.ButtonBase
         */
        var Button = (function (_super) {
            __extends(Button, _super);
            /**
             * @method egret.gui.Button#constructor
             */
            function Button() {
                _super.call(this);
            }
            Object.defineProperty(Button.prototype, "icon", {
                /**
                 * 要在按钮上显示的图标
                 * @member egret.gui.ButtonBase#icon
                 */
                get: function () {
                    return this._getIcon();
                },
                set: function (value) {
                    this._setIcon(value);
                },
                enumerable: true,
                configurable: true
            });
            Button.prototype._getIcon = function () {
                if (this.iconDisplay) {
                    return this.iconDisplay.source;
                }
                else {
                    return this._icon;
                }
            };
            Button.prototype._setIcon = function (value) {
                this._icon = value;
                if (this.iconDisplay) {
                    this.iconDisplay.source = value;
                }
            };
            /**
             * @method egret.gui.ButtonBase#partAdded
             * @param partName {string}
             * @param instance {any}
             */
            Button.prototype.partAdded = function (partName, instance) {
                _super.prototype.partAdded.call(this, partName, instance);
                if (instance == this.iconDisplay) {
                    this.iconDisplay.source = this._icon;
                }
            };
            return Button;
        })(gui.ButtonBase);
        gui.Button = Button;
        Button.prototype.__class__ = "egret.gui.Button";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.ToggleButton
         * @classdesc
         * 切换按钮
         * @extends egret.gui.ToggleButtonBase
         */
        var ToggleButton = (function (_super) {
            __extends(ToggleButton, _super);
            /**
             * 构造函数
             * @method egret.gui.ToggleButton#constructor
             */
            function ToggleButton() {
                _super.call(this);
            }
            Object.defineProperty(ToggleButton.prototype, "icon", {
                /**
                 * 要在按钮上显示的图标
                 * @member egret.gui.ButtonBase#icon
                 */
                get: function () {
                    return this._getIcon();
                },
                set: function (value) {
                    this._setIcon(value);
                },
                enumerable: true,
                configurable: true
            });
            ToggleButton.prototype._getIcon = function () {
                if (this.iconDisplay) {
                    return this.iconDisplay.source;
                }
                else {
                    return this._icon;
                }
            };
            ToggleButton.prototype._setIcon = function (value) {
                this._icon = value;
                if (this.iconDisplay) {
                    this.iconDisplay.source = value;
                }
            };
            /**
             * @param partName {string}
             * @param instance {any}
             */
            ToggleButton.prototype.partAdded = function (partName, instance) {
                _super.prototype.partAdded.call(this, partName, instance);
                if (instance == this.iconDisplay) {
                    this.iconDisplay.source = this._icon;
                }
            };
            return ToggleButton;
        })(gui.ToggleButtonBase);
        gui.ToggleButton = ToggleButton;
        ToggleButton.prototype.__class__ = "egret.gui.ToggleButton";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.Group
         * @classdesc
         * 自动布局容器
         * @extends egret.gui.GroupBase
         * @implements egret.gui.IVisualElementContainer
         */
        var Group = (function (_super) {
            __extends(Group, _super);
            /**
             * @method egret.gui.Group#constructor
             */
            function Group() {
                _super.call(this);
                /**
                 * createChildren()方法已经执行过的标志
                 */
                this.createChildrenCalled = false;
                /**
                 * elementsContent改变标志
                 */
                this.elementsContentChanged = false;
                this._elementsContent = [];
            }
            /**
             * @method egret.gui.Group#createChildren
             */
            Group.prototype.createChildren = function () {
                _super.prototype.createChildren.call(this);
                this.createChildrenCalled = true;
                if (this.elementsContentChanged) {
                    this.elementsContentChanged = false;
                    this.setElementsContent(this._elementsContent);
                }
            };
            /**
             * 返回子元素列表
             */
            Group.prototype._getElementsContent = function () {
                return this._elementsContent;
            };
            Object.defineProperty(Group.prototype, "elementsContent", {
                /**
                 * 设置容器子对象数组 。数组包含要添加到容器的子项列表，之前的已存在于容器中的子项列表被全部移除后添加列表里的每一项到容器。
                 * 设置该属性时会对您输入的数组进行一次浅复制操作，所以您之后对该数组的操作不会影响到添加到容器的子项列表数量。
                 */
                set: function (value) {
                    if (value == null)
                        value = [];
                    if (value == this._elementsContent)
                        return;
                    if (this.createChildrenCalled) {
                        this.setElementsContent(value);
                    }
                    else {
                        this.elementsContentChanged = true;
                        for (var i = this._elementsContent.length - 1; i >= 0; i--) {
                            this._elementRemoved(this._elementsContent[i], i);
                        }
                        this._elementsContent = value;
                    }
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 设置容器子对象列表
             */
            Group.prototype.setElementsContent = function (value) {
                var i;
                for (i = this._elementsContent.length - 1; i >= 0; i--) {
                    this._elementRemoved(this._elementsContent[i], i);
                }
                this._elementsContent = value.concat();
                var n = this._elementsContent.length;
                for (i = 0; i < n; i++) {
                    var elt = this._elementsContent[i];
                    if (elt.parent && "removeElement" in elt.parent)
                        (elt.parent).removeElement(elt);
                    else if (elt.owner && "removeElement" in elt.owner)
                        (elt.owner).removeElement(elt);
                    this._elementAdded(elt, i);
                }
            };
            Object.defineProperty(Group.prototype, "numElements", {
                /**
                 * @member egret.gui.Group#numElements
                 */
                get: function () {
                    return this._elementsContent.length;
                },
                enumerable: true,
                configurable: true
            });
            /**
             * @method egret.gui.Group#getElementAt
             * @param index {number}
             * @returns {IVisualElement}
             */
            Group.prototype.getElementAt = function (index) {
                this.checkForRangeError(index);
                return this._elementsContent[index];
            };
            Group.prototype.checkForRangeError = function (index, addingElement) {
                if (addingElement === void 0) { addingElement = false; }
                var maxIndex = this._elementsContent.length - 1;
                if (addingElement)
                    maxIndex++;
                if (index < 0 || index > maxIndex)
                    throw new RangeError("索引:\"" + index + "\"超出可视元素索引范围");
            };
            /**
             * @method egret.gui.Group#addElement
             * @param element {IVisualElement}
             * @returns {IVisualElement}
             */
            Group.prototype.addElement = function (element) {
                var index = this.numElements;
                if (element.parent == this)
                    index = this.numElements - 1;
                return this.addElementAt(element, index);
            };
            /**
             * @method egret.gui.Group#addElementAt
             * @param element {IVisualElement}
             * @param index {number}
             * @returns {IVisualElement}
             */
            Group.prototype.addElementAt = function (element, index) {
                if (element == this)
                    return element;
                this.checkForRangeError(index, true);
                var host = element.owner;
                if (host == this || element.parent == this) {
                    this.setElementIndex(element, index);
                    return element;
                }
                else if (host && "removeElement" in host) {
                    (element.owner).removeElement(element);
                }
                this._elementsContent.splice(index, 0, element);
                if (!this.elementsContentChanged)
                    this._elementAdded(element, index);
                return element;
            };
            /**
             * @method egret.gui.Group#removeElement
             * @param element {IVisualElement}
             * @returns {IVisualElement}
             */
            Group.prototype.removeElement = function (element) {
                return this.removeElementAt(this.getElementIndex(element));
            };
            /**
             * @method egret.gui.Group#removeElementAt
             * @param index {number}
             * @returns {IVisualElement}
             */
            Group.prototype.removeElementAt = function (index) {
                this.checkForRangeError(index);
                var element = this._elementsContent[index];
                if (!this.elementsContentChanged)
                    this._elementRemoved(element, index);
                this._elementsContent.splice(index, 1);
                return element;
            };
            /**
             * @method egret.gui.Group#removeAllElements
             */
            Group.prototype.removeAllElements = function () {
                for (var i = this.numElements - 1; i >= 0; i--) {
                    this.removeElementAt(i);
                }
            };
            /**
             * @method egret.gui.Group#getElementIndex
             * @param element {IVisualElement}
             * @returns {number}
             */
            Group.prototype.getElementIndex = function (element) {
                return this._elementsContent.indexOf(element);
            };
            /**
             * @method egret.gui.Group#setElementIndex
             * @param element {IVisualElement}
             * @param index {number}
             */
            Group.prototype.setElementIndex = function (element, index) {
                this.checkForRangeError(index);
                var oldIndex = this.getElementIndex(element);
                if (oldIndex == -1 || oldIndex == index)
                    return;
                if (!this.elementsContentChanged)
                    this._elementRemoved(element, oldIndex, false);
                this._elementsContent.splice(oldIndex, 1);
                this._elementsContent.splice(index, 0, element);
                if (!this.elementsContentChanged)
                    this._elementAdded(element, index, false);
            };
            /**
             * @method egret.gui.Group#swapElements
             * @param element1 {IVisualElement}
             * @param element2 {IVisualElement}
             */
            Group.prototype.swapElements = function (element1, element2) {
                this.swapElementsAt(this.getElementIndex(element1), this.getElementIndex(element2));
            };
            /**
             * @method egret.gui.Group#swapElementsAt
             * @param index1 {number}
             * @param index2 {number}
             */
            Group.prototype.swapElementsAt = function (index1, index2) {
                this.checkForRangeError(index1);
                this.checkForRangeError(index2);
                if (index1 > index2) {
                    var temp = index2;
                    index2 = index1;
                    index1 = temp;
                }
                else if (index1 == index2)
                    return;
                var elementsContent = this._elementsContent;
                var element1 = elementsContent[index1];
                var element2 = elementsContent[index2];
                if (!this.elementsContentChanged) {
                    this._elementRemoved(element1, index1, false);
                    this._elementRemoved(element2, index2, false);
                }
                elementsContent[index1] = element2;
                elementsContent[index2] = element1;
                if (!this.elementsContentChanged) {
                    this._elementAdded(element2, index1, false);
                    this._elementAdded(element1, index2, false);
                }
            };
            /**
             * 添加一个显示元素到容器
             * @param element {IVisualElement}
             * @param index {number}
             * @param notifyListeners {boolean}
             */
            Group.prototype._elementAdded = function (element, index, notifyListeners) {
                if (notifyListeners === void 0) { notifyListeners = true; }
                if (element instanceof egret.DisplayObject) {
                    var childDO = element;
                    this._addToDisplayListAt(childDO, index, notifyListeners);
                }
                if (notifyListeners) {
                    if (this.hasEventListener(gui.ElementExistenceEvent.ELEMENT_ADD))
                        gui.ElementExistenceEvent.dispatchElementExistenceEvent(this, gui.ElementExistenceEvent.ELEMENT_ADD, element, index);
                }
                this.invalidateSize();
                this.invalidateDisplayList();
            };
            /**
             * 从容器移除一个显示元素
             * @param element {IVisualElement}
             * @param index {number}
             * @param notifyListeners {boolean}
             */
            Group.prototype._elementRemoved = function (element, index, notifyListeners) {
                if (notifyListeners === void 0) { notifyListeners = true; }
                if (notifyListeners) {
                    if (this.hasEventListener(gui.ElementExistenceEvent.ELEMENT_REMOVE))
                        gui.ElementExistenceEvent.dispatchElementExistenceEvent(this, gui.ElementExistenceEvent.ELEMENT_REMOVE, element, index);
                }
                if (element instanceof egret.DisplayObject && element.parent == this) {
                    var childDO = element;
                    this._removeFromDisplayList(childDO, notifyListeners);
                }
                this.invalidateSize();
                this.invalidateDisplayList();
            };
            /**
             * @deprecated
             * @param child {DisplayObject}
             * @returns {DisplayObject}
             */
            Group.prototype.addChild = function (child) {
                throw (new Error("addChild()" + Group.errorStr + "addElement()代替"));
            };
            /**
             * @deprecated
             * @param child {DisplayObject}
             * @param index {number}
             * @returns {DisplayObject}
             */
            Group.prototype.addChildAt = function (child, index) {
                throw (new Error("addChildAt()" + Group.errorStr + "addElementAt()代替"));
            };
            /**
             * @deprecated
             * @param child {DisplayObject}
             * @returns {DisplayObject}
             */
            Group.prototype.removeChild = function (child) {
                throw (new Error("removeChild()" + Group.errorStr + "removeElement()代替"));
            };
            /**
             * @method egret.gui.Group#removeChildAt
             * @deprecated
             * @param index {number}
             * @returns {DisplayObject}
             */
            Group.prototype.removeChildAt = function (index) {
                throw (new Error("removeChildAt()" + Group.errorStr + "removeElementAt()代替"));
            };
            /**
             * @deprecated
             * @param child {DisplayObject}
             * @param index {number}
             */
            Group.prototype.setChildIndex = function (child, index) {
                throw (new Error("setChildIndex()" + Group.errorStr + "setElementIndex()代替"));
            };
            /**
             * @deprecated
             * @param child1 {DisplayObject}
             * @param child2 {DisplayObject}
             */
            Group.prototype.swapChildren = function (child1, child2) {
                throw (new Error("swapChildren()" + Group.errorStr + "swapElements()代替"));
            };
            /**
             * @method egret.gui.Group#swapChildrenAt
             * @deprecated
             * @param index1 {number}
             * @param index2 {number}
             */
            Group.prototype.swapChildrenAt = function (index1, index2) {
                throw (new Error("swapChildrenAt()" + Group.errorStr + "swapElementsAt()代替"));
            };
            Group.errorStr = "在此组件中不可用，若此组件为容器类，请使用";
            return Group;
        })(gui.GroupBase);
        gui.Group = Group;
        Group.prototype.__class__ = "egret.gui.Group";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.Skin
         * @classdesc
         * 含有视图状态功能的皮肤基类。
         * @extends egret.EventDispatcher
         * @implements egret.gui.IStateClient
         * @implements egret.gui.ISkin
         * @implements egret.gui.IContainer
         */
        var Skin = (function (_super) {
            __extends(Skin, _super);
            /**
             * 构造函数
             * @method egret.gui.Skin#constructor
             */
            function Skin() {
                _super.call(this);
                /**
                 * 组件的最大测量宽度,仅影响measuredWidth属性的取值范围。
                 * @member egret.gui.Skin#maxWidth
                 */
                this.maxWidth = 10000;
                /**
                 * 组件的最小测量宽度,此属性设置为大于maxWidth的值时无效。仅影响measuredWidth属性的取值范围。
                 * @member egret.gui.Skin#minWidth
                 */
                this.minWidth = 0;
                /**
                 * 组件的最大测量高度,仅影响measuredHeight属性的取值范围。
                 * @member egret.gui.Skin#maxHeight
                 */
                this.maxHeight = 10000;
                /**
                 * 组件的最小测量高度,此属性设置为大于maxHeight的值时无效。仅影响measuredHeight属性的取值范围。
                 * @member egret.gui.Skin#minHeight
                 */
                this.minHeight = 0;
                this._hasWidthSet = false;
                this._width = NaN;
                this._hasHeightSet = false;
                this._height = NaN;
                /**
                 * 组件的默认宽度（以像素为单位）。此值由 measure() 方法设置。
                 * @member egret.gui.Skin#measuredWidth
                 */
                this.measuredWidth = 0;
                /**
                 * 组件的默认高度（以像素为单位）。此值由 measure() 方法设置。
                 * @member egret.gui.Skin#measuredHeight
                 */
                this.measuredHeight = 0;
                this._initialized = false;
                this._elementsContent = [];
                //========================state相关函数===============start=========================
                this._states = [];
                this.initialized = false;
                this.skinLayout = new gui.SkinBasicLayout();
                this.skinLayout.target = this;
            }
            Object.defineProperty(Skin.prototype, "width", {
                /**
                 * 组件宽度,默认值为NaN,设置为NaN将使用组件的measure()方法自动计算尺寸
                 * @member egret.gui.Skin#width
                 */
                get: function () {
                    return this._width;
                },
                set: function (value) {
                    if (this._width == value)
                        return;
                    this._width = value;
                    this._hasWidthSet = egret.NumberUtils.isNumber(value);
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Skin.prototype, "height", {
                /**
                 * 组件高度,默认值为NaN,设置为NaN将使用组件的measure()方法自动计算尺寸
                 * @member egret.gui.Skin#height
                 */
                get: function () {
                    return this._height;
                },
                set: function (value) {
                    if (this._height == value)
                        return;
                    this._height = value;
                    this._hasHeightSet = egret.NumberUtils.isNumber(value);
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Skin.prototype, "preferredWidth", {
                get: function () {
                    return this._hasWidthSet ? this._width : this.measuredWidth;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Skin.prototype, "preferredHeight", {
                get: function () {
                    return this._hasHeightSet ? this._height : this.measuredHeight;
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 创建子项,子类覆盖此方法以完成组件子项的初始化操作，
             * 请务必调用super.createChildren()以完成父类组件的初始化
             * @method egret.gui.Skin#createChildren
             */
            Skin.prototype.createChildren = function () {
            };
            Object.defineProperty(Skin.prototype, "hostComponent", {
                /**
                 * @member egret.gui.Skin#hostComponent
                 */
                get: function () {
                    return this._hostComponent;
                },
                /**
                 * @inheritDoc
                 */
                set: function (value) {
                    this._setHostComponent(value);
                },
                enumerable: true,
                configurable: true
            });
            Skin.prototype._setHostComponent = function (value) {
                if (this._hostComponent == value)
                    return;
                var i;
                if (this._hostComponent) {
                    for (i = this._elementsContent.length - 1; i >= 0; i--) {
                        this._elementRemoved(this._elementsContent[i], i);
                    }
                }
                this._hostComponent = value;
                if (!this._initialized) {
                    this._initialized = true;
                    this.createChildren();
                }
                if (this._hostComponent) {
                    var n = this._elementsContent.length;
                    for (i = 0; i < n; i++) {
                        this._elementAdded(this._elementsContent[i], i);
                    }
                    this.initializeStates();
                    if (this.currentStateChanged) {
                        this.commitCurrentState();
                    }
                }
            };
            /**
             * 返回子元素列表
             */
            Skin.prototype._getElementsContent = function () {
                return this._elementsContent;
            };
            Object.defineProperty(Skin.prototype, "elementsContent", {
                /**
                 * 设置容器子对象数组 。数组包含要添加到容器的子项列表，之前的已存在于容器中的子项列表被全部移除后添加列表里的每一项到容器。
                 * 设置该属性时会对您输入的数组进行一次浅复制操作，所以您之后对该数组的操作不会影响到添加到容器的子项列表数量。
                 */
                set: function (value) {
                    if (value == null)
                        value = [];
                    if (value == this._elementsContent)
                        return;
                    if (this._hostComponent) {
                        var i;
                        for (i = this._elementsContent.length - 1; i >= 0; i--) {
                            this._elementRemoved(this._elementsContent[i], i);
                        }
                        this._elementsContent = value.concat();
                        var n = this._elementsContent.length;
                        for (i = 0; i < n; i++) {
                            var elt = this._elementsContent[i];
                            if (elt.parent && "removeElement" in elt.parent)
                                (elt.parent).removeElement(elt);
                            else if (elt.owner && "removeElement" in elt.owner)
                                (elt.owner).removeElement(elt);
                            this._elementAdded(elt, i);
                        }
                    }
                    else {
                        this._elementsContent = value.concat();
                    }
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Skin.prototype, "numElements", {
                /**
                 * @member egret.gui.Skin#numElements
                 */
                get: function () {
                    return this._elementsContent.length;
                },
                enumerable: true,
                configurable: true
            });
            /**
             * @method egret.gui.Skin#getElementAt
             * @param index {number}
             * @returns {IVisualElement}
             */
            Skin.prototype.getElementAt = function (index) {
                this.checkForRangeError(index);
                return this._elementsContent[index];
            };
            Skin.prototype.checkForRangeError = function (index, addingElement) {
                if (addingElement === void 0) { addingElement = false; }
                var maxIndex = this._elementsContent.length - 1;
                if (addingElement)
                    maxIndex++;
                if (index < 0 || index > maxIndex)
                    throw new RangeError("索引:\"" + index + "\"超出可视元素索引范围");
            };
            /**
             * @method egret.gui.Skin#addElement
             * @param element {IVisualElement}
             * @returns {IVisualElement}
             */
            Skin.prototype.addElement = function (element) {
                var index = this.numElements;
                if (element.owner == this)
                    index = this.numElements - 1;
                return this.addElementAt(element, index);
            };
            /**
             * @method egret.gui.Skin#addElementAt
             * @param element {IVisualElement}
             * @param index {number}
             * @returns {IVisualElement}
             */
            Skin.prototype.addElementAt = function (element, index) {
                this.checkForRangeError(index, true);
                var host = element.owner;
                if (host == this) {
                    this.setElementIndex(element, index);
                    return element;
                }
                else if (host && "removeElement" in host) {
                    host.removeElement(element);
                }
                this._elementsContent.splice(index, 0, element);
                if (this._hostComponent)
                    this._elementAdded(element, index);
                else
                    element.ownerChanged(this);
                return element;
            };
            /**
             * @method egret.gui.Skin#removeElement
             * @param element {IVisualElement}
             * @returns {IVisualElement}
             */
            Skin.prototype.removeElement = function (element) {
                return this.removeElementAt(this.getElementIndex(element));
            };
            /**
             * @method egret.gui.Skin#removeElementAt
             * @param index {number}
             * @returns {IVisualElement}
             */
            Skin.prototype.removeElementAt = function (index) {
                this.checkForRangeError(index);
                var element = this._elementsContent[index];
                if (this._hostComponent)
                    this._elementRemoved(element, index);
                else
                    element.ownerChanged(null);
                this._elementsContent.splice(index, 1);
                return element;
            };
            /**
             * @method egret.gui.Skin#getElementIndex
             * @param element {IVisualElement}
             * @returns {number}
             */
            Skin.prototype.getElementIndex = function (element) {
                return this._elementsContent.indexOf(element);
            };
            /**
             * @method egret.gui.Skin#setElementIndex
             * @param element {IVisualElement}
             * @param index {number}
             */
            Skin.prototype.setElementIndex = function (element, index) {
                this.checkForRangeError(index);
                var oldIndex = this.getElementIndex(element);
                if (oldIndex == -1 || oldIndex == index)
                    return;
                if (this._hostComponent)
                    this._elementRemoved(element, oldIndex, false);
                this._elementsContent.splice(oldIndex, 1);
                this._elementsContent.splice(index, 0, element);
                if (this._hostComponent)
                    this._elementAdded(element, index, false);
            };
            /**
             * 添加一个显示元素到容器
             * @param element {IVisualElement}
             * @param index {number}
             * @param notifyListeners {boolean}
             */
            Skin.prototype._elementAdded = function (element, index, notifyListeners) {
                if (notifyListeners === void 0) { notifyListeners = true; }
                element.ownerChanged(this);
                if (element instanceof egret.DisplayObject) {
                    var childDO = element;
                    this._hostComponent._addToDisplayListAt(childDO, index, notifyListeners);
                }
                if (notifyListeners) {
                    if (this.hasEventListener(gui.ElementExistenceEvent.ELEMENT_ADD))
                        gui.ElementExistenceEvent.dispatchElementExistenceEvent(this, gui.ElementExistenceEvent.ELEMENT_ADD, element, index);
                }
                this._hostComponent.invalidateSize();
                this._hostComponent.invalidateDisplayList();
            };
            /**
             * 从容器移除一个显示元素
             * @param element {IVisualElement}
             * @param index {number}
             * @param notifyListeners {boolean}
             */
            Skin.prototype._elementRemoved = function (element, index, notifyListeners) {
                if (notifyListeners === void 0) { notifyListeners = true; }
                if (notifyListeners) {
                    if (this.hasEventListener(gui.ElementExistenceEvent.ELEMENT_REMOVE))
                        gui.ElementExistenceEvent.dispatchElementExistenceEvent(this, gui.ElementExistenceEvent.ELEMENT_REMOVE, element, index);
                }
                if (element instanceof egret.DisplayObject && element.parent == this._hostComponent) {
                    var childDO = element;
                    this._hostComponent._removeFromDisplayList(childDO, notifyListeners);
                }
                element.ownerChanged(null);
                this._hostComponent.invalidateSize();
                this._hostComponent.invalidateDisplayList();
            };
            /**
             * 测量组件尺寸
             * @method egret.gui.Skin#measure
             */
            Skin.prototype.measure = function () {
                this.skinLayout.measure();
                if (this.measuredWidth < this.minWidth) {
                    this.measuredWidth = this.minWidth;
                }
                if (this.measuredWidth > this.maxWidth) {
                    this.measuredWidth = this.maxWidth;
                }
                if (this.measuredHeight < this.minHeight) {
                    this.measuredHeight = this.minHeight;
                }
                if (this.measuredHeight > this.maxHeight) {
                    this.measuredHeight = this.maxHeight;
                }
            };
            /**
             * 更新显示列表
             * @method egret.gui.Skin#updateDisplayList
             * @param unscaledWidth {number}
             * @param unscaledHeight {number}
             */
            Skin.prototype.updateDisplayList = function (unscaledWidth, unscaledHeight) {
                this.skinLayout.updateDisplayList(unscaledWidth, unscaledHeight);
            };
            Object.defineProperty(Skin.prototype, "states", {
                /**
                 * 为此组件定义的视图状态。
                 * @member egret.StateClientHelper#states
                 */
                get: function () {
                    return this._states;
                },
                set: function (value) {
                    this._setStates(value);
                },
                enumerable: true,
                configurable: true
            });
            Skin.prototype._setStates = function (value) {
                if (!value)
                    value = [];
                if (typeof (value[0]) == "string") {
                    var length = value.length;
                    for (var i = 0; i < length; i++) {
                        var state = new gui.State(value[i], []);
                        value[i] = state;
                    }
                }
                this._states = value;
                this.currentStateChanged = true;
                this.requestedCurrentState = this._currentState;
                if (!this.hasState(this.requestedCurrentState)) {
                    this.requestedCurrentState = this.getDefaultState();
                }
            };
            Object.defineProperty(Skin.prototype, "currentState", {
                /**
                 * 组件的当前视图状态。将其设置为 "" 或 null 可将组件重置回其基本状态。
                 * @member egret.StateClientHelper#currentState
                 */
                get: function () {
                    if (this.currentStateChanged)
                        return this.requestedCurrentState;
                    return this._currentState ? this._currentState : this.getDefaultState();
                },
                set: function (value) {
                    if (!value)
                        value = this.getDefaultState();
                    if (value != this.currentState && value && this.currentState) {
                        this.requestedCurrentState = value;
                        this.currentStateChanged = true;
                        if (this._hostComponent) {
                            this.commitCurrentState();
                        }
                    }
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 返回是否含有指定名称的视图状态
             * @method egret.gui.Skin#hasState
             * @param stateName {string}
             * @returns {boolean}
             */
            Skin.prototype.hasState = function (stateName) {
                return (this.getState(stateName) != null);
            };
            /**
             * 返回默认状态
             */
            Skin.prototype.getDefaultState = function () {
                if (this._states.length > 0) {
                    return this._states[0].name;
                }
                return null;
            };
            /**
             * 应用当前的视图状态。子类覆盖此方法在视图状态发生改变时执行相应更新操作。
             * @method egret.gui.Skin#commitCurrentState
             */
            Skin.prototype.commitCurrentState = function () {
                if (!this.currentStateChanged)
                    return;
                this.currentStateChanged = false;
                var destination = this.getState(this.requestedCurrentState);
                if (!destination) {
                    this.requestedCurrentState = this.getDefaultState();
                }
                var oldState = this._currentState ? this._currentState : "";
                if (this.hasEventListener(gui.StateChangeEvent.CURRENT_STATE_CHANGING)) {
                    gui.StateChangeEvent.dispatchStateChangeEvent(this, gui.StateChangeEvent.CURRENT_STATE_CHANGING, oldState, this.requestedCurrentState ? this.requestedCurrentState : "");
                }
                this.removeState(this._currentState);
                this._currentState = this.requestedCurrentState;
                if (this._currentState) {
                    this.applyState(this._currentState);
                }
                if (this.hasEventListener(gui.StateChangeEvent.CURRENT_STATE_CHANGE)) {
                    gui.StateChangeEvent.dispatchStateChangeEvent(this, gui.StateChangeEvent.CURRENT_STATE_CHANGE, oldState, this._currentState ? this._currentState : "");
                }
            };
            /**
             * 通过名称返回视图状态
             */
            Skin.prototype.getState = function (stateName) {
                if (!stateName)
                    return null;
                var states = this._states;
                var length = states.length;
                for (var i = 0; i < length; i++) {
                    var state = states[i];
                    if (state.name == stateName)
                        return state;
                }
                return null;
            };
            /**
             * 移除指定的视图状态以及所依赖的所有父级状态，除了与新状态的共同状态外
             */
            Skin.prototype.removeState = function (stateName) {
                var state = this.getState(stateName);
                if (state) {
                    var overrides = state.overrides;
                    for (var i = overrides.length - 1; i >= 0; i--)
                        overrides[i].remove(this);
                }
            };
            /**
             * 应用新状态
             */
            Skin.prototype.applyState = function (stateName) {
                var state = this.getState(stateName);
                if (state) {
                    var overrides = state.overrides;
                    var length = overrides.length;
                    for (var i = 0; i < length; i++)
                        overrides[i].apply((this));
                }
            };
            /**
             * 初始化所有视图状态
             * @method egret.StateClientHelper#initializeStates
             */
            Skin.prototype.initializeStates = function () {
                if (this.initialized)
                    return;
                this.initialized = true;
                var states = this._states;
                var length = states.length;
                for (var i = 0; i < length; i++) {
                    var state = (states[i]);
                    state.initialize(this);
                }
            };
            return Skin;
        })(egret.EventDispatcher);
        gui.Skin = Skin;
        Skin.prototype.__class__ = "egret.gui.Skin";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.StateSkin
         * @classdesc
         * 按钮组件的快速皮肤模板，能够快速制定哪个状态显示那个资源，实例化一次性专用的按钮皮肤。
         * @extends egret.gui.Skin
         */
        var ButtonSkin = (function (_super) {
            __extends(ButtonSkin, _super);
            /**
             * 构造函数
             * @method egret.gui.StateSkin#constructor
             * @param upSkinName {any} 按钮弹起状态的要显示的资源名
             * @param downSkinName {any} 按钮按下状态的要显示的资源名
             * @param disabledSkinName {any} 按钮禁用状态的要显示的资源名
             */
            function ButtonSkin(upSkinName, downSkinName, disabledSkinName) {
                if (upSkinName === void 0) { upSkinName = null; }
                if (downSkinName === void 0) { downSkinName = null; }
                if (disabledSkinName === void 0) { disabledSkinName = null; }
                _super.call(this);
                this.labelDisplay = new egret.gui.Label();
                this.iconDisplay = new egret.gui.UIAsset();
                var stateMap = {};
                stateMap["up"] = upSkinName;
                stateMap["down"] = downSkinName;
                stateMap["disabled"] = disabledSkinName;
                this.stateMap = stateMap;
                this._setStates(["up", "down", "disabled"]);
            }
            Object.defineProperty(ButtonSkin.prototype, "skinParts", {
                get: function () {
                    return ButtonSkin._skinParts;
                },
                enumerable: true,
                configurable: true
            });
            /**
             * @inheritDoc
             */
            ButtonSkin.prototype.createChildren = function () {
                _super.prototype.createChildren.call(this);
                var asset = new gui.UIAsset();
                asset.left = asset.top = asset.bottom = asset.right = 0;
                this.addElement(asset);
                this.backgroundAsset = asset;
                this.iconDisplay.includeInLayout = false;
                this.addElement(this.iconDisplay);
                this.labelDisplay.includeInLayout = false;
                this.labelDisplay.paddingLeft = 5;
                this.labelDisplay.paddingRight = 5;
                this.addElement(this.labelDisplay);
            };
            /**
             * @inheritDoc
             */
            ButtonSkin.prototype.commitCurrentState = function () {
                _super.prototype.commitCurrentState.call(this);
                var state = this.currentState;
                var source = this.stateMap[state];
                if (source) {
                    this.backgroundAsset.source = this.stateMap[state];
                }
            };
            ButtonSkin.prototype.measure = function () {
                _super.prototype.measure.call(this);
                var w = this.iconDisplay.preferredWidth + this.labelDisplay.preferredWidth + 20;
                var h = Math.max(this.iconDisplay.preferredHeight, this.labelDisplay.preferredHeight) + 20;
                if (w > this.measuredWidth) {
                    if (w < this.minWidth) {
                        w = this.minWidth;
                    }
                    if (w > this.maxWidth) {
                        w = this.maxWidth;
                    }
                    this.measuredWidth = w;
                }
                if (h > this.measuredHeight) {
                    if (h < this.minHeight) {
                        h = this.minHeight;
                    }
                    if (h > this.maxHeight) {
                        h = this.maxHeight;
                    }
                    this.measuredHeight = h;
                }
            };
            ButtonSkin.prototype.updateDisplayList = function (unscaledWidth, unscaledHeight) {
                _super.prototype.updateDisplayList.call(this, unscaledWidth, unscaledHeight);
                var iconWidth = this.iconDisplay.layoutBoundsWidth;
                var iconHeight = this.iconDisplay.layoutBoundsHeight;
                var labelWidth = this.labelDisplay.layoutBoundsWidth;
                var labelHeight = this.labelDisplay.layoutBoundsHeight;
                var iconX = (unscaledWidth - iconWidth - labelWidth) * 0.5;
                var iconY = (unscaledHeight - iconHeight) * 0.5;
                this.iconDisplay.setLayoutBoundsPosition(iconX, iconY);
                var labelX = iconX + iconWidth;
                var labelY = (unscaledHeight - labelHeight) * 0.5;
                this.labelDisplay.setLayoutBoundsPosition(labelX, labelY);
            };
            ButtonSkin._skinParts = ["labelDisplay", "iconDisplay"];
            return ButtonSkin;
        })(gui.Skin);
        gui.ButtonSkin = ButtonSkin;
        ButtonSkin.prototype.__class__ = "egret.gui.ButtonSkin";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.DataGroup
         * @classdesc
         * 数据项目的容器基类
         * 将数据项目转换为可视元素以进行显示。
         * @extends egret.gui.GroupBase
         */
        var DataGroup = (function (_super) {
            __extends(DataGroup, _super);
            /**
             * 构造函数
             * @method egret.gui.DataGroup#constructor
             */
            function DataGroup() {
                _super.call(this);
                this.useVirtualLayoutChanged = false;
                this.rendererToClassMap = [];
                this.freeRenderers = [];
                /**
                 * 是否创建了新的项呈示器标志
                 */
                this.createNewRendererFlag = false;
                this.dataProviderChanged = false;
                /**
                 * 对象池字典
                 */
                this.recyclerDic = [];
                this.itemRendererSkinNameChange = false;
                /**
                 * 正在进行虚拟布局阶段
                 */
                this.virtualLayoutUnderway = false;
                this.typicalItemChanged = false;
                /**
                 * 索引到项呈示器的转换数组
                 */
                this.indexToRenderer = [];
                /**
                 * 清理freeRenderer标志
                 */
                this.cleanFreeRenderer = false;
                /**
                 * 正在更新数据项的标志
                 */
                this.renderersBeingUpdated = false;
            }
            Object.defineProperty(DataGroup.prototype, "layout", {
                /**
                 * @member egret.gui.DataGroup#layout
                 */
                get: function () {
                    return this._layout;
                },
                /**
                 * @inheritDoc
                 */
                set: function (value) {
                    if (value == this.layout)
                        return;
                    if (this.layout) {
                        this.layout.typicalLayoutRect = null;
                        this.layout.removeEventListener("useVirtualLayoutChanged", this.layout_useVirtualLayoutChangedHandler, this);
                    }
                    if (this.layout && value && (this.layout.useVirtualLayout != value.useVirtualLayout))
                        this.changeUseVirtualLayout();
                    this._setLayout(value);
                    if (value) {
                        value.typicalLayoutRect = this.typicalLayoutRect;
                        value.addEventListener("useVirtualLayoutChanged", this.layout_useVirtualLayoutChangedHandler, this);
                    }
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 是否使用虚拟布局标记改变
             */
            DataGroup.prototype.layout_useVirtualLayoutChangedHandler = function (event) {
                this.changeUseVirtualLayout();
            };
            /**
             * @method egret.gui.DataGroup#setVirtualElementIndicesInView
             * @param startIndex {number}
             * @param endIndex {number}
             */
            DataGroup.prototype.setVirtualElementIndicesInView = function (startIndex, endIndex) {
                if (!this.layout || !this.layout.useVirtualLayout)
                    return;
                this.virtualRendererIndices = [];
                for (var i = startIndex; i <= endIndex; i++) {
                    this.virtualRendererIndices.push(i);
                }
                for (var index in this.indexToRenderer) {
                    index = parseInt(index);
                    if (this.virtualRendererIndices.indexOf(index) == -1) {
                        this.freeRendererByIndex(index);
                    }
                }
            };
            /**
             * @method egret.gui.DataGroup#getVirtualElementAt
             * @param index {number}
             * @returns {IVisualElement}
             */
            DataGroup.prototype.getVirtualElementAt = function (index) {
                if (index < 0 || index >= this.dataProvider.length)
                    return null;
                var element = this.indexToRenderer[index];
                if (!element) {
                    var item = this.dataProvider.getItemAt(index);
                    var renderer = this.createVirtualRenderer(index);
                    this.indexToRenderer[index] = renderer;
                    this.updateRenderer(renderer, index, item);
                    if (this.createNewRendererFlag) {
                        if ("validateNow" in renderer)
                            renderer.validateNow();
                        this.createNewRendererFlag = false;
                        gui.RendererExistenceEvent.dispatchRendererExistenceEvent(this, gui.RendererExistenceEvent.RENDERER_ADD, renderer, index, item);
                    }
                    element = renderer;
                }
                return element;
            };
            /**
             * 释放指定索引处的项呈示器
             */
            DataGroup.prototype.freeRendererByIndex = function (index) {
                if (!this.indexToRenderer[index])
                    return;
                var renderer = (this.indexToRenderer[index]);
                delete this.indexToRenderer[index];
                if (renderer && renderer instanceof egret.DisplayObject) {
                    this.doFreeRenderer(renderer);
                }
            };
            /**
             * 释放指定的项呈示器
             */
            DataGroup.prototype.doFreeRenderer = function (renderer) {
                var rendererFactory = this.rendererToClassMap[renderer.hashCode];
                var hashCode = rendererFactory.hashCode;
                if (!this.freeRenderers[hashCode]) {
                    this.freeRenderers[hashCode] = [];
                }
                this.freeRenderers[hashCode].push(renderer);
                renderer.visible = false;
            };
            /**
             * @method egret.gui.DataGroup#invalidateSize
             */
            DataGroup.prototype.invalidateSize = function () {
                if (!this.createNewRendererFlag)
                    _super.prototype.invalidateSize.call(this);
            };
            /**
             * 为指定索引创建虚拟的项呈示器
             */
            DataGroup.prototype.createVirtualRenderer = function (index) {
                var item = this.dataProvider.getItemAt(index);
                var renderer;
                var rendererFactory = this.itemToRendererClass(item);
                var hashCode = rendererFactory.hashCode;
                var freeRenderers = this.freeRenderers;
                if (freeRenderers[hashCode] && freeRenderers[hashCode].length > 0) {
                    renderer = freeRenderers[hashCode].pop();
                    renderer.visible = true;
                    return renderer;
                }
                this.createNewRendererFlag = true;
                return this.createOneRenderer(rendererFactory);
            };
            /**
             * 根据rendererClass创建一个Renderer,并添加到显示列表
             */
            DataGroup.prototype.createOneRenderer = function (rendererFactory) {
                var renderer;
                var hashCode = rendererFactory.hashCode;
                var recycler = this.recyclerDic[hashCode];
                if (recycler) {
                    renderer = recycler.pop();
                    if (recycler.length == 0)
                        delete this.recyclerDic[hashCode];
                }
                if (!renderer) {
                    renderer = (rendererFactory.newInstance());
                    this.rendererToClassMap[renderer.hashCode] = rendererFactory;
                }
                if (!renderer || !(renderer instanceof egret.DisplayObject))
                    return null;
                if (this._itemRendererSkinName) {
                    this.setItemRenderSkinName(renderer);
                }
                this._addToDisplayList(renderer);
                renderer.setLayoutBoundsSize(NaN, NaN);
                return renderer;
            };
            /**
             * 设置项呈示器的默认皮肤
             */
            DataGroup.prototype.setItemRenderSkinName = function (renderer) {
                if (!renderer)
                    return;
                var comp = renderer;
                if (comp) {
                    if (!comp._skinNameExplicitlySet)
                        comp.skinName = this._itemRendererSkinName;
                }
                else {
                    var client = renderer;
                    if (client && !client.skinName)
                        client.skinName = this._itemRendererSkinName;
                }
            };
            /**
             * 虚拟布局结束清理不可见的项呈示器
             */
            DataGroup.prototype.finishVirtualLayout = function () {
                if (!this.virtualLayoutUnderway)
                    return;
                this.virtualLayoutUnderway = false;
                var found = false;
                for (var hashCode in this.freeRenderers) {
                    if (this.freeRenderers[hashCode].length > 0) {
                        found = true;
                        break;
                    }
                }
                if (!found)
                    return;
                if (!this.cleanTimer) {
                    this.cleanTimer = new egret.Timer(3000, 1);
                    this.cleanTimer.addEventListener(egret.TimerEvent.TIMER, this.cleanAllFreeRenderer, this);
                }
                //为了提高持续滚动过程中的性能，防止反复地添加移除子项，这里不直接清理而是延迟后在滚动停止时清理一次。
                this.cleanTimer.reset();
                this.cleanTimer.start();
            };
            /**
             * 延迟清理多余的在显示列表中的ItemRenderer。
             */
            DataGroup.prototype.cleanAllFreeRenderer = function (event) {
                if (event === void 0) { event = null; }
                var renderer;
                var freeRenderers = this.freeRenderers;
                for (var hashCode in freeRenderers) {
                    var list = freeRenderers[hashCode];
                    var length = list.length;
                    for (var i = 0; i < length; i++) {
                        renderer = list[i];
                        renderer.visible = true;
                        this.recycle(renderer);
                    }
                }
                this.freeRenderers = [];
                this.cleanFreeRenderer = false;
            };
            /**
             * @method egret.gui.DataGroup#getElementIndicesInView
             * @returns {number}
             */
            DataGroup.prototype.getElementIndicesInView = function () {
                if (this.layout && this.layout.useVirtualLayout)
                    return this.virtualRendererIndices ? this.virtualRendererIndices : [];
                return _super.prototype.getElementIndicesInView.call(this);
            };
            /**
             * 更改是否使用虚拟布局
             */
            DataGroup.prototype.changeUseVirtualLayout = function () {
                this.useVirtualLayoutChanged = true;
                this.cleanFreeRenderer = true;
                this.removeDataProviderListener();
                this.invalidateProperties();
            };
            Object.defineProperty(DataGroup.prototype, "dataProvider", {
                /**
                 * 列表数据源，请使用实现了ICollection接口的数据类型，例如ArrayCollection
                 * @member egret.gui.DataGroup#dataProvider
                 */
                get: function () {
                    return this._dataProvider;
                },
                set: function (value) {
                    if (this._dataProvider == value)
                        return;
                    this.removeDataProviderListener();
                    this._dataProvider = value;
                    this.dataProviderChanged = true;
                    this.cleanFreeRenderer = true;
                    this.invalidateProperties();
                    this.invalidateSize();
                    this.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 移除数据源监听
             */
            DataGroup.prototype.removeDataProviderListener = function () {
                if (this._dataProvider)
                    this._dataProvider.removeEventListener(gui.CollectionEvent.COLLECTION_CHANGE, this.onCollectionChange, this);
            };
            /**
             * 数据源改变事件处理
             */
            DataGroup.prototype.onCollectionChange = function (event) {
                switch (event.kind) {
                    case gui.CollectionEventKind.ADD:
                        this.itemAddedHandler(event.items, event.location);
                        break;
                    case gui.CollectionEventKind.MOVE:
                        this.itemMovedHandler(event.items[0], event.location, event.oldLocation);
                        break;
                    case gui.CollectionEventKind.REMOVE:
                        this.itemRemovedHandler(event.items, event.location);
                        break;
                    case gui.CollectionEventKind.UPDATE:
                        this.itemUpdatedHandler(event.items[0], event.location);
                        break;
                    case gui.CollectionEventKind.REPLACE:
                        this.itemRemoved(event.oldItems[0], event.location);
                        this.itemAdded(event.items[0], event.location);
                        break;
                    case gui.CollectionEventKind.RESET:
                    case gui.CollectionEventKind.REFRESH:
                        if (this.layout && this.layout.useVirtualLayout) {
                            for (var index in this.indexToRenderer) {
                                index = parseInt(index);
                                this.freeRendererByIndex(index);
                            }
                        }
                        this.dataProviderChanged = true;
                        this.invalidateProperties();
                        break;
                }
                this.invalidateSize();
                this.invalidateDisplayList();
            };
            /**
             * 数据源添加项目事件处理
             */
            DataGroup.prototype.itemAddedHandler = function (items, index) {
                var length = items.length;
                for (var i = 0; i < length; i++) {
                    this.itemAdded(items[i], index + i);
                }
                this.resetRenderersIndices();
            };
            /**
             * 数据源移动项目事件处理
             */
            DataGroup.prototype.itemMovedHandler = function (item, location, oldLocation) {
                this.itemRemoved(item, oldLocation);
                this.itemAdded(item, location);
                this.resetRenderersIndices();
            };
            /**
             * 数据源移除项目事件处理
             */
            DataGroup.prototype.itemRemovedHandler = function (items, location) {
                var length = items.length;
                for (var i = length - 1; i >= 0; i--) {
                    this.itemRemoved(items[i], location + i);
                }
                this.resetRenderersIndices();
            };
            /**
             * 添加一项
             */
            DataGroup.prototype.itemAdded = function (item, index) {
                if (this.layout)
                    this.layout.elementAdded(index);
                if (this.layout && this.layout.useVirtualLayout) {
                    var virtualRendererIndices = this.virtualRendererIndices;
                    if (virtualRendererIndices) {
                        var length = virtualRendererIndices.length;
                        for (var i = 0; i < length; i++) {
                            var vrIndex = virtualRendererIndices[i];
                            if (vrIndex >= index)
                                virtualRendererIndices[i] = vrIndex + 1;
                        }
                        this.indexToRenderer.splice(index, 0, null);
                    }
                    return;
                }
                var rendererFactory = this.itemToRendererClass(item);
                var renderer = this.createOneRenderer(rendererFactory);
                this.indexToRenderer.splice(index, 0, renderer);
                if (!renderer)
                    return;
                this.updateRenderer(renderer, index, item);
                gui.RendererExistenceEvent.dispatchRendererExistenceEvent(this, gui.RendererExistenceEvent.RENDERER_ADD, renderer, index, item);
            };
            /**
             * 移除一项
             */
            DataGroup.prototype.itemRemoved = function (item, index) {
                if (this.layout)
                    this.layout.elementRemoved(index);
                var virtualRendererIndices = this.virtualRendererIndices;
                if (virtualRendererIndices && (virtualRendererIndices.length > 0)) {
                    var vrItemIndex = -1;
                    var length = virtualRendererIndices.length;
                    for (var i = 0; i < length; i++) {
                        var vrIndex = virtualRendererIndices[i];
                        if (vrIndex == index)
                            vrItemIndex = i;
                        else if (vrIndex > index)
                            virtualRendererIndices[i] = vrIndex - 1;
                    }
                    if (vrItemIndex != -1)
                        virtualRendererIndices.splice(vrItemIndex, 1);
                }
                var oldRenderer = this.indexToRenderer[index];
                if (this.indexToRenderer.length > index)
                    this.indexToRenderer.splice(index, 1);
                gui.RendererExistenceEvent.dispatchRendererExistenceEvent(this, gui.RendererExistenceEvent.RENDERER_REMOVE, oldRenderer, index, item);
                if (oldRenderer && oldRenderer instanceof egret.DisplayObject) {
                    this.recycle(oldRenderer);
                }
            };
            /**
             * 回收一个ItemRenderer实例
             */
            DataGroup.prototype.recycle = function (renderer) {
                this._removeFromDisplayList(renderer);
                if ("ownerChanged" in renderer) {
                    renderer.ownerChanged(null);
                }
                var rendererFactory = this.rendererToClassMap[renderer.hashCode];
                var hashCode = rendererFactory.hashCode;
                if (!this.recyclerDic[hashCode]) {
                    this.recyclerDic[hashCode] = new egret.Recycler();
                }
                this.recyclerDic[hashCode].push(renderer);
            };
            /**
             * 更新当前所有项的索引
             */
            DataGroup.prototype.resetRenderersIndices = function () {
                if (this.indexToRenderer.length == 0)
                    return;
                if (this.layout && this.layout.useVirtualLayout) {
                    var virtualRendererIndices = this.virtualRendererIndices;
                    var length = virtualRendererIndices.length;
                    for (var i = 0; i < length; i++) {
                        var index = virtualRendererIndices[i];
                        this.resetRendererItemIndex(index);
                    }
                }
                else {
                    var indexToRendererLength = this.indexToRenderer.length;
                    for (index = 0; index < indexToRendererLength; index++)
                        this.resetRendererItemIndex(index);
                }
            };
            /**
             * 数据源更新或替换项目事件处理
             */
            DataGroup.prototype.itemUpdatedHandler = function (item, location) {
                if (this.renderersBeingUpdated)
                    return; //防止无限循环
                var renderer = this.indexToRenderer[location];
                if (renderer)
                    this.updateRenderer(renderer, location, item);
            };
            /**
             * 调整指定项呈示器的索引值
             */
            DataGroup.prototype.resetRendererItemIndex = function (index) {
                var renderer = (this.indexToRenderer[index]);
                if (renderer)
                    renderer.itemIndex = index;
            };
            Object.defineProperty(DataGroup.prototype, "itemRenderer", {
                /**
                 * 用于数据项目的项呈示器。该类必须实现 IItemRenderer 接口。<br/>
                 * rendererClass获取顺序：itemRendererFunction > itemRenderer > 默认ItemRenerer。
                 * @member egret.gui.DataGroup#itemRenderer
                 */
                get: function () {
                    return this._itemRenderer;
                },
                set: function (value) {
                    if (this._itemRenderer === value)
                        return;
                    this._itemRenderer = value;
                    this.itemRendererChanged = true;
                    this.typicalItemChanged = true;
                    this.cleanFreeRenderer = true;
                    this.removeDataProviderListener();
                    this.invalidateProperties();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(DataGroup.prototype, "itemRendererSkinName", {
                /**
                 * 条目渲染器的可选皮肤标识符。在实例化itemRenderer时，若其内部没有设置过skinName,则将此属性的值赋值给它的skinName。
                 * 注意:若itemRenderer不是ISkinnableClient，则此属性无效。
                 * @member egret.gui.DataGroup#itemRendererSkinName
                 */
                get: function () {
                    return this._itemRendererSkinName;
                },
                set: function (value) {
                    if (this._itemRendererSkinName == value)
                        return;
                    this._itemRendererSkinName = value;
                    if (this._itemRendererSkinName && this.initialized) {
                        this.itemRendererSkinNameChange = true;
                        this.invalidateProperties();
                    }
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(DataGroup.prototype, "itemRendererFunction", {
                /**
                 * 为某个特定项目返回一个项呈示器Class的函数。<br/>
                 * rendererClass获取顺序：itemRendererFunction > itemRenderer > 默认ItemRenerer。<br/>
                 * 应该定义一个与此示例函数类似的呈示器函数： <br/>
                 * function myItemRendererFunction(item:Object):IFactory
                 * @member egret.gui.DataGroup#itemRendererFunction
                 */
                get: function () {
                    return this._itemRendererFunction;
                },
                set: function (value) {
                    if (this._itemRendererFunction == value)
                        return;
                    this._itemRendererFunction = value;
                    this.itemRendererChanged = true;
                    this.typicalItemChanged = true;
                    this.removeDataProviderListener();
                    this.invalidateProperties();
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 为特定的数据项返回项呈示器的工厂实例
             */
            DataGroup.prototype.itemToRendererClass = function (item) {
                var rendererFactory;
                if (this._itemRendererFunction != null) {
                    rendererFactory = this._itemRendererFunction(item);
                    if (!rendererFactory)
                        rendererFactory = this._itemRenderer;
                }
                else {
                    rendererFactory = this._itemRenderer;
                }
                return rendererFactory ? rendererFactory : DataGroup.defaultRendererFactory;
            };
            /**
             * @method egret.gui.DataGroup#createChildren
             * 设置默认的ItemRenderer
             * @private
             *
             */
            DataGroup.prototype.createChildren = function () {
                if (!this.layout) {
                    var _layout = new gui.VerticalLayout();
                    _layout.gap = 0;
                    _layout.horizontalAlign = egret.HorizontalAlign.CONTENT_JUSTIFY;
                    this.layout = _layout;
                }
                _super.prototype.createChildren.call(this);
            };
            /**
             * @method egret.gui.DataGroup#commitProperties
             */
            DataGroup.prototype.commitProperties = function () {
                if (this.itemRendererChanged || this.dataProviderChanged || this.useVirtualLayoutChanged) {
                    this.removeAllRenderers();
                    if (this.layout)
                        this.layout.clearVirtualLayoutCache();
                    this.setTypicalLayoutRect(null);
                    this.useVirtualLayoutChanged = false;
                    this.itemRendererChanged = false;
                    if (this._dataProvider)
                        this._dataProvider.addEventListener(gui.CollectionEvent.COLLECTION_CHANGE, this.onCollectionChange, this);
                    if (this.layout && this.layout.useVirtualLayout) {
                        this.invalidateSize();
                        this.invalidateDisplayList();
                    }
                    else {
                        this.createRenderers();
                    }
                    if (this.dataProviderChanged) {
                        this.dataProviderChanged = false;
                        this.verticalScrollPosition = this.horizontalScrollPosition = 0;
                    }
                }
                _super.prototype.commitProperties.call(this);
                if (this.typicalItemChanged) {
                    this.typicalItemChanged = false;
                    if (this._dataProvider && this._dataProvider.length > 0) {
                        this.typicalItem = this._dataProvider.getItemAt(0);
                        this.measureRendererSize();
                    }
                }
                if (this.itemRendererSkinNameChange) {
                    this.itemRendererSkinNameChange = false;
                    var length = this.indexToRenderer.length;
                    for (var i = 0; i < length; i++) {
                        this.setItemRenderSkinName(this.indexToRenderer[i]);
                    }
                    var freeRenderers = this.freeRenderers;
                    for (var hashCode in freeRenderers) {
                        var list = freeRenderers[hashCode];
                        if (list) {
                            length = list.length;
                            for (i = 0; i < length; i++) {
                                this.setItemRenderSkinName(list[i]);
                            }
                        }
                    }
                }
            };
            /**
             * @method egret.gui.DataGroup#measure
             */
            DataGroup.prototype.measure = function () {
                if (this.layout && this.layout.useVirtualLayout) {
                    this.ensureTypicalLayoutElement();
                }
                _super.prototype.measure.call(this);
            };
            /**
             * @method egret.gui.DataGroup#updateDisplayList
             * @param unscaledWidth {number}
             * @param unscaledHeight {number}
             */
            DataGroup.prototype.updateDisplayList = function (unscaledWidth, unscaledHeight) {
                if (this._layoutInvalidateDisplayListFlag && this.layout && this.layout.useVirtualLayout) {
                    this.virtualLayoutUnderway = true;
                    this.ensureTypicalLayoutElement();
                }
                _super.prototype.updateDisplayList.call(this, unscaledWidth, unscaledHeight);
                if (this.virtualLayoutUnderway)
                    this.finishVirtualLayout();
            };
            /**
             * 确保测量过默认条目大小。
             */
            DataGroup.prototype.ensureTypicalLayoutElement = function () {
                if (this.layout.typicalLayoutRect)
                    return;
                if (this._dataProvider && this._dataProvider.length > 0) {
                    this.typicalItem = this._dataProvider.getItemAt(0);
                    this.measureRendererSize();
                }
            };
            /**
             * 测量项呈示器默认尺寸
             */
            DataGroup.prototype.measureRendererSize = function () {
                if (!this.typicalItem) {
                    this.setTypicalLayoutRect(null);
                    return;
                }
                var rendererFactory = this.itemToRendererClass(this.typicalItem);
                var typicalRenderer = this.createOneRenderer(rendererFactory);
                if (!typicalRenderer) {
                    this.setTypicalLayoutRect(null);
                    return;
                }
                this.createNewRendererFlag = true;
                this.updateRenderer(typicalRenderer, 0, this.typicalItem);
                if ("validateNow" in typicalRenderer)
                    typicalRenderer.validateNow();
                var rect = new egret.Rectangle(0, 0, typicalRenderer.preferredWidth, typicalRenderer.preferredHeight);
                this.recycle(typicalRenderer);
                this.setTypicalLayoutRect(rect);
                this.createNewRendererFlag = false;
            };
            /**
             * 设置项目默认大小
             */
            DataGroup.prototype.setTypicalLayoutRect = function (rect) {
                this.typicalLayoutRect = rect;
                if (this.layout)
                    this.layout.typicalLayoutRect = rect;
            };
            /**
             * 移除所有项呈示器
             */
            DataGroup.prototype.removeAllRenderers = function () {
                var length = this.indexToRenderer.length;
                var renderer;
                for (var i = 0; i < length; i++) {
                    renderer = this.indexToRenderer[i];
                    if (renderer) {
                        this.recycle(renderer);
                        gui.RendererExistenceEvent.dispatchRendererExistenceEvent(this, gui.RendererExistenceEvent.RENDERER_REMOVE, renderer, renderer.itemIndex, renderer.data);
                    }
                }
                this.indexToRenderer = [];
                this.virtualRendererIndices = null;
                if (!this.cleanFreeRenderer)
                    return;
                this.cleanAllFreeRenderer();
            };
            /**
             * 为数据项创建项呈示器
             */
            DataGroup.prototype.createRenderers = function () {
                if (!this._dataProvider)
                    return;
                var index = 0;
                var length = this._dataProvider.length;
                for (var i = 0; i < length; i++) {
                    var item = this._dataProvider.getItemAt(i);
                    var rendererFactory = this.itemToRendererClass(item);
                    var renderer = this.createOneRenderer(rendererFactory);
                    if (!renderer)
                        continue;
                    this.indexToRenderer[index] = renderer;
                    this.updateRenderer(renderer, index, item);
                    gui.RendererExistenceEvent.dispatchRendererExistenceEvent(this, gui.RendererExistenceEvent.RENDERER_ADD, renderer, index, item);
                    index++;
                }
            };
            /**
             * 更新项呈示器
             * @method egret.gui.DataGroup#updateRenderer
             * @param renderer {IItemRenderer}
             * @param itemIndex {number}
             * @param data {any}
             * @returns {IItemRenderer}
             */
            DataGroup.prototype.updateRenderer = function (renderer, itemIndex, data) {
                this.renderersBeingUpdated = true;
                if (this._rendererOwner) {
                    renderer = this._rendererOwner.updateRenderer(renderer, itemIndex, data);
                }
                else {
                    if ("ownerChanged" in renderer) {
                        renderer.ownerChanged(this);
                    }
                    renderer.itemIndex = itemIndex;
                    renderer.label = this.itemToLabel(data);
                    renderer.data = data;
                }
                this.renderersBeingUpdated = false;
                return renderer;
            };
            /**
             * 返回可在项呈示器中显示的 String。
             * 若DataGroup被作为SkinnableDataContainer的皮肤组件,此方法将不会执行，被SkinnableDataContainer.itemToLabel()所替代。
             * @method egret.gui.DataGroup#itemToLabel
             * @param item {any}
             * @returns {string}
             */
            DataGroup.prototype.itemToLabel = function (item) {
                if (item)
                    return item.toString();
                else
                    return " ";
            };
            /**
             * @method egret.gui.DataGroup#getElementAt
             * @param index {number}
             * @returns {IVisualElement}
             */
            DataGroup.prototype.getElementAt = function (index) {
                return this.indexToRenderer[index];
            };
            /**
             * @method egret.gui.DataGroup#getElementIndex
             * @param element {IVisualElement}
             * @returns {number}
             */
            DataGroup.prototype.getElementIndex = function (element) {
                if (!element)
                    return -1;
                return this.indexToRenderer.indexOf(element);
            };
            Object.defineProperty(DataGroup.prototype, "numElements", {
                /**
                 * @member egret.gui.DataGroup#numElements
                 */
                get: function () {
                    if (!this._dataProvider)
                        return 0;
                    return this._dataProvider.length;
                },
                enumerable: true,
                configurable: true
            });
            /**
             * @method egret.gui.DataGroup#addChild
             * @deprecated
             * @param child {DisplayObject}
             * @returns {DisplayObject}
             */
            DataGroup.prototype.addChild = function (child) {
                throw (new Error("addChild()" + DataGroup.errorStr + "addElement()代替"));
            };
            /**
             * @method egret.gui.DataGroup#addChildAt
             * @deprecated
             * @param child {DisplayObject}
             * @param index {number}
             * @returns {DisplayObject}
             */
            DataGroup.prototype.addChildAt = function (child, index) {
                throw (new Error("addChildAt()" + DataGroup.errorStr + "addElementAt()代替"));
            };
            /**
             * @method egret.gui.DataGroup#removeChild
             * @deprecated
             * @param child {DisplayObject}
             * @returns {DisplayObject}
             */
            DataGroup.prototype.removeChild = function (child) {
                throw (new Error("removeChild()" + DataGroup.errorStr + "removeElement()代替"));
            };
            /**
             * @method egret.gui.DataGroup#removeChildAt
             * @deprecated
             * @param index {number}
             * @returns {DisplayObject}
             */
            DataGroup.prototype.removeChildAt = function (index) {
                throw (new Error("removeChildAt()" + DataGroup.errorStr + "removeElementAt()代替"));
            };
            /**
             * @method egret.gui.DataGroup#setChildIndex
             * @deprecated
             * @param child {DisplayObject}
             * @param index {number}
             */
            DataGroup.prototype.setChildIndex = function (child, index) {
                throw (new Error("setChildIndex()" + DataGroup.errorStr + "setElementIndex()代替"));
            };
            /**
             * @method egret.gui.DataGroup#swapChildren
             * @deprecated
             * @param child1 {DisplayObject}
             * @param child2 {DisplayObject}
             */
            DataGroup.prototype.swapChildren = function (child1, child2) {
                throw (new Error("swapChildren()" + DataGroup.errorStr + "swapElements()代替"));
            };
            /**
             * @method egret.gui.DataGroup#swapChildrenAt
             * @deprecated
             * @param index1 {number}
             * @param index2 {number}
             */
            DataGroup.prototype.swapChildrenAt = function (index1, index2) {
                throw (new Error("swapChildrenAt()" + DataGroup.errorStr + "swapElementsAt()代替"));
            };
            /**
             * @method egret.gui.DataGroup.defaultRendererFactory
             * @param ClassFactory {any}
             */
            DataGroup.defaultRendererFactory = new gui.ClassFactory(gui.ItemRenderer);
            DataGroup.errorStr = "在此组件中不可用，若此组件为容器类，请使用";
            return DataGroup;
        })(gui.GroupBase);
        gui.DataGroup = DataGroup;
        DataGroup.prototype.__class__ = "egret.gui.DataGroup";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.HSlider
         * @classdesc
         * 水平滑块控件
         * @extends egret.gui.SliderBase
         */
        var HSlider = (function (_super) {
            __extends(HSlider, _super);
            /**
             * 构造函数
             * @method egret.gui.HSlider#constructor
             */
            function HSlider() {
                _super.call(this);
            }
            HSlider.prototype.pointToValue = function (x, y) {
                if (!this.thumb || !this.track)
                    return 0;
                var range = this.maximum - this.minimum;
                var thumbRange = this.track.layoutBoundsWidth - this.thumb.layoutBoundsWidth;
                return this.minimum + ((thumbRange != 0) ? (x / thumbRange) * range : 0);
            };
            HSlider.prototype.updateSkinDisplayList = function () {
                if (!this.thumb || !this.track)
                    return;
                var thumbRange = this.track.layoutBoundsWidth - this.thumb.layoutBoundsWidth;
                var range = this.maximum - this.minimum;
                var thumbPosTrackX = (range > 0) ? ((this.pendingValue - this.minimum) / range) * thumbRange : 0;
                var thumbPos = this.track.localToGlobal(thumbPosTrackX, 0);
                var thumbPosX = thumbPos.x;
                var thumbPosY = thumbPos.y;
                var thumbPosParentX = this.thumb.parent.globalToLocal(thumbPosX, thumbPosY, egret.Point.identity).x;
                this.thumb.setLayoutBoundsPosition(Math.round(thumbPosParentX), this.thumb.layoutBoundsY);
                if (this.showTrackHighlight && this.trackHighlight && this.trackHighlight.parent) {
                    var trackHighlightX = this.trackHighlight.parent.globalToLocal(thumbPosX, thumbPosY, egret.Point.identity).x - thumbPosTrackX;
                    this.trackHighlight.x = Math.round(trackHighlightX);
                    this.trackHighlight.width = Math.round(thumbPosTrackX);
                }
            };
            return HSlider;
        })(gui.SliderBase);
        gui.HSlider = HSlider;
        HSlider.prototype.__class__ = "egret.gui.HSlider";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        var HScrollBar = (function (_super) {
            __extends(HScrollBar, _super);
            function HScrollBar() {
                _super.call(this);
                this._autoHideTimer = NaN;
                this._autoHideDelay = 3000;
                this.trackAlpha = 0.4;
                this.thumbAlpha = 0.8;
                this._autoHideShowAnimat = null;
                this._animatTargetIsShow = false;
            }
            HScrollBar.prototype._setViewportMetric = function (width, contentWidth) {
                this._setMaximun(contentWidth - width);
                this._setMinimun(0);
                this._setVisible(width < contentWidth);
                var thumbLength = width * width / contentWidth;
                this.thumb._setWidth(thumbLength);
            };
            HScrollBar.prototype._setValue = function (value) {
                value = Math.max(0, value);
                _super.prototype._setValue.call(this, value);
                //被赋值时自动显示
                this.hideOrShow(true);
                this.autoHide();
            };
            HScrollBar.prototype.setValue = function (value) {
                _super.prototype.setValue.call(this, value);
                //被赋值时自动显示
                this.hideOrShow(true);
                this.autoHide();
            };
            HScrollBar.prototype.autoHide = function () {
                if (this._autoHideDelay != NaN) {
                    egret.clearTimeout(this._autoHideDelay);
                }
                this._autoHideTimer = egret.setTimeout(this.hideOrShow.bind(this, false), this, this._autoHideDelay);
            };
            HScrollBar.prototype.hideOrShow = function (show) {
                var _this = this;
                if (this._autoHideShowAnimat == null) {
                    this._autoHideShowAnimat = new gui.Animation(function (b) {
                        var a = b.currentValue["alpha"];
                        _this.thumb.alpha = _this.thumbAlpha * a;
                        _this.track.alpha = _this.trackAlpha * a;
                    }, this);
                }
                else {
                    if (this._animatTargetIsShow == show)
                        return;
                    this._autoHideShowAnimat.isPlaying && this._autoHideShowAnimat.stop();
                }
                this._animatTargetIsShow = show;
                var animat = this._autoHideShowAnimat;
                animat.motionPaths = [{
                    prop: "alpha",
                    from: this.thumb.alpha / this.thumbAlpha,
                    to: show ? 1 : 0
                }];
                animat.duration = show ? 100 : 500;
                animat.play();
            };
            HScrollBar.prototype._animationUpdateHandler = function (animation) {
                this.pendingValue = animation.currentValue["value"];
                this.value = animation.currentValue["value"];
                this.dispatchEventWith(egret.Event.CHANGE);
            };
            return HScrollBar;
        })(gui.HSlider);
        gui.HScrollBar = HScrollBar;
        HScrollBar.prototype.__class__ = "egret.gui.HScrollBar";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.VSlider
         * @classdesc
         * 垂直滑块控件
         * @extends egret.gui.SliderBase
         */
        var VSlider = (function (_super) {
            __extends(VSlider, _super);
            /**
             * 构造函数
             * @method egret.gui.VSlider#constructor
             */
            function VSlider() {
                _super.call(this);
            }
            /**
             * @param x {number}
             * @param y {number}
             * @returns {number}
             */
            VSlider.prototype.pointToValue = function (x, y) {
                if (!this.thumb || !this.track)
                    return 0;
                var range = this.maximum - this.minimum;
                var thumbRange = this.track.layoutBoundsHeight - this.thumb.layoutBoundsHeight;
                return this.minimum + ((thumbRange != 0) ? ((thumbRange - y) / thumbRange) * range : 0);
            };
            /**
             */
            VSlider.prototype.updateSkinDisplayList = function () {
                if (!this.thumb || !this.track)
                    return;
                var thumbHeight = this.thumb.layoutBoundsHeight;
                var thumbRange = this.track.layoutBoundsHeight - thumbHeight;
                var range = this.maximum - this.minimum;
                var thumbPosTrackY = (range > 0) ? thumbRange - (((this.pendingValue - this.minimum) / range) * thumbRange) : 0;
                var thumbPos = this.track.localToGlobal(0, thumbPosTrackY);
                var thumbPosX = thumbPos.x;
                var thumbPosY = thumbPos.y;
                var thumbPosParentY = this.thumb.parent.globalToLocal(thumbPosX, thumbPosY, egret.Point.identity).y;
                this.thumb.setLayoutBoundsPosition(this.thumb.layoutBoundsX, Math.round(thumbPosParentY));
                if (this.showTrackHighlight && this.trackHighlight && this.trackHighlight._parent) {
                    var trackHighlightY = this.trackHighlight._parent.globalToLocal(thumbPosX, thumbPosY, egret.Point.identity).y;
                    this.trackHighlight.y = Math.round(trackHighlightY + thumbHeight);
                    this.trackHighlight.height = Math.round(thumbRange - trackHighlightY);
                }
            };
            return VSlider;
        })(gui.SliderBase);
        gui.VSlider = VSlider;
        VSlider.prototype.__class__ = "egret.gui.VSlider";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        var VScrollBar = (function (_super) {
            __extends(VScrollBar, _super);
            function VScrollBar() {
                _super.call(this);
                this._autoHideTimer = NaN;
                this._autoHideDelay = 3000;
                this.trackAlpha = 0.4;
                this.thumbAlpha = 0.8;
                this._autoHideShowAnimat = null;
                this._animatTargetIsShow = false;
            }
            VScrollBar.prototype._setViewportMetric = function (height, contentHeight) {
                this._setMaximun(contentHeight - height);
                this._setMinimun(0);
                this._setValue(contentHeight - height);
                this._setVisible(height < contentHeight);
                var thumbLength = height * height / contentHeight;
                this.thumb._setHeight(thumbLength);
            };
            VScrollBar.prototype.setPosition = function (value) {
                this._setValue(this._maximum - value);
            };
            VScrollBar.prototype.getPosition = function () {
                return this._maximum - this._getValue();
            };
            VScrollBar.prototype._setValue = function (value) {
                value = Math.max(0, value);
                _super.prototype._setValue.call(this, value);
                //被赋值时自动显示
                this.hideOrShow(true);
                this.autoHide();
            };
            VScrollBar.prototype.setValue = function (value) {
                _super.prototype.setValue.call(this, value);
                //被赋值时自动显示
                this.hideOrShow(true);
                this.autoHide();
            };
            VScrollBar.prototype.autoHide = function () {
                if (this._autoHideDelay != NaN) {
                    egret.clearTimeout(this._autoHideDelay);
                }
                this._autoHideTimer = egret.setTimeout(this.hideOrShow.bind(this, false), this, this._autoHideDelay);
            };
            VScrollBar.prototype.hideOrShow = function (show) {
                var _this = this;
                if (this._autoHideShowAnimat == null) {
                    this._autoHideShowAnimat = new gui.Animation(function (b) {
                        var a = b.currentValue["alpha"];
                        _this.thumb.alpha = _this.thumbAlpha * a;
                        _this.track.alpha = _this.trackAlpha * a;
                    }, this);
                }
                else {
                    if (this._animatTargetIsShow == show)
                        return;
                    this._autoHideShowAnimat.isPlaying && this._autoHideShowAnimat.stop();
                }
                this._animatTargetIsShow = show;
                var animat = this._autoHideShowAnimat;
                animat.motionPaths = [{
                    prop: "alpha",
                    from: this.thumb.alpha / this.thumbAlpha,
                    to: show ? 1 : 0
                }];
                animat.duration = show ? 100 : 500;
                animat.play();
            };
            VScrollBar.prototype._animationUpdateHandler = function (animation) {
                this.pendingValue = animation.currentValue["value"];
                this.value = animation.currentValue["value"];
                this.dispatchEventWith(egret.Event.CHANGE);
            };
            return VScrollBar;
        })(gui.VSlider);
        gui.VScrollBar = VScrollBar;
        VScrollBar.prototype.__class__ = "egret.gui.VScrollBar";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.PopUpAnchor
         * @classdesc
         * PopUpAnchor组件用于定位布局中的弹出控件或下拉控件
         * @extends egret.gui.UIComponent
         */
        var PopUpAnchor = (function (_super) {
            __extends(PopUpAnchor, _super);
            /**
             * 构造函数
             * @method egret.gui.PopUpAnchor#constructor
             */
            function PopUpAnchor() {
                _super.call(this);
                /**
                 * popUp已经弹出的标志
                 */
                this.popUpIsDisplayed = false;
                /**
                 * 自身已经添加到舞台标志
                 */
                this.addedToStage = false;
                this._popUpHeightMatchesAnchorHeight = false;
                this._popUpWidthMatchesAnchorWidth = false;
                this._displayPopUp = false;
                this._popUpPosition = gui.PopUpPosition.TOP_LEFT;
                /**
                 * 正在播放动画的标志
                 */
                this.inAnimation = false;
                /**
                 * 动画类实例
                 */
                this.animator = null;
                this._openDuration = 250;
                this._closeDuration = 150;
                this.valueRange = 1;
                this.addEventListener(egret.Event.ADDED_TO_STAGE, this.addedToStageHandler, this);
                this.addEventListener(egret.Event.REMOVED_FROM_STAGE, this.removedFromStageHandler, this);
            }
            Object.defineProperty(PopUpAnchor.prototype, "popUpHeightMatchesAnchorHeight", {
                /**
                 * 如果为 true，则将popUp控件的高度设置为 PopUpAnchor的高度值。
                 * @member egret.gui.PopUpAnchor#popUpHeightMatchesAnchorHeight
                 */
                get: function () {
                    return this._popUpHeightMatchesAnchorHeight;
                },
                set: function (value) {
                    if (this._popUpHeightMatchesAnchorHeight == value)
                        return;
                    this._popUpHeightMatchesAnchorHeight = value;
                    this.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(PopUpAnchor.prototype, "popUpWidthMatchesAnchorWidth", {
                /**
                 * 如果为true，则将popUp控件的宽度设置为PopUpAnchor的宽度值。
                 * @member egret.gui.PopUpAnchor#popUpWidthMatchesAnchorWidth
                 */
                get: function () {
                    return this._popUpWidthMatchesAnchorWidth;
                },
                set: function (value) {
                    if (this._popUpWidthMatchesAnchorWidth == value)
                        return;
                    this._popUpWidthMatchesAnchorWidth = value;
                    this.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(PopUpAnchor.prototype, "displayPopUp", {
                /**
                 * 如果为 true，则将popUp对象弹出。若为false，关闭弹出的popUp。
                 * @member egret.gui.PopUpAnchor#displayPopUp
                 */
                get: function () {
                    return this._displayPopUp;
                },
                set: function (value) {
                    if (this._displayPopUp == value)
                        return;
                    this._displayPopUp = value;
                    this.addOrRemovePopUp();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(PopUpAnchor.prototype, "popUp", {
                /**
                 * 要弹出或移除的目标显示对象。
                 * @member egret.gui.PopUpAnchor#popUp
                 */
                get: function () {
                    return this._popUp;
                },
                set: function (value) {
                    if (this._popUp == value)
                        return;
                    this._popUp = value;
                    this.dispatchEventWith("popUpChanged");
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(PopUpAnchor.prototype, "popUpPosition", {
                /**
                 * popUp相对于PopUpAnchor的弹出位置。请使用PopUpPosition里定义的常量。默认值TOP_LEFT。
                 * @see org.flexlite.domUI.core.PopUpPosition
                 * @member egret.gui.PopUpAnchor#popUpPosition
                 */
                get: function () {
                    return this._popUpPosition;
                },
                set: function (value) {
                    if (this._popUpPosition == value)
                        return;
                    this._popUpPosition = value;
                    this.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            /**
             * @method egret.gui.PopUpAnchor#updateDisplayList
             * @param unscaledWidth {number}
             * @param unscaledHeight {number}
             */
            PopUpAnchor.prototype.updateDisplayList = function (unscaledWidth, unscaledHeight) {
                _super.prototype.updateDisplayList.call(this, unscaledWidth, unscaledHeight);
                this.applyPopUpTransform(unscaledWidth, unscaledHeight);
            };
            /**
             * 手动刷新popUp的弹出位置和尺寸。
             * @method egret.gui.PopUpAnchor#updatePopUpTransform
             */
            PopUpAnchor.prototype.updatePopUpTransform = function () {
                this.applyPopUpTransform(this.width, this.height);
            };
            /**
             * 计算popUp的弹出位置
             */
            PopUpAnchor.prototype.calculatePopUpPosition = function () {
                var registrationPoint = egret.Point.identity;
                switch (this._popUpPosition) {
                    case gui.PopUpPosition.BELOW:
                        registrationPoint.x = 0;
                        registrationPoint.y = this.height;
                        break;
                    case gui.PopUpPosition.ABOVE:
                        registrationPoint.x = 0;
                        registrationPoint.y = -this.popUp.layoutBoundsHeight;
                        break;
                    case gui.PopUpPosition.LEFT:
                        registrationPoint.x = -this.popUp.layoutBoundsWidth;
                        registrationPoint.y = 0;
                        break;
                    case gui.PopUpPosition.RIGHT:
                        registrationPoint.x = this.width;
                        registrationPoint.y = 0;
                        break;
                    case gui.PopUpPosition.CENTER:
                        registrationPoint.x = (this.width - this.popUp.layoutBoundsWidth) * 0.5;
                        registrationPoint.y = (this.height - this.popUp.layoutBoundsHeight) * 0.5;
                        break;
                    case gui.PopUpPosition.TOP_LEFT:
                        break;
                }
                registrationPoint = this.localToGlobal(registrationPoint.x, registrationPoint.y, registrationPoint);
                registrationPoint = this.popUp.parent.globalToLocal(registrationPoint.x, registrationPoint.y, registrationPoint);
                return registrationPoint;
            };
            Object.defineProperty(PopUpAnchor.prototype, "openDuration", {
                /**
                 * 窗口弹出的动画时间(以毫秒为单位)，设置为0则直接弹出窗口而不播放动画效果。默认值250。
                 * @member egret.gui.PopUpAnchor#openDuration
                 */
                get: function () {
                    return this._openDuration;
                },
                set: function (value) {
                    this._openDuration = value;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(PopUpAnchor.prototype, "closeDuration", {
                /**
                 * 窗口关闭的动画时间(以毫秒为单位)，设置为0则直接关闭窗口而不播放动画效果。默认值150。
                 * @member egret.gui.PopUpAnchor#closeDuration
                 */
                get: function () {
                    return this._closeDuration;
                },
                set: function (value) {
                    this._closeDuration = value;
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 动画开始播放触发的函数
             */
            PopUpAnchor.prototype.animationStartHandler = function (animation) {
                this.inAnimation = true;
                if (this.popUp && "enabled" in this.popUp)
                    (this.popUp).enabled = false;
            };
            /**
             * 动画播放过程中触发的更新数值函数
             */
            PopUpAnchor.prototype.animationUpdateHandler = function (animation) {
                var rect = (this.popUp)._scrollRect;
                var x = Math.round(animation.currentValue["x"]);
                var y = Math.round(animation.currentValue["y"]);
                if (rect) {
                    rect.x = x;
                    rect.y = y;
                    rect.width = this.popUp.width;
                    rect.height = this.popUp.height;
                }
                else {
                    (this.popUp)._scrollRect = new egret.Rectangle(x, y, this.popUp.width, this.popUp.height);
                }
                (this.popUp)._setScrollRect(rect);
            };
            /**
             * 动画播放完成触发的函数
             */
            PopUpAnchor.prototype.animationEndHandler = function (animation) {
                this.inAnimation = false;
                if (this.popUp && "enabled" in this.popUp)
                    (this.popUp).enabled = true;
                (this.popUp).scrollRect = null;
                if (!this.popUpIsDisplayed) {
                    gui.PopUpManager.removePopUp(this.popUp);
                    this.popUp.ownerChanged(null);
                }
            };
            /**
             * 添加或移除popUp
             */
            PopUpAnchor.prototype.addOrRemovePopUp = function () {
                if (!this.addedToStage || !this.popUp)
                    return;
                if (this.popUp.parent == null && this.displayPopUp) {
                    gui.PopUpManager.addPopUp(this.popUp, false, false);
                    this.popUp.ownerChanged(this);
                    this.popUpIsDisplayed = true;
                    if (this.inAnimation)
                        this.animator.end();
                    if (this.initialized) {
                        this.applyPopUpTransform(this.width, this.height);
                        if (this._openDuration > 0)
                            this.startAnimation();
                    }
                    else {
                        egret.callLater(function () {
                            if (this.openDuration > 0)
                                this.startAnimation();
                        }, this);
                    }
                }
                else if (this.popUp.parent != null && !this.displayPopUp) {
                    this.removeAndResetPopUp();
                }
            };
            /**
             * 移除并重置popUp
             */
            PopUpAnchor.prototype.removeAndResetPopUp = function () {
                if (this.inAnimation)
                    this.animator.end();
                this.popUpIsDisplayed = false;
                if (this._closeDuration > 0) {
                    this.startAnimation();
                }
                else {
                    gui.PopUpManager.removePopUp(this.popUp);
                    this.popUp.ownerChanged(null);
                }
            };
            /**
             * 对popUp应用尺寸和位置调整
             */
            PopUpAnchor.prototype.applyPopUpTransform = function (unscaledWidth, unscaledHeight) {
                if (!this.popUpIsDisplayed)
                    return;
                if (this.popUpWidthMatchesAnchorWidth)
                    this.popUp.width = unscaledWidth;
                if (this.popUpHeightMatchesAnchorHeight)
                    this.popUp.height = unscaledHeight;
                if ("validateNow" in this.popUp)
                    (this.popUp).validateNow();
                var popUpPoint = this.calculatePopUpPosition();
                this.popUp.x = popUpPoint.x;
                this.popUp.y = popUpPoint.y;
            };
            /**
             * 开始播放动画
             */
            PopUpAnchor.prototype.startAnimation = function () {
                if (!this.animator) {
                    this.animator = new gui.Animation(this.animationUpdateHandler, this);
                    this.animator.endFunction = this.animationEndHandler;
                    this.animator.startFunction = this.animationStartHandler;
                }
                this.animator.motionPaths = this.createMotionPath();
                if (this.popUpIsDisplayed) {
                    this.animator.duration = this._openDuration;
                }
                else {
                    this.animator.duration = this._closeDuration;
                }
                this.animator.play();
            };
            /**
             * 创建动画轨迹
             */
            PopUpAnchor.prototype.createMotionPath = function () {
                var xPath = { prop: "x" };
                var yPath = { prop: "y" };
                var path = [xPath, yPath];
                switch (this._popUpPosition) {
                    case gui.PopUpPosition.TOP_LEFT:
                    case gui.PopUpPosition.CENTER:
                    case gui.PopUpPosition.BELOW:
                        xPath.from = xPath.to = 0;
                        yPath.from = this.popUp.height;
                        yPath.to = 0;
                        this.valueRange = this.popUp.height;
                        break;
                    case gui.PopUpPosition.ABOVE:
                        xPath.from = xPath.to = 0;
                        yPath.from = -this.popUp.height;
                        yPath.to = 0;
                        this.valueRange = this.popUp.height;
                        break;
                    case gui.PopUpPosition.LEFT:
                        yPath.from = yPath.to = 0;
                        xPath.from = -this.popUp.width;
                        xPath.to = 0;
                        this.valueRange = this.popUp.width;
                        break;
                    case gui.PopUpPosition.RIGHT:
                        yPath.from = yPath.to = 0;
                        xPath.from = this.popUp.width;
                        xPath.to = 0;
                        this.valueRange = this.popUp.width;
                        break;
                    default:
                        this.valueRange = 1;
                        break;
                }
                this.valueRange = Math.abs(this.valueRange);
                if (!this.popUpIsDisplayed) {
                    var tempValue = xPath.from;
                    xPath.from = xPath.to;
                    xPath.to = tempValue;
                    tempValue = yPath.from;
                    yPath.from = yPath.to;
                    yPath.to = tempValue;
                }
                return path;
            };
            /**
             * 添加到舞台事件
             */
            PopUpAnchor.prototype.addedToStageHandler = function (event) {
                this.addedToStage = true;
                egret.callLater(this.checkPopUpState, this);
            };
            /**
             * 延迟检查弹出状态，防止堆栈溢出。
             */
            PopUpAnchor.prototype.checkPopUpState = function () {
                if (this.addedToStage) {
                    this.addOrRemovePopUp();
                }
                else {
                    if (this.popUp != null && (this.popUp).parent != null)
                        this.removeAndResetPopUp();
                }
            };
            /**
             * 从舞台移除事件
             */
            PopUpAnchor.prototype.removedFromStageHandler = function (event) {
                this.addedToStage = false;
                egret.callLater(this.checkPopUpState, this);
            };
            return PopUpAnchor;
        })(gui.UIComponent);
        gui.PopUpAnchor = PopUpAnchor;
        PopUpAnchor.prototype.__class__ = "egret.gui.PopUpAnchor";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
            * 适用Viewport的滑动类
            */
        var ViewportScroller = (function (_super) {
            __extends(ViewportScroller, _super);
            /**
                * @method egret.gui.GroupBase#constructor
                */
            function ViewportScroller(content) {
                _super.call(this, content);
                this._width = 0;
                this._height = 0;
            }
            ViewportScroller.prototype.setContent = function (content) {
                _super.prototype.setContent.call(this, content);
                var viewport = this._content;
                this._scrollLeft = viewport.horizontalScrollPosition;
                this._scrollTop = viewport.verticalScrollPosition;
            };
            ViewportScroller.prototype._updateContentPosition = function () {
                var content = this._content;
                content.horizontalScrollPosition = this._scrollLeft;
                content.verticalScrollPosition = this._scrollTop;
                content.setLayoutBoundsSize(this._width, this._height);
                this.dispatchEvent(new egret.Event(egret.Event.CHANGE));
            };
            ViewportScroller.prototype.getMaxScrollLeft = function () {
                var content = this._content;
                var max = content.contentWidth - content.width;
                return Math.max(max, 0);
            };
            ViewportScroller.prototype.getMaxScrollTop = function () {
                var content = this._content;
                var max = content.contentHeight - content.height;
                return Math.max(max, 0);
            };
            ViewportScroller.prototype._getContentWidth = function () {
                return this._content.contentWidth;
            };
            ViewportScroller.prototype._getContentHeight = function () {
                return this._content.contentHeight;
            };
            ViewportScroller.prototype._setHeight = function (value) {
                this._explicitHeight = value;
                this._hasHeightSet = egret.NumberUtils.isNumber(value);
                this._height = value;
                var content = this._content;
                content && content.setLayoutBoundsSize(this._width, this._height);
            };
            ViewportScroller.prototype._setWidth = function (value) {
                this._explicitWidth = value;
                this._hasWidthSet = egret.NumberUtils.isNumber(value);
                this._width = value;
                var content = this._content;
                content && content.setLayoutBoundsSize(this._width, this._height);
            };
            Object.defineProperty(ViewportScroller.prototype, "height", {
                get: function () {
                    return this._height;
                },
                set: function (value) {
                    this._setHeight(value);
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(ViewportScroller.prototype, "width", {
                get: function () {
                    return this._width;
                },
                set: function (value) {
                    this._setWidth(value);
                },
                enumerable: true,
                configurable: true
            });
            ViewportScroller.prototype.invalidateSize = function () {
                var p = this.parent;
                p && p.invalidateSize();
            };
            ViewportScroller.prototype.invalidateDisplayList = function () {
                var p = this.parent;
                p && p.invalidateDisplayList();
            };
            return ViewportScroller;
        })(egret.ScrollView);
        ViewportScroller.prototype.__class__ = "egret.gui.ViewportScroller";
        /**
         * @class egret.gui.Scroller
         * @classdesc
         * 滚动条组件
         * @extends egret.gui.UIComponent
         * @implements egret.gui.IVisualElementContainer
         */
        var Scroller = (function (_super) {
            __extends(Scroller, _super);
            /**
             * 构造函数
             * @method egret.gui.Scroller#constructor
             */
            function Scroller() {
                _super.call(this);
                this._verticalScrollPolicy = "auto";
                this._horizontalScrollPolicy = "auto";
            }
            /**
             * @method egret.gui.Scroller#measure
             */
            Scroller.prototype.measure = function () {
                if (!this._viewport)
                    return;
                this.measuredWidth = this._viewport.preferredWidth;
                this.measuredHeight = this._viewport.preferredHeight;
            };
            /**
             * @param unscaledWidth {number}
             * @param unscaledHeight {number}
             */
            Scroller.prototype.updateDisplayList = function (unscaledWidth, unscaledHeight) {
                this._scroller._setWidth(unscaledWidth);
                this._scroller._setHeight(unscaledHeight);
                if (this.horizontalScrollBar) {
                    if (this._horizontalScrollPolicy != "off") {
                        this.horizontalScrollBar._setViewportMetric(unscaledWidth, this._viewport.contentWidth);
                        this.horizontalScrollBar._setWidth(unscaledWidth - 2);
                        this.horizontalScrollBar.x = 1;
                        this.horizontalScrollBar.y = unscaledHeight - this.horizontalScrollBar._height - 1;
                    }
                }
                if (this.verticalScrollBar) {
                    if (this._verticalScrollPolicy != "off") {
                        this.verticalScrollBar._setViewportMetric(unscaledHeight, this._viewport.contentHeight);
                        this.verticalScrollBar._setHeight(unscaledHeight - 2);
                        this.verticalScrollBar.y = 1;
                        this.verticalScrollBar.x = unscaledWidth - this.verticalScrollBar.width - 1;
                    }
                }
            };
            Object.defineProperty(Scroller.prototype, "verticalScrollPolicy", {
                /**
                 * 垂直滚动条显示策略，参见ScrollPolicy类定义的常量。
                 * @member egret.gui.Scroller#verticalScrollPolicy
                 */
                get: function () {
                    return this._verticalScrollPolicy;
                },
                set: function (value) {
                    if (value == this._verticalScrollPolicy)
                        return;
                    this._verticalScrollPolicy = value;
                    this._checkVbar();
                    if (this._scroller)
                        this._scroller.verticalScrollPolicy = value;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Scroller.prototype, "horizontalScrollPolicy", {
                /**
                 * 水平滚动条显示策略，参见ScrollPolicy类定义的常量。
                 * @member egret.gui.Scroller#horizontalScrollPolicy
                 */
                get: function () {
                    return this._horizontalScrollPolicy;
                },
                set: function (value) {
                    if (value == this._horizontalScrollPolicy)
                        return;
                    this._horizontalScrollPolicy = value;
                    this._checkHbar();
                    if (this._scroller)
                        this._scroller.horizontalScrollPolicy = value;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Scroller.prototype, "viewport", {
                /**
                 * 要滚动的视域组件。
                 * @member egret.gui.Scroller#viewport
                 */
                get: function () {
                    return this._viewport;
                },
                set: function (value) {
                    if (value == this._viewport)
                        return;
                    this.uninstallViewport();
                    this._viewport = value;
                    this.installViewport();
                    this.dispatchEventWith("viewportChanged");
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 安装并初始化视域组件
             */
            Scroller.prototype.installViewport = function () {
                var viewport = this.viewport;
                if (this._scroller == null) {
                    this._scroller = new ViewportScroller(viewport);
                    this._scroller.horizontalScrollPolicy = this._horizontalScrollPolicy;
                    this._scroller.verticalScrollPolicy = this._verticalScrollPolicy;
                    this._scroller.addEventListener(egret.Event.CHANGE, this._scrollerChangedHandler, this);
                    this._addToDisplayListAt(this._scroller, 0);
                }
                if (viewport) {
                    viewport.clipAndEnableScrolling = true;
                    this._scroller.setContent(viewport);
                    viewport.addEventListener(egret.gui.PropertyChangeEvent.PROPERTY_CHANGE, this._viewportChangedHandler, this);
                    if ("_addToStyleProtoChain" in viewport) {
                        viewport["_addToStyleProtoChain"](this._styleProtoChain);
                    }
                }
            };
            Scroller.prototype._onAddToStage = function () {
                _super.prototype._onAddToStage.call(this);
                this._scroller._stage = this.stage;
            };
            /**
             * 卸载视域组件
             */
            Scroller.prototype.uninstallViewport = function () {
                if (this.viewport) {
                    this.viewport.clipAndEnableScrolling = false;
                    this.viewport.removeEventListener(egret.gui.PropertyChangeEvent.PROPERTY_CHANGE, this._viewportChangedHandler, this);
                }
                if (this._scroller) {
                    this._scroller.removeContent();
                }
            };
            Scroller.prototype._viewportChangedHandler = function (e) {
                if (e.property == "horizontalScrollPosition")
                    this.setViewportHScrollPosition(this.viewport.horizontalScrollPosition);
                if (e.property == "verticalScrollPosition")
                    this.setViewportVScrollPosition(this.viewport.verticalScrollPosition);
            };
            Scroller.prototype._scrollerChangedHandler = function (e) {
                this.setViewportHScrollPosition(this._scroller.scrollLeft);
                this.setViewportVScrollPosition(this._scroller.scrollTop);
            };
            Scroller.prototype.setViewportVScrollPosition = function (pos) {
                if (this._scroller.scrollTop != pos)
                    this._scroller.scrollTop = pos;
                if (this.verticalScrollBar && this.verticalScrollBar.value != pos)
                    this.verticalScrollBar.setPosition(pos);
            };
            Scroller.prototype.setViewportHScrollPosition = function (pos) {
                if (this._scroller.scrollLeft != pos)
                    this._scroller.scrollLeft = pos;
                if (this.horizontalScrollBar && this.horizontalScrollBar.value != pos)
                    this.horizontalScrollBar._setValue(pos);
            };
            /**
             * 缓动到水平滚动位置
             * @method egret.gui.Scroller#throwHorizontally
             * @param hspTo {number}
             * @param duration {number}
             */
            Scroller.prototype.throwHorizontally = function (hspTo, duration) {
                if (duration === void 0) { duration = 500; }
                if (!this._scroller)
                    return;
                this._scroller.setScrollLeft(hspTo, duration);
            };
            /**
             * 缓动到垂直滚动位置
             * @method egret.gui.Scroller#throwVertically
             * @param vspTo {number}
             * @param duration {number}
             */
            Scroller.prototype.throwVertically = function (vspTo, duration) {
                if (duration === void 0) { duration = 500; }
                if (!this._scroller)
                    return;
                this._scroller.setScrollTop(vspTo, duration);
            };
            Object.defineProperty(Scroller.prototype, "numElements", {
                /**
                 * @member egret.gui.Scroller#numElements
                 */
                get: function () {
                    return this.viewport ? 1 : 0;
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 抛出索引越界异常
             */
            Scroller.prototype.throwRangeError = function (index) {
                throw new RangeError("索引:\"" + index + "\"超出可视元素索引范围");
            };
            /**
             * @param index {number}
             * @returns {IVisualElement}
             */
            Scroller.prototype.getElementAt = function (index) {
                if (this.viewport && index == 0)
                    return this.viewport;
                else
                    this.throwRangeError(index);
                return null;
            };
            /**
             * @param element {IVisualElement}
             * @returns {number}
             */
            Scroller.prototype.getElementIndex = function (element) {
                if (element != null && element == this.viewport)
                    return 0;
                else
                    return -1;
            };
            /**
             * @param element {IVisualElement}
             * @returns {boolean}
             */
            Scroller.prototype.containsElement = function (element) {
                if (element != null && element == this.viewport)
                    return true;
                return false;
            };
            Scroller.prototype.throwNotSupportedError = function () {
                throw new Error("此方法在Scroller组件内不可用!");
            };
            /**
             * @deprecated
             * @param element {IVisualElement}
             * @returns {IVisualElement}
             */
            Scroller.prototype.addElement = function (element) {
                this.throwNotSupportedError();
                return null;
            };
            /**
             * @deprecated
             * @param element {IVisualElement}
             * @param index {number}
             * @returns {IVisualElement}
             */
            Scroller.prototype.addElementAt = function (element, index) {
                this.throwNotSupportedError();
                return null;
            };
            /**
             * @deprecated
             * @param element {IVisualElement}
             * @returns {IVisualElement}
             */
            Scroller.prototype.removeElement = function (element) {
                this.throwNotSupportedError();
                return null;
            };
            /**
             * @deprecated
             * @param index {number}
             * @returns {IVisualElement}
             */
            Scroller.prototype.removeElementAt = function (index) {
                this.throwNotSupportedError();
                return null;
            };
            /**
             * @deprecated
             */
            Scroller.prototype.removeAllElements = function () {
                this.throwNotSupportedError();
            };
            /**
             * @deprecated
             * @param element {IVisualElement}
             * @param index {number}
             */
            Scroller.prototype.setElementIndex = function (element, index) {
                this.throwNotSupportedError();
            };
            /**
             * @deprecated
             * @param element1 {IVisualElement}
             * @param element2 {IVisualElement}
             */
            Scroller.prototype.swapElements = function (element1, element2) {
                this.throwNotSupportedError();
            };
            /**
             * @deprecated
             * @param index1 {number}
             * @param index2 {number}
             */
            Scroller.prototype.swapElementsAt = function (index1, index2) {
                this.throwNotSupportedError();
            };
            /**
             * @deprecated
             * @param child {DisplayObject}
             * @returns {DisplayObject}
             */
            Scroller.prototype.addChild = function (child) {
                this.throwNotSupportedError();
                return null;
            };
            /**
             * @deprecated
             * @param child {DisplayObject}
             * @param index {number}
             * @returns {DisplayObject}
             */
            Scroller.prototype.addChildAt = function (child, index) {
                this.throwNotSupportedError();
                return null;
            };
            /**
             * @deprecated
             * @param child {DisplayObject}
             * @returns {DisplayObject}
             */
            Scroller.prototype.removeChild = function (child) {
                this.throwNotSupportedError();
                return null;
            };
            /**
             * @deprecated
             * @param index {number}
             * @returns {DisplayObject}
             */
            Scroller.prototype.removeChildAt = function (index) {
                this.throwNotSupportedError();
                return null;
            };
            /**
             * @deprecated
             * @param child {DisplayObject}
             * @param index {number}
             */
            Scroller.prototype.setChildIndex = function (child, index) {
                this.throwNotSupportedError();
            };
            /**
             * @deprecated
             * @param child1 {DisplayObject}
             * @param child2 {DisplayObject}
             */
            Scroller.prototype.swapChildren = function (child1, child2) {
                this.throwNotSupportedError();
            };
            /**
             * @deprecated
             * @param index1 {number}
             * @param index2 {number}
             */
            Scroller.prototype.swapChildrenAt = function (index1, index2) {
                this.throwNotSupportedError();
            };
            Scroller.prototype._checkHbar = function () {
                if (this._horizontalScrollPolicy == "off") {
                    if (this.horizontalScrollBar) {
                        this._removeFromDisplayList(this.horizontalScrollBar);
                    }
                    return;
                }
                if (!this.horizontalScrollBar)
                    return;
                var bar = this.horizontalScrollBar;
                bar.addEventListener(egret.Event.CHANGE, this.hBarChanged, this, false);
                bar._setViewportMetric(this._viewport.width, this._viewport.contentWidth);
                this.horizontalScrollBar = bar;
                var host = bar.owner;
                if (host && "removeElement" in host) {
                    host.removeElement(bar);
                }
                this._addToDisplayList(this.horizontalScrollBar);
            };
            Scroller.prototype._checkVbar = function () {
                if (this._verticalScrollPolicy == "off") {
                    if (this.verticalScrollBar) {
                        this._removeFromDisplayList(this.verticalScrollBar);
                    }
                    return;
                }
                if (!this.verticalScrollBar)
                    return;
                var vbar = this.verticalScrollBar;
                vbar.addEventListener(egret.Event.CHANGE, this.vBarChanged, this, false);
                vbar._setViewportMetric(this._viewport.height, this._viewport.contentHeight);
                this.verticalScrollBar = vbar;
                var host = vbar.owner;
                if (host && "removeElement" in host) {
                    host.removeElement(vbar);
                }
                this._addToDisplayList(this.verticalScrollBar);
            };
            /**
             * 若皮肤是ISkin,则调用此方法附加皮肤中的公共部件
             * @param partName {string}
             * @param instance {any}
             */
            Scroller.prototype.partAdded = function (partName, instance) {
                _super.prototype.partAdded.call(this, partName, instance);
                if (instance == this.horizontalScrollBar) {
                    this._checkHbar();
                }
                if (instance == this.verticalScrollBar) {
                    this._checkVbar();
                }
            };
            Scroller.prototype._removeScrollBars = function () {
                if (this.horizontalScrollBar) {
                    this._removeFromDisplayList(this.horizontalScrollBar);
                    this.horizontalScrollBar.removeEventListener(egret.Event.CHANGE, this.hBarChanged, this, false);
                    this.horizontalScrollBar = null;
                }
                if (this.verticalScrollBar) {
                    this._removeFromDisplayList(this.verticalScrollBar);
                    this.verticalScrollBar.removeEventListener(egret.Event.CHANGE, this.vBarChanged, this, false);
                    this.verticalScrollBar = null;
                }
            };
            Scroller.prototype.hBarChanged = function (e) {
                this.setViewportHScrollPosition(this.horizontalScrollBar._getValue());
            };
            Scroller.prototype.vBarChanged = function (e) {
                this.setViewportVScrollPosition(this.verticalScrollBar.getPosition());
            };
            Scroller.prototype._createOwnStyleProtoChain = function (chain) {
                chain = _super.prototype._createOwnStyleProtoChain.call(this, chain);
                var viewport = this._viewport;
                if (viewport && "_addToStyleProtoChain" in viewport) {
                    viewport["_addToStyleProtoChain"](chain);
                }
                return chain;
            };
            /**
             * 添加到父级容器的样式原型链
             */
            Scroller.prototype.regenerateStyleCache = function (parentChain) {
                _super.prototype.regenerateStyleCache.call(this, parentChain);
                var viewport = this._viewport;
                if (viewport && "regenerateStyleCache" in viewport) {
                    viewport["regenerateStyleCache"](parentChain);
                }
            };
            /**
             * 通知项列表样式发生改变
             */
            Scroller.prototype.notifyStyleChangeInChildren = function (styleProp) {
                _super.prototype.notifyStyleChangeInChildren.call(this, styleProp);
                var viewport = this._viewport;
                if (viewport && "styleChanged" in viewport) {
                    viewport["styleChanged"](styleProp);
                    viewport["notifyStyleChangeInChildren"](styleProp);
                }
            };
            /**
             * 更新子项的nestLevel属性
             */
            Scroller.prototype._updateChildrenNestLevel = function () {
                _super.prototype._updateChildrenNestLevel.call(this);
                var viewport = this._viewport;
                if (viewport && "nestLevel" in viewport) {
                    viewport["nestLevel"] = this.nestLevel + 1;
                }
            };
            return Scroller;
        })(gui.SkinnableComponent);
        gui.Scroller = Scroller;
        Scroller.prototype.__class__ = "egret.gui.Scroller";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        var EditableText = (function (_super) {
            __extends(EditableText, _super);
            function EditableText() {
                _super.call(this);
                this._selectable = true;
                this._displayAsPassword = false;
                this.displayAsPasswordChanged = true;
                this.pendingEditable = true;
                this._editable = true;
                this.editableChanged = false;
                this._maxChars = 0;
                this.maxCharsChanged = false;
                this._multiline = true;
                this.multilineChanged = false;
                this._restrict = null;
                this.restrictChanged = false;
                this._heightInLines = NaN;
                this.heightInLinesChanged = false;
                this._widthInChars = NaN;
                this.widthInCharsChanged = false;
                this._contentWidth = 0;
                this._contentHeight = 0;
                this._horizontalScrollPosition = 0;
                this._verticalScrollPosition = 0;
                this._clipAndEnableScrolling = false;
                /**
                 * heightInLines计算出来的默认高度。
                 */
                this.defaultHeight = NaN;
                /**
                 * widthInChars计算出来的默认宽度。
                 */
                this.defaultWidth = NaN;
                this.isValidating = false;
                this.selectable = true;
            }
            Object.defineProperty(EditableText.prototype, "selectable", {
                get: function () {
                    return this._selectable;
                },
                set: function (value) {
                    this._selectable = value;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(EditableText.prototype, "displayAsPassword", {
                /**
                 * @inheritDoc
                 */
                get: function () {
                    return this._displayAsPassword;
                },
                set: function (value) {
                    if (value == this._displayAsPassword)
                        return;
                    this._displayAsPassword = value;
                    this.displayAsPasswordChanged = true;
                    this.invalidateProperties();
                    this.invalidateSize();
                    this.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(EditableText.prototype, "editable", {
                /**
                 * @inheritDoc
                 */
                get: function () {
                    if (this._enabled)
                        return this._editable;
                    return this.pendingEditable;
                },
                set: function (value) {
                    if (this._editable == value)
                        return;
                    if (this._enabled) {
                        this._editable = value;
                        this.editableChanged = true;
                        this.invalidateProperties();
                    }
                    else {
                        this.pendingEditable = value;
                    }
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(EditableText.prototype, "enabled", {
                get: function () {
                    return this._editable;
                },
                /**
                 * @inheritDoc
                 */
                set: function (value) {
                    if (value == this._enabled)
                        return;
                    this._enabled = value;
                    if (this._enabled) {
                        if (this._editable != this.pendingEditable)
                            this.editableChanged = true;
                        this._editable = this.pendingEditable;
                    }
                    else {
                        if (this.editable)
                            this.editableChanged = true;
                        this.pendingEditable = this._editable;
                        this._editable = false;
                    }
                    this.invalidateProperties();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(EditableText.prototype, "maxChars", {
                /**
                 * @inheritDoc
                 */
                get: function () {
                    return this._maxChars;
                },
                set: function (value) {
                    if (value === undefined)
                        value = 0;
                    if (value == this._maxChars)
                        return;
                    this._maxChars = value;
                    this.maxCharsChanged = true;
                    this.invalidateProperties();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(EditableText.prototype, "multiline", {
                /**
                 * @inheritDoc
                 */
                get: function () {
                    return this._multiline;
                },
                set: function (value) {
                    if (value == this.multiline)
                        return;
                    this._multiline = value;
                    this.multilineChanged = true;
                    this.invalidateProperties();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(EditableText.prototype, "restrict", {
                /**
                 * @inheritDoc
                 */
                get: function () {
                    return this._restrict;
                },
                set: function (value) {
                    if (value == this._restrict)
                        return;
                    this._restrict = value;
                    this.restrictChanged = true;
                    this.invalidateProperties();
                },
                enumerable: true,
                configurable: true
            });
            EditableText.prototype.styleChanged = function (styleProp) {
                _super.prototype.styleChanged.call(this, styleProp);
                if (!styleProp || styleProp == "size") {
                    this.heightInLinesChanged = true;
                    this.widthInCharsChanged = true;
                }
            };
            EditableText.prototype._setLineSpacing = function (value) {
                if (this._lineSpacing == value)
                    return;
                _super.prototype._setLineSpacing.call(this, value);
                this.heightInLinesChanged = true;
            };
            Object.defineProperty(EditableText.prototype, "heightInLines", {
                /**
                 * 控件的默认高度（以行为单位测量）。 若设置了multiline属性为false，则忽略此属性。
                 */
                get: function () {
                    return this._heightInLines;
                },
                set: function (value) {
                    if (this._heightInLines == value)
                        return;
                    this._heightInLines = value;
                    this.heightInLinesChanged = true;
                    this.invalidateProperties();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(EditableText.prototype, "widthInChars", {
                /**
                 * 控件的默认宽度（使用字号：size为单位测量）。 若同时设置了maxChars属性，将会根据两者测量结果的最小值作为测量宽度。
                 */
                get: function () {
                    return this._widthInChars;
                },
                set: function (value) {
                    if (this._widthInChars == value)
                        return;
                    this._widthInChars = value;
                    this.widthInCharsChanged = true;
                    this.invalidateProperties();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(EditableText.prototype, "contentWidth", {
                get: function () {
                    return this._contentWidth;
                },
                enumerable: true,
                configurable: true
            });
            EditableText.prototype.setContentWidth = function (value) {
                if (value == this._contentWidth)
                    return;
                var oldValue = this._contentWidth;
                this._contentWidth = value;
                this.dispatchPropertyChangeEvent("contentWidth", oldValue, value);
            };
            Object.defineProperty(EditableText.prototype, "contentHeight", {
                get: function () {
                    return this._contentHeight;
                },
                enumerable: true,
                configurable: true
            });
            EditableText.prototype.setContentHeight = function (value) {
                if (value == this._contentHeight)
                    return;
                var oldValue = this._contentHeight;
                this._contentHeight = value;
                this.dispatchPropertyChangeEvent("contentHeight", oldValue, value);
            };
            Object.defineProperty(EditableText.prototype, "horizontalScrollPosition", {
                /**
                 * @inheritDoc
                 */
                get: function () {
                    return this._horizontalScrollPosition;
                },
                set: function (value) {
                    if (this._horizontalScrollPosition == value)
                        return;
                    this._horizontalScrollPosition = value;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(EditableText.prototype, "verticalScrollPosition", {
                /**
                 * @inheritDoc
                 */
                get: function () {
                    return this._verticalScrollPosition;
                },
                set: function (value) {
                    if (this._verticalScrollPosition == value)
                        return;
                    value = Math.round(value);
                    this._verticalScrollPosition = value;
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 根据垂直像素位置获取对应的垂直滚动位置
             */
            EditableText.prototype.getScrollVByVertitcalPos = function (value) {
                if (this._textField.numLines == 0)
                    return 1;
                var lineHeight = this._textField._getLineHeight();
                var offsetHeight = (this.height - 4) % lineHeight;
                if (this._textField.height + offsetHeight - this.height == value) {
                    return this._textField.maxScrollV;
                }
                return parseInt(((value - 2) / lineHeight)) + 1;
            };
            /**
             * 根据垂直滚动位置获取对应的垂直像位置
             */
            EditableText.prototype.getVerticalPosByScrollV = function (scrollV) {
                if (scrollV === void 0) { scrollV = 0; }
                if (scrollV == 1 || this._textField.numLines == 0)
                    return 0;
                var lineHeight = this._textField._getLineHeight();
                if (scrollV == this._textField.maxScrollV) {
                    var offsetHeight = (this.height - 4) % lineHeight;
                    return this._textField.height + offsetHeight - this.height;
                }
                return lineHeight * (scrollV - 1) + 2;
            };
            /**
             * @inheritDoc
             */
            EditableText.prototype.getHorizontalScrollPositionDelta = function (navigationUnit) {
                if (navigationUnit === void 0) { navigationUnit = 0; }
                var delta = 0;
                var maxDelta = this._contentWidth - this._horizontalScrollPosition - this.width;
                var minDelta = -this._horizontalScrollPosition;
                switch (navigationUnit) {
                    case gui.NavigationUnit.LEFT:
                        delta = this._horizontalScrollPosition <= 0 ? 0 : Math.max(minDelta, -this.size);
                        break;
                    case gui.NavigationUnit.RIGHT:
                        delta = (this._horizontalScrollPosition + this.width >= this.contentWidth) ? 0 : Math.min(maxDelta, this.size);
                        break;
                    case gui.NavigationUnit.PAGE_LEFT:
                        delta = Math.max(minDelta, -this.width);
                        break;
                    case gui.NavigationUnit.PAGE_RIGHT:
                        delta = Math.min(maxDelta, this.width);
                        break;
                    case gui.NavigationUnit.HOME:
                        delta = minDelta;
                        break;
                    case gui.NavigationUnit.END:
                        delta = maxDelta;
                        break;
                }
                return delta;
            };
            /**
             * @inheritDoc
             */
            EditableText.prototype.getVerticalScrollPositionDelta = function (navigationUnit) {
                if (navigationUnit === void 0) { navigationUnit = 0; }
                var delta = 0;
                var maxDelta = this._contentHeight - this._verticalScrollPosition - this.height;
                var minDelta = -this._verticalScrollPosition;
                switch (navigationUnit) {
                    case gui.NavigationUnit.UP:
                        delta = this.getVScrollDelta(-1);
                        break;
                    case gui.NavigationUnit.DOWN:
                        delta = this.getVScrollDelta(1);
                        break;
                    case gui.NavigationUnit.PAGE_UP:
                        delta = Math.max(minDelta, -this.width);
                        break;
                    case gui.NavigationUnit.PAGE_DOWN:
                        delta = Math.min(maxDelta, this.width);
                        break;
                    case gui.NavigationUnit.HOME:
                        delta = minDelta;
                        break;
                    case gui.NavigationUnit.END:
                        delta = maxDelta;
                        break;
                }
                return delta;
            };
            /**
             * 返回指定偏移行数的滚动条偏移量
             */
            EditableText.prototype.getVScrollDelta = function (offsetLine) {
                if (offsetLine === void 0) { offsetLine = 0; }
                if (!this._textField)
                    return 0;
                var currentScrollV = this.getScrollVByVertitcalPos(this._verticalScrollPosition);
                var scrollV = currentScrollV + offsetLine;
                scrollV = Math.max(1, Math.min(this._textField.maxScrollV, scrollV));
                var startPos = this.getVerticalPosByScrollV(scrollV);
                var delta = startPos - this._verticalScrollPosition;
                return delta;
            };
            Object.defineProperty(EditableText.prototype, "clipAndEnableScrolling", {
                /**
                 * @inheritDoc
                 */
                get: function () {
                    return this._clipAndEnableScrolling;
                },
                set: function (value) {
                    if (this._clipAndEnableScrolling == value)
                        return;
                    this._clipAndEnableScrolling = value;
                },
                enumerable: true,
                configurable: true
            });
            /**
             * @inheritDoc
             */
            EditableText.prototype.commitProperties = function () {
                if (!this._textField) {
                    this.editableChanged = true;
                    this.displayAsPasswordChanged = true;
                    this.maxCharsChanged = true;
                    this.multilineChanged = true;
                    this.restrictChanged = true;
                }
                _super.prototype.commitProperties.call(this);
                if (this.editableChanged) {
                    this._textField.type = this._editable ? egret.TextFieldType.INPUT : egret.TextFieldType.DYNAMIC;
                    this.editableChanged = false;
                }
                if (this.displayAsPasswordChanged) {
                    this._textField.displayAsPassword = this._displayAsPassword;
                    this.displayAsPasswordChanged = false;
                }
                if (this.maxCharsChanged) {
                    this._textField.maxChars = this._maxChars;
                    this.maxCharsChanged = false;
                }
                if (this.multilineChanged) {
                    this._textField.multiline = this._multiline;
                    //this._textField.wordWrap = this._multiline;
                    this.multilineChanged = false;
                }
                if (this.restrictChanged) {
                    //this._textField.restrict = this._restrict;
                    this.restrictChanged = false;
                }
                if (this.heightInLinesChanged) {
                    this.heightInLinesChanged = false;
                    if (isNaN(this._heightInLines)) {
                        this.defaultHeight = NaN;
                    }
                    else {
                        //todo:没有文字时的测量
                        var hInLine = parseInt(this.heightInLines);
                        var lineHeight = 22;
                        if (this._textField._text.length > 0) {
                            lineHeight = this._textField._getLineHeight();
                        }
                        else {
                            this._textField._text = "M";
                            lineHeight = this._textField._getLineHeight();
                            this._textField._text = "";
                        }
                        this.defaultHeight = hInLine * lineHeight + 4;
                    }
                }
                if (this.widthInCharsChanged) {
                    this.widthInCharsChanged = false;
                    if (isNaN(this._widthInChars)) {
                        this.defaultWidth = NaN;
                    }
                    else {
                        var wInChars = parseInt(this._widthInChars);
                        this.defaultWidth = this.size * wInChars + 5;
                    }
                }
            };
            /**
             * @inheritDoc
             */
            EditableText.prototype.updateDisplayList = function (unscaledWidth, unscaledHeight) {
                this.isValidating = true;
                _super.prototype.updateDisplayList.call(this, unscaledWidth, unscaledHeight);
                this.updateContentSize();
                this.isValidating = false;
            };
            /**
             * 更新内容尺寸大小
             */
            EditableText.prototype.updateContentSize = function () {
                if (!this.clipAndEnableScrolling)
                    return;
                this.setContentWidth(this._textField.width);
                var contentHeight = 0;
                var numLines = this._textField.numLines;
                if (numLines == 0) {
                    contentHeight = 4;
                }
                else {
                    var lineHeight = this._textField._getLineHeight();
                    var offsetHeight = (this.height - 4) % lineHeight;
                    contentHeight = this._textField.height + offsetHeight;
                }
                this.setContentHeight(contentHeight);
            };
            Object.defineProperty(EditableText.prototype, "selectionBeginIndex", {
                /**
                 * @inheritDoc
                 */
                get: function () {
                    this.validateProperties();
                    if (this._textField)
                        return this._textField.selectionBeginIndex;
                    return 0;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(EditableText.prototype, "selectionEndIndex", {
                /**
                 * @inheritDoc
                 */
                get: function () {
                    this.validateProperties();
                    if (this._textField)
                        return this._textField.selectionEndIndex;
                    return 0;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(EditableText.prototype, "caretIndex", {
                /**
                 * @inheritDoc
                 */
                get: function () {
                    this.validateProperties();
                    if (this._textField)
                        return this._textField.caretIndex;
                    return 0;
                },
                enumerable: true,
                configurable: true
            });
            /**
             * @inheritDoc
             */
            EditableText.prototype.setSelection = function (beginIndex, endIndex) {
                if (endIndex === void 0) { endIndex = 0; }
                this.validateProperties();
                if (this._textField) {
                    this._textField._setSelection(beginIndex, endIndex);
                }
            };
            /**
             * @inheritDoc
             */
            EditableText.prototype.selectAll = function () {
                this.validateProperties();
                if (this._textField) {
                    this._textField._setSelection(0, this._textField.text.length);
                }
            };
            /**
             * @inheritDoc
             */
            EditableText.prototype.measure = function () {
                this.measuredWidth = isNaN(this.defaultWidth) ? gui.TextBase.DEFAULT_MEASURED_WIDTH : this.defaultWidth;
                if (this._maxChars != 0) {
                    this.measuredWidth = Math.min(this.measuredWidth, this._textField.width);
                }
                if (this._multiline) {
                    this.measuredHeight = isNaN(this.defaultHeight) ? gui.TextBase.DEFAULT_MEASURED_HEIGHT * 2 : this.defaultHeight;
                }
                else {
                    this.measuredHeight = this._textField.height;
                }
            };
            /**
             * 创建文本显示对象
             */
            EditableText.prototype._createTextField = function () {
                _super.prototype._createTextField.call(this);
                this._textField.type = this._editable ? egret.TextFieldType.INPUT : egret.TextFieldType.DYNAMIC;
                this._textField.multiline = this._multiline;
                //this._textField.wordWrap = this._multiline;
                this._textField.addEventListener(egret.Event.CHANGE, this.textField_changeHandler, this);
                this._textField.addEventListener("scroll", this.textField_scrollHandler, this); //todo:Scroll event
                this._textField.addEventListener("input", this.textField_textInputHandler, this);
            };
            EditableText.prototype.textField_changeHandler = function (event) {
                //this._textFieldChanged(false);
                event.stopImmediatePropagation();
                this.dispatchEvent(new egret.Event(egret.Event.CHANGE));
                this.invalidateSize();
                this.invalidateDisplayList();
                this.updateContentSize();
            };
            /**
             *  @private
             */
            EditableText.prototype.textField_scrollHandler = function (event) {
            };
            /**
             * 即将输入文字
             */
            EditableText.prototype.textField_textInputHandler = function (event) {
                event.stopImmediatePropagation();
                var newEvent = new egret.Event(event.type, false, true);
                newEvent.data = event.data;
                this.dispatchEvent(newEvent);
                if (newEvent.isDefaultPrevented())
                    event.preventDefault();
            };
            return EditableText;
        })(gui.TextBase);
        gui.EditableText = EditableText;
        EditableText.prototype.__class__ = "egret.gui.EditableText";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.UIEvent
         * @classdesc
         * UI事件
         * @extends egret.Event
         */
        var UIEvent = (function (_super) {
            __extends(UIEvent, _super);
            /**
             * @method egret.gui.UIEvent#constructor
             * @param type {string}
             * @param bubbles {boolean}
             * @param cancelable {boolean}
             */
            function UIEvent(type, bubbles, cancelable) {
                if (bubbles === void 0) { bubbles = false; }
                if (cancelable === void 0) { cancelable = false; }
                _super.call(this, type, bubbles, cancelable);
            }
            /**
             * 使用指定的EventDispatcher对象来抛出事件对象。抛出的对象将会缓存在对象池上，供下次循环复用。
             * @method egret.gui.UIEvent.dispatchUIEvent
             */
            UIEvent.dispatchUIEvent = function (target, type) {
                var eventClass = UIEvent;
                egret.Event._dispatchByTarget(eventClass, target, type);
            };
            /**
             * 组件初始化开始
             * @constant egret.gui.UIEvent.INITIALIZE
             */
            UIEvent.INITIALIZE = "initialize";
            /**
             * 组件创建完成
             * @constant egret.gui.UIEvent.CREATION_COMPLETE
             */
            UIEvent.CREATION_COMPLETE = "creationComplete";
            /**
             * 组件的一次三个延迟验证渲染阶段全部完成
             * @constant egret.gui.UIEvent.UPDATE_COMPLETE
             */
            UIEvent.UPDATE_COMPLETE = "updateComplete";
            /**
             * 当用户按下ButtonBase控件时分派。如果 autoRepeat属性为 true，则只要按钮处于按下状态，就将重复分派此事件。
             * @constant egret.gui.UIEvent.BUTTON_DOWN
             */
            UIEvent.BUTTON_DOWN = "buttonDown";
            /**
             * 改变结束
             * @constant egret.gui.UIEvent.CHANGE_END
             */
            UIEvent.CHANGE_END = "changeEnd";
            /**
             * 改变开始
             * @constant egret.gui.UIEvent.CHANGE_START
             */
            UIEvent.CHANGE_START = "changeStart";
            /**
             * 正在改变中
             * @constant egret.gui.UIEvent.CHANGING
             */
            UIEvent.CHANGING = "changing";
            /**
             * 值发生改变
             * @constant egret.gui.UIEvent.VALUE_COMMIT
             */
            UIEvent.VALUE_COMMIT = "valueCommit";
            /**
             * SkinnableComponent皮肤发生改变
             * @constant egret.gui.UIEvent.SKIN_CHANGED
             */
            UIEvent.SKIN_CHANGED = "skinChanged";
            /**
             * UIAsset的content属性解析完成
             * @constant egret.gui.UIEvent.CONTENT_CHANGED
             */
            UIEvent.CONTENT_CHANGED = "contentChanged";
            /**
             * 下拉框弹出事件
             * @constant egret.gui.UIEvent.OPEN
             */
            UIEvent.OPEN = "open";
            /**
             * 下拉框关闭事件
             * @constant egret.gui.UIEvent.CLOSE
             */
            UIEvent.CLOSE = "close";
            /**
             * UIMoveClip一次播放完成事件。仅当UIMovieClip.totalFrames>1时会抛出此事件。
             * @constant egret.gui.UIEvent.PLAY_COMPLETE
             */
            UIEvent.PLAY_COMPLETE = "playComplete";
            return UIEvent;
        })(egret.Event);
        gui.UIEvent = UIEvent;
        UIEvent.prototype.__class__ = "egret.gui.UIEvent";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.PropertyChangeEvent
         * @classdesc
         * 对象的一个属性发生更改时传递到事件侦听器的事件
         * @extends egret.Event
         */
        var PropertyChangeEvent = (function (_super) {
            __extends(PropertyChangeEvent, _super);
            /**
             * 构造函数
             * @method egret.gui.PropertyChangeEvent#constructor
             * @param type {string}
             * @param bubbles {boolean}
             * @param cancelable {boolean}
             * @param kind {string}
             * @param property {any}
             * @param oldValue {any}
             * @param newValue {any}
             * @param source {any}
             */
            function PropertyChangeEvent(type, bubbles, cancelable, kind, property, oldValue, newValue, source) {
                if (bubbles === void 0) { bubbles = false; }
                if (cancelable === void 0) { cancelable = false; }
                if (kind === void 0) { kind = null; }
                if (property === void 0) { property = null; }
                if (oldValue === void 0) { oldValue = null; }
                if (newValue === void 0) { newValue = null; }
                if (source === void 0) { source = null; }
                _super.call(this, type, bubbles, cancelable);
                this.kind = kind;
                this.property = property;
                this.oldValue = oldValue;
                this.newValue = newValue;
                this.source = source;
            }
            /**
             * 使用指定的EventDispatcher对象来抛出事件对象。抛出的对象将会缓存在对象池上，供下次循环复用。
             * @method egret.gui.PropertyChangeEvent.dispatchPropertyChangeEvent
             */
            PropertyChangeEvent.dispatchPropertyChangeEvent = function (target, kind, property, oldValue, newValue, source) {
                if (kind === void 0) { kind = null; }
                if (property === void 0) { property = null; }
                if (oldValue === void 0) { oldValue = null; }
                if (newValue === void 0) { newValue = null; }
                if (source === void 0) { source = null; }
                var eventClass = PropertyChangeEvent;
                var props = egret.Event._getPropertyData(eventClass);
                props.kind = kind;
                props.property = property;
                props.oldValue = oldValue;
                props.newValue = newValue;
                props.source = source;
                egret.Event._dispatchByTarget(eventClass, target, PropertyChangeEvent.PROPERTY_CHANGE, props);
            };
            /**
             * 属性改变
             * @constant egret.gui.PropertyChangeEvent.PROPERTY_CHANGE
             */
            PropertyChangeEvent.PROPERTY_CHANGE = "propertyChange";
            return PropertyChangeEvent;
        })(egret.Event);
        gui.PropertyChangeEvent = PropertyChangeEvent;
        PropertyChangeEvent.prototype.__class__ = "egret.gui.PropertyChangeEvent";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.PropertyChangeEventKind
         * @classdesc
         * PropertyChangeEventKind 类定义 PropertyChangeEvent 类的 kind 属性的常量值。
         */
        var PropertyChangeEventKind = (function () {
            function PropertyChangeEventKind() {
            }
            /**
             * 指示该属性的值已更改。
             * @constant egret.gui.PropertyChangeEventKind.UPDATE
             */
            PropertyChangeEventKind.UPDATE = "update";
            /**
             * 指示该属性已从此对象中删除。
             * @constant egret.gui.PropertyChangeEventKind.DELETE
             */
            PropertyChangeEventKind.DELETE = "delete";
            return PropertyChangeEventKind;
        })();
        gui.PropertyChangeEventKind = PropertyChangeEventKind;
        PropertyChangeEventKind.prototype.__class__ = "egret.gui.PropertyChangeEventKind";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.MoveEvent
         * @classdesc
         * 移动事件
         * @extends egret.Event
         */
        var MoveEvent = (function (_super) {
            __extends(MoveEvent, _super);
            /**
             * @method egret.gui.MoveEvent#constructor
             * @param type {string}
             * @param oldX {number}
             * @param oldY {number}
             * @param bubbles {boolean}
             * @param cancelable {boolean}
             */
            function MoveEvent(type, oldX, oldY, bubbles, cancelable) {
                if (oldX === void 0) { oldX = NaN; }
                if (oldY === void 0) { oldY = NaN; }
                if (bubbles === void 0) { bubbles = false; }
                if (cancelable === void 0) { cancelable = false; }
                _super.call(this, type, bubbles, cancelable);
                this.oldX = oldX;
                this.oldY = oldY;
            }
            /**
             * 使用指定的EventDispatcher对象来抛出事件对象。抛出的对象将会缓存在对象池上，供下次循环复用。
             * @method egret.gui.MoveEvent.dispatchMoveEvent
             */
            MoveEvent.dispatchMoveEvent = function (target, oldX, oldY) {
                if (oldX === void 0) { oldX = NaN; }
                if (oldY === void 0) { oldY = NaN; }
                var eventClass = MoveEvent;
                var props = egret.Event._getPropertyData(eventClass);
                props.oldX = oldX;
                props.oldY = oldY;
                egret.Event._dispatchByTarget(eventClass, target, MoveEvent.MOVE, props);
            };
            /**
             * @constant egret.gui.MoveEvent.MOVE
             */
            MoveEvent.MOVE = "move";
            return MoveEvent;
        })(egret.Event);
        gui.MoveEvent = MoveEvent;
        MoveEvent.prototype.__class__ = "egret.gui.MoveEvent";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.ResizeEvent
         * @classdesc
         * 尺寸改变事件
         * @extends egret.Event
         */
        var ResizeEvent = (function (_super) {
            __extends(ResizeEvent, _super);
            /**
             * @method egret.gui.ResizeEvent#constructor
             * @param type {string}
             * @param oldWidth {number}
             * @param oldHeight {number}
             * @param bubbles {boolean}
             * @param cancelable {boolean}
             */
            function ResizeEvent(type, oldWidth, oldHeight, bubbles, cancelable) {
                if (oldWidth === void 0) { oldWidth = NaN; }
                if (oldHeight === void 0) { oldHeight = NaN; }
                if (bubbles === void 0) { bubbles = false; }
                if (cancelable === void 0) { cancelable = false; }
                _super.call(this, type, bubbles, cancelable);
                this.oldWidth = oldWidth;
                this.oldHeight = oldHeight;
            }
            /**
             * 使用指定的EventDispatcher对象来抛出事件对象。抛出的对象将会缓存在对象池上，供下次循环复用。
             * @method egret.gui.ResizeEvent.dispatchResizeEvent
             */
            ResizeEvent.dispatchResizeEvent = function (target, oldWidth, oldHeight) {
                if (oldWidth === void 0) { oldWidth = NaN; }
                if (oldHeight === void 0) { oldHeight = NaN; }
                var eventClass = ResizeEvent;
                var props = egret.Event._getPropertyData(eventClass);
                props.oldWidth = oldWidth;
                props.oldHeight = oldHeight;
                egret.Event._dispatchByTarget(eventClass, target, ResizeEvent.RESIZE, props);
            };
            /**
             * @constant egret.gui.ResizeEvent.RESIZE
             */
            ResizeEvent.RESIZE = "resize";
            return ResizeEvent;
        })(egret.Event);
        gui.ResizeEvent = ResizeEvent;
        ResizeEvent.prototype.__class__ = "egret.gui.ResizeEvent";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.SkinPartEvent
         * @classdesc
         * 皮肤组件附加移除事件
         * @extends egret.Event
         */
        var SkinPartEvent = (function (_super) {
            __extends(SkinPartEvent, _super);
            /**
             * @method egret.gui.SkinPartEvent#constructor
             * @param type {string}
             * @param bubbles {boolean}
             * @param cancelable {boolean}
             * @param partName {string}
             * @param instance {any}
             */
            function SkinPartEvent(type, bubbles, cancelable, partName, instance) {
                if (bubbles === void 0) { bubbles = false; }
                if (cancelable === void 0) { cancelable = false; }
                if (partName === void 0) { partName = null; }
                if (instance === void 0) { instance = null; }
                _super.call(this, type, bubbles, cancelable);
                this.partName = partName;
                this.instance = instance;
            }
            /**
             * 使用指定的EventDispatcher对象来抛出事件对象。抛出的对象将会缓存在对象池上，供下次循环复用。
             * @method egret.gui.SkinPartEvent.dispatchSkinPartEvent
             */
            SkinPartEvent.dispatchSkinPartEvent = function (target, type, partName, instance) {
                if (partName === void 0) { partName = null; }
                if (instance === void 0) { instance = null; }
                var eventClass = SkinPartEvent;
                var props = egret.Event._getPropertyData(eventClass);
                props.partName = partName;
                props.instance = instance;
                egret.Event._dispatchByTarget(eventClass, target, type, props);
            };
            /**
             * 附加皮肤公共子部件
             * @constant egret.gui.SkinPartEvent.PART_ADDED
             */
            SkinPartEvent.PART_ADDED = "partAdded";
            /**
             * 移除皮肤公共子部件
             * @constant egret.gui.SkinPartEvent.PART_REMOVED
             */
            SkinPartEvent.PART_REMOVED = "partRemoved";
            return SkinPartEvent;
        })(egret.Event);
        gui.SkinPartEvent = SkinPartEvent;
        SkinPartEvent.prototype.__class__ = "egret.gui.SkinPartEvent";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.CollectionEvent
         * @classdesc
         * 集合类型数据改变事件
         * @extends egret.Event
         */
        var CollectionEvent = (function (_super) {
            __extends(CollectionEvent, _super);
            /**
             * @method egret.gui.CollectionEvent#constructor
             * @param type {string}
             * @param bubbles {boolean}
             * @param cancelable {boolean}
             * @param kind {string}
             * @param location {number}
             * @param oldLocation {number}
             * @param items {Array<any>}
             * @param oldItems {Array<any>}
             */
            function CollectionEvent(type, bubbles, cancelable, kind, location, oldLocation, items, oldItems) {
                if (bubbles === void 0) { bubbles = false; }
                if (cancelable === void 0) { cancelable = false; }
                if (kind === void 0) { kind = null; }
                if (location === void 0) { location = -1; }
                if (oldLocation === void 0) { oldLocation = -1; }
                if (items === void 0) { items = null; }
                if (oldItems === void 0) { oldItems = null; }
                _super.call(this, type, bubbles, cancelable);
                this.kind = kind;
                this.location = location;
                this.oldLocation = oldLocation;
                this.items = items ? items : [];
                this.oldItems = oldItems ? oldItems : [];
            }
            /**
             * 使用指定的EventDispatcher对象来抛出事件对象。抛出的对象将会缓存在对象池上，供下次循环复用。
             * @method egret.gui.CollectionEvent.dispatchCollectionEvent
             */
            CollectionEvent.dispatchCollectionEvent = function (target, type, kind, location, oldLocation, items, oldItems) {
                if (kind === void 0) { kind = null; }
                if (location === void 0) { location = -1; }
                if (oldLocation === void 0) { oldLocation = -1; }
                if (items === void 0) { items = null; }
                if (oldItems === void 0) { oldItems = null; }
                var eventClass = CollectionEvent;
                var props = egret.Event._getPropertyData(eventClass);
                props.kind = kind;
                props.location = location;
                props.oldLocation = oldLocation;
                props.items = items;
                props.oldItems = oldItems;
                egret.Event._dispatchByTarget(eventClass, target, type, props);
            };
            /**
             * 集合类数据发生改变
             * @constant egret.gui.CollectionEvent.COLLECTION_CHANGE
             */
            CollectionEvent.COLLECTION_CHANGE = "collectionChange";
            return CollectionEvent;
        })(egret.Event);
        gui.CollectionEvent = CollectionEvent;
        CollectionEvent.prototype.__class__ = "egret.gui.CollectionEvent";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.CollectionEventKind
         * @classdesc
         * 定义  CollectionEvent 类 kind 属性的有效值的常量。
         * 这些常量指示对集合进行的更改类型。
         */
        var CollectionEventKind = (function () {
            function CollectionEventKind() {
            }
            /**
             * 指示集合添加了一个或多个项目。
             * @constant egret.gui.CollectionEventKind.ADD
             */
            CollectionEventKind.ADD = "add";
            /**
             * 指示项目已从 CollectionEvent.oldLocation确定的位置移动到 location确定的位置。
             * @constant egret.gui.CollectionEventKind.MOVE
             */
            CollectionEventKind.MOVE = "move";
            /**
             * 指示集合应用了排序或/和筛选。
             * @constant egret.gui.CollectionEventKind.REFRESH
             */
            CollectionEventKind.REFRESH = "refresh";
            /**
             * 指示集合删除了一个或多个项目。
             * @constant egret.gui.CollectionEventKind.REMOVE
             */
            CollectionEventKind.REMOVE = "remove";
            /**
             * 指示已替换由 CollectionEvent.location 属性确定的位置处的项目。
             * @constant egret.gui.CollectionEventKind.REPLACE
             */
            CollectionEventKind.REPLACE = "replace";
            /**
             * 指示集合已彻底更改，需要进行重置。
             * @constant egret.gui.CollectionEventKind.RESET
             */
            CollectionEventKind.RESET = "reset";
            /**
             * 指示集合中一个或多个项目进行了更新。受影响的项目将存储在  CollectionEvent.items 属性中。
             * @constant egret.gui.CollectionEventKind.UPDATE
             */
            CollectionEventKind.UPDATE = "update";
            /**
             * 指示集合中某个节点的子项列表已打开，通常应用于Tree的数据源XMLCollection。
             * @constant egret.gui.CollectionEventKind.OPEN
             */
            CollectionEventKind.OPEN = "open";
            /**
             * 指示集合中某个节点的子项列表已关闭，通常应用于Tree的数据源XMLCollection。
             * @constant egret.gui.CollectionEventKind.CLOSE
             */
            CollectionEventKind.CLOSE = "close";
            return CollectionEventKind;
        })();
        gui.CollectionEventKind = CollectionEventKind;
        CollectionEventKind.prototype.__class__ = "egret.gui.CollectionEventKind";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.ElementExistenceEvent
         * @classdesc
         * Group添加或移除元素时分派的事件。
         * @extends egret.Event
         */
        var ElementExistenceEvent = (function (_super) {
            __extends(ElementExistenceEvent, _super);
            /**
             * @member egret.gui.ElementExistenceEvent#constructor
             */
            function ElementExistenceEvent(type, bubbles, cancelable, element, index) {
                if (bubbles === void 0) { bubbles = false; }
                if (cancelable === void 0) { cancelable = false; }
                if (element === void 0) { element = null; }
                if (index === void 0) { index = -1; }
                _super.call(this, type, bubbles, cancelable);
                this.element = element;
                this.index = index;
            }
            /**
             * 使用指定的EventDispatcher对象来抛出事件对象。抛出的对象将会缓存在对象池上，供下次循环复用。
             * @method egret.gui.ElementExistenceEvent.dispatchElementExistenceEvent
             */
            ElementExistenceEvent.dispatchElementExistenceEvent = function (target, type, element, index) {
                if (element === void 0) { element = null; }
                if (index === void 0) { index = -1; }
                var eventClass = ElementExistenceEvent;
                var props = egret.Event._getPropertyData(eventClass);
                props.element = element;
                props.index = index;
                egret.Event._dispatchByTarget(eventClass, target, type, props);
            };
            /**
             * 元素添加
             * @constant egret.gui.ElementExistenceEvent.ELEMENT_ADD
             */
            ElementExistenceEvent.ELEMENT_ADD = "elementAdd";
            /**
             * 元素移除
             * @constant egret.gui.ElementExistenceEvent.ELEMENT_REMOVE
             */
            ElementExistenceEvent.ELEMENT_REMOVE = "elementRemove";
            return ElementExistenceEvent;
        })(egret.Event);
        gui.ElementExistenceEvent = ElementExistenceEvent;
        ElementExistenceEvent.prototype.__class__ = "egret.gui.ElementExistenceEvent";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.PopUpEvent
         * @classdesc
         * 弹出管理器事件
         * @extends egret.Event
         */
        var PopUpEvent = (function (_super) {
            __extends(PopUpEvent, _super);
            /**
             * 构造函数
             * @method egret.gui.PopUpEvent#constructor
             * @param type {string}
             * @param bubbles {boolean}
             * @param cancelable {boolean}
             * @param popUp {IVisualElement}
             * @param modal {boolean}
             */
            function PopUpEvent(type, bubbles, cancelable, popUp, modal) {
                if (bubbles === void 0) { bubbles = false; }
                if (cancelable === void 0) { cancelable = false; }
                if (popUp === void 0) { popUp = null; }
                if (modal === void 0) { modal = false; }
                _super.call(this, type, bubbles, cancelable);
                this.popUp = popUp;
                this.modal = modal;
            }
            /**
             * 使用指定的EventDispatcher对象来抛出事件对象。抛出的对象将会缓存在对象池上，供下次循环复用。
             * @method egret.gui.PopUpEvent.dispatchPopUpEvent
             */
            PopUpEvent.dispatchPopUpEvent = function (target, type, popUp, modal) {
                if (popUp === void 0) { popUp = null; }
                if (modal === void 0) { modal = false; }
                var eventClass = PopUpEvent;
                var props = egret.Event._getPropertyData(eventClass);
                props.popUp = popUp;
                props.modal = modal;
                egret.Event._dispatchByTarget(eventClass, target, type, props);
            };
            /**
             * 添加一个弹出框，在执行完添加之后抛出。
             * @constant egret.gui.PopUpEvent.ADD_POPUP
             */
            PopUpEvent.ADD_POPUP = "addPopUp";
            /**
             * 移除一个弹出框，在执行完移除之后抛出。
             * @constant egret.gui.PopUpEvent.REMOVE_POPUP
             */
            PopUpEvent.REMOVE_POPUP = "removePopUp";
            /**
             * 移动弹出框到最前，在执行完前置之后抛出。
             * @constant egret.gui.PopUpEvent.BRING_TO_FRONT
             */
            PopUpEvent.BRING_TO_FRONT = "bringToFront";
            return PopUpEvent;
        })(egret.Event);
        gui.PopUpEvent = PopUpEvent;
        PopUpEvent.prototype.__class__ = "egret.gui.PopUpEvent";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.RendererExistenceEvent
         * @classdesc
         * 在DataGroup添加或删除项呈示器时分派的事件。
         * @extends egret.Event
         */
        var RendererExistenceEvent = (function (_super) {
            __extends(RendererExistenceEvent, _super);
            /**
             * @method egret.gui.RendererExistenceEvent#constructor
             * @param type {string}
             * @param bubbles {boolean}
             * @param cancelable {boolean}
             * @param renderer {IItemRenderer}
             * @param index {number}
             * @param data {any}
             */
            function RendererExistenceEvent(type, bubbles, cancelable, renderer, index, data) {
                if (bubbles === void 0) { bubbles = false; }
                if (cancelable === void 0) { cancelable = false; }
                if (renderer === void 0) { renderer = null; }
                if (index === void 0) { index = -1; }
                if (data === void 0) { data = null; }
                _super.call(this, type, bubbles, cancelable);
                this.renderer = renderer;
                this.index = index;
                this.data = data;
            }
            /**
             * 使用指定的EventDispatcher对象来抛出事件对象。抛出的对象将会缓存在对象池上，供下次循环复用。
             * @method egret.gui.RendererExistenceEvent.dispatchRendererExistenceEvent
             */
            RendererExistenceEvent.dispatchRendererExistenceEvent = function (target, type, renderer, index, data) {
                if (renderer === void 0) { renderer = null; }
                if (index === void 0) { index = -1; }
                if (data === void 0) { data = null; }
                var eventClass = RendererExistenceEvent;
                var props = egret.Event._getPropertyData(eventClass);
                props.renderer = renderer;
                props.index = index;
                props.data = data;
                egret.Event._dispatchByTarget(eventClass, target, type, props);
            };
            /**
             * 添加了项呈示器
             * @constant egret.gui.RendererExistenceEvent.RENDERER_ADD
             */
            RendererExistenceEvent.RENDERER_ADD = "rendererAdd";
            /**
             * 移除了项呈示器
             * @constant egret.gui.RendererExistenceEvent.RENDERER_REMOVE
             */
            RendererExistenceEvent.RENDERER_REMOVE = "rendererRemove";
            return RendererExistenceEvent;
        })(egret.Event);
        gui.RendererExistenceEvent = RendererExistenceEvent;
        RendererExistenceEvent.prototype.__class__ = "egret.gui.RendererExistenceEvent";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.StateChangeEvent
         * @classdesc
         * 视图状态改变事件
         * @extends egret.Event
         */
        var StateChangeEvent = (function (_super) {
            __extends(StateChangeEvent, _super);
            /**
             * @method egret.gui.StateChangeEvent#constructor
             * @param type {string}
             * @param bubbles {boolean}
             * @param cancelable {boolean}
             * @param oldState {string}
             * @param newState {string}
             */
            function StateChangeEvent(type, bubbles, cancelable, oldState, newState) {
                if (bubbles === void 0) { bubbles = false; }
                if (cancelable === void 0) { cancelable = false; }
                if (oldState === void 0) { oldState = null; }
                if (newState === void 0) { newState = null; }
                _super.call(this, type, bubbles, cancelable);
                this.oldState = oldState;
                this.newState = newState;
            }
            /**
             * 使用指定的EventDispatcher对象来抛出事件对象。抛出的对象将会缓存在对象池上，供下次循环复用。
             * @method egret.gui.StateChangeEvent.dispatchStateChangeEvent
             */
            StateChangeEvent.dispatchStateChangeEvent = function (target, type, oldState, newState) {
                if (oldState === void 0) { oldState = null; }
                if (newState === void 0) { newState = null; }
                var eventClass = StateChangeEvent;
                var props = egret.Event._getPropertyData(eventClass);
                props.oldState = oldState;
                props.newState = newState;
                egret.Event._dispatchByTarget(eventClass, target, type, props);
            };
            /**
             * 当前视图状态已经改变
             * @constant egret.gui.StateChangeEvent.CURRENT_STATE_CHANGE
             */
            StateChangeEvent.CURRENT_STATE_CHANGE = "currentStateChange";
            /**
             * 当前视图状态即将改变
             * @constant egret.gui.StateChangeEvent.CURRENT_STATE_CHANGING
             */
            StateChangeEvent.CURRENT_STATE_CHANGING = "currentStateChanging";
            return StateChangeEvent;
        })(egret.Event);
        gui.StateChangeEvent = StateChangeEvent;
        StateChangeEvent.prototype.__class__ = "egret.gui.StateChangeEvent";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.TrackBaseEvent
         * @classdesc
         * 从TrackBase组件分派的事件。
         * @extends egret.Event
         */
        var TrackBaseEvent = (function (_super) {
            __extends(TrackBaseEvent, _super);
            /**
             * 构造函数
             * @method egret.gui.TrackBaseEvent#constructor
             * @param type {string}
             * @param bubbles {boolean}
             * @param cancelable {boolean}
             */
            function TrackBaseEvent(type, bubbles, cancelable) {
                if (bubbles === void 0) { bubbles = false; }
                if (cancelable === void 0) { cancelable = false; }
                _super.call(this, type, bubbles, cancelable);
            }
            /**
             * 使用指定的EventDispatcher对象来抛出事件对象。抛出的对象将会缓存在对象池上，供下次循环复用。
             * @method egret.gui.TrackBaseEvent.dispatchTrackBaseEvent
             */
            TrackBaseEvent.dispatchTrackBaseEvent = function (target, type) {
                var eventClass = TrackBaseEvent;
                egret.Event._dispatchByTarget(eventClass, target, type);
            };
            /**
             * 正在拖拽滑块
             * @constant egret.gui.TrackBaseEvent.THUMB_DRAG
             */
            TrackBaseEvent.THUMB_DRAG = "thumbDrag";
            /**
             * 滑块被按下
             * @constant egret.gui.TrackBaseEvent.THUMB_PRESS
             */
            TrackBaseEvent.THUMB_PRESS = "thumbPress";
            /**
             * 滑块被放开
             * @constant egret.gui.TrackBaseEvent.THUMB_RELEASE
             */
            TrackBaseEvent.THUMB_RELEASE = "thumbRelease";
            return TrackBaseEvent;
        })(egret.Event);
        gui.TrackBaseEvent = TrackBaseEvent;
        TrackBaseEvent.prototype.__class__ = "egret.gui.TrackBaseEvent";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.LayoutBase
         * @classdesc
         * 容器布局基类
         * @extends egret.EventDispatcher
         */
        var LayoutBase = (function (_super) {
            __extends(LayoutBase, _super);
            /**
             * @method egret.gui.LayoutBase#constructor
             */
            function LayoutBase() {
                _super.call(this);
                this._useVirtualLayout = false;
            }
            Object.defineProperty(LayoutBase.prototype, "target", {
                /**
                 * 目标容器
                 * @member egret.gui.LayoutBase#target
                 */
                get: function () {
                    return this._target;
                },
                set: function (value) {
                    if (this._target == value)
                        return;
                    this._target = value;
                    this.clearVirtualLayoutCache();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(LayoutBase.prototype, "useVirtualLayout", {
                /**
                 * 若要配置容器使用虚拟布局，请为与容器关联的布局的 useVirtualLayout 属性设置为 true。
                 * 只有布局设置为 VerticalLayout、HorizontalLayout
                 * 或 TileLayout 的 DataGroup 或 SkinnableDataContainer
                 * 才支持虚拟布局。不支持虚拟化的布局子类必须禁止更改此属性。
                 * @member egret.gui.LayoutBase#useVirtualLayout
                 */
                get: function () {
                    return this._useVirtualLayout;
                },
                set: function (value) {
                    if (this._useVirtualLayout == value)
                        return;
                    this._useVirtualLayout = value;
                    this.dispatchEventWith("useVirtualLayoutChanged");
                    if (this._useVirtualLayout && !value)
                        this.clearVirtualLayoutCache();
                    if (this.target)
                        this.target.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(LayoutBase.prototype, "typicalLayoutRect", {
                /**
                 * 由虚拟布局所使用，以估计尚未滚动到视图中的布局元素的大小。
                 * @member egret.gui.LayoutBase#typicalLayoutRect
                 */
                get: function () {
                    return this._typicalLayoutRect;
                },
                set: function (value) {
                    if (this._typicalLayoutRect == value)
                        return;
                    this._typicalLayoutRect = value;
                    if (this.target)
                        this.target.invalidateSize();
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 滚动条位置改变
             * @method egret.gui.LayoutBase#scrollPositionChanged
             */
            LayoutBase.prototype.scrollPositionChanged = function () {
            };
            /**
             * 清理虚拟布局缓存的数据
             * @method egret.gui.LayoutBase#clearVirtualLayoutCache
             */
            LayoutBase.prototype.clearVirtualLayoutCache = function () {
            };
            /**
             * 在已添加布局元素之后且在验证目标的大小和显示列表之前，由目标调用。
             * 按元素状态缓存的布局（比如虚拟布局）可以覆盖此方法以更新其缓存。
             * @method egret.gui.LayoutBase#elementAdded
             * @param index {number}
             */
            LayoutBase.prototype.elementAdded = function (index) {
            };
            /**
             * 必须在已删除布局元素之后且在验证目标的大小和显示列表之前，由目标调用此方法。
             * 按元素状态缓存的布局（比如虚拟布局）可以覆盖此方法以更新其缓存。
             * @method egret.gui.LayoutBase#elementRemoved
             * @param index {number}
             */
            LayoutBase.prototype.elementRemoved = function (index) {
            };
            /**
             * 测量组件尺寸大小
             * @method egret.gui.LayoutBase#measure
             */
            LayoutBase.prototype.measure = function () {
            };
            /**
             * 更新显示列表
             * @method egret.gui.LayoutBase#updateDisplayList
             * @param width {number}
             * @param height {number}
             */
            LayoutBase.prototype.updateDisplayList = function (width, height) {
            };
            return LayoutBase;
        })(egret.EventDispatcher);
        gui.LayoutBase = LayoutBase;
        LayoutBase.prototype.__class__ = "egret.gui.LayoutBase";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.BasicLayout
         * @classdesc
         * 基本布局
         * @extends egret.gui.LayoutBase
         */
        var BasicLayout = (function (_super) {
            __extends(BasicLayout, _super);
            /**
             * @method egret.gui.BasicLayout#constructor
             */
            function BasicLayout() {
                _super.call(this);
                this._mouseWheelSpeed = 20;
            }
            Object.defineProperty(BasicLayout.prototype, "useVirtualLayout", {
                /**
                 * 此布局不支持虚拟布局，设置这个属性无效
                 */
                set: function (value) {
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(BasicLayout.prototype, "mouseWheelSpeed", {
                /**
                 * 鼠标滚轮每次滚动时目标容器的verticalScrollPosition
                 * 或horizontalScrollPosition改变的像素距离。必须大于0， 默认值20。
                 * @member egret.gui.BasicLayout#mouseWheelSpeed
                 */
                get: function () {
                    return this._mouseWheelSpeed;
                },
                set: function (value) {
                    if (value == 0)
                        value = 1;
                    this._mouseWheelSpeed = value;
                },
                enumerable: true,
                configurable: true
            });
            BasicLayout.prototype.getElementBoundsLeftOfScrollRect = function (scrollRect) {
                var bounds = new egret.Rectangle();
                bounds.x = scrollRect.x - this._mouseWheelSpeed;
                bounds.right = scrollRect.x;
                return bounds;
            };
            BasicLayout.prototype.getElementBoundsRightOfScrollRect = function (scrollRect) {
                var bounds = new egret.Rectangle();
                bounds.x = scrollRect.right;
                bounds.right = scrollRect.right + this._mouseWheelSpeed;
                return bounds;
            };
            BasicLayout.prototype.getElementBoundsAboveScrollRect = function (scrollRect) {
                var bounds = new egret.Rectangle();
                bounds.y = scrollRect.y - this._mouseWheelSpeed;
                bounds.bottom = scrollRect.y;
                return bounds;
            };
            BasicLayout.prototype.getElementBoundsBelowScrollRect = function (scrollRect) {
                var bounds = new egret.Rectangle();
                bounds.y = scrollRect.bottom;
                bounds.bottom = scrollRect.bottom + this._mouseWheelSpeed;
                return bounds;
            };
            BasicLayout.prototype.measure = function () {
                _super.prototype.measure.call(this);
                if (this.target == null)
                    return;
                var width = 0;
                var height = 0;
                var count = this.target.numElements;
                for (var i = 0; i < count; i++) {
                    var layoutElement = (this.target.getElementAt(i));
                    if (!layoutElement || !layoutElement.includeInLayout)
                        continue;
                    var hCenter = layoutElement.horizontalCenter;
                    var vCenter = layoutElement.verticalCenter;
                    var left = layoutElement.left;
                    var right = layoutElement.right;
                    var top = layoutElement.top;
                    var bottom = layoutElement.bottom;
                    var extX;
                    var extY;
                    if (!isNaN(left) && !isNaN(right)) {
                        extX = left + right;
                    }
                    else if (!isNaN(hCenter)) {
                        extX = Math.abs(hCenter) * 2;
                    }
                    else if (!isNaN(left) || !isNaN(right)) {
                        extX = isNaN(left) ? 0 : left;
                        extX += isNaN(right) ? 0 : right;
                    }
                    else {
                        extX = layoutElement.preferredX;
                    }
                    if (!isNaN(top) && !isNaN(bottom)) {
                        extY = top + bottom;
                    }
                    else if (!isNaN(vCenter)) {
                        extY = Math.abs(vCenter) * 2;
                    }
                    else if (!isNaN(top) || !isNaN(bottom)) {
                        extY = isNaN(top) ? 0 : top;
                        extY += isNaN(bottom) ? 0 : bottom;
                    }
                    else {
                        extY = layoutElement.preferredY;
                    }
                    var preferredWidth = layoutElement.preferredWidth;
                    var preferredHeight = layoutElement.preferredHeight;
                    width = Math.ceil(Math.max(width, extX + preferredWidth));
                    height = Math.ceil(Math.max(height, extY + preferredHeight));
                }
                this.target.measuredWidth = width;
                this.target.measuredHeight = height;
            };
            BasicLayout.prototype.updateDisplayList = function (unscaledWidth, unscaledHeight) {
                _super.prototype.updateDisplayList.call(this, unscaledWidth, unscaledHeight);
                if (this.target == null)
                    return;
                var count = this.target.numElements;
                var maxX = 0;
                var maxY = 0;
                for (var i = 0; i < count; i++) {
                    var layoutElement = (this.target.getElementAt(i));
                    if (layoutElement == null || !layoutElement.includeInLayout)
                        continue;
                    var hCenter = layoutElement.horizontalCenter;
                    var vCenter = layoutElement.verticalCenter;
                    var left = layoutElement.left;
                    var right = layoutElement.right;
                    var top = layoutElement.top;
                    var bottom = layoutElement.bottom;
                    var percentWidth = layoutElement.percentWidth;
                    var percentHeight = layoutElement.percentHeight;
                    var childWidth = NaN;
                    var childHeight = NaN;
                    if (!isNaN(left) && !isNaN(right)) {
                        childWidth = unscaledWidth - right - left;
                    }
                    else if (!isNaN(percentWidth)) {
                        childWidth = Math.round(unscaledWidth * Math.min(percentWidth * 0.01, 1));
                    }
                    if (!isNaN(top) && !isNaN(bottom)) {
                        childHeight = unscaledHeight - bottom - top;
                    }
                    else if (!isNaN(percentHeight)) {
                        childHeight = Math.round(unscaledHeight * Math.min(percentHeight * 0.01, 1));
                    }
                    layoutElement.setLayoutBoundsSize(childWidth, childHeight);
                    var elementWidth = layoutElement.layoutBoundsWidth;
                    var elementHeight = layoutElement.layoutBoundsHeight;
                    var childX = NaN;
                    var childY = NaN;
                    if (!isNaN(hCenter))
                        childX = Math.round((unscaledWidth - elementWidth) / 2 + hCenter);
                    else if (!isNaN(left))
                        childX = left;
                    else if (!isNaN(right))
                        childX = unscaledWidth - elementWidth - right;
                    else
                        childX = layoutElement.layoutBoundsX;
                    if (!isNaN(vCenter))
                        childY = Math.round((unscaledHeight - elementHeight) / 2 + vCenter);
                    else if (!isNaN(top))
                        childY = top;
                    else if (!isNaN(bottom))
                        childY = unscaledHeight - elementHeight - bottom;
                    else
                        childY = layoutElement.layoutBoundsY;
                    layoutElement.setLayoutBoundsPosition(childX, childY);
                    maxX = Math.max(maxX, childX + elementWidth);
                    maxY = Math.max(maxY, childY + elementHeight);
                }
                this.target.setContentSize(maxX, maxY);
            };
            return BasicLayout;
        })(gui.LayoutBase);
        gui.BasicLayout = BasicLayout;
        BasicLayout.prototype.__class__ = "egret.gui.BasicLayout";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.VerticalLayout
         * @classdesc
         * 垂直布局
         * @extends egret.gui.LayoutBase
         */
        var VerticalLayout = (function (_super) {
            __extends(VerticalLayout, _super);
            /**
             * @method egret.gui.VerticalLayout#constructor
             */
            function VerticalLayout() {
                _super.call(this);
                this._horizontalAlign = egret.HorizontalAlign.LEFT;
                this._verticalAlign = egret.VerticalAlign.TOP;
                this._gap = 6;
                this._padding = 0;
                this._paddingLeft = NaN;
                this._paddingRight = NaN;
                this._paddingTop = NaN;
                this._paddingBottom = NaN;
                /**
                 * 虚拟布局使用的子对象尺寸缓存
                 */
                this.elementSizeTable = [];
                /**
                 * 虚拟布局使用的当前视图中的第一个元素索引
                 */
                this.startIndex = -1;
                /**
                 * 虚拟布局使用的当前视图中的最后一个元素的索引
                 */
                this.endIndex = -1;
                /**
                 * 视图的第一个和最后一个元素的索引值已经计算好的标志
                 */
                this.indexInViewCalculated = false;
                /**
                 * 子对象最大宽度
                 */
                this.maxElementWidth = 0;
            }
            Object.defineProperty(VerticalLayout.prototype, "horizontalAlign", {
                /**
                 * 布局元素的水平对齐策略。参考HorizontalAlign定义的常量。
                 * @member egret.gui.VerticalLayout#horizontalAlign
                 */
                get: function () {
                    return this._horizontalAlign;
                },
                set: function (value) {
                    if (this._horizontalAlign == value)
                        return;
                    this._horizontalAlign = value;
                    if (this.target)
                        this.target.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(VerticalLayout.prototype, "verticalAlign", {
                /**
                 * 布局元素的竖直对齐策略。参考VerticalAlign定义的常量。
                 * 注意：此属性设置为CONTENT_JUSTIFY始终无效。当useVirtualLayout为true时，设置JUSTIFY也无效。
                 * @member egret.gui.VerticalLayout#verticalAlign
                 */
                get: function () {
                    return this._verticalAlign;
                },
                set: function (value) {
                    if (this._verticalAlign == value)
                        return;
                    this._verticalAlign = value;
                    if (this.target)
                        this.target.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(VerticalLayout.prototype, "gap", {
                /**
                 * 布局元素之间的垂直空间（以像素为单位）
                 * @member egret.gui.VerticalLayout#gap
                 */
                get: function () {
                    return this._gap;
                },
                set: function (value) {
                    if (this._gap == value)
                        return;
                    this._gap = value;
                    this.invalidateTargetSizeAndDisplayList();
                    if (this.hasEventListener("gapChanged"))
                        this.dispatchEventWith("gapChanged");
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(VerticalLayout.prototype, "padding", {
                /**
                 * 四个边缘的共同内边距。若单独设置了任一边缘的内边距，则该边缘的内边距以单独设置的值为准。
                 * 此属性主要用于快速设置多个边缘的相同内边距。默认值：0。
                 * @member egret.gui.VerticalLayout#padding
                 */
                get: function () {
                    return this._padding;
                },
                set: function (value) {
                    if (this._padding == value)
                        return;
                    this._padding = value;
                    this.invalidateTargetSizeAndDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(VerticalLayout.prototype, "paddingLeft", {
                /**
                 * 容器的左边缘与布局元素的左边缘之间的最少像素数,若为NaN将使用padding的值，默认值：NaN。
                 * @member egret.gui.VerticalLayout#paddingLeft
                 */
                get: function () {
                    return this._paddingLeft;
                },
                set: function (value) {
                    if (this._paddingLeft == value)
                        return;
                    this._paddingLeft = value;
                    this.invalidateTargetSizeAndDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(VerticalLayout.prototype, "paddingRight", {
                /**
                 * 容器的右边缘与布局元素的右边缘之间的最少像素数,若为NaN将使用padding的值，默认值：NaN。
                 * @member egret.gui.VerticalLayout#paddingRight
                 */
                get: function () {
                    return this._paddingRight;
                },
                set: function (value) {
                    if (this._paddingRight == value)
                        return;
                    this._paddingRight = value;
                    this.invalidateTargetSizeAndDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(VerticalLayout.prototype, "paddingTop", {
                /**
                 * 容器的顶边缘与第一个布局元素的顶边缘之间的像素数,若为NaN将使用padding的值，默认值：NaN。
                 * @member egret.gui.VerticalLayout#paddingTop
                 */
                get: function () {
                    return this._paddingTop;
                },
                set: function (value) {
                    if (this._paddingTop == value)
                        return;
                    this._paddingTop = value;
                    this.invalidateTargetSizeAndDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(VerticalLayout.prototype, "paddingBottom", {
                /**
                 * 容器的底边缘与最后一个布局元素的底边缘之间的像素数,若为NaN将使用padding的值，默认值：NaN。
                 * @member egret.gui.VerticalLayout#paddingBottom
                 */
                get: function () {
                    return this._paddingBottom;
                },
                set: function (value) {
                    if (this._paddingBottom == value)
                        return;
                    this._paddingBottom = value;
                    this.invalidateTargetSizeAndDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 标记目标容器的尺寸和显示列表失效
             */
            VerticalLayout.prototype.invalidateTargetSizeAndDisplayList = function () {
                if (this.target) {
                    this.target.invalidateSize();
                    this.target.invalidateDisplayList();
                }
            };
            VerticalLayout.prototype.measure = function () {
                _super.prototype.measure.call(this);
                if (!this.target)
                    return;
                if (this.useVirtualLayout) {
                    this.measureVirtual();
                }
                else {
                    this.measureReal();
                }
            };
            /**
             * 测量使用虚拟布局的尺寸
             */
            VerticalLayout.prototype.measureVirtual = function () {
                var numElements = this.target.numElements;
                var typicalHeight = this.typicalLayoutRect ? this.typicalLayoutRect.height : 22;
                var typicalWidth = this.typicalLayoutRect ? this.typicalLayoutRect.width : 71;
                var measuredWidth = Math.max(this.maxElementWidth, typicalWidth);
                var measuredHeight = this.getElementTotalSize();
                var visibleIndices = this.target.getElementIndicesInView();
                var length = visibleIndices.length;
                for (var i = 0; i < length; i++) {
                    var index = visibleIndices[i];
                    var layoutElement = (this.target.getElementAt(index));
                    if (layoutElement == null || !layoutElement.includeInLayout)
                        continue;
                    var preferredWidth = layoutElement.preferredWidth;
                    var preferredHeight = layoutElement.preferredHeight;
                    measuredHeight += preferredHeight;
                    measuredHeight -= isNaN(this.elementSizeTable[index]) ? typicalHeight : this.elementSizeTable[index];
                    measuredWidth = Math.max(measuredWidth, preferredWidth);
                }
                var padding = isNaN(this._padding) ? 0 : this._padding;
                var paddingL = isNaN(this._paddingLeft) ? padding : this._paddingLeft;
                var paddingR = isNaN(this._paddingRight) ? padding : this._paddingRight;
                var paddingT = isNaN(this._paddingTop) ? padding : this._paddingTop;
                var paddingB = isNaN(this._paddingBottom) ? padding : this._paddingBottom;
                var hPadding = paddingL + paddingR;
                var vPadding = paddingT + paddingB;
                this.target.measuredWidth = Math.ceil(measuredWidth + hPadding);
                this.target.measuredHeight = Math.ceil(measuredHeight + vPadding);
            };
            /**
             * 测量使用真实布局的尺寸
             */
            VerticalLayout.prototype.measureReal = function () {
                var count = this.target.numElements;
                var numElements = count;
                var measuredWidth = 0;
                var measuredHeight = 0;
                for (var i = 0; i < count; i++) {
                    var layoutElement = (this.target.getElementAt(i));
                    if (!layoutElement || !layoutElement.includeInLayout) {
                        numElements--;
                        continue;
                    }
                    var preferredWidth = layoutElement.preferredWidth;
                    var preferredHeight = layoutElement.preferredHeight;
                    measuredHeight += preferredHeight;
                    measuredWidth = Math.max(measuredWidth, preferredWidth);
                }
                var gap = isNaN(this._gap) ? 0 : this._gap;
                measuredHeight += (numElements - 1) * gap;
                var padding = isNaN(this._padding) ? 0 : this._padding;
                var paddingL = isNaN(this._paddingLeft) ? padding : this._paddingLeft;
                var paddingR = isNaN(this._paddingRight) ? padding : this._paddingRight;
                var paddingT = isNaN(this._paddingTop) ? padding : this._paddingTop;
                var paddingB = isNaN(this._paddingBottom) ? padding : this._paddingBottom;
                var hPadding = paddingL + paddingR;
                var vPadding = paddingT + paddingB;
                this.target.measuredWidth = Math.ceil(measuredWidth + hPadding);
                this.target.measuredHeight = Math.ceil(measuredHeight + vPadding);
            };
            /**
             * @param width {number}
             * @param height {number}
             */
            VerticalLayout.prototype.updateDisplayList = function (width, height) {
                _super.prototype.updateDisplayList.call(this, width, height);
                if (!this.target)
                    return;
                if (this.useVirtualLayout) {
                    this.updateDisplayListVirtual(width, height);
                }
                else {
                    this.updateDisplayListReal(width, height);
                }
            };
            /**
             * 获取指定索引的起始位置
             */
            VerticalLayout.prototype.getStartPosition = function (index) {
                var padding = isNaN(this._padding) ? 0 : this._padding;
                var paddingT = isNaN(this._paddingTop) ? padding : this._paddingTop;
                var gap = isNaN(this._gap) ? 0 : this._gap;
                if (!this.useVirtualLayout) {
                    var element;
                    if (this.target) {
                        element = this.target.getElementAt(index);
                    }
                    return element ? element.y : paddingT;
                }
                var typicalHeight = this.typicalLayoutRect ? this.typicalLayoutRect.height : 22;
                var startPos = paddingT;
                for (var i = 0; i < index; i++) {
                    var eltHeight = this.elementSizeTable[i];
                    if (isNaN(eltHeight)) {
                        eltHeight = typicalHeight;
                    }
                    startPos += eltHeight + gap;
                }
                return startPos;
            };
            /**
             * 获取指定索引的元素尺寸
             */
            VerticalLayout.prototype.getElementSize = function (index) {
                if (this.useVirtualLayout) {
                    var size = this.elementSizeTable[index];
                    if (isNaN(size)) {
                        size = this.typicalLayoutRect ? this.typicalLayoutRect.height : 22;
                    }
                    return size;
                }
                if (this.target) {
                    return this.target.getElementAt(index).height;
                }
                return 0;
            };
            /**
             * 获取缓存的子对象尺寸总和
             */
            VerticalLayout.prototype.getElementTotalSize = function () {
                var gap = isNaN(this._gap) ? 0 : this._gap;
                var typicalHeight = this.typicalLayoutRect ? this.typicalLayoutRect.height : 22;
                var totalSize = 0;
                var length = this.target.numElements;
                for (var i = 0; i < length; i++) {
                    var eltHeight = this.elementSizeTable[i];
                    if (isNaN(eltHeight)) {
                        eltHeight = typicalHeight;
                    }
                    totalSize += eltHeight + gap;
                }
                totalSize -= gap;
                return totalSize;
            };
            /**
             * @param index {number}
             */
            VerticalLayout.prototype.elementAdded = function (index) {
                _super.prototype.elementAdded.call(this, index);
                var typicalHeight = this.typicalLayoutRect ? this.typicalLayoutRect.height : 22;
                this.elementSizeTable.splice(index, 0, typicalHeight);
            };
            /**
             * @param index {number}
             */
            VerticalLayout.prototype.elementRemoved = function (index) {
                _super.prototype.elementRemoved.call(this, index);
                this.elementSizeTable.splice(index, 1);
            };
            VerticalLayout.prototype.clearVirtualLayoutCache = function () {
                _super.prototype.clearVirtualLayoutCache.call(this);
                this.elementSizeTable = [];
                this.maxElementWidth = 0;
            };
            /**
             * 折半查找法寻找指定位置的显示对象索引
             */
            VerticalLayout.prototype.findIndexAt = function (y, i0, i1) {
                var index = Math.floor((i0 + i1) * 0.5);
                var elementY = this.getStartPosition(index);
                var elementHeight = this.getElementSize(index);
                var gap = isNaN(this._gap) ? 0 : this._gap;
                if ((y >= elementY) && (y < elementY + elementHeight + gap))
                    return index;
                else if (i0 == i1)
                    return -1;
                else if (y < elementY)
                    return this.findIndexAt(y, i0, Math.max(i0, index - 1));
                else
                    return this.findIndexAt(y, Math.min(index + 1, i1), i1);
            };
            /**
             */
            VerticalLayout.prototype.scrollPositionChanged = function () {
                _super.prototype.scrollPositionChanged.call(this);
                if (this.useVirtualLayout) {
                    var changed = this.getIndexInView();
                    if (changed) {
                        this.indexInViewCalculated = true;
                        this.target.invalidateDisplayList();
                    }
                }
            };
            /**
             * 获取视图中第一个和最后一个元素的索引,返回是否发生改变
             */
            VerticalLayout.prototype.getIndexInView = function () {
                if (!this.target || this.target.numElements == 0) {
                    this.startIndex = this.endIndex = -1;
                    return false;
                }
                if (isNaN(this.target.width) || this.target.width == 0 || isNaN(this.target.height) || this.target.height == 0) {
                    this.startIndex = this.endIndex = -1;
                    return false;
                }
                var padding = isNaN(this._padding) ? 0 : this._padding;
                var paddingT = isNaN(this._paddingTop) ? padding : this._paddingTop;
                var paddingB = isNaN(this._paddingBottom) ? padding : this._paddingBottom;
                var numElements = this.target.numElements;
                var contentHeight = this.getStartPosition(numElements - 1) + this.elementSizeTable[numElements - 1] + paddingB;
                var minVisibleY = this.target.verticalScrollPosition;
                if (minVisibleY > contentHeight - paddingB) {
                    this.startIndex = -1;
                    this.endIndex = -1;
                    return false;
                }
                var maxVisibleY = this.target.verticalScrollPosition + this.target.height;
                if (maxVisibleY < paddingT) {
                    this.startIndex = -1;
                    this.endIndex = -1;
                    return false;
                }
                var oldStartIndex = this.startIndex;
                var oldEndIndex = this.endIndex;
                this.startIndex = this.findIndexAt(minVisibleY, 0, numElements - 1);
                if (this.startIndex == -1)
                    this.startIndex = 0;
                this.endIndex = this.findIndexAt(maxVisibleY, 0, numElements - 1);
                if (this.endIndex == -1)
                    this.endIndex = numElements - 1;
                return oldStartIndex != this.startIndex || oldEndIndex != this.endIndex;
            };
            /**
             * 更新使用虚拟布局的显示列表
             */
            VerticalLayout.prototype.updateDisplayListVirtual = function (width, height) {
                if (this.indexInViewCalculated)
                    this.indexInViewCalculated = false;
                else
                    this.getIndexInView();
                var padding = isNaN(this._padding) ? 0 : this._padding;
                var paddingL = isNaN(this._paddingLeft) ? padding : this._paddingLeft;
                var paddingR = isNaN(this._paddingRight) ? padding : this._paddingRight;
                var paddingB = isNaN(this._paddingBottom) ? padding : this._paddingBottom;
                var gap = isNaN(this._gap) ? 0 : this._gap;
                var contentHeight;
                var numElements = this.target.numElements;
                if (this.startIndex == -1 || this.endIndex == -1) {
                    contentHeight = this.getStartPosition(numElements) - gap + paddingB;
                    this.target.setContentSize(this.target.contentWidth, Math.ceil(contentHeight));
                    return;
                }
                this.target.setVirtualElementIndicesInView(this.startIndex, this.endIndex);
                //获取水平布局参数
                var justify = this._horizontalAlign == egret.HorizontalAlign.JUSTIFY || this._horizontalAlign == egret.HorizontalAlign.CONTENT_JUSTIFY;
                var contentJustify = this._horizontalAlign == egret.HorizontalAlign.CONTENT_JUSTIFY;
                var hAlign = 0;
                if (!justify) {
                    if (this._horizontalAlign == egret.HorizontalAlign.CENTER) {
                        hAlign = 0.5;
                    }
                    else if (this._horizontalAlign == egret.HorizontalAlign.RIGHT) {
                        hAlign = 1;
                    }
                }
                var targetWidth = Math.max(0, width - paddingL - paddingR);
                var justifyWidth = Math.ceil(targetWidth);
                var layoutElement;
                var typicalHeight = this.typicalLayoutRect ? this.typicalLayoutRect.height : 22;
                var typicalWidth = this.typicalLayoutRect ? this.typicalLayoutRect.width : 71;
                var oldMaxW = Math.max(typicalWidth, this.maxElementWidth);
                if (contentJustify) {
                    for (var index = this.startIndex; index <= this.endIndex; index++) {
                        layoutElement = (this.target.getVirtualElementAt(index));
                        if (!layoutElement || !layoutElement.includeInLayout)
                            continue;
                        this.maxElementWidth = Math.max(this.maxElementWidth, layoutElement.preferredWidth);
                    }
                    justifyWidth = Math.ceil(Math.max(targetWidth, this.maxElementWidth));
                }
                var x = 0;
                var y = 0;
                var contentWidth = 0;
                var oldElementSize;
                var needInvalidateSize = false;
                for (var i = this.startIndex; i <= this.endIndex; i++) {
                    var exceesWidth = 0;
                    layoutElement = (this.target.getVirtualElementAt(i));
                    if (!layoutElement) {
                        continue;
                    }
                    else if (!layoutElement.includeInLayout) {
                        this.elementSizeTable[i] = 0;
                        continue;
                    }
                    if (justify) {
                        x = paddingL;
                        layoutElement.setLayoutBoundsSize(justifyWidth, NaN);
                    }
                    else {
                        exceesWidth = (targetWidth - layoutElement.layoutBoundsWidth) * hAlign;
                        exceesWidth = exceesWidth > 0 ? exceesWidth : 0;
                        x = paddingL + exceesWidth;
                    }
                    if (!contentJustify)
                        this.maxElementWidth = Math.max(this.maxElementWidth, layoutElement.preferredWidth);
                    contentWidth = Math.max(contentWidth, layoutElement.layoutBoundsWidth);
                    if (!needInvalidateSize) {
                        oldElementSize = isNaN(this.elementSizeTable[i]) ? typicalHeight : this.elementSizeTable[i];
                        if (oldElementSize != layoutElement.layoutBoundsHeight)
                            needInvalidateSize = true;
                    }
                    if (i == 0 && this.elementSizeTable.length > 0 && this.elementSizeTable[i] != layoutElement.layoutBoundsHeight)
                        this.typicalLayoutRect = null;
                    this.elementSizeTable[i] = layoutElement.layoutBoundsHeight;
                    y = this.getStartPosition(i);
                    layoutElement.setLayoutBoundsPosition(Math.round(x), Math.round(y));
                }
                contentWidth += paddingL + paddingR;
                contentHeight = this.getStartPosition(numElements) - gap + paddingB;
                this.target.setContentSize(Math.ceil(contentWidth), Math.ceil(contentHeight));
                if (needInvalidateSize || oldMaxW < this.maxElementWidth) {
                    this.target.invalidateSize();
                }
            };
            /**
             * 更新使用真实布局的显示列表
             */
            VerticalLayout.prototype.updateDisplayListReal = function (width, height) {
                var padding = isNaN(this._padding) ? 0 : this._padding;
                var paddingL = isNaN(this._paddingLeft) ? padding : this._paddingLeft;
                var paddingR = isNaN(this._paddingRight) ? padding : this._paddingRight;
                var paddingT = isNaN(this._paddingTop) ? padding : this._paddingTop;
                var paddingB = isNaN(this._paddingBottom) ? padding : this._paddingBottom;
                var gap = isNaN(this._gap) ? 0 : this._gap;
                var targetWidth = Math.max(0, width - paddingL - paddingR);
                var targetHeight = Math.max(0, height - paddingT - paddingB);
                // 获取水平布局参数
                var vJustify = this._verticalAlign == egret.VerticalAlign.JUSTIFY;
                var hJustify = this._horizontalAlign == egret.HorizontalAlign.JUSTIFY || this._horizontalAlign == egret.HorizontalAlign.CONTENT_JUSTIFY;
                var hAlign = 0;
                if (!hJustify) {
                    if (this._horizontalAlign == egret.HorizontalAlign.CENTER) {
                        hAlign = 0.5;
                    }
                    else if (this._horizontalAlign == egret.HorizontalAlign.RIGHT) {
                        hAlign = 1;
                    }
                }
                var count = this.target.numElements;
                var numElements = count;
                var x = paddingL;
                var y = paddingT;
                var i;
                var layoutElement;
                var totalPreferredHeight = 0;
                var totalPercentHeight = 0;
                var childInfoArray = [];
                var childInfo;
                var heightToDistribute = targetHeight;
                for (i = 0; i < count; i++) {
                    layoutElement = (this.target.getElementAt(i));
                    if (!layoutElement || !layoutElement.includeInLayout) {
                        numElements--;
                        continue;
                    }
                    this.maxElementWidth = Math.max(this.maxElementWidth, layoutElement.preferredWidth);
                    if (vJustify) {
                        totalPreferredHeight += layoutElement.preferredHeight;
                    }
                    else {
                        if (!isNaN(layoutElement.percentHeight)) {
                            totalPercentHeight += layoutElement.percentHeight;
                            childInfo = new ChildInfo();
                            childInfo.layoutElement = layoutElement;
                            childInfo.percent = layoutElement.percentHeight;
                            childInfo.min = layoutElement.minHeight;
                            childInfo.max = layoutElement.maxHeight;
                            childInfoArray.push(childInfo);
                        }
                        else {
                            heightToDistribute -= layoutElement.preferredHeight;
                        }
                    }
                }
                heightToDistribute -= (numElements - 1) * gap;
                heightToDistribute = heightToDistribute > 0 ? heightToDistribute : 0;
                var excessSpace = targetHeight - totalPreferredHeight - gap * (numElements - 1);
                var averageHeight;
                var largeChildrenCount = numElements;
                var heightDic = [];
                if (vJustify) {
                    if (excessSpace < 0) {
                        averageHeight = heightToDistribute / numElements;
                        for (i = 0; i < count; i++) {
                            layoutElement = this.target.getElementAt(i);
                            if (!layoutElement || !layoutElement.includeInLayout)
                                continue;
                            var preferredHeight = layoutElement.preferredHeight;
                            if (preferredHeight <= averageHeight) {
                                heightToDistribute -= preferredHeight;
                                largeChildrenCount--;
                                continue;
                            }
                        }
                        heightToDistribute = heightToDistribute > 0 ? heightToDistribute : 0;
                    }
                }
                else {
                    if (totalPercentHeight > 0) {
                        VerticalLayout.flexChildrenProportionally(targetHeight, heightToDistribute, totalPercentHeight, childInfoArray);
                        var roundOff = 0;
                        var length = childInfoArray.length;
                        for (i = 0; i < length; i++) {
                            childInfo = childInfoArray[i];
                            var childSize = Math.round(childInfo.size + roundOff);
                            roundOff += childInfo.size - childSize;
                            heightDic[childInfo.layoutElement.hashCode] = childSize;
                            heightToDistribute -= childSize;
                        }
                        heightToDistribute = heightToDistribute > 0 ? heightToDistribute : 0;
                    }
                }
                if (this._verticalAlign == egret.VerticalAlign.MIDDLE) {
                    y = paddingT + heightToDistribute * 0.5;
                }
                else if (this._verticalAlign == egret.VerticalAlign.BOTTOM) {
                    y = paddingT + heightToDistribute;
                }
                //开始对所有元素布局
                var maxX = paddingL;
                var maxY = paddingT;
                var dx = 0;
                var dy = 0;
                var justifyWidth = Math.ceil(targetWidth);
                if (this._horizontalAlign == egret.HorizontalAlign.CONTENT_JUSTIFY)
                    justifyWidth = Math.ceil(Math.max(targetWidth, this.maxElementWidth));
                roundOff = 0;
                var layoutElementHeight = NaN;
                var childHeight;
                for (i = 0; i < count; i++) {
                    var exceesWidth = 0;
                    layoutElement = (this.target.getElementAt(i));
                    if (!layoutElement || !layoutElement.includeInLayout)
                        continue;
                    layoutElementHeight = NaN;
                    if (vJustify) {
                        childHeight = NaN;
                        if (excessSpace > 0) {
                            childHeight = heightToDistribute * layoutElement.preferredHeight / totalPreferredHeight;
                        }
                        else if (excessSpace < 0 && layoutElement.preferredHeight > averageHeight) {
                            childHeight = heightToDistribute / largeChildrenCount;
                        }
                        if (!isNaN(childHeight)) {
                            layoutElementHeight = Math.round(childHeight + roundOff);
                            roundOff += childHeight - layoutElementHeight;
                        }
                    }
                    else {
                        layoutElementHeight = heightDic[layoutElement.hashCode];
                    }
                    if (hJustify) {
                        x = paddingL;
                        layoutElement.setLayoutBoundsSize(justifyWidth, layoutElementHeight);
                    }
                    else {
                        var layoutElementWidth = NaN;
                        if (!isNaN(layoutElement.percentWidth)) {
                            var percent = Math.min(100, layoutElement.percentWidth);
                            layoutElementWidth = Math.round(targetWidth * percent * 0.01);
                        }
                        layoutElement.setLayoutBoundsSize(layoutElementWidth, layoutElementHeight);
                        exceesWidth = (targetWidth - layoutElement.layoutBoundsWidth) * hAlign;
                        exceesWidth = exceesWidth > 0 ? exceesWidth : 0;
                        x = paddingL + exceesWidth;
                    }
                    layoutElement.setLayoutBoundsPosition(Math.round(x), Math.round(y));
                    dx = Math.ceil(layoutElement.layoutBoundsWidth);
                    dy = Math.ceil(layoutElement.layoutBoundsHeight);
                    maxX = Math.max(maxX, x + dx);
                    maxY = Math.max(maxY, y + dy);
                    y += dy + gap;
                }
                this.target.setContentSize(Math.ceil(maxX + paddingR), Math.ceil(maxY + paddingB));
            };
            /**
             * 为每个可变尺寸的子项分配空白区域
             * @method egret.gui.VerticalLayout.flexChildrenProportionally
             * @param spaceForChildren {number}
             * @param spaceToDistribute {number}
             * @param totalPercent {number}
             * @param childInfoArray {Array<any>}
             */
            VerticalLayout.flexChildrenProportionally = function (spaceForChildren, spaceToDistribute, totalPercent, childInfoArray) {
                var numChildren = childInfoArray.length;
                var done;
                do {
                    done = true;
                    var unused = spaceToDistribute - (spaceForChildren * totalPercent / 100);
                    if (unused > 0)
                        spaceToDistribute -= unused;
                    else
                        unused = 0;
                    var spacePerPercent = spaceToDistribute / totalPercent;
                    for (var i = 0; i < numChildren; i++) {
                        var childInfo = childInfoArray[i];
                        var size = childInfo.percent * spacePerPercent;
                        if (size < childInfo.min) {
                            var min = childInfo.min;
                            childInfo.size = min;
                            childInfoArray[i] = childInfoArray[--numChildren];
                            childInfoArray[numChildren] = childInfo;
                            totalPercent -= childInfo.percent;
                            if (unused >= min) {
                                unused -= min;
                            }
                            else {
                                spaceToDistribute -= min - unused;
                                unused = 0;
                            }
                            done = false;
                            break;
                        }
                        else if (size > childInfo.max) {
                            var max = childInfo.max;
                            childInfo.size = max;
                            childInfoArray[i] = childInfoArray[--numChildren];
                            childInfoArray[numChildren] = childInfo;
                            totalPercent -= childInfo.percent;
                            if (unused >= max) {
                                unused -= max;
                            }
                            else {
                                spaceToDistribute -= max - unused;
                                unused = 0;
                            }
                            done = false;
                            break;
                        }
                        else {
                            childInfo.size = size;
                        }
                    }
                } while (!done);
            };
            return VerticalLayout;
        })(gui.LayoutBase);
        gui.VerticalLayout = VerticalLayout;
        VerticalLayout.prototype.__class__ = "egret.gui.VerticalLayout";
        var ChildInfo = (function () {
            function ChildInfo() {
                /**
                 * @member egret.ChildInfo#size
                 */
                this.size = 0;
            }
            return ChildInfo;
        })();
        ChildInfo.prototype.__class__ = "egret.gui.ChildInfo";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.HorizontalLayout
         * @classdesc
         * 水平布局
         * @extends egret.gui.LayoutBase
         */
        var HorizontalLayout = (function (_super) {
            __extends(HorizontalLayout, _super);
            /**
             * @method egret.gui.HorizontalLayout#constructor
             */
            function HorizontalLayout() {
                _super.call(this);
                this._horizontalAlign = egret.HorizontalAlign.LEFT;
                this._verticalAlign = egret.VerticalAlign.TOP;
                this._gap = 6;
                this._padding = 0;
                this._paddingLeft = NaN;
                this._paddingRight = NaN;
                this._paddingTop = NaN;
                this._paddingBottom = NaN;
                /**
                 * 虚拟布局使用的子对象尺寸缓存
                 */
                this.elementSizeTable = [];
                /**
                 * 虚拟布局使用的当前视图中的第一个元素索引
                 */
                this.startIndex = -1;
                /**
                 * 虚拟布局使用的当前视图中的最后一个元素的索引
                 */
                this.endIndex = -1;
                /**
                 * 视图的第一个和最后一个元素的索引值已经计算好的标志
                 */
                this.indexInViewCalculated = false;
                /**
                 * 子对象最大宽度
                 */
                this.maxElementHeight = 0;
            }
            Object.defineProperty(HorizontalLayout.prototype, "horizontalAlign", {
                /**
                 * 布局元素的水平对齐策略。参考HorizontalAlign定义的常量。
                 * 注意：此属性设置为CONTENT_JUSTIFY始终无效。当useVirtualLayout为true时，设置JUSTIFY也无效。
                 * @member egret.gui.HorizontalLayout#horizontalAlign
                 */
                get: function () {
                    return this._horizontalAlign;
                },
                set: function (value) {
                    if (this._horizontalAlign == value)
                        return;
                    this._horizontalAlign = value;
                    if (this.target)
                        this.target.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(HorizontalLayout.prototype, "verticalAlign", {
                /**
                 * 布局元素的竖直对齐策略。参考VerticalAlign定义的常量。
                 * @member egret.gui.HorizontalLayout#verticalAlign
                 */
                get: function () {
                    return this._verticalAlign;
                },
                set: function (value) {
                    if (this._verticalAlign == value)
                        return;
                    this._verticalAlign = value;
                    if (this.target)
                        this.target.invalidateDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(HorizontalLayout.prototype, "gap", {
                /**
                 * 布局元素之间的水平空间（以像素为单位）
                 * @member egret.gui.HorizontalLayout#gap
                 */
                get: function () {
                    return this._gap;
                },
                set: function (value) {
                    if (this._gap == value)
                        return;
                    this._gap = value;
                    this.invalidateTargetSizeAndDisplayList();
                    if (this.hasEventListener("gapChanged"))
                        this.dispatchEventWith("gapChanged");
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(HorizontalLayout.prototype, "padding", {
                /**
                 * 四个边缘的共同内边距。若单独设置了任一边缘的内边距，则该边缘的内边距以单独设置的值为准。
                 * 此属性主要用于快速设置多个边缘的相同内边距。默认值：0。
                 * @member egret.gui.HorizontalLayout#padding
                 */
                get: function () {
                    return this._padding;
                },
                set: function (value) {
                    if (this._padding == value)
                        return;
                    this._padding = value;
                    this.invalidateTargetSizeAndDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(HorizontalLayout.prototype, "paddingLeft", {
                /**
                 * 容器的左边缘与布局元素的左边缘之间的最少像素数,若为NaN将使用padding的值，默认值：NaN。
                 * @member egret.gui.HorizontalLayout#paddingLeft
                 */
                get: function () {
                    return this._paddingLeft;
                },
                set: function (value) {
                    if (this._paddingLeft == value)
                        return;
                    this._paddingLeft = value;
                    this.invalidateTargetSizeAndDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(HorizontalLayout.prototype, "paddingRight", {
                /**
                 * 容器的右边缘与布局元素的右边缘之间的最少像素数,若为NaN将使用padding的值，默认值：NaN。
                 * @member egret.gui.HorizontalLayout#paddingRight
                 */
                get: function () {
                    return this._paddingRight;
                },
                set: function (value) {
                    if (this._paddingRight == value)
                        return;
                    this._paddingRight = value;
                    this.invalidateTargetSizeAndDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(HorizontalLayout.prototype, "paddingTop", {
                /**
                 * 容器的顶边缘与第一个布局元素的顶边缘之间的像素数,若为NaN将使用padding的值，默认值：NaN。
                 * @member egret.gui.HorizontalLayout#paddingTop
                 */
                get: function () {
                    return this._paddingTop;
                },
                set: function (value) {
                    if (this._paddingTop == value)
                        return;
                    this._paddingTop = value;
                    this.invalidateTargetSizeAndDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(HorizontalLayout.prototype, "paddingBottom", {
                /**
                 * 容器的底边缘与最后一个布局元素的底边缘之间的像素数,若为NaN将使用padding的值，默认值：NaN。
                 * @member egret.gui.HorizontalLayout#paddingBottom
                 */
                get: function () {
                    return this._paddingBottom;
                },
                set: function (value) {
                    if (this._paddingBottom == value)
                        return;
                    this._paddingBottom = value;
                    this.invalidateTargetSizeAndDisplayList();
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 标记目标容器的尺寸和显示列表失效
             */
            HorizontalLayout.prototype.invalidateTargetSizeAndDisplayList = function () {
                if (this.target) {
                    this.target.invalidateSize();
                    this.target.invalidateDisplayList();
                }
            };
            /**
             * @method egret.gui.HorizontalLayout#measure
             */
            HorizontalLayout.prototype.measure = function () {
                _super.prototype.measure.call(this);
                if (!this.target)
                    return;
                if (this.useVirtualLayout) {
                    this.measureVirtual();
                }
                else {
                    this.measureReal();
                }
            };
            /**
             * 测量使用虚拟布局的尺寸
             */
            HorizontalLayout.prototype.measureVirtual = function () {
                var numElements = this.target.numElements;
                var typicalHeight = this.typicalLayoutRect ? this.typicalLayoutRect.height : 22;
                var typicalWidth = this.typicalLayoutRect ? this.typicalLayoutRect.width : 71;
                var measuredWidth = this.getElementTotalSize();
                var measuredHeight = Math.max(this.maxElementHeight, typicalHeight);
                var visibleIndices = this.target.getElementIndicesInView();
                var length = visibleIndices.length;
                for (var i = 0; i < length; i++) {
                    var index = visibleIndices[i];
                    var layoutElement = (this.target.getElementAt(index));
                    if (layoutElement == null || !layoutElement.includeInLayout)
                        continue;
                    var preferredWidth = layoutElement.preferredWidth;
                    var preferredHeight = layoutElement.preferredHeight;
                    measuredWidth += preferredWidth;
                    measuredWidth -= isNaN(this.elementSizeTable[index]) ? typicalWidth : this.elementSizeTable[index];
                    measuredHeight = Math.max(measuredHeight, preferredHeight);
                }
                var padding = isNaN(this._padding) ? 0 : this._padding;
                var paddingL = isNaN(this._paddingLeft) ? padding : this._paddingLeft;
                var paddingR = isNaN(this._paddingRight) ? padding : this._paddingRight;
                var paddingT = isNaN(this._paddingTop) ? padding : this._paddingTop;
                var paddingB = isNaN(this._paddingBottom) ? padding : this._paddingBottom;
                var hPadding = paddingL + paddingR;
                var vPadding = paddingT + paddingB;
                this.target.measuredWidth = Math.ceil(measuredWidth + hPadding);
                this.target.measuredHeight = Math.ceil(measuredHeight + vPadding);
            };
            /**
             * 测量使用真实布局的尺寸
             */
            HorizontalLayout.prototype.measureReal = function () {
                var count = this.target.numElements;
                var numElements = count;
                var measuredWidth = 0;
                var measuredHeight = 0;
                for (var i = 0; i < count; i++) {
                    var layoutElement = (this.target.getElementAt(i));
                    if (!layoutElement || !layoutElement.includeInLayout) {
                        numElements--;
                        continue;
                    }
                    var preferredWidth = layoutElement.preferredWidth;
                    var preferredHeight = layoutElement.preferredHeight;
                    measuredWidth += preferredWidth;
                    measuredHeight = Math.max(measuredHeight, preferredHeight);
                }
                var gap = isNaN(this._gap) ? 0 : this._gap;
                measuredWidth += (numElements - 1) * gap;
                var padding = isNaN(this._padding) ? 0 : this._padding;
                var paddingL = isNaN(this._paddingLeft) ? padding : this._paddingLeft;
                var paddingR = isNaN(this._paddingRight) ? padding : this._paddingRight;
                var paddingT = isNaN(this._paddingTop) ? padding : this._paddingTop;
                var paddingB = isNaN(this._paddingBottom) ? padding : this._paddingBottom;
                var hPadding = paddingL + paddingR;
                var vPadding = paddingT + paddingB;
                this.target.measuredWidth = Math.ceil(measuredWidth + hPadding);
                this.target.measuredHeight = Math.ceil(measuredHeight + vPadding);
            };
            /**
             * @method egret.gui.HorizontalLayout#updateDisplayList
             * @param width {number}
             * @param height {number}
             */
            HorizontalLayout.prototype.updateDisplayList = function (width, height) {
                _super.prototype.updateDisplayList.call(this, width, height);
                if (!this.target)
                    return;
                if (this.useVirtualLayout) {
                    this.updateDisplayListVirtual(width, height);
                }
                else {
                    this.updateDisplayListReal(width, height);
                }
            };
            /**
             * 获取指定索引的起始位置
             */
            HorizontalLayout.prototype.getStartPosition = function (index) {
                var padding = isNaN(this._padding) ? 0 : this._padding;
                var paddingL = isNaN(this._paddingLeft) ? padding : this._paddingLeft;
                var gap = isNaN(this._gap) ? 0 : this._gap;
                if (!this.useVirtualLayout) {
                    var element;
                    if (this.target) {
                        element = this.target.getElementAt(index);
                    }
                    return element ? element.x : paddingL;
                }
                var typicalWidth = this.typicalLayoutRect ? this.typicalLayoutRect.width : 71;
                var startPos = paddingL;
                for (var i = 0; i < index; i++) {
                    var eltWidth = this.elementSizeTable[i];
                    if (isNaN(eltWidth)) {
                        eltWidth = typicalWidth;
                    }
                    startPos += eltWidth + gap;
                }
                return startPos;
            };
            /**
             * 获取指定索引的元素尺寸
             */
            HorizontalLayout.prototype.getElementSize = function (index) {
                if (this.useVirtualLayout) {
                    var size = this.elementSizeTable[index];
                    if (isNaN(size)) {
                        size = this.typicalLayoutRect ? this.typicalLayoutRect.width : 71;
                    }
                    return size;
                }
                if (this.target) {
                    return this.target.getElementAt(index).width;
                }
                return 0;
            };
            /**
             * 获取缓存的子对象尺寸总和
             */
            HorizontalLayout.prototype.getElementTotalSize = function () {
                var typicalWidth = this.typicalLayoutRect ? this.typicalLayoutRect.width : 71;
                var gap = isNaN(this._gap) ? 0 : this._gap;
                var totalSize = 0;
                var length = this.target.numElements;
                for (var i = 0; i < length; i++) {
                    var eltWidth = this.elementSizeTable[i];
                    if (isNaN(eltWidth)) {
                        eltWidth = typicalWidth;
                    }
                    totalSize += eltWidth + gap;
                }
                totalSize -= gap;
                return totalSize;
            };
            HorizontalLayout.prototype.elementAdded = function (index) {
                if (!this.useVirtualLayout)
                    return;
                _super.prototype.elementAdded.call(this, index);
                var typicalWidth = this.typicalLayoutRect ? this.typicalLayoutRect.width : 71;
                this.elementSizeTable.splice(index, 0, typicalWidth);
            };
            HorizontalLayout.prototype.elementRemoved = function (index) {
                if (!this.useVirtualLayout)
                    return;
                _super.prototype.elementRemoved.call(this, index);
                this.elementSizeTable.splice(index, 1);
            };
            HorizontalLayout.prototype.clearVirtualLayoutCache = function () {
                if (!this.useVirtualLayout)
                    return;
                _super.prototype.clearVirtualLayoutCache.call(this);
                this.elementSizeTable = [];
                this.maxElementHeight = 0;
            };
            /**
             * 折半查找法寻找指定位置的显示对象索引
             */
            HorizontalLayout.prototype.findIndexAt = function (x, i0, i1) {
                var index = Math.floor((i0 + i1) * 0.5);
                var elementX = this.getStartPosition(index);
                var elementWidth = this.getElementSize(index);
                var gap = isNaN(this._gap) ? 0 : this._gap;
                if ((x >= elementX) && (x < elementX + elementWidth + gap))
                    return index;
                else if (i0 == i1)
                    return -1;
                else if (x < elementX)
                    return this.findIndexAt(x, i0, Math.max(i0, index - 1));
                else
                    return this.findIndexAt(x, Math.min(index + 1, i1), i1);
            };
            /**
             * @method egret.gui.HorizontalLayout#scrollPositionChanged
             */
            HorizontalLayout.prototype.scrollPositionChanged = function () {
                _super.prototype.scrollPositionChanged.call(this);
                if (this.useVirtualLayout) {
                    var changed = this.getIndexInView();
                    if (changed) {
                        this.indexInViewCalculated = true;
                        this.target.invalidateDisplayList();
                    }
                }
            };
            /**
             * 获取视图中第一个和最后一个元素的索引,返回是否发生改变
             */
            HorizontalLayout.prototype.getIndexInView = function () {
                if (!this.target || this.target.numElements == 0) {
                    this.startIndex = this.endIndex = -1;
                    return false;
                }
                if (isNaN(this.target.width) || this.target.width == 0 || isNaN(this.target.height) || this.target.height == 0) {
                    this.startIndex = this.endIndex = -1;
                    return false;
                }
                var padding = isNaN(this._padding) ? 0 : this._padding;
                var paddingL = isNaN(this._paddingLeft) ? padding : this._paddingLeft;
                var paddingR = isNaN(this._paddingRight) ? padding : this._paddingRight;
                var paddingT = isNaN(this._paddingTop) ? padding : this._paddingTop;
                var paddingB = isNaN(this._paddingBottom) ? padding : this._paddingBottom;
                var numElements = this.target.numElements;
                var contentWidth = this.getStartPosition(numElements - 1) + this.elementSizeTable[numElements - 1] + paddingR;
                var minVisibleX = this.target.horizontalScrollPosition;
                if (minVisibleX > contentWidth - paddingR) {
                    this.startIndex = -1;
                    this.endIndex = -1;
                    return false;
                }
                var maxVisibleX = this.target.horizontalScrollPosition + this.target.width;
                if (maxVisibleX < paddingL) {
                    this.startIndex = -1;
                    this.endIndex = -1;
                    return false;
                }
                var oldStartIndex = this.startIndex;
                var oldEndIndex = this.endIndex;
                this.startIndex = this.findIndexAt(minVisibleX, 0, numElements - 1);
                if (this.startIndex == -1)
                    this.startIndex = 0;
                this.endIndex = this.findIndexAt(maxVisibleX, 0, numElements - 1);
                if (this.endIndex == -1)
                    this.endIndex = numElements - 1;
                return oldStartIndex != this.startIndex || oldEndIndex != this.endIndex;
            };
            /**
             * 更新使用虚拟布局的显示列表
             */
            HorizontalLayout.prototype.updateDisplayListVirtual = function (width, height) {
                if (this.indexInViewCalculated)
                    this.indexInViewCalculated = false;
                else
                    this.getIndexInView();
                var padding = isNaN(this._padding) ? 0 : this._padding;
                var paddingR = isNaN(this._paddingRight) ? padding : this._paddingRight;
                var paddingT = isNaN(this._paddingTop) ? padding : this._paddingTop;
                var paddingB = isNaN(this._paddingBottom) ? padding : this._paddingBottom;
                var gap = isNaN(this._gap) ? 0 : this._gap;
                var contentWidth;
                var numElements = this.target.numElements;
                if (this.startIndex == -1 || this.endIndex == -1) {
                    contentWidth = this.getStartPosition(numElements) - gap + paddingR;
                    this.target.setContentSize(Math.ceil(contentWidth), this.target.contentHeight);
                    return;
                }
                this.target.setVirtualElementIndicesInView(this.startIndex, this.endIndex);
                //获取垂直布局参数
                var justify = this._verticalAlign == egret.VerticalAlign.JUSTIFY || this._verticalAlign == egret.VerticalAlign.CONTENT_JUSTIFY;
                var contentJustify = this._verticalAlign == egret.VerticalAlign.CONTENT_JUSTIFY;
                var vAlign = 0;
                if (!justify) {
                    if (this._verticalAlign == egret.VerticalAlign.MIDDLE) {
                        vAlign = 0.5;
                    }
                    else if (this._verticalAlign == egret.VerticalAlign.BOTTOM) {
                        vAlign = 1;
                    }
                }
                var targetHeight = Math.max(0, height - paddingT - paddingB);
                var justifyHeight = Math.ceil(targetHeight);
                var layoutElement;
                var typicalHeight = this.typicalLayoutRect ? this.typicalLayoutRect.height : 22;
                var typicalWidth = this.typicalLayoutRect ? this.typicalLayoutRect.width : 71;
                var oldMaxH = Math.max(typicalHeight, this.maxElementHeight);
                if (contentJustify) {
                    for (var index = this.startIndex; index <= this.endIndex; index++) {
                        layoutElement = (this.target.getVirtualElementAt(index));
                        if (!layoutElement || !layoutElement.includeInLayout)
                            continue;
                        this.maxElementHeight = Math.max(this.maxElementHeight, layoutElement.preferredHeight);
                    }
                    justifyHeight = Math.ceil(Math.max(targetHeight, this.maxElementHeight));
                }
                var x = 0;
                var y = 0;
                var contentHeight = 0;
                var oldElementSize;
                var needInvalidateSize = false;
                for (var i = this.startIndex; i <= this.endIndex; i++) {
                    var exceesHeight = 0;
                    layoutElement = (this.target.getVirtualElementAt(i));
                    if (!layoutElement) {
                        continue;
                    }
                    else if (!layoutElement.includeInLayout) {
                        this.elementSizeTable[i] = 0;
                        continue;
                    }
                    if (justify) {
                        y = paddingT;
                        layoutElement.setLayoutBoundsSize(NaN, justifyHeight);
                    }
                    else {
                        exceesHeight = (targetHeight - layoutElement.layoutBoundsHeight) * vAlign;
                        exceesHeight = exceesHeight > 0 ? exceesHeight : 0;
                        y = paddingT + exceesHeight;
                    }
                    if (!contentJustify)
                        this.maxElementHeight = Math.max(this.maxElementHeight, layoutElement.preferredHeight);
                    contentHeight = Math.max(contentHeight, layoutElement.layoutBoundsHeight);
                    if (!needInvalidateSize) {
                        oldElementSize = isNaN(this.elementSizeTable[i]) ? typicalWidth : this.elementSizeTable[i];
                        if (oldElementSize != layoutElement.layoutBoundsWidth)
                            needInvalidateSize = true;
                    }
                    if (i == 0 && this.elementSizeTable.length > 0 && this.elementSizeTable[i] != layoutElement.layoutBoundsWidth)
                        this.typicalLayoutRect = null;
                    this.elementSizeTable[i] = layoutElement.layoutBoundsWidth;
                    x = this.getStartPosition(i);
                    layoutElement.setLayoutBoundsPosition(Math.round(x), Math.round(y));
                }
                contentHeight += paddingT + paddingB;
                contentWidth = this.getStartPosition(numElements) - gap + paddingR;
                this.target.setContentSize(Math.ceil(contentWidth), Math.ceil(contentHeight));
                if (needInvalidateSize || oldMaxH < this.maxElementHeight) {
                    this.target.invalidateSize();
                }
            };
            /**
             * 更新使用真实布局的显示列表
             */
            HorizontalLayout.prototype.updateDisplayListReal = function (width, height) {
                var padding = isNaN(this._padding) ? 0 : this._padding;
                var paddingL = isNaN(this._paddingLeft) ? padding : this._paddingLeft;
                var paddingR = isNaN(this._paddingRight) ? padding : this._paddingRight;
                var paddingT = isNaN(this._paddingTop) ? padding : this._paddingTop;
                var paddingB = isNaN(this._paddingBottom) ? padding : this._paddingBottom;
                var gap = isNaN(this._gap) ? 0 : this._gap;
                var targetWidth = Math.max(0, width - paddingL - paddingR);
                var targetHeight = Math.max(0, height - paddingT - paddingB);
                var hJustify = this._horizontalAlign == egret.HorizontalAlign.JUSTIFY;
                var vJustify = this._verticalAlign == egret.VerticalAlign.JUSTIFY || this._verticalAlign == egret.VerticalAlign.CONTENT_JUSTIFY;
                var vAlign = 0;
                if (!vJustify) {
                    if (this._verticalAlign == egret.VerticalAlign.MIDDLE) {
                        vAlign = 0.5;
                    }
                    else if (this._verticalAlign == egret.VerticalAlign.BOTTOM) {
                        vAlign = 1;
                    }
                }
                var count = this.target.numElements;
                var numElements = count;
                var x = paddingL;
                var y = paddingT;
                var i;
                var layoutElement;
                var totalPreferredWidth = 0;
                var totalPercentWidth = 0;
                var childInfoArray = [];
                var childInfo;
                var widthToDistribute = targetWidth;
                for (i = 0; i < count; i++) {
                    layoutElement = (this.target.getElementAt(i));
                    if (!layoutElement || !layoutElement.includeInLayout) {
                        numElements--;
                        continue;
                    }
                    this.maxElementHeight = Math.max(this.maxElementHeight, layoutElement.preferredHeight);
                    if (hJustify) {
                        totalPreferredWidth += layoutElement.preferredWidth;
                    }
                    else {
                        if (!isNaN(layoutElement.percentWidth)) {
                            totalPercentWidth += layoutElement.percentWidth;
                            childInfo = new ChildInfo();
                            childInfo.layoutElement = layoutElement;
                            childInfo.percent = layoutElement.percentWidth;
                            childInfo.min = layoutElement.minWidth;
                            childInfo.max = layoutElement.maxWidth;
                            childInfoArray.push(childInfo);
                        }
                        else {
                            widthToDistribute -= layoutElement.preferredWidth;
                        }
                    }
                }
                widthToDistribute -= gap * (numElements - 1);
                widthToDistribute = widthToDistribute > 0 ? widthToDistribute : 0;
                var excessSpace = targetWidth - totalPreferredWidth - gap * (numElements - 1);
                var averageWidth;
                var largeChildrenCount = numElements;
                var widthDic = [];
                if (hJustify) {
                    if (excessSpace < 0) {
                        averageWidth = widthToDistribute / numElements;
                        for (i = 0; i < count; i++) {
                            layoutElement = this.target.getElementAt(i);
                            if (!layoutElement || !layoutElement.includeInLayout)
                                continue;
                            var preferredWidth = layoutElement.preferredWidth;
                            if (preferredWidth <= averageWidth) {
                                widthToDistribute -= preferredWidth;
                                largeChildrenCount--;
                                continue;
                            }
                        }
                        widthToDistribute = widthToDistribute > 0 ? widthToDistribute : 0;
                    }
                }
                else {
                    if (totalPercentWidth > 0) {
                        HorizontalLayout.flexChildrenProportionally(targetWidth, widthToDistribute, totalPercentWidth, childInfoArray);
                        var roundOff = 0;
                        var length = childInfoArray.length;
                        for (i = 0; i < length; i++) {
                            childInfo = childInfoArray[i];
                            var childSize = Math.round(childInfo.size + roundOff);
                            roundOff += childInfo.size - childSize;
                            widthDic[childInfo.layoutElement.hashCode] = childSize;
                            widthToDistribute -= childSize;
                        }
                        widthToDistribute = widthToDistribute > 0 ? widthToDistribute : 0;
                    }
                }
                if (this._horizontalAlign == egret.HorizontalAlign.CENTER) {
                    x = paddingL + widthToDistribute * 0.5;
                }
                else if (this._horizontalAlign == egret.HorizontalAlign.RIGHT) {
                    x = paddingL + widthToDistribute;
                }
                var maxX = paddingL;
                var maxY = paddingT;
                var dx = 0;
                var dy = 0;
                var justifyHeight = Math.ceil(targetHeight);
                if (this._verticalAlign == egret.VerticalAlign.CONTENT_JUSTIFY)
                    justifyHeight = Math.ceil(Math.max(targetHeight, this.maxElementHeight));
                roundOff = 0;
                var layoutElementWidth;
                var childWidth;
                for (i = 0; i < count; i++) {
                    var exceesHeight = 0;
                    layoutElement = (this.target.getElementAt(i));
                    if (!layoutElement || !layoutElement.includeInLayout)
                        continue;
                    layoutElementWidth = NaN;
                    if (hJustify) {
                        childWidth = NaN;
                        if (excessSpace > 0) {
                            childWidth = widthToDistribute * layoutElement.preferredWidth / totalPreferredWidth;
                        }
                        else if (excessSpace < 0 && layoutElement.preferredWidth > averageWidth) {
                            childWidth = widthToDistribute / largeChildrenCount;
                        }
                        if (!isNaN(childWidth)) {
                            layoutElementWidth = Math.round(childWidth + roundOff);
                            roundOff += childWidth - layoutElementWidth;
                        }
                    }
                    else {
                        layoutElementWidth = widthDic[layoutElement.hashCode];
                    }
                    if (vJustify) {
                        y = paddingT;
                        layoutElement.setLayoutBoundsSize(layoutElementWidth, justifyHeight);
                    }
                    else {
                        var layoutElementHeight = NaN;
                        if (!isNaN(layoutElement.percentHeight)) {
                            var percent = Math.min(100, layoutElement.percentHeight);
                            layoutElementHeight = Math.round(targetHeight * percent * 0.01);
                        }
                        layoutElement.setLayoutBoundsSize(layoutElementWidth, layoutElementHeight);
                        exceesHeight = (targetHeight - layoutElement.layoutBoundsHeight) * vAlign;
                        exceesHeight = exceesHeight > 0 ? exceesHeight : 0;
                        y = paddingT + exceesHeight;
                    }
                    layoutElement.setLayoutBoundsPosition(Math.round(x), Math.round(y));
                    dx = Math.ceil(layoutElement.layoutBoundsWidth);
                    dy = Math.ceil(layoutElement.layoutBoundsHeight);
                    maxX = Math.max(maxX, x + dx);
                    maxY = Math.max(maxY, y + dy);
                    x += dx + gap;
                }
                this.target.setContentSize(Math.ceil(maxX + paddingR), Math.ceil(maxY + paddingB));
            };
            /**
             * 为每个可变尺寸的子项分配空白区域
             * @param spaceForChildren {number}
             * @param spaceToDistribute {number}
             * @param totalPercent {number}
             * @param childInfoArray {Array<any>}
             */
            HorizontalLayout.flexChildrenProportionally = function (spaceForChildren, spaceToDistribute, totalPercent, childInfoArray) {
                var numChildren = childInfoArray.length;
                var done;
                do {
                    done = true;
                    var unused = spaceToDistribute - (spaceForChildren * totalPercent / 100);
                    if (unused > 0)
                        spaceToDistribute -= unused;
                    else
                        unused = 0;
                    var spacePerPercent = spaceToDistribute / totalPercent;
                    for (var i = 0; i < numChildren; i++) {
                        var childInfo = childInfoArray[i];
                        var size = childInfo.percent * spacePerPercent;
                        if (size < childInfo.min) {
                            var min = childInfo.min;
                            childInfo.size = min;
                            childInfoArray[i] = childInfoArray[--numChildren];
                            childInfoArray[numChildren] = childInfo;
                            totalPercent -= childInfo.percent;
                            if (unused >= min) {
                                unused -= min;
                            }
                            else {
                                spaceToDistribute -= min - unused;
                                unused = 0;
                            }
                            done = false;
                            break;
                        }
                        else if (size > childInfo.max) {
                            var max = childInfo.max;
                            childInfo.size = max;
                            childInfoArray[i] = childInfoArray[--numChildren];
                            childInfoArray[numChildren] = childInfo;
                            totalPercent -= childInfo.percent;
                            if (unused >= max) {
                                unused -= max;
                            }
                            else {
                                spaceToDistribute -= max - unused;
                                unused = 0;
                            }
                            done = false;
                            break;
                        }
                        else {
                            childInfo.size = size;
                        }
                    }
                } while (!done);
            };
            return HorizontalLayout;
        })(gui.LayoutBase);
        gui.HorizontalLayout = HorizontalLayout;
        HorizontalLayout.prototype.__class__ = "egret.gui.HorizontalLayout";
        var ChildInfo = (function () {
            function ChildInfo() {
                /**
                 * @member egret.ChildInfo#size
                 */
                this.size = 0;
            }
            return ChildInfo;
        })();
        ChildInfo.prototype.__class__ = "egret.gui.ChildInfo";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.PopUpManagerImpl
         * @classdesc
         * 窗口弹出管理器实现类
         * @extends egret.EventDispatcher
         * @implements egret.gui.IPopUpManager
         */
        var PopUpManagerImpl = (function (_super) {
            __extends(PopUpManagerImpl, _super);
            /**
             * 构造函数
             * @method egret.gui.PopUpManagerImpl#constructor
             */
            function PopUpManagerImpl() {
                _super.call(this);
                this._popUpList = [];
                /**
                 * 模态窗口列表
                 */
                this.popUpDataList = [];
                this._modalColor = 0x000000;
                this._modalAlpha = 0.5;
                this.invalidateModalFlag = false;
            }
            Object.defineProperty(PopUpManagerImpl.prototype, "popUpList", {
                /**
                 * 已经弹出的窗口列表
                 * @member egret.gui.PopUpManagerImpl#popUpList
                 */
                get: function () {
                    return this._popUpList.concat();
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 根据popUp获取对应的popUpData
             */
            PopUpManagerImpl.prototype.findPopUpData = function (popUp) {
                var list = this.popUpDataList;
                var length = list.length;
                for (var i = 0; i < length; i++) {
                    var data = list[i];
                    if (data.popUp == popUp)
                        return data;
                }
                return null;
            };
            /**
             * 弹出一个窗口。<br/>
             * @method egret.gui.PopUpManagerImpl#addPopUp
             * @param popUp {IVisualElement} 要弹出的窗口
             * @param modal {boolean} 是否启用模态。即禁用弹出窗口所在层以下的鼠标事件。默认false。
             * @param center {boolean} 是否居中窗口。等效于在外部调用centerPopUp()来居中。默认true。
             */
            PopUpManagerImpl.prototype.addPopUp = function (popUp, modal, center) {
                if (modal === void 0) { modal = false; }
                if (center === void 0) { center = true; }
                var uiStage = gui.UIGlobals.uiStage;
                var data = this.findPopUpData(popUp);
                if (data) {
                    data.modal = modal;
                    popUp.removeEventListener(PopUpManagerImpl.REMOVE_FROM_UISTAGE, this.onRemoved, this);
                }
                else {
                    data = new PopUpData(popUp, modal);
                    this.popUpDataList.push(data);
                    this._popUpList.push(popUp);
                }
                uiStage.popUpContainer.addElement(popUp);
                if (center)
                    this.centerPopUp(popUp);
                if ("isPopUp" in popUp)
                    popUp.isPopUp = true;
                if (modal) {
                    this.invalidateModal();
                }
                popUp.addEventListener(PopUpManagerImpl.REMOVE_FROM_UISTAGE, this.onRemoved, this);
            };
            /**
             * 从舞台移除
             */
            PopUpManagerImpl.prototype.onRemoved = function (event) {
                var index = 0;
                var list = this.popUpDataList;
                var length = list.length;
                for (var i = 0; i < length; i++) {
                    var data = list[i];
                    if (data.popUp == event.target) {
                        if ("isPopUp" in data.popUp)
                            (data.popUp).isPopUp = false;
                        data.popUp.removeEventListener(PopUpManagerImpl.REMOVE_FROM_UISTAGE, this.onRemoved, this);
                        this.popUpDataList.splice(index, 1);
                        this._popUpList.splice(index, 1);
                        this.invalidateModal();
                        break;
                    }
                    index++;
                }
            };
            Object.defineProperty(PopUpManagerImpl.prototype, "modalColor", {
                /**
                 * 模态遮罩的填充颜色
                 * @member egret.gui.PopUpManagerImpl#modalColor
                 */
                get: function () {
                    return this._modalColor;
                },
                set: function (value) {
                    if (this._modalColor == value)
                        return;
                    this._modalColor = value;
                    this.invalidateModal();
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(PopUpManagerImpl.prototype, "modalAlpha", {
                /**
                 * 模态遮罩的透明度
                 * @member egret.gui.PopUpManagerImpl#modalAlpha
                 */
                get: function () {
                    return this._modalAlpha;
                },
                set: function (value) {
                    if (this._modalAlpha == value)
                        return;
                    this._modalAlpha = value;
                    this.invalidateModal();
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 标记一个UIStage的模态层失效
             */
            PopUpManagerImpl.prototype.invalidateModal = function () {
                if (!this.invalidateModalFlag) {
                    this.invalidateModalFlag = true;
                    gui.UIGlobals.stage.addEventListener(egret.Event.ENTER_FRAME, this.validateModal, this);
                    gui.UIGlobals.stage.addEventListener(egret.Event.RENDER, this.validateModal, this);
                    gui.UIGlobals.stage.invalidate();
                }
            };
            PopUpManagerImpl.prototype.validateModal = function (event) {
                this.invalidateModalFlag = false;
                gui.UIGlobals.stage.removeEventListener(egret.Event.ENTER_FRAME, this.validateModal, this);
                gui.UIGlobals.stage.removeEventListener(egret.Event.RENDER, this.validateModal, this);
                this.updateModal(gui.UIGlobals.uiStage);
            };
            /**
             * 更新窗口模态效果
             */
            PopUpManagerImpl.prototype.updateModal = function (uiStage) {
                var popUpContainer = uiStage.popUpContainer;
                var found = false;
                for (var i = popUpContainer.numElements - 1; i >= 0; i--) {
                    var element = popUpContainer.getElementAt(i);
                    var data = this.findPopUpData(element);
                    if (data && data.modal) {
                        found = true;
                        break;
                    }
                }
                if (found) {
                    if (!this.modalMask) {
                        this.modalMask = new gui.Rect();
                        this.modalMask.touchEnabled = true;
                        this.modalMask.top = this.modalMask.left = this.modalMask.right = this.modalMask.bottom = 0;
                    }
                    this.modalMask.fillColor = this._modalColor;
                    this.modalMask.alpha = this._modalAlpha;
                    if (this.modalMask.parent == uiStage) {
                        if (popUpContainer.getElementIndex(this.modalMask) < i)
                            i--;
                        popUpContainer.setElementIndex(this.modalMask, i);
                    }
                    else {
                        popUpContainer.addElementAt(this.modalMask, i);
                    }
                }
                else if (this.modalMask && this.modalMask.parent == uiStage) {
                    popUpContainer.removeElement(this.modalMask);
                }
            };
            /**
             * 移除由addPopUp()方法弹出的窗口。
             * @method egret.gui.PopUpManagerImpl#removePopUp
             * @param popUp {IVisualElement} 要移除的窗口
             */
            PopUpManagerImpl.prototype.removePopUp = function (popUp) {
                if (popUp && popUp.parent && this.findPopUpData(popUp)) {
                    if ("removeElement" in popUp.parent)
                        (popUp.parent).removeElement(popUp);
                    else if (popUp.parent instanceof gui.UIComponent)
                        (popUp.parent)._removeFromDisplayList(popUp);
                    else if (popUp instanceof egret.DisplayObject)
                        popUp.parent.removeChild(popUp);
                }
            };
            /**
             * 将指定窗口居中显示
             * @method egret.gui.PopUpManagerImpl#centerPopUp
             * @param popUp {IVisualElement} 要居中显示的窗口
             */
            PopUpManagerImpl.prototype.centerPopUp = function (popUp) {
                popUp.top = popUp.bottom = popUp.left = popUp.right = NaN;
                popUp.verticalCenter = popUp.horizontalCenter = 0;
                var parent = popUp.parent;
                if (parent) {
                    if ("validateNow" in popUp)
                        popUp.validateNow();
                    popUp.x = (parent.width - popUp.layoutBoundsWidth) * 0.5;
                    popUp.y = (parent.height - popUp.layoutBoundsHeight) * 0.5;
                }
            };
            /**
             * 将指定窗口的层级调至最前
             * @method egret.gui.PopUpManagerImpl#bringToFront
             * @param popUp {IVisualElement} 要最前显示的窗口
             */
            PopUpManagerImpl.prototype.bringToFront = function (popUp) {
                var data = this.findPopUpData(popUp);
                if (data && popUp.parent && "popUpContainer" in popUp.parent) {
                    var uiStage = (popUp.parent);
                    uiStage.popUpContainer.setElementIndex(popUp, uiStage.popUpContainer.numElements - 1);
                    this.invalidateModal();
                }
            };
            PopUpManagerImpl.REMOVE_FROM_UISTAGE = "removeFromUIStage";
            return PopUpManagerImpl;
        })(egret.EventDispatcher);
        gui.PopUpManagerImpl = PopUpManagerImpl;
        PopUpManagerImpl.prototype.__class__ = "egret.gui.PopUpManagerImpl";
        var PopUpData = (function () {
            /**
             * @method egret.PopUpData#constructor
             * @param popUp {IVisualElement}
             * @param modal {boolea}
             */
            function PopUpData(popUp, modal) {
                this.popUp = popUp;
                this.modal = modal;
            }
            return PopUpData;
        })();
        PopUpData.prototype.__class__ = "egret.gui.PopUpData";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    var gui;
    (function (gui) {
        /**
         * @class egret.gui.PopUpManager
         * @classdesc
         * 窗口弹出管理器<p/>
         * 若项目需要自定义弹出框管理器，请实现IPopUpManager接口，
         * 并在项目初始化前调用Injector.mapClass("egret.gui.IPopUpManager",YourPopUpManager)，
         * 注入自定义的弹出框管理器类。
         */
        var PopUpManager = (function () {
            /**
             * 构造函数
             * @method egret.gui.PopUpManager#constructor
             */
            function PopUpManager() {
            }
            /**
             * 获取单例
             */
            PopUpManager.getImpl = function () {
                if (!PopUpManager._impl) {
                    try {
                        PopUpManager._impl = egret.Injector.getInstance("egret.gui.IPopUpManager");
                    }
                    catch (e) {
                        PopUpManager._impl = new gui.PopUpManagerImpl();
                    }
                }
                return PopUpManager._impl;
            };
            Object.defineProperty(PopUpManager.prototype, "modalColor", {
                /**
                 * 模态遮罩的填充颜色
                 * @member egret.gui.PopUpManager#modalColor
                 */
                get: function () {
                    return PopUpManager.getImpl().modalColor;
                },
                set: function (value) {
                    PopUpManager.getImpl().modalColor = value;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(PopUpManager.prototype, "modalAlpha", {
                /**
                 * 模态遮罩的透明度
                 * @member egret.gui.PopUpManager#modalAlpha
                 */
                get: function () {
                    return PopUpManager.getImpl().modalAlpha;
                },
                set: function (value) {
                    PopUpManager.getImpl().modalAlpha = value;
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 弹出一个窗口。<br/>
             * @method egret.gui.PopUpManager.addPopUp
             * @param popUp {IVisualElement} 要弹出的窗口
             * @param modal {boolean} 是否启用模态。即禁用弹出窗口所在层以下的鼠标事件。默认false。
             * @param center {boolean} 是否居中窗口。等效于在外部调用centerPopUp()来居中。默认true。
             */
            PopUpManager.addPopUp = function (popUp, modal, center) {
                if (modal === void 0) { modal = false; }
                if (center === void 0) { center = true; }
                PopUpManager.getImpl().addPopUp(popUp, modal, center);
                gui.PopUpEvent.dispatchPopUpEvent(PopUpManager.getImpl(), gui.PopUpEvent.ADD_POPUP, popUp, modal);
            };
            /**
             * 移除由addPopUp()方法弹出的窗口。
             * @method egret.gui.PopUpManager.removePopUp
             * @param popUp {IVisualElement} 要移除的窗口
             */
            PopUpManager.removePopUp = function (popUp) {
                PopUpManager.getImpl().removePopUp(popUp);
                gui.PopUpEvent.dispatchPopUpEvent(PopUpManager.getImpl(), gui.PopUpEvent.REMOVE_POPUP, popUp);
            };
            /**
             * 将指定窗口居中显示
             * @method egret.gui.PopUpManager.centerPopUp
             * @param popUp {IVisualElement} 要居中显示的窗口
             */
            PopUpManager.centerPopUp = function (popUp) {
                PopUpManager.getImpl().centerPopUp(popUp);
            };
            /**
             * 将指定窗口的层级调至最前
             * @method egret.gui.PopUpManager.bringToFront
             * @param popUp {IVisualElement} 要最前显示的窗口
             */
            PopUpManager.bringToFront = function (popUp) {
                PopUpManager.getImpl().bringToFront(popUp);
                gui.PopUpEvent.dispatchPopUpEvent(PopUpManager.getImpl(), gui.PopUpEvent.BRING_TO_FRONT, popUp);
            };
            Object.defineProperty(PopUpManager, "popUpList", {
                /**
                 * 已经弹出的窗口列表
                 * @member egret.gui.PopUpManager.popUpList
                 */
                get: function () {
                    return PopUpManager.getImpl().popUpList;
                },
                enumerable: true,
                configurable: true
            });
            /**
             * 添加事件监听,参考PopUpEvent定义的常量。
             * @method egret.gui.PopUpManager.addEventListener
             * @see org.flexlite.domUI.events.PopUpEvent
             * @param type {string}
             * @param listener {Function}
             * @param thisObject {any}
             * @param useCapture {boolean}
             * @param priority {number}
             */
            PopUpManager.addEventListener = function (type, listener, thisObject, useCapture, priority) {
                if (useCapture === void 0) { useCapture = false; }
                if (priority === void 0) { priority = 0; }
                PopUpManager.getImpl().addEventListener(type, listener, this, useCapture, priority);
            };
            /**
             * 移除事件监听,参考PopUpEvent定义的常量。
             * @method egret.gui.PopUpManager.removeEventListener
             * @see org.flexlite.domUI.events.PopUpEvent
             * @param type {string}
             * @param listener {Function}
             * @param thisObject {any}
             * @param useCapture {boolean}
             */
            PopUpManager.removeEventListener = function (type, listener, thisObject, useCapture) {
                if (useCapture === void 0) { useCapture = false; }
                PopUpManager.getImpl().removeEventListener(type, listener, thisObject, useCapture);
            };
            return PopUpManager;
        })();
        gui.PopUpManager = PopUpManager;
        PopUpManager.prototype.__class__ = "egret.gui.PopUpManager";
    })(gui = egret.gui || (egret.gui = {}));
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.HTML5DeviceContext
     * @classdesc
     * @extends egret.DeviceContext
     */
    var HTML5DeviceContext = (function (_super) {
        __extends(HTML5DeviceContext, _super);
        /**
         * @method egret.HTML5DeviceContext#constructor
         */
        function HTML5DeviceContext(frameRate) {
            if (frameRate === void 0) { frameRate = 60; }
            _super.call(this);
            this.frameRate = frameRate;
            this._time = 0;
            this._isActivate = true;
            if (frameRate == 60) {
                HTML5DeviceContext.requestAnimationFrame = window["requestAnimationFrame"] || window["webkitRequestAnimationFrame"] || window["mozRequestAnimationFrame"] || window["oRequestAnimationFrame"] || window["msRequestAnimationFrame"];
                HTML5DeviceContext.cancelAnimationFrame = window["cancelAnimationFrame"] || window["msCancelAnimationFrame"] || window["mozCancelAnimationFrame"] || window["webkitCancelAnimationFrame"] || window["oCancelAnimationFrame"] || window["cancelRequestAnimationFrame"] || window["msCancelRequestAnimationFrame"] || window["mozCancelRequestAnimationFrame"] || window["oCancelRequestAnimationFrame"] || window["webkitCancelRequestAnimationFrame"];
            }
            if (!HTML5DeviceContext.requestAnimationFrame) {
                HTML5DeviceContext.requestAnimationFrame = function (callback) {
                    return window.setTimeout(callback, 1000 / frameRate);
                };
            }
            if (!HTML5DeviceContext.cancelAnimationFrame) {
                HTML5DeviceContext.cancelAnimationFrame = function (id) {
                    return window.clearTimeout(id);
                };
            }
            HTML5DeviceContext.instance = this;
            this.registerListener();
        }
        HTML5DeviceContext.prototype.enterFrame = function () {
            var context = HTML5DeviceContext.instance;
            var thisObject = HTML5DeviceContext._thisObject;
            var callback = HTML5DeviceContext._callback;
            var thisTime = egret.getTimer();
            var advancedTime = thisTime - context._time;
            context._requestAnimationId = HTML5DeviceContext.requestAnimationFrame.call(window, HTML5DeviceContext.prototype.enterFrame);
            callback.call(thisObject, advancedTime);
            context._time = thisTime;
        };
        /**
         * @method egret.HTML5DeviceContext#executeMainLoop
         * @param callback {Function}
         * @param thisObject {any}
         */
        HTML5DeviceContext.prototype.executeMainLoop = function (callback, thisObject) {
            HTML5DeviceContext._callback = callback;
            HTML5DeviceContext._thisObject = thisObject;
            this.enterFrame();
        };
        HTML5DeviceContext.prototype.reset = function () {
            var context = HTML5DeviceContext.instance;
            if (context._requestAnimationId) {
                context._time = egret.getTimer();
                HTML5DeviceContext.cancelAnimationFrame.call(window, context._requestAnimationId);
                context.enterFrame();
            }
        };
        HTML5DeviceContext.prototype.registerListener = function () {
            var self = this;
            //失去焦点
            var onBlurHandler = function () {
                if (!self._isActivate) {
                    return;
                }
                self._isActivate = false;
                egret.MainContext.instance.stage.dispatchEvent(new egret.Event(egret.Event.DEACTIVATE));
            };
            //激活
            var onFocusHandler = function () {
                if (self._isActivate) {
                    return;
                }
                self._isActivate = true;
                var context = HTML5DeviceContext.instance;
                context.reset();
                egret.MainContext.instance.stage.dispatchEvent(new egret.Event(egret.Event.ACTIVATE));
            };
            var handleVisibilityChange = function () {
                if (!document[hidden]) {
                    onFocusHandler();
                }
                else {
                    onBlurHandler();
                }
            };
            //            window.onfocus = onFocusHandler;
            //            window.onblur = onBlurHandler;
            window.addEventListener("focus", onFocusHandler, false);
            window.addEventListener("blur", onBlurHandler, false);
            var hidden, visibilityChange;
            if (typeof document.hidden !== "undefined") {
                hidden = "hidden";
                visibilityChange = "visibilitychange";
            }
            else if (typeof document["mozHidden"] !== "undefined") {
                hidden = "mozHidden";
                visibilityChange = "mozvisibilitychange";
            }
            else if (typeof document["msHidden"] !== "undefined") {
                hidden = "msHidden";
                visibilityChange = "msvisibilitychange";
            }
            else if (typeof document["webkitHidden"] !== "undefined") {
                hidden = "webkitHidden";
                visibilityChange = "webkitvisibilitychange";
            }
            else if (typeof document["oHidden"] !== "undefined") {
                hidden = "oHidden";
                visibilityChange = "ovisibilitychange";
            }
            if ("onpageshow" in window && "onpagehide" in window) {
                window.addEventListener("pageshow", onFocusHandler, false);
                window.addEventListener("pagehide", onBlurHandler, false);
            }
            if (hidden && visibilityChange) {
                document.addEventListener(visibilityChange, handleVisibilityChange, false);
            }
        };
        return HTML5DeviceContext;
    })(egret.DeviceContext);
    egret.HTML5DeviceContext = HTML5DeviceContext;
    HTML5DeviceContext.prototype.__class__ = "egret.HTML5DeviceContext";
})(egret || (egret = {}));
var egret_html5_localStorage;
(function (egret_html5_localStorage) {
    //todo 有可能没有window.localStorage对象
    function getItem(key) {
        return window.localStorage.getItem(key);
    }
    egret_html5_localStorage.getItem = getItem;
    function setItem(key, value) {
        try {
            window.localStorage.setItem(key, value);
            return true;
        }
        catch (e) {
            console.log("egret_html5_localStorage.setItem保存失败,key=" + key + "&value=" + value);
            return false;
        }
    }
    egret_html5_localStorage.setItem = setItem;
    function removeItem(key) {
        window.localStorage.removeItem(key);
    }
    egret_html5_localStorage.removeItem = removeItem;
    function clear() {
        window.localStorage.clear();
    }
    egret_html5_localStorage.clear = clear;
    function init() {
        for (var key in egret_html5_localStorage) {
            egret.localStorage[key] = egret_html5_localStorage[key];
        }
    }
    egret_html5_localStorage.init = init;
})(egret_html5_localStorage || (egret_html5_localStorage = {}));
egret_html5_localStorage.init();
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.HTML5CanvasRenderer
     * @classdesc
     * @extends egret.RendererContext
     * @private
     */
    var HTML5CanvasRenderer = (function (_super) {
        __extends(HTML5CanvasRenderer, _super);
        function HTML5CanvasRenderer(canvas) {
            _super.call(this);
            this.globalAlpha = 1;
            this.canvas = canvas || this.createCanvas();
            this.canvasContext = this.canvas.getContext("2d");
            this._cacheCanvas = document.createElement("canvas");
            this._cacheCanvas.width = this.canvas.width;
            this._cacheCanvas.height = this.canvas.height;
            this._cacheCanvasContext = this._cacheCanvas.getContext("2d");
            this.onResize();
            var f = this.canvasContext.setTransform;
            var that = this;
            this._cacheCanvasContext.setTransform = function (a, b, c, d, tx, ty) {
                that._matrixA = a;
                that._matrixB = b;
                that._matrixC = c;
                that._matrixD = d;
                that._matrixTx = tx;
                that._matrixTy = ty;
                f.call(that._cacheCanvasContext, a, b, c, d, tx, ty);
            };
            this._matrixA = 1;
            this._matrixB = 0;
            this._matrixC = 0;
            this._matrixD = 1;
            this._matrixTx = 0;
            this._matrixTy = 0;
            this._transformTx = 0;
            this._transformTy = 0;
            this.initBlendMode();
        }
        HTML5CanvasRenderer.prototype.createCanvas = function () {
            var canvas = egret.Browser.getInstance().$("#egretCanvas");
            if (!canvas) {
                var container = document.getElementById(egret.StageDelegate.canvas_div_name);
                canvas = egret.Browser.getInstance().$new("canvas");
                canvas.id = "egretCanvas";
                container.appendChild(canvas);
            }
            egret.MainContext.instance.stage.addEventListener(egret.Event.RESIZE, this.onResize, this);
            return canvas;
        };
        HTML5CanvasRenderer.prototype.onResize = function () {
            //设置canvas宽高
            if (this.canvas) {
                var container = document.getElementById(egret.StageDelegate.canvas_div_name);
                this.canvas.width = egret.MainContext.instance.stage.stageWidth; //stageW
                this.canvas.height = egret.MainContext.instance.stage.stageHeight; //stageH
                this.canvas.style.width = container.style.width;
                this.canvas.style.height = container.style.height;
                //              this.canvas.style.position = "absolute";
                this._cacheCanvas.width = this.canvas.width;
                this._cacheCanvas.height = this.canvas.height;
                this._cacheCanvasContext["imageSmoothingEnabled"] = egret.RendererContext.imageSmoothingEnabled;
                this._cacheCanvasContext["webkitImageSmoothingEnabled"] = egret.RendererContext.imageSmoothingEnabled;
                this._cacheCanvasContext["mozImageSmoothingEnabled"] = egret.RendererContext.imageSmoothingEnabled;
                this._cacheCanvasContext["msImageSmoothingEnabled"] = egret.RendererContext.imageSmoothingEnabled;
            }
        };
        HTML5CanvasRenderer.prototype.clearScreen = function () {
            var list = egret.RenderFilter.getInstance().getDrawAreaList();
            for (var i = 0, l = list.length; i < l; i++) {
                var area = list[i];
                this.clearRect(area.x, area.y, area.width, area.height);
            }
            var stage = egret.MainContext.instance.stage;
            this._cacheCanvasContext.clearRect(0, 0, stage.stageWidth, stage.stageHeight);
            this.renderCost = 0;
        };
        HTML5CanvasRenderer.prototype.clearRect = function (x, y, w, h) {
            //            this.canvasContext.fillRect(x, y, w, h);
            this.canvasContext.clearRect(x, y, w, h);
        };
        HTML5CanvasRenderer.prototype.drawImage = function (texture, sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight, repeat) {
            if (repeat === void 0) { repeat = undefined; }
            //            if (DEBUG && DEBUG.DRAW_IMAGE) {
            //                DEBUG.checkDrawImage(texture, sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight);
            //            }
            var image = texture._bitmapData;
            destX += this._transformTx;
            destY += this._transformTy;
            var beforeDraw = egret.getTimer();
            if (repeat === undefined) {
                this._cacheCanvasContext.drawImage(image, sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight);
            }
            else {
                this.drawRepeatImage(texture, sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight, repeat);
            }
            _super.prototype.drawImage.call(this, texture, sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight, repeat);
            this.renderCost += egret.getTimer() - beforeDraw;
        };
        HTML5CanvasRenderer.prototype.drawRepeatImage = function (texture, sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight, repeat) {
            if (texture['pattern'] === undefined) {
                var texture_scale_factor = egret.MainContext.instance.rendererContext.texture_scale_factor;
                var image = texture._bitmapData;
                var tempImage = image;
                if (image.width != sourceWidth || image.height != sourceHeight || texture_scale_factor != 1) {
                    var tempCanvas = document.createElement("canvas");
                    tempCanvas.width = sourceWidth * texture_scale_factor;
                    tempCanvas.height = sourceHeight * texture_scale_factor;
                    tempCanvas.getContext("2d").drawImage(image, sourceX, sourceY, sourceWidth, sourceHeight, 0, 0, sourceWidth * texture_scale_factor, sourceHeight * texture_scale_factor);
                    tempImage = tempCanvas;
                }
                var pat = this._cacheCanvasContext.createPattern(tempImage, repeat);
                texture['pattern'] = pat;
            }
            var pattern = texture['pattern'];
            this._cacheCanvasContext.fillStyle = pattern;
            this._cacheCanvasContext.translate(destX, destY);
            this._cacheCanvasContext.fillRect(0, 0, destWidth, destHeight);
            this._cacheCanvasContext.translate(-destX, -destY);
        };
        HTML5CanvasRenderer.prototype.setTransform = function (matrix) {
            //在没有旋转缩放斜切的情况下，先不进行矩阵偏移，等下次绘制的时候偏移
            if (matrix.a == 1 && matrix.b == 0 && matrix.c == 0 && matrix.d == 1 && this._matrixA == 1 && this._matrixB == 0 && this._matrixC == 0 && this._matrixD == 1) {
                this._transformTx = matrix.tx - this._matrixTx;
                this._transformTy = matrix.ty - this._matrixTy;
                return;
            }
            this._transformTx = this._transformTy = 0;
            if (this._matrixA != matrix.a || this._matrixB != matrix.b || this._matrixC != matrix.c || this._matrixD != matrix.d || this._matrixTx != matrix.tx || this._matrixTy != matrix.ty) {
                this._cacheCanvasContext.setTransform(matrix.a, matrix.b, matrix.c, matrix.d, matrix.tx, matrix.ty);
            }
        };
        HTML5CanvasRenderer.prototype.setAlpha = function (alpha, blendMode) {
            if (alpha != this.globalAlpha) {
                this._cacheCanvasContext.globalAlpha = this.globalAlpha = alpha;
            }
            if (blendMode) {
                this.blendValue = this.blendModes[blendMode];
                this._cacheCanvasContext.globalCompositeOperation = this.blendValue;
            }
            else if (this.blendValue != egret.BlendMode.NORMAL) {
                this.blendValue = this.blendModes[egret.BlendMode.NORMAL];
                this._cacheCanvasContext.globalCompositeOperation = this.blendValue;
            }
        };
        HTML5CanvasRenderer.prototype.initBlendMode = function () {
            this.blendModes = {};
            this.blendModes[egret.BlendMode.NORMAL] = "source-over";
            this.blendModes[egret.BlendMode.ADD] = "lighter";
        };
        HTML5CanvasRenderer.prototype.setupFont = function (textField, style) {
            if (style === void 0) { style = null; }
            style = style || {};
            var italic = style["italic"] == null ? textField._italic : style["italic"];
            var bold = style["bold"] == null ? textField._bold : style["bold"];
            var size = style["size"] == null ? textField._size : style["size"];
            var fontFamily = style["fontFamily"] == null ? textField._fontFamily : style["fontFamily"];
            var ctx = this._cacheCanvasContext;
            var font = italic ? "italic " : "normal ";
            font += bold ? "bold " : "normal ";
            font += size + "px " + fontFamily;
            ctx.font = font;
            ctx.textAlign = "left";
            ctx.textBaseline = "middle";
        };
        HTML5CanvasRenderer.prototype.measureText = function (text) {
            var result = this._cacheCanvasContext.measureText(text);
            return result.width;
        };
        HTML5CanvasRenderer.prototype.drawText = function (textField, text, x, y, maxWidth, style) {
            if (style === void 0) { style = null; }
            this.setupFont(textField, style);
            style = style || {};
            var textColor;
            if (style.textColor != null) {
                textColor = egret.toColorString(style.textColor);
            }
            else {
                textColor = textField._textColorString;
            }
            var strokeColor;
            if (style.strokeColor != null) {
                strokeColor = egret.toColorString(style.strokeColor);
            }
            else {
                strokeColor = textField._strokeColorString;
            }
            var outline;
            if (style.stroke != null) {
                outline = style.stroke;
            }
            else {
                outline = textField._stroke;
            }
            var renderContext = this._cacheCanvasContext;
            renderContext.fillStyle = textColor;
            renderContext.strokeStyle = strokeColor;
            if (outline) {
                renderContext.lineWidth = outline * 2;
                renderContext.strokeText(text, x + this._transformTx, y + this._transformTy, maxWidth || 0xFFFF);
            }
            renderContext.fillText(text, x + this._transformTx, y + this._transformTy, maxWidth || 0xFFFF);
            _super.prototype.drawText.call(this, textField, text, x, y, maxWidth, style);
        };
        HTML5CanvasRenderer.prototype.strokeRect = function (x, y, w, h, color) {
            this._cacheCanvasContext.strokeStyle = color;
            this._cacheCanvasContext.strokeRect(x, y, w, h);
        };
        HTML5CanvasRenderer.prototype.pushMask = function (mask) {
            this._cacheCanvasContext.save();
            this._cacheCanvasContext.beginPath();
            this._cacheCanvasContext.rect(mask.x + this._transformTx, mask.y + this._transformTy, mask.width, mask.height);
            this._cacheCanvasContext.clip();
            this._cacheCanvasContext.closePath();
        };
        HTML5CanvasRenderer.prototype.popMask = function () {
            this._cacheCanvasContext.restore();
            this._cacheCanvasContext.setTransform(1, 0, 0, 1, 0, 0);
        };
        HTML5CanvasRenderer.prototype.onRenderStart = function () {
            this._cacheCanvasContext.save();
        };
        HTML5CanvasRenderer.prototype.onRenderFinish = function () {
            this._cacheCanvasContext.restore();
            this._cacheCanvasContext.setTransform(1, 0, 0, 1, 0, 0);
            var canvasWidth = this._cacheCanvas.width;
            var canvasHeight = this._cacheCanvas.height;
            var list = egret.RenderFilter.getInstance().getDrawAreaList();
            for (var i = 0, l = list.length; i < l; i++) {
                var area = list[i];
                var areaX = area.x;
                var areaY = area.y;
                var areaWidth = area.width;
                var areaHeight = area.height;
                if (areaX + areaWidth > canvasWidth) {
                    areaWidth = canvasWidth - areaX;
                }
                if (areaY + areaHeight > canvasHeight) {
                    areaHeight = canvasHeight - areaY;
                }
                if (areaWidth > 0 && areaHeight > 0) {
                    this.canvasContext.drawImage(this._cacheCanvas, areaX, areaY, areaWidth, areaHeight, areaX, areaY, areaWidth, areaHeight);
                }
            }
        };
        return HTML5CanvasRenderer;
    })(egret.RendererContext);
    egret.HTML5CanvasRenderer = HTML5CanvasRenderer;
    HTML5CanvasRenderer.prototype.__class__ = "egret.HTML5CanvasRenderer";
})(egret || (egret = {}));
var egret_h5_graphics;
(function (egret_h5_graphics) {
    function beginFill(color, alpha) {
        if (alpha === void 0) { alpha = 1; }
        var _colorBlue = color & 0x0000FF;
        var _colorGreen = (color & 0x00ff00) >> 8;
        var _colorRed = color >> 16;
        var _colorStr = "rgba(" + _colorRed + "," + _colorGreen + "," + _colorBlue + "," + alpha + ")";
        this.fillStyleColor = _colorStr;
        this.commandQueue.push(new Command(this._setStyle, this, [_colorStr]));
    }
    egret_h5_graphics.beginFill = beginFill;
    function drawRect(x, y, width, height) {
        this.commandQueue.push(new Command(function (x, y, width, height) {
            var rendererContext = this.renderContext;
            this.canvasContext.beginPath();
            this.canvasContext.rect(rendererContext._transformTx + x, rendererContext._transformTy + y, width, height);
            this.canvasContext.closePath();
        }, this, [x, y, width, height]));
        this._fill();
    }
    egret_h5_graphics.drawRect = drawRect;
    function drawCircle(x, y, r) {
        this.commandQueue.push(new Command(function (x, y, r) {
            var rendererContext = this.renderContext;
            this.canvasContext.beginPath();
            this.canvasContext.arc(rendererContext._transformTx + x, rendererContext._transformTy + y, r, 0, Math.PI * 2);
            this.canvasContext.closePath();
        }, this, [x, y, r]));
        this._fill();
    }
    egret_h5_graphics.drawCircle = drawCircle;
    function drawRoundRect(x, y, width, height, ellipseWidth, ellipseHeight) {
        //非等值椭圆角实现
        this.commandQueue.push(new Command(function (x, y, width, height, ellipseWidth, ellipseHeight) {
            var rendererContext = this.renderContext;
            var _x = rendererContext._transformTx + x; //控制X偏移
            var _y = rendererContext._transformTy + y; //控制Y偏移
            var _w = width;
            var _h = height;
            var _ew = ellipseWidth / 2;
            var _eh = ellipseHeight ? ellipseHeight / 2 : _ew;
            var right = _x + _w;
            var bottom = _y + _h;
            var ax = right;
            var ay = bottom - _eh;
            this.canvasContext.beginPath();
            this.canvasContext.moveTo(ax, ay);
            this.canvasContext.quadraticCurveTo(right, bottom, right - _ew, bottom);
            this.canvasContext.lineTo(_x + _ew, bottom);
            this.canvasContext.quadraticCurveTo(_x, bottom, _x, bottom - _eh);
            this.canvasContext.lineTo(_x, _y + _eh);
            this.canvasContext.quadraticCurveTo(_x, _y, _x + _ew, _y);
            this.canvasContext.lineTo(right - _ew, _y);
            this.canvasContext.quadraticCurveTo(right, _y, right, _y + _eh);
            this.canvasContext.lineTo(ax, ay);
            this.canvasContext.closePath();
        }, this, [x, y, width, height, ellipseWidth, ellipseHeight]));
        this._fill();
    }
    egret_h5_graphics.drawRoundRect = drawRoundRect;
    function drawEllipse(x, y, width, height) {
        //基于均匀压缩算法
        this.commandQueue.push(new Command(function (x, y, width, height) {
            var rendererContext = this.renderContext;
            this.canvasContext.save();
            var _x = rendererContext._transformTx + x; //控制X偏移
            var _y = rendererContext._transformTy + y; //控制Y偏移
            var r = (width > height) ? width : height; //选宽高较大者做为arc半径参数
            var ratioX = width / r; //横轴缩放比率
            var ratioY = height / r; //纵轴缩放比率
            this.canvasContext.scale(ratioX, ratioY); //进行缩放(均匀压缩)
            this.canvasContext.beginPath();
            this.canvasContext.moveTo((_x + width) / ratioX, _y / ratioY);
            this.canvasContext.arc(_x / ratioX, _y / ratioY, r, 0, 2 * Math.PI);
            this.canvasContext.closePath();
            this.canvasContext.restore();
            this.canvasContext.stroke();
        }, this, [x, y, width, height]));
        this._fill();
    }
    egret_h5_graphics.drawEllipse = drawEllipse;
    function lineStyle(thickness, color, alpha, pixelHinting, scaleMode, caps, joints, miterLimit) {
        if (thickness === void 0) { thickness = NaN; }
        if (color === void 0) { color = 0; }
        if (alpha === void 0) { alpha = 1.0; }
        if (pixelHinting === void 0) { pixelHinting = false; }
        if (scaleMode === void 0) { scaleMode = "normal"; }
        if (caps === void 0) { caps = null; }
        if (joints === void 0) { joints = null; }
        if (miterLimit === void 0) { miterLimit = 3; }
        if (this.strokeStyleColor) {
            this.createEndLineCommand();
            this.commandQueue.push(this.endLineCommand);
        }
        var _colorBlue = color & 0x0000FF;
        var _colorGreen = (color & 0x00ff00) >> 8;
        var _colorRed = color >> 16;
        var _colorStr = "rgba(" + _colorRed + "," + _colorGreen + "," + _colorBlue + "," + alpha + ")";
        this.strokeStyleColor = _colorStr;
        this.commandQueue.push(new Command(function (lineWidth, strokeStyle) {
            this.canvasContext.lineWidth = lineWidth;
            this.canvasContext.strokeStyle = strokeStyle;
            this.canvasContext.beginPath();
        }, this, [thickness, _colorStr]));
        if (typeof (this.lineX) === "undefined") {
            this.lineX = 0;
            this.lineY = 0;
        }
        this.moveTo(this.lineX, this.lineY);
    }
    egret_h5_graphics.lineStyle = lineStyle;
    function lineTo(x, y) {
        this.commandQueue.push(new Command(function (x, y) {
            var rendererContext = this.renderContext;
            var canvasContext = this.canvasContext;
            canvasContext.lineTo(rendererContext._transformTx + x, rendererContext._transformTy + y);
        }, this, [x, y]));
        this.lineX = x;
        this.lineY = y;
    }
    egret_h5_graphics.lineTo = lineTo;
    function curveTo(controlX, controlY, anchorX, anchorY) {
        this.commandQueue.push(new Command(function (x, y, ax, ay) {
            var rendererContext = this.renderContext;
            var canvasContext = this.canvasContext;
            canvasContext.quadraticCurveTo(rendererContext._transformTx + x, rendererContext._transformTy + y, rendererContext._transformTx + ax, rendererContext._transformTy + ay);
        }, this, [controlX, controlY, anchorX, anchorY]));
        this.lineX = anchorX;
        this.lineY = anchorY;
    }
    egret_h5_graphics.curveTo = curveTo;
    function moveTo(x, y) {
        this.commandQueue.push(new Command(function (x, y) {
            var rendererContext = this.renderContext;
            var canvasContext = this.canvasContext;
            canvasContext.moveTo(rendererContext._transformTx + x, rendererContext._transformTy + y);
        }, this, [x, y]));
    }
    egret_h5_graphics.moveTo = moveTo;
    function clear() {
        this.commandQueue.length = 0;
        this.lineX = 0;
        this.lineY = 0;
        this.strokeStyleColor = null;
        this.fillStyleColor = null;
    }
    egret_h5_graphics.clear = clear;
    function createEndFillCommand() {
        if (!this.endFillCommand) {
            this.endFillCommand = new Command(function () {
                this.canvasContext.fill();
                this.canvasContext.closePath();
            }, this, null);
        }
    }
    egret_h5_graphics.createEndFillCommand = createEndFillCommand;
    function endFill() {
        if (this.fillStyleColor != null) {
            this._fill();
        }
        this.fillStyleColor = null;
    }
    egret_h5_graphics.endFill = endFill;
    function _fill() {
        if (this.fillStyleColor) {
            this.createEndFillCommand();
            this.commandQueue.push(this.endFillCommand);
        }
    }
    egret_h5_graphics._fill = _fill;
    function createEndLineCommand() {
        if (!this.endLineCommand) {
            this.endLineCommand = new Command(function () {
                this.canvasContext.stroke();
                this.canvasContext.closePath();
            }, this, null);
        }
    }
    egret_h5_graphics.createEndLineCommand = createEndLineCommand;
    function _draw(renderContext) {
        var length = this.commandQueue.length;
        if (length == 0) {
            return;
        }
        this.renderContext = renderContext;
        this.canvasContext = this.renderContext._cacheCanvasContext || this.renderContext.canvasContext;
        var canvasContext = this.canvasContext;
        canvasContext.save();
        if (this.strokeStyleColor && length > 0 && this.commandQueue[length - 1] != this.endLineCommand) {
            this.createEndLineCommand();
            this.commandQueue.push(this.endLineCommand);
            length = this.commandQueue.length;
        }
        for (var i = 0; i < length; i++) {
            var command = this.commandQueue[i];
            command.method.apply(command.thisObject, command.args);
        }
        canvasContext.restore();
    }
    egret_h5_graphics._draw = _draw;
    var Command = (function () {
        function Command(method, thisObject, args) {
            this.method = method;
            this.thisObject = thisObject;
            this.args = args;
        }
        return Command;
    })();
    Command.prototype.__class__ = "egret_h5_graphics.Command";
    function _setStyle(colorStr) {
        this.canvasContext.fillStyle = colorStr;
        this.canvasContext.beginPath();
    }
    egret_h5_graphics._setStyle = _setStyle;
    function init() {
        for (var key in egret_h5_graphics) {
            egret.Graphics.prototype[key] = egret_h5_graphics[key];
        }
        egret.RendererContext.createRendererContext = function (canvas) {
            return new egret.HTML5CanvasRenderer(canvas);
        };
    }
    egret_h5_graphics.init = init;
})(egret_h5_graphics || (egret_h5_graphics = {}));
egret_h5_graphics.init();
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.WebGLRenderer
     * @classdesc
     * WebGL的渲染类
     * @extends egret.RendererContext
     * @private
     */
    var WebGLRenderer = (function (_super) {
        __extends(WebGLRenderer, _super);
        function WebGLRenderer(canvas) {
            _super.call(this);
            this.size = 2000;
            this.vertSize = 5;
            this.contextLost = false;
            this.glContextId = 0;
            this.currentBlendMode = "";
            this.currentBaseTexture = null;
            this.currentBatchSize = 0;
            this.maskList = [];
            this.maskDataFreeList = [];
            this.canvasContext = document.createElement("canvas").getContext("2d");
            console.log("使用WebGL模式");
            this.canvas = canvas || this.createCanvas();
            this.canvas.addEventListener("webglcontextlost", this.handleContextLost.bind(this), false);
            this.canvas.addEventListener("webglcontextrestored", this.handleContextRestored.bind(this), false);
            this.onResize();
            this.projectionX = this.canvas.width / 2;
            this.projectionY = -this.canvas.height / 2;
            var numVerts = this.size * 4 * this.vertSize;
            var numIndices = this.size * 6;
            this.vertices = new Float32Array(numVerts);
            this.indices = new Uint16Array(numIndices);
            for (var i = 0, j = 0; i < numIndices; i += 6, j += 4) {
                this.indices[i + 0] = j + 0;
                this.indices[i + 1] = j + 1;
                this.indices[i + 2] = j + 2;
                this.indices[i + 3] = j + 0;
                this.indices[i + 4] = j + 2;
                this.indices[i + 5] = j + 3;
            }
            this.initWebGL();
            this.shaderManager = new egret.WebGLShaderManager(this.gl);
            this.worldTransform = new egret.Matrix();
            this.initBlendMode();
            egret.MainContext.instance.addEventListener(egret.Event.FINISH_RENDER, this._draw, this);
            egret.TextField.prototype._draw = function (renderContext) {
                var textField = this;
                if (textField.getDirty()) {
                    textField.cacheAsBitmap = true;
                }
                egret.DisplayObject.prototype._draw.call(textField, renderContext);
            };
        }
        WebGLRenderer.prototype.createCanvas = function () {
            var canvas = egret.Browser.getInstance().$("#egretCanvas");
            if (!canvas) {
                var container = document.getElementById(egret.StageDelegate.canvas_div_name);
                canvas = egret.Browser.getInstance().$new("canvas");
                canvas.id = "egretCanvas";
                container.appendChild(canvas);
            }
            egret.MainContext.instance.stage.addEventListener(egret.Event.RESIZE, this.onResize, this);
            return canvas;
        };
        WebGLRenderer.prototype.onResize = function () {
            //设置canvas宽高
            if (this.canvas) {
                var container = document.getElementById(egret.StageDelegate.canvas_div_name);
                this.canvas.width = egret.MainContext.instance.stage.stageWidth; //stageW
                this.canvas.height = egret.MainContext.instance.stage.stageHeight; //stageH
                this.canvas.style.width = container.style.width;
                this.canvas.style.height = container.style.height;
                //              this.canvas.style.position = "absolute";
                this.projectionX = this.canvas.width / 2;
                this.projectionY = -this.canvas.height / 2;
            }
        };
        WebGLRenderer.prototype.handleContextLost = function () {
            this.contextLost = true;
        };
        WebGLRenderer.prototype.handleContextRestored = function () {
            this.initWebGL();
            this.shaderManager.setContext(this.gl);
            this.contextLost = false;
        };
        WebGLRenderer.prototype.initWebGL = function () {
            var options = {
                stencil: true //设置可以使用模板（用于遮罩实现）
            };
            var gl;
            var names = ["experimental-webgl", "webgl"];
            for (var i = 0; i < names.length; i++) {
                try {
                    gl = this.canvas.getContext(names[i], options);
                }
                catch (e) {
                }
                if (gl) {
                    break;
                }
            }
            if (!gl) {
                throw new Error("当前浏览器不支持webgl");
            }
            this.setContext(gl);
        };
        WebGLRenderer.prototype.setContext = function (gl) {
            this.gl = gl;
            gl.id = this.glContextId++;
            this.vertexBuffer = gl.createBuffer();
            this.indexBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer);
            gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.indices, gl.STATIC_DRAW);
            gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexBuffer);
            gl.bufferData(gl.ARRAY_BUFFER, this.vertices, gl.DYNAMIC_DRAW);
            gl.disable(gl.DEPTH_TEST);
            gl.disable(gl.CULL_FACE);
            gl.enable(gl.BLEND);
            gl.colorMask(true, true, true, true);
        };
        WebGLRenderer.prototype.initBlendMode = function () {
            this.blendModesWebGL = {};
            this.blendModesWebGL[egret.BlendMode.NORMAL] = [this.gl.ONE, this.gl.ONE_MINUS_SRC_ALPHA];
            this.blendModesWebGL[egret.BlendMode.ADD] = [this.gl.SRC_ALPHA, this.gl.ONE];
        };
        WebGLRenderer.prototype.start = function () {
            if (this.contextLost) {
                return;
            }
            var gl = this.gl;
            gl.activeTexture(gl.TEXTURE0);
            gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexBuffer);
            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer);
            var shader;
            if (this.colorTransformMatrix) {
                shader = this.shaderManager.colorTransformShader;
            }
            else {
                shader = this.shaderManager.defaultShader;
            }
            this.shaderManager.activateShader(shader);
            shader.syncUniforms();
            gl.uniform2f(shader.projectionVector, this.projectionX, this.projectionY);
            var stride = this.vertSize * 4;
            gl.vertexAttribPointer(shader.aVertexPosition, 2, gl.FLOAT, false, stride, 0);
            gl.vertexAttribPointer(shader.aTextureCoord, 2, gl.FLOAT, false, stride, 2 * 4);
            gl.vertexAttribPointer(shader.colorAttribute, 2, gl.FLOAT, false, stride, 4 * 4);
        };
        WebGLRenderer.prototype.clearScreen = function () {
            var gl = this.gl;
            gl.colorMask(true, true, true, true);
            var list = egret.RenderFilter.getInstance().getDrawAreaList();
            for (var i = 0, l = list.length; i < l; i++) {
                var area = list[i];
                gl.viewport(area.x, area.y, area.width, area.height);
                gl.bindFramebuffer(gl.FRAMEBUFFER, null);
                gl.clearColor(0, 0, 0, 0);
                gl.clear(gl.COLOR_BUFFER_BIT);
            }
            var stage = egret.MainContext.instance.stage;
            gl.viewport(0, 0, stage.stageWidth, stage.stageHeight);
            this.renderCost = 0;
        };
        WebGLRenderer.prototype.setBlendMode = function (blendMode) {
            if (!blendMode) {
                blendMode = egret.BlendMode.NORMAL;
            }
            if (this.currentBlendMode != blendMode) {
                var blendModeWebGL = this.blendModesWebGL[blendMode];
                if (blendModeWebGL) {
                    this._draw();
                    this.gl.blendFunc(blendModeWebGL[0], blendModeWebGL[1]);
                    this.currentBlendMode = blendMode;
                }
            }
        };
        WebGLRenderer.prototype.drawRepeatImage = function (texture, sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight, repeat) {
            var texture_scale_factor = egret.MainContext.instance.rendererContext.texture_scale_factor;
            sourceWidth = sourceWidth * texture_scale_factor;
            sourceHeight = sourceHeight * texture_scale_factor;
            for (var x = destX; x < destWidth; x += sourceWidth) {
                for (var y = destY; y < destHeight; y += sourceHeight) {
                    var destW = Math.min(sourceWidth, destWidth - x);
                    var destH = Math.min(sourceHeight, destHeight - y);
                    this.drawImage(texture, sourceX, sourceY, destW / texture_scale_factor, destH / texture_scale_factor, x, y, destW, destH);
                }
            }
        };
        WebGLRenderer.prototype.drawImage = function (texture, sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight, repeat) {
            if (repeat === void 0) { repeat = undefined; }
            if (this.contextLost) {
                return;
            }
            if (repeat !== undefined) {
                this.drawRepeatImage(texture, sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight, repeat);
                return;
            }
            this.createWebGLTexture(texture);
            if (texture.webGLTexture !== this.currentBaseTexture || this.currentBatchSize >= this.size - 1) {
                this._draw();
                this.currentBaseTexture = texture.webGLTexture;
            }
            //计算出绘制矩阵，之后把矩阵还原回之前的
            var locWorldTransform = this.worldTransform;
            var originalA = locWorldTransform.a;
            var originalB = locWorldTransform.b;
            var originalC = locWorldTransform.c;
            var originalD = locWorldTransform.d;
            var originalTx = locWorldTransform.tx;
            var originalTy = locWorldTransform.ty;
            if (destX != 0 || destY != 0) {
                locWorldTransform.append(1, 0, 0, 1, destX, destY);
            }
            if (sourceWidth / destWidth != 1 || sourceHeight / destHeight != 1) {
                locWorldTransform.append(destWidth / sourceWidth, 0, 0, destHeight / sourceHeight, 0, 0);
            }
            var a = locWorldTransform.a;
            var b = locWorldTransform.b;
            var c = locWorldTransform.c;
            var d = locWorldTransform.d;
            var tx = locWorldTransform.tx;
            var ty = locWorldTransform.ty;
            locWorldTransform.a = originalA;
            locWorldTransform.b = originalB;
            locWorldTransform.c = originalC;
            locWorldTransform.d = originalD;
            locWorldTransform.tx = originalTx;
            locWorldTransform.ty = originalTy;
            var width = texture._sourceWidth;
            var height = texture._sourceHeight;
            var w = sourceWidth;
            var h = sourceHeight;
            sourceX = sourceX / width;
            sourceY = sourceY / height;
            sourceWidth = sourceWidth / width;
            sourceHeight = sourceHeight / height;
            var vertices = this.vertices;
            var index = this.currentBatchSize * 4 * this.vertSize;
            var alpha = this.worldAlpha;
            // xy
            vertices[index++] = tx;
            vertices[index++] = ty;
            // uv
            vertices[index++] = sourceX;
            vertices[index++] = sourceY;
            // alpha
            vertices[index++] = alpha;
            // xy
            vertices[index++] = a * w + tx;
            vertices[index++] = b * w + ty;
            // uv
            vertices[index++] = sourceWidth + sourceX;
            vertices[index++] = sourceY;
            // alpha
            vertices[index++] = alpha;
            // xy
            vertices[index++] = a * w + c * h + tx;
            vertices[index++] = d * h + b * w + ty;
            // uv
            vertices[index++] = sourceWidth + sourceX;
            vertices[index++] = sourceHeight + sourceY;
            // alpha
            vertices[index++] = alpha;
            // xy
            vertices[index++] = c * h + tx;
            vertices[index++] = d * h + ty;
            // uv
            vertices[index++] = sourceX;
            vertices[index++] = sourceHeight + sourceY;
            // alpha
            vertices[index++] = alpha;
            this.currentBatchSize++;
        };
        WebGLRenderer.prototype._draw = function () {
            if (this.currentBatchSize == 0 || this.contextLost) {
                return;
            }
            var beforeDraw = egret.getTimer();
            this.start();
            var gl = this.gl;
            gl.bindTexture(gl.TEXTURE_2D, this.currentBaseTexture);
            var view = this.vertices.subarray(0, this.currentBatchSize * 4 * this.vertSize);
            gl.bufferSubData(gl.ARRAY_BUFFER, 0, view);
            gl.drawElements(gl.TRIANGLES, this.currentBatchSize * 6, gl.UNSIGNED_SHORT, 0);
            this.currentBatchSize = 0;
            this.renderCost += egret.getTimer() - beforeDraw;
            egret.Profiler.getInstance().onDrawImage();
        };
        WebGLRenderer.prototype.setTransform = function (matrix) {
            var locWorldTransform = this.worldTransform;
            locWorldTransform.a = matrix.a;
            locWorldTransform.b = matrix.b;
            locWorldTransform.c = matrix.c;
            locWorldTransform.d = matrix.d;
            locWorldTransform.tx = matrix.tx;
            locWorldTransform.ty = matrix.ty;
        };
        WebGLRenderer.prototype.setAlpha = function (value, blendMode) {
            this.worldAlpha = value;
            this.setBlendMode(blendMode);
        };
        WebGLRenderer.prototype.createWebGLTexture = function (texture) {
            if (!texture.webGLTexture) {
                var gl = this.gl;
                texture.webGLTexture = gl.createTexture();
                gl.bindTexture(gl.TEXTURE_2D, texture.webGLTexture);
                gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);
                gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, texture._bitmapData);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
                gl.bindTexture(gl.TEXTURE_2D, null);
            }
        };
        WebGLRenderer.prototype.pushMask = function (mask) {
            this._draw();
            var gl = this.gl;
            if (this.maskList.length == 0) {
                gl.enable(gl.STENCIL_TEST);
                gl.stencilFunc(gl.ALWAYS, 1, 1);
            }
            var maskData = this.maskDataFreeList.pop();
            if (!maskData) {
                maskData = { x: mask.x, y: mask.y, w: mask.width, h: mask.height };
            }
            else {
                maskData.x = mask.x;
                maskData.y = mask.y;
                maskData.w = mask.width;
                maskData.h = mask.height;
            }
            this.maskList.push(maskData);
            gl.colorMask(false, false, false, false);
            gl.stencilOp(gl.KEEP, gl.KEEP, gl.INCR);
            this.renderGraphics(maskData);
            gl.colorMask(true, true, true, true);
            gl.stencilFunc(gl.NOTEQUAL, 0, this.maskList.length);
            gl.stencilOp(gl.KEEP, gl.KEEP, gl.KEEP);
        };
        WebGLRenderer.prototype.popMask = function () {
            this._draw();
            var gl = this.gl;
            var maskData = this.maskList.pop();
            if (maskData) {
                gl.colorMask(false, false, false, false);
                gl.stencilOp(gl.KEEP, gl.KEEP, gl.DECR);
                this.renderGraphics(maskData);
                gl.colorMask(true, true, true, true);
                gl.stencilFunc(gl.NOTEQUAL, 0, this.maskList.length);
                gl.stencilOp(gl.KEEP, gl.KEEP, gl.KEEP);
                this.maskDataFreeList.push(maskData);
            }
            if (this.maskList.length == 0) {
                gl.disable(gl.STENCIL_TEST);
            }
        };
        WebGLRenderer.prototype.setGlobalColorTransform = function (colorTransformMatrix) {
            if (this.colorTransformMatrix != colorTransformMatrix) {
                this._draw();
                this.colorTransformMatrix = colorTransformMatrix;
                if (colorTransformMatrix) {
                    var colorTransformMatrix = colorTransformMatrix.concat();
                    var shader = this.shaderManager.colorTransformShader;
                    shader.uniforms.colorAdd.value.w = colorTransformMatrix.splice(19, 1)[0] / 255.0;
                    shader.uniforms.colorAdd.value.z = colorTransformMatrix.splice(14, 1)[0] / 255.0;
                    shader.uniforms.colorAdd.value.y = colorTransformMatrix.splice(9, 1)[0] / 255.0;
                    shader.uniforms.colorAdd.value.x = colorTransformMatrix.splice(4, 1)[0] / 255.0;
                    shader.uniforms.matrix.value = colorTransformMatrix;
                }
            }
        };
        WebGLRenderer.prototype.setupFont = function (textField, style) {
            if (style === void 0) { style = null; }
            var ctx = this.canvasContext;
            var font = textField.italic ? "italic " : "normal ";
            font += textField.bold ? "bold " : "normal ";
            font += textField.size + "px " + textField.fontFamily;
            ctx.font = font;
            ctx.textAlign = "left";
            ctx.textBaseline = "middle";
        };
        WebGLRenderer.prototype.measureText = function (text) {
            var result = this.canvasContext.measureText(text);
            return result.width;
        };
        WebGLRenderer.prototype.renderGraphics = function (graphics) {
            var gl = this.gl;
            var shader = this.shaderManager.primitiveShader;
            if (!this.graphicsPoints) {
                this.graphicsPoints = [];
                this.graphicsIndices = [];
                this.graphicsBuffer = gl.createBuffer();
                this.graphicsIndexBuffer = gl.createBuffer();
            }
            else {
                this.graphicsPoints.length = 0;
                this.graphicsIndices.length = 0;
            }
            this.updateGraphics(graphics);
            this.shaderManager.activateShader(shader);
            gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);
            gl.uniformMatrix3fv(shader.translationMatrix, false, this.worldTransform.toArray(true));
            gl.uniform2f(shader.projectionVector, this.projectionX, -this.projectionY);
            gl.uniform2f(shader.offsetVector, 0, 0);
            gl.uniform3fv(shader.tintColor, [1, 1, 1]);
            gl.uniform1f(shader.alpha, this.worldAlpha);
            gl.bindBuffer(gl.ARRAY_BUFFER, this.graphicsBuffer);
            gl.vertexAttribPointer(shader.aVertexPosition, 2, gl.FLOAT, false, 4 * 6, 0);
            gl.vertexAttribPointer(shader.colorAttribute, 4, gl.FLOAT, false, 4 * 6, 2 * 4);
            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.graphicsIndexBuffer);
            gl.drawElements(gl.TRIANGLE_STRIP, this.graphicsIndices.length, gl.UNSIGNED_SHORT, 0);
            this.shaderManager.activateShader(this.shaderManager.defaultShader);
        };
        WebGLRenderer.prototype.updateGraphics = function (graphics) {
            var gl = this.gl;
            this.buildRectangle(graphics);
            gl.bindBuffer(gl.ARRAY_BUFFER, this.graphicsBuffer);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(this.graphicsPoints), gl.STATIC_DRAW);
            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.graphicsIndexBuffer);
            gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(this.graphicsIndices), gl.STATIC_DRAW);
        };
        WebGLRenderer.prototype.buildRectangle = function (graphicsData) {
            var x = graphicsData.x;
            var y = graphicsData.y;
            var width = graphicsData.w;
            var height = graphicsData.h;
            var r = 0;
            var g = 0;
            var b = 0;
            var alpha = 1;
            var verts = this.graphicsPoints;
            var indices = this.graphicsIndices;
            var vertPos = verts.length / 6;
            verts.push(x, y);
            verts.push(r, g, b, alpha);
            verts.push(x + width, y);
            verts.push(r, g, b, alpha);
            verts.push(x, y + height);
            verts.push(r, g, b, alpha);
            verts.push(x + width, y + height);
            verts.push(r, g, b, alpha);
            indices.push(vertPos, vertPos, vertPos + 1, vertPos + 2, vertPos + 3, vertPos + 3);
        };
        return WebGLRenderer;
    })(egret.RendererContext);
    egret.WebGLRenderer = WebGLRenderer;
    WebGLRenderer.prototype.__class__ = "egret.WebGLRenderer";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    var WebGLUtils = (function () {
        function WebGLUtils() {
        }
        WebGLUtils.compileProgram = function (gl, vertexSrc, fragmentSrc) {
            var fragmentShader = WebGLUtils.compileFragmentShader(gl, fragmentSrc);
            var vertexShader = WebGLUtils.compileVertexShader(gl, vertexSrc);
            var shaderProgram = gl.createProgram();
            gl.attachShader(shaderProgram, vertexShader);
            gl.attachShader(shaderProgram, fragmentShader);
            gl.linkProgram(shaderProgram);
            if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {
                console.log("无法初始化着色器");
            }
            return shaderProgram;
        };
        WebGLUtils.compileFragmentShader = function (gl, shaderSrc) {
            return WebGLUtils._compileShader(gl, shaderSrc, gl.FRAGMENT_SHADER);
        };
        WebGLUtils.compileVertexShader = function (gl, shaderSrc) {
            return WebGLUtils._compileShader(gl, shaderSrc, gl.VERTEX_SHADER);
        };
        WebGLUtils._compileShader = function (gl, shaderSrc, shaderType) {
            var shader = gl.createShader(shaderType);
            gl.shaderSource(shader, shaderSrc);
            gl.compileShader(shader);
            if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
                console.log(gl.getShaderInfoLog(shader));
                return null;
            }
            return shader;
        };
        WebGLUtils.checkCanUseWebGL = function () {
            if (WebGLUtils.canUseWebGL == undefined) {
                try {
                    var canvas = document.createElement("canvas");
                    WebGLUtils.canUseWebGL = !!window["WebGLRenderingContext"] && !!(canvas.getContext("webgl") || canvas.getContext("experimental-webgl"));
                }
                catch (e) {
                    WebGLUtils.canUseWebGL = false;
                }
            }
            return WebGLUtils.canUseWebGL;
        };
        return WebGLUtils;
    })();
    egret.WebGLUtils = WebGLUtils;
    WebGLUtils.prototype.__class__ = "egret.WebGLUtils";
})(egret || (egret = {}));
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var egret;
(function (egret) {
    var WebGLShaderManager = (function () {
        function WebGLShaderManager(gl) {
            this.maxAttibs = 10;
            this.attribState = [];
            this.tempAttribState = [];
            for (var i = 0; i < this.maxAttibs; i++) {
                this.attribState[i] = false;
            }
            this.setContext(gl);
        }
        WebGLShaderManager.prototype.setContext = function (gl) {
            this.gl = gl;
            this.primitiveShader = new PrimitiveShader(gl);
            this.defaultShader = new EgretShader(gl);
            this.colorTransformShader = new ColorTransformShader(gl);
            this.activateShader(this.defaultShader);
        };
        WebGLShaderManager.prototype.activateShader = function (shader) {
            if (this.currentShader != shader) {
                this.gl.useProgram(shader.program);
                this.setAttribs(shader.attributes);
                this.currentShader = shader;
            }
        };
        WebGLShaderManager.prototype.setAttribs = function (attribs) {
            var i;
            var l;
            l = this.tempAttribState.length;
            for (i = 0; i < l; i++) {
                this.tempAttribState[i] = false;
            }
            l = attribs.length;
            for (i = 0; i < l; i++) {
                var attribId = attribs[i];
                this.tempAttribState[attribId] = true;
            }
            var gl = this.gl;
            l = this.attribState.length;
            for (i = 0; i < l; i++) {
                if (this.attribState[i] !== this.tempAttribState[i]) {
                    this.attribState[i] = this.tempAttribState[i];
                    if (this.tempAttribState[i]) {
                        gl.enableVertexAttribArray(i);
                    }
                    else {
                        gl.disableVertexAttribArray(i);
                    }
                }
            }
        };
        return WebGLShaderManager;
    })();
    egret.WebGLShaderManager = WebGLShaderManager;
    WebGLShaderManager.prototype.__class__ = "egret.WebGLShaderManager";
    var EgretShader = (function () {
        function EgretShader(gl) {
            this.defaultVertexSrc = "attribute vec2 aVertexPosition;\n" + "attribute vec2 aTextureCoord;\n" + "attribute vec2 aColor;\n" + "uniform vec2 projectionVector;\n" + "uniform vec2 offsetVector;\n" + "varying vec2 vTextureCoord;\n" + "varying vec4 vColor;\n" + "const vec2 center = vec2(-1.0, 1.0);\n" + "void main(void) {\n" + "   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);\n" + "   vTextureCoord = aTextureCoord;\n" + "   vColor = vec4(aColor.x, aColor.x, aColor.x, aColor.x);\n" + "}";
            this.program = null;
            this.fragmentSrc = "precision lowp float;\n" + "varying vec2 vTextureCoord;\n" + "varying vec4 vColor;\n" + "uniform sampler2D uSampler;\n" + "void main(void) {\n" + "gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;\n" + "}";
            this.gl = gl;
            this.init();
        }
        EgretShader.prototype.init = function () {
            var gl = this.gl;
            var program = egret.WebGLUtils.compileProgram(gl, this.defaultVertexSrc, this.fragmentSrc);
            gl.useProgram(program);
            this.uSampler = gl.getUniformLocation(program, "uSampler");
            this.projectionVector = gl.getUniformLocation(program, "projectionVector");
            this.offsetVector = gl.getUniformLocation(program, "offsetVector");
            this.dimensions = gl.getUniformLocation(program, "dimensions");
            this.aVertexPosition = gl.getAttribLocation(program, "aVertexPosition");
            this.aTextureCoord = gl.getAttribLocation(program, "aTextureCoord");
            this.colorAttribute = gl.getAttribLocation(program, "aColor");
            if (this.colorAttribute === -1) {
                this.colorAttribute = 2;
            }
            this.attributes = [this.aVertexPosition, this.aTextureCoord, this.colorAttribute];
            for (var key in this.uniforms) {
                this.uniforms[key].uniformLocation = gl.getUniformLocation(program, key);
            }
            this.initUniforms();
            this.program = program;
        };
        EgretShader.prototype.initUniforms = function () {
            if (!this.uniforms) {
                return;
            }
            var gl = this.gl;
            var uniform;
            for (var key in this.uniforms) {
                uniform = this.uniforms[key];
                var type = uniform.type;
                if (type === 'mat2' || type === 'mat3' || type === 'mat4') {
                    uniform.glMatrix = true;
                    uniform.glValueLength = 1;
                    if (type === 'mat2') {
                        uniform.glFunc = gl.uniformMatrix2fv;
                    }
                    else if (type === 'mat3') {
                        uniform.glFunc = gl.uniformMatrix3fv;
                    }
                    else if (type === 'mat4') {
                        uniform.glFunc = gl.uniformMatrix4fv;
                    }
                }
                else {
                    uniform.glFunc = gl['uniform' + type];
                    if (type === '2f' || type === '2i') {
                        uniform.glValueLength = 2;
                    }
                    else if (type === '3f' || type === '3i') {
                        uniform.glValueLength = 3;
                    }
                    else if (type === '4f' || type === '4i') {
                        uniform.glValueLength = 4;
                    }
                    else {
                        uniform.glValueLength = 1;
                    }
                }
            }
        };
        EgretShader.prototype.syncUniforms = function () {
            if (!this.uniforms) {
                return;
            }
            var uniform;
            var gl = this.gl;
            for (var key in this.uniforms) {
                uniform = this.uniforms[key];
                if (uniform.glValueLength === 1) {
                    if (uniform.glMatrix === true) {
                        uniform.glFunc.call(gl, uniform.uniformLocation, uniform.transpose, uniform.value);
                    }
                    else {
                        uniform.glFunc.call(gl, uniform.uniformLocation, uniform.value);
                    }
                }
                else if (uniform.glValueLength === 2) {
                    uniform.glFunc.call(gl, uniform.uniformLocation, uniform.value.x, uniform.value.y);
                }
                else if (uniform.glValueLength === 3) {
                    uniform.glFunc.call(gl, uniform.uniformLocation, uniform.value.x, uniform.value.y, uniform.value.z);
                }
                else if (uniform.glValueLength === 4) {
                    uniform.glFunc.call(gl, uniform.uniformLocation, uniform.value.x, uniform.value.y, uniform.value.z, uniform.value.w);
                }
            }
        };
        return EgretShader;
    })();
    egret.EgretShader = EgretShader;
    EgretShader.prototype.__class__ = "egret.EgretShader";
    var ColorTransformShader = (function (_super) {
        __extends(ColorTransformShader, _super);
        function ColorTransformShader(gl) {
            _super.call(this, gl);
            this.fragmentSrc = "precision mediump float;\n" + "varying vec2 vTextureCoord;\n" + "varying vec4 vColor;\n" + "uniform float invert;\n" + "uniform mat4 matrix;\n" + "uniform vec4 colorAdd;\n" + "uniform sampler2D uSampler;\n" + "void main(void) {\n" + "vec4 locColor = texture2D(uSampler, vTextureCoord) * matrix;\n" + "if(locColor.a != 0.0){\n" + "locColor += colorAdd;\n" + "}\n" + "gl_FragColor = locColor;\n" + "}";
            this.uniforms = {
                matrix: { type: 'mat4', value: [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1] },
                colorAdd: { type: '4f', value: { x: 0, y: 0, z: 0, w: 0 } }
            };
            this.init();
        }
        return ColorTransformShader;
    })(EgretShader);
    egret.ColorTransformShader = ColorTransformShader;
    ColorTransformShader.prototype.__class__ = "egret.ColorTransformShader";
    var PrimitiveShader = (function () {
        function PrimitiveShader(gl) {
            this.program = null;
            this.projectionVector = null;
            this.offsetVector = null;
            this.tintColor = null;
            this.aVertexPosition = null;
            this.colorAttribute = null;
            this.attributes = null;
            this.translationMatrix = null;
            this.alpha = null;
            this.fragmentSrc = "precision mediump float;\n" + "varying vec4 vColor;\n" + "void main(void) {\n" + "   gl_FragColor = vColor;\n" + "}";
            this.vertexSrc = "attribute vec2 aVertexPosition;\n" + "attribute vec4 aColor;\n" + "uniform mat3 translationMatrix;\n" + "uniform vec2 projectionVector;\n" + "uniform vec2 offsetVector;\n" + "uniform float alpha;\n" + "uniform vec3 tint;\n" + "varying vec4 vColor;\n" + "void main(void) {\n" + "   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);\n" + "   v -= offsetVector.xyx;\n" + "   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);\n" + "   vColor = aColor * vec4(tint * alpha, alpha);\n" + "}";
            this.gl = gl;
            this.init();
        }
        PrimitiveShader.prototype.init = function () {
            var gl = this.gl;
            var program = egret.WebGLUtils.compileProgram(gl, this.vertexSrc, this.fragmentSrc);
            gl.useProgram(program);
            this.projectionVector = gl.getUniformLocation(program, "projectionVector");
            this.offsetVector = gl.getUniformLocation(program, "offsetVector");
            this.tintColor = gl.getUniformLocation(program, "tint");
            this.aVertexPosition = gl.getAttribLocation(program, "aVertexPosition");
            this.colorAttribute = gl.getAttribLocation(program, "aColor");
            this.attributes = [this.aVertexPosition, this.colorAttribute];
            this.translationMatrix = gl.getUniformLocation(program, "translationMatrix");
            this.alpha = gl.getUniformLocation(program, "alpha");
            this.program = program;
        };
        return PrimitiveShader;
    })();
    egret.PrimitiveShader = PrimitiveShader;
    PrimitiveShader.prototype.__class__ = "egret.PrimitiveShader";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @class egret.HTML5NetContext
     * @classdesc
     * @extends egret.NetContext
     * @private
     */
    var HTML5NetContext = (function (_super) {
        __extends(HTML5NetContext, _super);
        function HTML5NetContext() {
            _super.call(this);
        }
        HTML5NetContext.prototype.proceed = function (loader) {
            if (loader.dataFormat == egret.URLLoaderDataFormat.TEXTURE) {
                this.loadTexture(loader);
                return;
            }
            if (loader.dataFormat == egret.URLLoaderDataFormat.SOUND) {
                //                if(WebAudio.canUseWebAudio) {
                //                    this.loadWebAudio(loader);
                //                }
                //                else {
                this.loadSound(loader);
                //                }
                return;
            }
            var request = loader._request;
            var xhr = this.getXHR();
            //            xhr.onload = onLoadComplete;
            xhr.onreadystatechange = onReadyStateChange;
            var url = egret.NetContext._getUrl(request);
            xhr.open(request.method, url, true);
            this.setResponseType(xhr, loader.dataFormat);
            if (request.method == egret.URLRequestMethod.GET || !request.data) {
                xhr.send();
            }
            else if (request.data instanceof egret.URLVariables) {
                xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                var urlVars = request.data;
                xhr.send(urlVars.toString());
            }
            else {
                xhr.setRequestHeader("Content-Type", "multipart/form-data");
                xhr.send(request.data);
            }
            function onReadyStateChange() {
                if (xhr.readyState == 4) {
                    if (xhr.status != loader._status) {
                        loader._status = xhr.status;
                        egret.HTTPStatusEvent.dispatchHTTPStatusEvent(loader, xhr.status);
                    }
                    if (xhr.status >= 400 || xhr.status == 0) {
                        egret.IOErrorEvent.dispatchIOErrorEvent(loader);
                    }
                    else {
                        onLoadComplete();
                    }
                }
            }
            function onLoadComplete() {
                switch (loader.dataFormat) {
                    case egret.URLLoaderDataFormat.TEXT:
                        loader.data = xhr.responseText;
                        break;
                    case egret.URLLoaderDataFormat.VARIABLES:
                        loader.data = new egret.URLVariables(xhr.responseText);
                        break;
                    case egret.URLLoaderDataFormat.BINARY:
                        loader.data = xhr.response;
                        break;
                    default:
                        loader.data = xhr.responseText;
                        break;
                }
                egret.__callAsync(egret.Event.dispatchEvent, egret.Event, loader, egret.Event.COMPLETE);
            }
        };
        HTML5NetContext.prototype.loadSound = function (loader) {
            var request = loader._request;
            var audio = new Audio(request.url);
            audio["__timeoutId"] = window.setTimeout(soundPreloadCanplayHandler, 100);
            audio.addEventListener('canplaythrough', soundPreloadCanplayHandler, false);
            audio.addEventListener("error", soundPreloadErrorHandler, false);
            audio.load();
            function soundPreloadCanplayHandler(event) {
                window.clearTimeout(audio["__timeoutId"]);
                audio.removeEventListener('canplaythrough', soundPreloadCanplayHandler, false);
                audio.removeEventListener("error", soundPreloadErrorHandler, false);
                var sound = new egret.Sound();
                sound._setAudio(audio);
                loader.data = sound;
                egret.__callAsync(egret.Event.dispatchEvent, egret.Event, loader, egret.Event.COMPLETE);
            }
            ;
            function soundPreloadErrorHandler(event) {
                window.clearTimeout(audio["__timeoutId"]);
                audio.removeEventListener('canplaythrough', soundPreloadCanplayHandler, false);
                audio.removeEventListener("error", soundPreloadErrorHandler, false);
                egret.IOErrorEvent.dispatchIOErrorEvent(loader);
            }
            ;
        };
        //        private loadWebAudio(loader:URLLoader):void {
        //            var url:string = loader._request.url;
        //            var request = new XMLHttpRequest();
        //            request.open("GET", url, true);
        //            request.responseType = "arraybuffer";
        //            console.log("loadWebAudio");
        //            request.onload = function () {
        //                WebAudio.ctx["decodeAudioData"](request.response, onSuccessHandler, onErrorHandler);
        //            };
        //            request.send();
        //
        //            function onSuccessHandler(buffer) {
        //                var audio = new WebAudio();
        //                audio._buffer = buffer;
        //
        //                var sound = new Sound();
        //                sound._setAudio(audio);
        //                loader.data = sound;
        //                __callAsync(Event.dispatchEvent, Event, loader, Event.COMPLETE);
        //            }
        //
        //            function onErrorHandler() {
        //                IOErrorEvent.dispatchIOErrorEvent(loader);
        //            }
        //        }
        HTML5NetContext.prototype.getXHR = function () {
            if (window["XMLHttpRequest"]) {
                return new window["XMLHttpRequest"]();
            }
            else {
                return new ActiveXObject("MSXML2.XMLHTTP");
            }
        };
        HTML5NetContext.prototype.setResponseType = function (xhr, responseType) {
            switch (responseType) {
                case egret.URLLoaderDataFormat.TEXT:
                case egret.URLLoaderDataFormat.VARIABLES:
                    xhr.responseType = egret.URLLoaderDataFormat.TEXT;
                    break;
                case egret.URLLoaderDataFormat.BINARY:
                    xhr.responseType = "arraybuffer";
                    break;
                default:
                    xhr.responseType = responseType;
                    break;
            }
        };
        HTML5NetContext.prototype.loadTexture = function (loader) {
            var request = loader._request;
            var image = new Image();
            //            image.crossOrigin = "Anonymous";
            image.onload = onImageComplete;
            image.onerror = onLoadError;
            image.src = request.url;
            function onImageComplete(event) {
                image.onerror = null;
                image.onload = null;
                var texture = new egret.Texture();
                texture._setBitmapData(image);
                loader.data = texture;
                egret.__callAsync(egret.Event.dispatchEvent, egret.Event, loader, egret.Event.COMPLETE);
            }
            function onLoadError(event) {
                image.onerror = null;
                image.onload = null;
                egret.IOErrorEvent.dispatchIOErrorEvent(loader);
            }
        };
        return HTML5NetContext;
    })(egret.NetContext);
    egret.HTML5NetContext = HTML5NetContext;
    HTML5NetContext.prototype.__class__ = "egret.HTML5NetContext";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    var HTML5TouchContext = (function (_super) {
        __extends(HTML5TouchContext, _super);
        function HTML5TouchContext() {
            _super.call(this);
            this._isTouchDown = false;
            this.rootDiv = document.getElementById(egret.StageDelegate.canvas_div_name);
        }
        HTML5TouchContext.prototype.prevent = function (event) {
            event.stopPropagation();
            if (event["isScroll"] != true) {
                event.preventDefault();
            }
        };
        HTML5TouchContext.prototype.run = function () {
            var that = this;
            if (window.navigator.msPointerEnabled) {
                this.rootDiv.addEventListener("MSPointerDown", function (event) {
                    that._onTouchBegin(event);
                    that.prevent(event);
                }, false);
                this.rootDiv.addEventListener("MSPointerMove", function (event) {
                    that._onTouchMove(event);
                    that.prevent(event);
                }, false);
                this.rootDiv.addEventListener("MSPointerUp", function (event) {
                    that._onTouchEnd(event);
                    that.prevent(event);
                }, false);
            }
            else if (egret.MainContext.deviceType == egret.MainContext.DEVICE_MOBILE) {
                this.addTouchListener();
            }
            else if (egret.MainContext.deviceType == egret.MainContext.DEVICE_PC) {
                this.addTouchListener();
                this.addMouseListener();
            }
            window.addEventListener("mousedown", function (event) {
                if (!that.inOutOfCanvas(event)) {
                    that._isTouchDown = true;
                }
                else {
                    that.dispatchLeaveStageEvent();
                }
            });
            window.addEventListener("mouseup", function (event) {
                if (that._isTouchDown) {
                    if (that.inOutOfCanvas(event))
                        that.dispatchLeaveStageEvent();
                    else
                        that._onTouchEnd(event);
                }
                that._isTouchDown = false;
            });
        };
        HTML5TouchContext.prototype.addMouseListener = function () {
            var that = this;
            this.rootDiv.addEventListener("mousedown", function (event) {
                that._onTouchBegin(event);
            });
            this.rootDiv.addEventListener("mousemove", function (event) {
                that._onTouchMove(event);
            });
            this.rootDiv.addEventListener("mouseup", function (event) {
                that._onTouchEnd(event);
            });
        };
        HTML5TouchContext.prototype.addTouchListener = function () {
            var that = this;
            this.rootDiv.addEventListener("touchstart", function (event) {
                var l = event.changedTouches.length;
                for (var i = 0; i < l; i++) {
                    that._onTouchBegin(event.changedTouches[i]);
                }
                that.prevent(event);
            }, false);
            this.rootDiv.addEventListener("touchmove", function (event) {
                var l = event.changedTouches.length;
                for (var i = 0; i < l; i++) {
                    that._onTouchMove(event.changedTouches[i]);
                }
                that.prevent(event);
            }, false);
            this.rootDiv.addEventListener("touchend", function (event) {
                var l = event.changedTouches.length;
                for (var i = 0; i < l; i++) {
                    that._onTouchEnd(event.changedTouches[i]);
                }
                that.prevent(event);
            }, false);
            this.rootDiv.addEventListener("touchcancel", function (event) {
                var l = event.changedTouches.length;
                for (var i = 0; i < l; i++) {
                    that._onTouchEnd(event.changedTouches[i]);
                }
                that.prevent(event);
            }, false);
        };
        HTML5TouchContext.prototype.inOutOfCanvas = function (event) {
            var location = this.getLocation(this.rootDiv, event);
            var x = location.x, y = location.y;
            var stage = egret.MainContext.instance.stage;
            if (x < 0 || y < 0 || x > stage.stageWidth || y > stage.stageHeight) {
                return true;
            }
            return false;
        };
        HTML5TouchContext.prototype.dispatchLeaveStageEvent = function () {
            this.touchingIdentifiers.length = 0;
            egret.MainContext.instance.stage.dispatchEventWith(egret.Event.LEAVE_STAGE);
        };
        HTML5TouchContext.prototype._onTouchBegin = function (event) {
            var location = this.getLocation(this.rootDiv, event);
            var identifier = -1;
            if (event.hasOwnProperty("identifier")) {
                identifier = event.identifier;
            }
            this.onTouchBegan(location.x, location.y, identifier);
        };
        HTML5TouchContext.prototype._onTouchMove = function (event) {
            var location = this.getLocation(this.rootDiv, event);
            var identifier = -1;
            if (event.hasOwnProperty("identifier")) {
                identifier = event.identifier;
            }
            this.onTouchMove(location.x, location.y, identifier);
        };
        HTML5TouchContext.prototype._onTouchEnd = function (event) {
            var location = this.getLocation(this.rootDiv, event);
            var identifier = -1;
            if (event.hasOwnProperty("identifier")) {
                identifier = event.identifier;
            }
            this.onTouchEnd(location.x, location.y, identifier);
        };
        HTML5TouchContext.prototype.getLocation = function (rootDiv, event) {
            var doc = document.documentElement;
            var win = window;
            var left, top, tx, ty;
            if (typeof rootDiv.getBoundingClientRect === 'function') {
                var box = rootDiv.getBoundingClientRect();
                left = box.left;
                top = box.top;
            }
            else {
                left = 0;
                top = 0;
            }
            left += win.pageXOffset - doc.clientLeft;
            top += win.pageYOffset - doc.clientTop;
            if (event.pageX != null) {
                tx = event.pageX;
                ty = event.pageY;
            }
            else {
                left -= document.body.scrollLeft;
                top -= document.body.scrollTop;
                tx = event.clientX;
                ty = event.clientY;
            }
            var result = egret.Point.identity;
            result.x = (tx - left) / egret.StageDelegate.getInstance().getScaleX();
            result.y = (ty - top) / egret.StageDelegate.getInstance().getScaleY();
            return result;
        };
        return HTML5TouchContext;
    })(egret.TouchContext);
    egret.HTML5TouchContext = HTML5TouchContext;
    HTML5TouchContext.prototype.__class__ = "egret.HTML5TouchContext";
})(egret || (egret = {}));
/**
 * Copyright (c) 2014,Egret-Labs.org
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Egret-Labs.org nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY EGRET-LABS.ORG AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL EGRET-LABS.ORG AND CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var egret;
(function (egret) {
    /**
     * @classdesc
     * @extends egret.StageText
     * @private
     */
    var HTML5StageText = (function (_super) {
        __extends(HTML5StageText, _super);
        function HTML5StageText() {
            _super.call(this);
            this._hasListeners = false;
            this._inputType = "";
            this._isShow = false;
            this.textValue = "";
            this._width = 0;
            this._height = 0;
            this._styleInfoes = {};
            var scaleX = egret.StageDelegate.getInstance().getScaleX();
            var scaleY = egret.StageDelegate.getInstance().getScaleY();
            var div = egret.Browser.getInstance().$new("div");
            div.position.x = 0;
            div.position.y = 0;
            div.scale.x = scaleX;
            div.scale.y = scaleY;
            div.transforms();
            div.style[egret_dom.getTrans("transformOrigin")] = "0% 0% 0px";
            this.div = div;
            var stage = egret.MainContext.instance.stage;
            var stageWidth = stage.stageWidth;
            var stageHeight = stage.stageHeight;
            var shape = new egret.Shape();
            //            shape.graphics.beginFill(0x000000, .3);
            //            shape.graphics.drawRect(0, 0, stageWidth, stageHeight);
            //            shape.graphics.endFill();
            shape.width = stageWidth;
            shape.height = stageHeight;
            shape.touchEnabled = true;
            this._shape = shape;
            this.getStageDelegateDiv().appendChild(this.div);
        }
        HTML5StageText.prototype.getStageDelegateDiv = function () {
            var stageDelegateDiv = egret.Browser.getInstance().$("#StageDelegateDiv");
            if (!stageDelegateDiv) {
                stageDelegateDiv = egret.Browser.getInstance().$new("div");
                stageDelegateDiv.id = "StageDelegateDiv";
                //                stageDelegateDiv.style.position = "absolute";
                var container = document.getElementById(egret.StageDelegate.canvas_div_name);
                container.appendChild(stageDelegateDiv);
                stageDelegateDiv.transforms();
            }
            return stageDelegateDiv;
        };
        HTML5StageText.prototype._setMultiline = function (value) {
            _super.prototype._setMultiline.call(this, value);
            this.createInput();
        };
        HTML5StageText.prototype.callHandler = function (e) {
            e.stopPropagation();
        };
        HTML5StageText.prototype._add = function () {
            if (this.div && this.div.parentNode == null) {
                this.getStageDelegateDiv().appendChild(this.div);
            }
        };
        HTML5StageText.prototype._remove = function () {
            if (this._shape && this._shape.parent) {
                this._shape.parent.removeChild(this._shape);
            }
            if (this.div && this.div.parentNode) {
                this.div.parentNode.removeChild(this.div);
            }
        };
        HTML5StageText.prototype._addListeners = function () {
            if (this.inputElement && !this._hasListeners) {
                this._hasListeners = true;
                this.inputElement.addEventListener("mousedown", this.callHandler);
                this.inputElement.addEventListener("touchstart", this.callHandler);
                this.inputElement.addEventListener("MSPointerDown", this.callHandler);
            }
        };
        HTML5StageText.prototype._removeListeners = function () {
            if (this.inputElement && this._hasListeners) {
                this._hasListeners = false;
                this.inputElement.removeEventListener("mousedown", this.callHandler);
                this.inputElement.removeEventListener("touchstart", this.callHandler);
                this.inputElement.removeEventListener("MSPointerDown", this.callHandler);
            }
        };
        HTML5StageText.prototype.createInput = function () {
            var type = this._multiline ? "textarea" : "input";
            if (this._inputType == type) {
                return;
            }
            this._inputType = type;
            if (this.inputElement != null) {
                this._removeListeners();
                this.div.removeChild(this.inputElement);
            }
            if (this._multiline) {
                var inputElement = document.createElement("textarea");
                inputElement.style["resize"] = "none";
            }
            else {
                inputElement = document.createElement("input");
            }
            this._styleInfoes = {};
            inputElement.type = "text";
            this.inputElement = inputElement;
            this.inputElement.value = "";
            this.div.appendChild(inputElement);
            this._addListeners();
            this.setElementStyle("width", 0 + "px");
            //默认值
            this.setElementStyle("border", "none");
            this.setElementStyle("margin", "0");
            this.setElementStyle("padding", "0");
            this.setElementStyle("outline", "medium");
            this.setElementStyle("verticalAlign", "top");
            this.setElementStyle("wordBreak", "break-all");
            this.setElementStyle("overflow", "hidden");
        };
        HTML5StageText.prototype._open = function (x, y, width, height) {
            if (width === void 0) { width = 160; }
            if (height === void 0) { height = 21; }
        };
        HTML5StageText.prototype._setScale = function (x, y) {
            _super.prototype._setScale.call(this, x, y);
            var scaleX = egret.StageDelegate.getInstance().getScaleX();
            var scaleY = egret.StageDelegate.getInstance().getScaleY();
            this.div.scale.x = scaleX * x;
            this.div.scale.y = scaleY * y;
            this.div.transforms();
        };
        HTML5StageText.prototype.changePosition = function (x, y) {
            //            if (this._isShow) {
            var scaleX = egret.StageDelegate.getInstance().getScaleX();
            var scaleY = egret.StageDelegate.getInstance().getScaleY();
            this.div.position.x = x * scaleX;
            this.div.position.y = y * scaleY;
            this.div.transforms();
            //            }
        };
        HTML5StageText.prototype.setStyles = function () {
            //修改属性
            this.setElementStyle("fontStyle", this._italic ? "italic" : "normal");
            this.setElementStyle("fontWeight", this._bold ? "bold" : "normal");
            this.setElementStyle("textAlign", this._textAlign);
            this.setElementStyle("fontSize", this._size + "px");
            this.setElementStyle("color", "#000000");
            this.setElementStyle("width", this._width + "px");
            //            if (this._multiline) {
            this.setElementStyle("height", this._height + "px");
            //            }
            this.setElementStyle("border", "1px solid red");
            this.setElementStyle("display", "block");
        };
        HTML5StageText.prototype._show = function () {
            if (this._maxChars > 0) {
                this.inputElement.setAttribute("maxlength", this._maxChars);
            }
            else {
                this.inputElement.removeAttribute("maxlength");
            }
            this._isShow = true;
            //打开
            var txt = this._getText();
            this.inputElement.value = txt;
            var self = this;
            this.inputElement.oninput = function () {
                self.textValue = self.inputElement.value;
                self.dispatchEvent(new egret.Event("updateText"));
            };
            this.setStyles();
            this.inputElement.focus();
            //            if (this._multiline) {
            this.inputElement.selectionStart = txt.length;
            this.inputElement.selectionEnd = txt.length;
            //            }
            if (this._shape && this._shape.parent == null) {
                egret.MainContext.instance.stage.addChild(this._shape);
            }
        };
        HTML5StageText.prototype._hide = function () {
            if (this.inputElement == null) {
                return;
            }
            this._isShow = false;
            this.inputElement.oninput = function () {
            };
            this.setElementStyle("border", "none");
            this.setElementStyle("display", "none");
            //关闭
            this.inputElement.value = "";
            this.setElementStyle("width", 0 + "px");
            window.scrollTo(0, 0);
            var self = this;
            egret.setTimeout(function () {
                self.inputElement.blur();
                window.scrollTo(0, 0);
            }, this, 50);
            if (this._shape && this._shape.parent) {
                this._shape.parent.removeChild(this._shape);
            }
        };
        HTML5StageText.prototype._getText = function () {
            if (!this.textValue) {
                this.textValue = "";
            }
            return this.textValue;
        };
        HTML5StageText.prototype._setText = function (value) {
            this.textValue = value;
            this.resetText();
        };
        HTML5StageText.prototype.resetText = function () {
            if (this.inputElement) {
                this.inputElement.value = this.textValue;
            }
        };
        HTML5StageText.prototype._setWidth = function (value) {
            this._width = value;
        };
        HTML5StageText.prototype._setHeight = function (value) {
            this._height = value;
        };
        HTML5StageText.prototype.setElementStyle = function (style, value) {
            if (this.inputElement) {
                if (this._styleInfoes[style] != value) {
                    this.inputElement.style[style] = value;
                    this._styleInfoes[style] = value;
                }
            }
        };
        return HTML5StageText;
    })(egret.StageText);
    egret.HTML5StageText = HTML5StageText;
    HTML5StageText.prototype.__class__ = "egret.HTML5StageText";
})(egret || (egret = {}));
egret.StageText.create = function () {
    return new egret.HTML5StageText();
};
